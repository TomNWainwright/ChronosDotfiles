var namespace = {
    addon: {},
    attach: {},
    backend: {},
    bg: {
        task: {}
    },
    cb: {},
    cloud: {},
    crawling: {},
    cs: {},
    files: {},
    fg: {},
    format: {},
    iframe: {},
    library: {},
    pdf: {},
    plugin: {},
    pop: {},
    guru: {
        crawling: {},
        db: {},
        format: {},
        deduplication: {}
    },
    scratch: {},
    target: {},
    test: {},
    upload: {},
    webimport: {},
    wizard: {},
    write: {}
};

function isBrowserEnvironment() {
    return typeof window === "object" && typeof window.document === "object" && !isNodeEnvironment();
}

function isNodeEnvironment() {
    return typeof module == "object" && module && typeof module.exports === "object";
}

function isChromeEnvironment() {
    return typeof window === "object" && typeof window.chrome === "object";
}

if (isNodeEnvironment()) {
    var PP = namespace;
    PP.ent = require("ent");
    module.exports = PP;
}

if (!isBrowserEnvironment()) {
    var window = {};
    if (!global.isPaperpileCiteServerInstance) {
        var $ = require("cheerio");
        $.prototype.filterNode = function(a) {
            var b = a.toLowerCase();
            return this.find("*").filter(function() {
                var a = this.name.toLowerCase();
                return a === b;
            });
        };
        var $xmlNodeJs = $.load("XMLSTRING", {
            xmlMode: true
        });
        var xhrc = require("xmlhttprequest-cookie");
        var XMLHttpRequest = xhrc.XMLHttpRequest;
        var CookieJar = xhrc.CookieJar;
        var userAgent = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36";
    }
}

if (window.ppAlreadyExists === undefined) {
    window.ppAlreadyExists = false;
}

if (window.PP) {
    console.log("window.PP already exists -- not loading singletons");
    window.ppAlreadyExists = true;
} else {
    window.PP = namespace;
    var PP = window.PP;
}

if (window.document) {
    var runningNode = document.getElementById("pp-extension-running");
    if (runningNode) {
        window.extensionExists = true;
    }
}

if (window.isWorker) {
    var PP = namespace;
}

var extV = "344";

var webappV = "344";

var urlBase = "https://paperpile.com";

var placeholderRegex = /^__PP_/;

if (extV.match(placeholderRegex) && webappV.match(placeholderRegex)) {
    window.PP_EXTENSION_VERSION = 0;
    window.PP_WEBAPP_VERSION = 0;
    window.PP_URL_BASE = "http://127.0.0.1:8080";
} else {
    window.PP_EXTENSION_VERSION = extV;
    window.PP_WEBAPP_VERSION = webappV;
    window.PP_URL_BASE = urlBase;
}

if (typeof require !== "undefined" && typeof module !== "undefined" && "exports" in module) {
    module.exports = PP;
} else {
    if (!window.isWorker) {}
}

if (!window.ppAlreadyExists && window.$) {
    $.fn.filterNode = function(a) {
        var b = a.toLowerCase();
        return this.find("*").filter(function() {
            var a = this.nodeName.toLowerCase();
            return a === b;
        });
    };
}

function createSingleton(a, b, c) {
    if (isBrowserEnvironment()) {
        if (window.ppAlreadyExists === true && window.doNotClobber === true) {
            return;
        }
    }
    a[c] = new a[b]();
}

PP.Ajax = {
    request: function(a) {
        var b = this;
        if (window.plackSession) {
            var c = PP.Utils.getCookie("plack_session");
            if (window.plackSession !== c) {
                window.plackSession = null;
                PP.log({
                    type: "exception",
                    subtype: "Sanitation",
                    msg: "Plack session mismatch",
                    session_user_id: PP.Session.user_id
                });
            }
        }
        var d = {
            url: a.url,
            data: a.params,
            type: "GET"
        };
        var e = PP.Utils.clone(a);
        var f = a.callback;
        delete a.callback;
        var g = 0;
        if (a.delay) {
            g = a.delay;
        }
        var h = 0;
        if (a.maxRetries !== undefined) {
            h = a.maxRetries;
        }
        var i = 0;
        if (a.curRetryCount === undefined) {
            a.curRetryCount = 0;
        } else {
            i = a.curRetryCount;
        }
        if (a.timeout) {
            d.timeout = a.timeout;
        }
        if (a.dataType) {
            d.dataType = a.dataType;
        }
        if (a.cache === false) {
            d.cache = false;
        }
        if (a.method) {
            d.type = a.method;
        }
        if (a.oauth) {
            var j = d.url;
            var k = d.type;
            var l = d.data;
            var m = a.oauth.signURL(j, k, l);
            if (m != j) {
                d.url = m;
                delete d.data;
            }
            if (a.oauth && a.oauth["addHeaders"]) {
                a.oauth.addHeaders(a);
            }
        }
        if (a.accessToken) {
            if (!a.headers) {
                a.headers = {};
            }
            a.headers["Authorization"] = "Bearer " + a.accessToken;
        }
        if (a.headers) {
            d.beforeSend = function(b, c) {
                b.origUrl = c.url;
                for (var d in a.headers) {
                    if (a.headers.hasOwnProperty(d)) {
                        b.setRequestHeader(d, a.headers[d]);
                    }
                }
            };
        } else {
            d.beforeSend = function(a, b) {
                a.origUrl = b.url;
            };
        }
        if (a.scope) {
            d.context = a.scope;
        }
        if (a.progress && isBrowserEnvironment()) {
            var n = a.progress;
            delete a.progress;
            d.xhr = function() {
                var a = new window.XMLHttpRequest();
                a.addEventListener("progress", function(a) {
                    if (a.lengthComputable) {
                        var b = a.loaded / a.total;
                        n(b);
                    }
                }, false);
                return a;
            };
        }
        d.async = true;
        var o = {
            url: a.url,
            urlHistory: [ a.url ]
        };
        var p;
        var q;
        if (a.requestListenFn) {
            q = a.requestListenFn;
            if (window && window.chrome && window.chrome.webRequest) {
                chrome.webRequest.onBeforeRequest.addListener(q, {
                    urls: [ "<all_urls>" ]
                });
            }
        }
        if (a.trackRedirects && isChromeEnvironment() && window.chrome.webRequest) {
            p = function(b) {
                var c = window.unescape(b.url);
                if (o.url === c || o.url === b.url) {
                    var d = PP.Utils.ellipsis(b.url, 30, null, "...");
                    var e = PP.Utils.ellipsis(b.redirectUrl, 30, null, "...");
                    console.log(a.logPrefix || "", "found redirect URL", d, "->", e);
                    o.urlHistory.push(b.redirectUrl);
                    o.url = b.redirectUrl;
                }
            };
            chrome.webRequest.onBeforeRedirect.addListener(p, {
                urls: [ "<all_urls>" ]
            });
        }
        var r;
        if (a.loadingMessage && isBrowserEnvironment()) {
            var s = a.loadingMessageDelay || 1e3;
            r = window.setTimeout(function() {
                a.loadingMessageObject = PP.backend.Utils.showLoadingMessage(a.loadingMessage);
            }, s);
        }
        if (typeof jQuery != "undefined") {
            jQuery.support.cors = true;
        }
        var t = function() {
            var c = new Date().getTime();
            var g = function(d, g, k) {
                var l;
                var m = new Date().getTime();
                if (p && isChromeEnvironment()) {
                    if (window.chrome.webRequest) {
                        chrome.webRequest.onBeforeRedirect.removeListener(p);
                    }
                }
                if (q && isChromeEnvironment()) {
                    if (window.chrome.webRequest) {
                        chrome.webRequest.onBeforeRequest.removeListener(q);
                    }
                }
                if (isBrowserEnvironment()) {
                    if (o.url !== a.url) {
                        j.redirectUrl = [ o.url ];
                    }
                    if (o.urlHistory) {
                        j.redirectHistory = o.urlHistory;
                    }
                    if (a.trackRedirects) {
                        if ((g === "parsererror" || g === "success") && !("redirectUrl" in j)) {
                            var n = [];
                            if (g === "success") {
                                n = b.getRedirectUrlFromBody(a.url, j.responseText, a.purpose);
                            } else {
                                n = b.getRedirectUrlFromBody(a.url, j.responseText, a.purpose);
                            }
                            if (n.length > 0) {
                                j.redirectUrl = n;
                            }
                        } else if (g === "success" && "redirectUrl" in j && j.redirectUrl[0]) {
                            var s = b.getRedirectUrlFromBody(j.redirectUrl[0], j.responseText, a.purpose);
                            if (s.length > 0) {
                                j.redirectUrl = s;
                            }
                        }
                    }
                }
                if (r !== undefined) {
                    clearTimeout(r);
                    PP.backend.Utils.clearLoadingMessage(a.loadingMessageObject);
                    delete a.loadingMessageObject;
                }
                if (g === "success") {
                    var t = 5e3;
                    var u = 1e4;
                    var v = m - c;
                    var w = true;
                    var x = "";
                    if (a.params && a.params.query) {
                        var y = a.params.query;
                        var z = JSON.parse(y);
                        x = z.action;
                        if (z.mcollection) {
                            if (z.mcollection === "Logs") {
                                w = false;
                            }
                            x += "/" + z.mcollection;
                        }
                    }
                    var A = a.url;
                    if (PP.Ajax.isPaperpileAjax(a.url)) {
                        A = A.replace(/https?:\/\/(127.0.0.1:8080|paperpile.com|stage.paperpile.com)\//, "");
                        A = A.replace(/\?.*$/, "");
                    } else {
                        if (a.logTiming !== true) {
                            w = false;
                        }
                        A = PP.Utils.getDomainSuffix(a.url);
                    }
                    if (w) {
                        var B = .5;
                        if (PP.Ajax.isPaperpileAjax(a.url)) {
                            if (PP.Globals.isBackgroundPage()) {
                                B = .1;
                            }
                            if (x && x.match(/update\/library/i)) {
                                B = .1;
                            }
                        }
                        if (Math.random() < B) {
                            var C = a.url;
                            var D = C.split("?");
                            if (D.length > 1) {
                                C = D[0];
                            }
                            var E = PP.Ajax.isPaperpileAjax(a.url);
                            var F = E ? "Paperpile" : "Non-Paperpile";
                            if (typeof PP.backend.Logs != "undefined") {
                                PP.backend.Logs.googleAnalytics({
                                    timingOnly: true,
                                    type: F,
                                    subtype: x || A,
                                    msg: C,
                                    duration: v
                                });
                            }
                        }
                    }
                    if (PP.Ajax.isPaperpileAjax(a.url) && v > t) {
                        var G = x;
                        if (G == "") {
                            G = A;
                        }
                        var H = true;
                        if (G == "insert/Logs") {
                            H = false;
                        }
                        if (H) {
                            if (typeof PP.log == "function") {
                                PP.log({
                                    type: "performance",
                                    subtype: "Paperpile Ajax",
                                    msg: "Slow request at " + G,
                                    url: a.url,
                                    start: c,
                                    end: m,
                                    duration: v
                                });
                            }
                        }
                    } else if (v > u) {
                        if (typeof PP.log == "function") {
                            PP.log({
                                type: "performance",
                                subtype: "Other Ajax",
                                msg: "Slow request at " + A,
                                url: a.url,
                                start: c,
                                end: m,
                                duration: v
                            });
                        }
                    }
                    PP.Utils.callback(f, a.scope || j, [ d, g, k ]);
                } else {
                    if (g === "error" && d.status === 401 && PP.Ajax.isPaperpileAjax(a.url)) {
                        if (PP.bg.LoginState) {
                            PP.bg.LoginState.setLoggedOut();
                        }
                        if (PP.Globals.isWebApp() || PP.Globals.isBackgroundPage()) {
                            if (!(a.params && a.params.query && a.params.query.match('"mcollection":"Logs"'))) {
                                PP.Utils.createErrorStatus("You need to sign in again", [ "STATUS_PANEL_SIGN_IN" ]);
                            }
                        }
                        PP.Utils.callback(f, a.scope || j, [ d.responseText, g, d ]);
                        return;
                    }
                    if (g === "timeout") {
                        if (typeof PP.log == "function") {
                            PP.log({
                                type: "performance",
                                subtype: "Ajax timeout",
                                msg: "URL timed out: " + a.url,
                                url: a.url,
                                start: c,
                                end: m,
                                duration: v
                            });
                        }
                        if (h > 0 && i < h) {
                            if (typeof PP.log == "function") {
                                PP.log({
                                    type: "performance",
                                    subtype: "Ajax timeout -> retry",
                                    msg: "Timeout retry (" + i + " of " + h + ") for URL: " + a.url,
                                    url: a.url,
                                    start: c,
                                    end: m,
                                    duration: v
                                });
                            }
                            e.curRetryCount = i + 1;
                            PP.Utils.defer(function() {
                                b.request(e);
                            }, 20);
                        }
                        PP.Utils.callback(f, a.scope || j, [ d.responseText, g, d ]);
                        return;
                    }
                    if (PP.Ajax.isPaperpileAjax(a.url) && a.noErrorStatusPanel !== true && g !== "abort" && isBrowserEnvironment()) {
                        var I = true;
                        var J = true;
                        var K = "there was an error on our server.";
                        var L = [ "STATUS_PANEL_RELOAD_WEBAPP" ];
                        if (d.status === 503) {
                            K = "the Paperpile servers are currently unavailable.";
                            L = [ "STATUS_PANEL_VISIT_TWITTER" ];
                        } else if (d.responseText && d.responseText.match(/error/g)) {
                            var z = JSON.parse(d.responseText);
                            if (z && z.error) {
                                var M = z.error;
                                if (M && M.type && !M.type.match(/unknown/gi)) {
                                    K = 'The server responded with an error "' + M.msg + '"';
                                    if (M.actions) {
                                        L = z.error.actions;
                                    }
                                    J = false;
                                }
                            }
                        } else if (d.status === 0 && d.responseText == "") {
                            J = true;
                            I = false;
                            if (PP.Globals.isBackgroundPage() && !a.url.match(/ping/i)) {
                                PP.bg.LoginState.pingServer();
                            }
                        }
                        if (PP.Globals.isWebApp()) {
                            if (!a.url.match(/ping/i)) {
                                var N = Paperpile.Globals.grid();
                                if (N) {
                                    var O = N.store;
                                    if (O.updateFilterViewTimeout) {
                                        clearTimeout(O.updateFilterViewTimeout);
                                    }
                                }
                                if (I) {
                                    PP.Utils.createErrorStatus(K, L);
                                }
                                if (J) {
                                    PP.fg.ServerState.badResponseCheck();
                                }
                            }
                        } else {
                            if (I) {
                                PP.Utils.createErrorStatus(K, L);
                            }
                        }
                    }
                    PP.Utils.callback(f, a.scope || j, [ d.responseText, g, d ]);
                }
            };
            nodeRequest = function(a, c) {
                a.method = c.type;
                if (a.hasOwnProperty("beforeSend")) {
                    if (c.headers) {
                        for (var d in c.headers) {
                            if (c.headers.hasOwnProperty(d)) {
                                if (a.hasOwnProperty("headers")) {
                                    a.headers[d] = c.headers[d];
                                } else {
                                    a.headers = {
                                        key: c.headers[d]
                                    };
                                }
                            }
                        }
                    }
                }
                var e = new URI(c.url);
                var f = e.getQuery() || "";
                if ("params" in c) {
                    Object.keys(c.params).forEach(function(a) {
                        if (a == "action") return;
                        if (f.length) f += "&";
                        f += encodeURIComponent(a) + "=" + encodeURIComponent(c.params[a]);
                    });
                    e.setQuery(f);
                    c.url = e.toString();
                }
                var h = new XMLHttpRequest();
                h.open(a.type, c.url, true);
                if (c.headers) {
                    Object.keys(c.headers).forEach(function(a) {
                        h.replaceRequestHeader(a, c.headers[a]);
                    });
                }
                h.replaceRequestHeader("User-Agent", userAgent);
                h.onload = function() {
                    if (c.trackRedirects && c.url !== h.responseUrl) {
                        h.origUrl = c.url;
                        h.redirectUrl = h.responseUrl;
                        h.redirectHistory = [ c.url, h.responseUrl ];
                    } else if (c.trackRedirects) {
                        var a = b.getRedirectUrlFromBody(c.url, h.responseText, c.purpose);
                        if (a.length) {
                            h.origUrl = c.url;
                            h.redirectUrl = a[0];
                            h.redirectHistory = [ c.url, a[0] ];
                        }
                    }
                    if (h.status >= 200 && h.status < 400) {
                        var d = h.getResponseHeader("Content-Type");
                        if (d && d.indexOf("application/json") > -1) {
                            var e;
                            try {
                                e = JSON.parse(h.responseText);
                            } catch (a) {
                                e = false;
                            }
                            if (e) h.responseText = e;
                        }
                        if (c.hasOwnProperty("scope") && c.scope) {
                            g.bind(c.scope)(h.responseText, "success", h);
                        } else {
                            g(h.responseText, "success", h);
                        }
                    } else {
                        g(h, "error", null);
                    }
                };
                h.onerror = function() {
                    console.log("Request failed", h.statusText);
                    g(h, "error", null);
                };
                if (a.type == "POST" && f && c.url.indexOf("base-search.net") > -1) {
                    h.replaceRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
                    h.send(f);
                } else {
                    h.send();
                }
            };
            if (isBrowserEnvironment()) {
                var j = $.ajax(d);
                j.always(g);
                return j;
            } else {
                return nodeRequest(d, a);
            }
        };
        if (g > 0) {
            var u = PP.Utils.defer(t, g);
            var v = {
                isFakeXhr: true,
                abort: function() {
                    clearTimeout(u);
                    var b = {
                        status: -1
                    };
                    PP.Utils.callback(f, a.scope, [ null, "aborted", b ]);
                }
            };
            return v;
        } else {
            return t();
        }
    },
    followRedirects: function(a, b) {
        var c = this;
        var d = {
            initiatingUrl: a,
            requestId: null,
            jqXhr: null,
            urls: []
        };
        var e = function(a) {
            var b = a.url;
            if (b === d.initiatingUrl) {
                d.requestId = a.requestId;
            } else {
                if (a.requestId !== d.requestId) {
                    return;
                }
            }
            d.urls.push(b);
            if (!PP.Ajax.isRedirectUrl(b)) {
                d.jqXhr.abort();
            }
        };
        var c = this;
        var f = function(a) {
            d.jqXhr = PP.Ajax.request({
                url: a,
                requestListenFn: e,
                callback: function(c, e, g) {
                    if (e === "success") {
                        var h = PP.Ajax.getRedirectUrlFromBody(a, c);
                        if (h.length > 0) {
                            d.initiatingUrl = h[0];
                            f(h[0]);
                        } else {
                            PP.Utils.callback(b, null, [ d.urls ]);
                        }
                    } else {
                        PP.Utils.callback(b, null, [ d.urls ]);
                    }
                }
            });
        };
        f(a);
    },
    isPaperpileAjax: function(a) {
        if (!a) {
            return false;
        }
        if (a.match(/ajax\/crud\/query/)) {
            return true;
        }
        if (a.match(/ajax/)) {
            return true;
        }
        return false;
    },
    getRedirectUrlFromBody: function(a, b, c) {
        var d = null;
        var e, f;
        if (a.match(/.*readcube.com\/articles\/(10\..*)/i)) {
            return [ "http://dx.doi.org/" + RegExp.$1 ];
        }
        if (b && PP.Utils.isString(b)) {
            if (a.match(/pt.wkhealth.com\/pt\/re\/lwwgateway\/landingpage/)) {
                d = b.match(/OvidAN\s*=\s*'([^\']+)'/);
                if (d && d[1]) {
                    var g = "http://ovidsp.ovid.com/ovidweb.cgi?T=JS&MODE=ovid&NEWS=n&PAGE=fulltext&D=ovft&SEARCH=" + d[1] + ".an.";
                    var h = "http://content.wkhealth.com/linkback/openurl?an=" + d[1];
                    return [ g, h ];
                }
            }
            if (b.match(/EZproxyCheckBack/)) {
                d = b.match(/location.href\s*=\s*"([^\"]+)"/);
                if (d && d[1]) {
                    return [ d[1] ];
                }
            }
            if (a.match(/fulltext\.do/i)) {
                if (b.match(/^http/)) {
                    return [ b ];
                }
            }
            if (a.match(/nature\.com\/doifinder/i)) {
                d = b.match(/href="([^\"]+)"\s+class="articletext"/);
                if (d && d[1]) {
                    return [ "http://www.nature.com" + d[1] ];
                }
            }
            if (a.match(/linkinghub\.elsevier\.com/)) {
                d = b.match(/name=\"urls\[\'sd\'\]\"\s+value=\"(http:\/\/www.sciencedirect.com\/[^\"]+)\"/);
                if (d && d[1]) {
                    return [ d[1] ];
                } else {
                    d = b.match(/name=\"redirectURL\"\s+value=\"([^\"]+)\"/);
                    if (d && d[1]) {
                        return [ d[1].replace(/\?_returnURL=.*/, "") ];
                    }
                }
            }
            if (b.match(/googleJavaScriptRedirect/i)) {
                d = b.match(/URL='(.*?)'/);
                if (d && d[1]) {
                    return [ d[1] ];
                }
            }
            if (b.match(/http-equiv="refresh"/i)) {
                d = b.match(/URL=(.*?)"/);
                if (d && d[1]) {
                    return [ d[1] ];
                }
            }
            if (a.match(/ebscohost\.com\/plink/i)) {
                d = b.match(/window\.location\.replace\('([^']+)'\)/);
                if (d && d[1]) {
                    e = new URI(d[1]);
                    return [ e.resolve(new URI(a)).toString() ];
                }
            }
            if (a.match(/heinonline\.org\/hol/i) || a.match(/heinonline\.org\/hol\/printrequest/i)) {
                d = b.match(/window\.location\s*=\s*"([^"]+)/);
                if (d && d[1]) {
                    e = new URI(d[1]);
                    return [ e.resolve(new URI(a)).toString() ];
                }
            }
            if (a.match(/ncbi\.nlm\.nih\.gov\/pubmed/i) && c === "PDF") {
                d = b.match(/Full text links[^=]+="([^"]+)"/i);
                if (d && d[1]) {
                    e = new URI(d[1].replace(/&amp;/g, "&"));
                    return [ e.resolve(new URI(a)).toString() ];
                }
            }
            if (a.match(/sfx\./i) || a.match(/sfxit\./i) || a.match(/sfxhosted\./i) || a.match(/exlibrisgroup\.com\S+openurl/i) || a.match(/exlibrisgroup\.com\S+uresolver/i)) {
                f = new PP.crawling.LinkResolver({
                    url: a,
                    text: b
                });
                return f.sfx();
            }
            if (a.match(/search\.serialssolutions\.com/i) && !a.match(/vb3lk7eb4t\./)) {
                f = new PP.crawling.LinkResolver({
                    url: a,
                    text: b
                });
                return f.serialsSolutions();
            }
            if (a.match(/\.on\.worldcat\.org/i)) {
                d = b.match(/a\s+class="fullTextLink"\s+href="([^"]+)/);
                if (d && d[1]) {
                    return [ d[1] ];
                }
            }
        }
        return [];
    },
    isRedirectUrl: function(a, b) {
        var c = [ "bit\\.ly/", "doi\\.wiley\\.com\\/", "doi\\.acm\\.org\\/", "doi\\.org\\/[a-z:]*10\\.", "dx\\.plos\\.org\\/", "entrez\\/eutils\\/elink\\.fcgi", "f1000r\\.es\\/", "feeds\\.plos\\.org\\/~r", "feeds\\.nature\\.com\\/~r", "ff\\.im\\/", "fulltext\\.do", "goo\\.gl\\/", "google\\.com\\/url\\?", "is\\.gd\\/", "agu\\.org\\/pubs\\/crossref", "japanlinkcenter\\.org", "worldscinet\\.com", "joi\\.jlc\\.jst\\.go\\.jp\\/jst\\.jstage\\/expanim\\/", "joi\\.jlc\\.jst\\.go\\.jp\\/dn", "linkinghub\\.elsevier\\.com\\/", "nature\\.com\\/doifinder\\/", "nyti\\.ms\\/", "ow\\.ly\\/", "shar\\.es\\/", "t\\.co\\/", "tinyurl\\.com\\/", "openurl\\.ingenta\\.com\\/", "\\/xflink\\?", "\\/cgi\\/doi\\/", "\\/cgi\\/pmidlookup\\?", "\\/lookup\\/", "\\/resolve\\/", "readcube\\.com\\/articles\\/", "nature\\.com\\/(embo|msb)", "ovidsp\\.tx\\.ovid\\.com.+pdflink=", "emeraldinsight\\.com.*(articleid|contentid|chapterid)=", "landesbioscience\\.com", "hdl\\.handle\\.net\\/", "springerlink\\.metapress\\.com\\/", "mendeley.com\\/files\\/.*", "opticsinfobase\\.org", "icevirtuallibrary\\.com\\/content\\/", "envplan\\.com", "perceptionweb\\.com", "hthpweb\\.com", "summon\\.serialssolutions\\.com\\/2\\.0\\.0\\/link", "maneyonline\\.com", "palgrave-journals\\.com\\/", "link\\.aps\\.org\\/", "ascopubs\\.org\\/content", "medphys\\.org", "asadl\\.org", "avspublications\\.org", "aip\\.org", "doi\\.emh\\.ch", "palgraveconnect\\.com", "oxfordjournals\\.org", "sfx\\.\\S+\\.\\S+\\?", "sfxit\\.\\S+\\.\\S+\\?", "sfxhosted\\.\\S+\\.\\S+\\?", "exlibrisgroup\\.com\\S+openurl", "exlibrisgroup\\.com\\S+uresolver", "search\\.serialssolutions\\.com", "on\\.worldcat\\.org", "linker2\\.worldcat\\.org", "ebscohost\\.com\\/plink", "heinonline\\.org\\/hol.*men_hide" ];
        var d = [];
        var e = [ "ncbi\\.nlm\\.nih\\.gov\\/pubmed" ];
        if (PP.crawling.Proxy.isLoginUrl(a)) return true;
        a = a.toLowerCase();
        for (var f = 0; f < c.length; f++) {
            if (a.match(c[f])) {
                return true;
            }
        }
        if (b === "PDF") {
            for (var f = 0; f < e.length; f++) {
                if (a.match(e[f])) {
                    return true;
                }
            }
        }
        if (b === "META") {
            for (var f = 0; f < d.length; f++) {
                if (a.match(d[f])) {
                    return true;
                }
            }
        }
        return false;
    }
};

(function() {
    var a = Array.prototype, b = a.slice, c = "forEach" in a, d = "map" in a, e = "indexOf" in a, f = "every" in a, g = "some" in a, h = "filter" in a;
    PP.Array = {
        remove: function(a, b) {
            for (var c = 0; c < a.length; c++) {
                if (a[c] === b) {
                    a.splice(c, 1);
                    return a;
                }
            }
        },
        pluck: function(a, b) {
            var c = [], d, e, f;
            for (d = 0, e = a.length; d < e; d++) {
                f = a[d];
                c.push(f[b]);
            }
            return c;
        },
        sort: function(a, b) {
            a.sort(b);
        },
        filter: function(a, b, c) {
            return a.filter(b, c);
        },
        each: function(a, b, c) {
            return a.forEach(b, c);
        },
        map: function(a, b, c) {
            return a.map(b, c);
        },
        contains: function(a, b) {
            return a.indexOf(b) !== -1;
        },
        indexOf: function(a, b, c) {
            return a.indexOf(b, c);
        },
        merge: function() {
            var a = b.call(arguments), c = [], d, e;
            for (d = 0, e = a.length; d < e; d++) {
                c = c.concat(a[d]);
            }
            return PP.Array.unique(c);
        },
        flatten: function(a) {
            var b = [];
            function c(a) {
                var d, e, f;
                for (d = 0, e = a.length; d < e; d++) {
                    f = a[d];
                    if (PP.Utils.isArray(f)) {
                        c(f);
                    } else {
                        b.push(f);
                    }
                }
                return b;
            }
            return c(a);
        },
        stringUnique: function(a) {
            var b = {};
            var c = [];
            a.forEach(function(a) {
                if (b[a] === undefined) {
                    c.push(a);
                    b[a] = true;
                }
            });
            return c;
        },
        unique: function(a) {
            var b = [], c = 0, d = a.length, e;
            for (;c < d; c++) {
                e = a[c];
                if (PP.Array.indexOf(b, e) === -1) {
                    b.push(e);
                }
            }
            return b;
        },
        mapCounts: function(a, b, c) {
            var d = {}, e = a.length, f = undefined, g = 0;
            if (!b) {
                while (e--) {
                    f = a[e];
                    g = d[f];
                    if (g === undefined) g = 0;
                    d[f] = g + 1;
                }
            } else if (typeof b === "string") {
                while (e--) {
                    f = a[e][b];
                    g = d[f];
                    if (g === undefined) g = 0;
                    d[f] = g + 1;
                }
            } else {
                while (e--) {
                    f = b.call(c, a[e]);
                    g = d[f];
                    if (g === undefined) g = 0;
                    d[f] = g + 1;
                }
            }
            return d;
        },
        mapBoolean: function(a, b, c) {
            var d = {}, e = a.length;
            if (!b) {
                while (e--) {
                    d[a[e]] = true;
                }
            } else if (typeof b === "string") {
                while (e--) {
                    d[a[e][b]] = true;
                }
            } else {
                while (e--) {
                    d[b.call(c, a[e])] = true;
                }
            }
            return d;
        },
        toMap: function(a, b, c) {
            var d = {};
            if (a === undefined || a === null) {
                return d;
            }
            var e = a.length;
            if (!b) {
                console.log("toMap requires a getKey argument");
                return {};
            } else if (typeof b === "string") {
                while (e--) {
                    d[a[e][b]] = a[e];
                }
            } else {
                while (e--) {
                    d[b.call(c, a[e])] = a[e];
                }
            }
            return d;
        },
        batch: function(a, b) {
            var c = [];
            while (1) {
                var d = [];
                for (var e = 0; e < b; e++) {
                    var f = a.pop();
                    if (f) {
                        d.push(f);
                    } else {
                        break;
                    }
                }
                c.push(d);
                if (a.length === 0) break;
            }
            return c;
        }
    };
})();

(function() {
    var a = Object.prototype, b = a.toString, c = function() {}, d;
    PP.Utils = {
        languages: {
            aa: {
                n: [ "Afar" ],
                a3: "aar"
            },
            ab: {
                n: [ "Abkhazian" ],
                a3: "abk"
            },
            af: {
                n: [ "Afrikaans" ],
                a3: "afr"
            },
            ak: {
                n: [ "Akan" ],
                a3: "aka"
            },
            sq: {
                n: [ "Albanian" ],
                a3: "alb"
            },
            am: {
                n: [ "Amharic" ],
                a3: "amh"
            },
            ar: {
                n: [ "Arabic" ],
                a3: "ara"
            },
            an: {
                n: [ "Aragonese" ],
                a3: "arg"
            },
            hy: {
                n: [ "Armenian" ],
                a3: "arm"
            },
            as: {
                n: [ "Assamese" ],
                a3: "asm"
            },
            av: {
                n: [ "Avaric" ],
                a3: "ava"
            },
            ae: {
                n: [ "Avestan" ],
                a3: "ave"
            },
            ay: {
                n: [ "Aymara" ],
                a3: "aym"
            },
            az: {
                n: [ "Azerbaijani" ],
                a3: "aze"
            },
            ba: {
                n: [ "Bashkir" ],
                a3: "bak"
            },
            bm: {
                n: [ "Bambara" ],
                a3: "bam"
            },
            eu: {
                n: [ "Basque" ],
                a3: "baq"
            },
            be: {
                n: [ "Belarusian" ],
                a3: "bel"
            },
            bn: {
                n: [ "Bengali" ],
                a3: "ben"
            },
            bh: {
                n: [ "Bihari languages" ],
                a3: "bih"
            },
            bi: {
                n: [ "Bislama" ],
                a3: "bis"
            },
            bs: {
                n: [ "Bosnian" ],
                a3: "bos"
            },
            br: {
                n: [ "Breton" ],
                a3: "bre"
            },
            bg: {
                n: [ "Bulgarian" ],
                a3: "bul"
            },
            my: {
                n: [ "Burmese" ],
                a3: "bur"
            },
            ca: {
                n: [ "Catalan", "Valencian" ],
                a3: "cat"
            },
            ch: {
                n: [ "Chamorro" ],
                a3: "cha"
            },
            ce: {
                n: [ "Chechen" ],
                a3: "che"
            },
            zh: {
                n: [ "Chinese" ],
                a3: "chi"
            },
            cu: {
                n: [ "Church Slavic", "Old Slavonic", "Church Slavonic", "Old Bulgarian", "Old Church Slavonic" ],
                a3: "chu"
            },
            cv: {
                n: [ "Chuvash" ],
                a3: "chv"
            },
            kw: {
                n: [ "Cornish" ],
                a3: "cor"
            },
            co: {
                n: [ "Corsican" ],
                a3: "cos"
            },
            cr: {
                n: [ "Cree" ],
                a3: "cre"
            },
            cs: {
                n: [ "Czech" ],
                a3: "cze"
            },
            da: {
                n: [ "Danish" ],
                a3: "dan"
            },
            dv: {
                n: [ "Divehi", "Dhivehi", "Maldivian" ],
                a3: "div"
            },
            nl: {
                n: [ "Dutch", "Flemish" ],
                a3: "dut"
            },
            dz: {
                n: [ "Dzongkha" ],
                a3: "dzo"
            },
            en: {
                n: [ "English", "Englisch", "Inglese", "Anglais" ],
                a3: "eng"
            },
            eo: {
                n: [ "Esperanto" ],
                a3: "epo"
            },
            et: {
                n: [ "Estonian" ],
                a3: "est"
            },
            ee: {
                n: [ "Ewe" ],
                a3: "ewe"
            },
            fo: {
                n: [ "Faroese" ],
                a3: "fao"
            },
            fj: {
                n: [ "Fijian" ],
                a3: "fij"
            },
            fi: {
                n: [ "Finnish" ],
                a3: "fin"
            },
            fr: {
                n: [ "French", "Fran\xe7ais" ],
                a3: "fre"
            },
            fy: {
                n: [ "Western Frisian" ],
                a3: "fry"
            },
            ff: {
                n: [ "Fulah" ],
                a3: "ful"
            },
            ka: {
                n: [ "Georgian" ],
                a3: "geo"
            },
            de: {
                n: [ "German" ],
                a3: [ "ger", "deu" ]
            },
            gd: {
                n: [ "Gaelic", "Scottish Gaelic" ],
                a3: "gla"
            },
            ga: {
                n: [ "Irish" ],
                a3: "gle"
            },
            gl: {
                n: [ "Galician" ],
                a3: "glg"
            },
            gv: {
                n: [ "Manx" ],
                a3: "glv"
            },
            el: {
                n: [ "Greek" ],
                a3: "gre"
            },
            gn: {
                n: [ "Guarani" ],
                a3: "grn"
            },
            gu: {
                n: [ "Gujarati" ],
                a3: "guj"
            },
            ht: {
                n: [ "Haitian", "Haitian Creole" ],
                a3: "hat"
            },
            ha: {
                n: [ "Hausa" ],
                a3: "hau"
            },
            he: {
                n: [ "Hebrew" ],
                a3: "heb"
            },
            hz: {
                n: [ "Herero" ],
                a3: "her"
            },
            hi: {
                n: [ "Hindi" ],
                a3: "hin"
            },
            ho: {
                n: [ "Hiri Motu" ],
                a3: "hmo"
            },
            hr: {
                n: [ "Croatian" ],
                a3: "hrv"
            },
            hu: {
                n: [ "Hungarian" ],
                a3: "hun"
            },
            ig: {
                n: [ "Igbo" ],
                a3: "ibo"
            },
            is: {
                n: [ "Icelandic" ],
                a3: "ice"
            },
            io: {
                n: [ "Ido" ],
                a3: "ido"
            },
            ii: {
                n: [ "Sichuan Yi", "Nuosu" ],
                a3: "iii"
            },
            iu: {
                n: [ "Inuktitut" ],
                a3: "iku"
            },
            ie: {
                n: [ "Interlingue", "Occidental" ],
                a3: "ile"
            },
            id: {
                n: [ "Indonesian" ],
                a3: "ind"
            },
            ik: {
                n: [ "Inupiaq" ],
                a3: "ipk"
            },
            it: {
                n: [ "Italian", "Italiano" ],
                a3: "ita"
            },
            jv: {
                n: [ "Javanese" ],
                a3: "jav"
            },
            ja: {
                n: [ "Japanese" ],
                a3: "jpn"
            },
            kl: {
                n: [ "Kalaallisut", "Greenlandic" ],
                a3: "kal"
            },
            kn: {
                n: [ "Kannada" ],
                a3: "kan"
            },
            ks: {
                n: [ "Kashmiri" ],
                a3: "kas"
            },
            kr: {
                n: [ "Kanuri" ],
                a3: "kau"
            },
            kk: {
                n: [ "Kazakh" ],
                a3: "kaz"
            },
            km: {
                n: [ "Central Khmer" ],
                a3: "khm"
            },
            ki: {
                n: [ "Kikuyu", "Gikuyu" ],
                a3: "kik"
            },
            rw: {
                n: [ "Kinyarwanda" ],
                a3: "kin"
            },
            ky: {
                n: [ "Kirghiz", "Kyrgyz" ],
                a3: "kir"
            },
            kv: {
                n: [ "Komi" ],
                a3: "kom"
            },
            kg: {
                n: [ "Kongo" ],
                a3: "kon"
            },
            ko: {
                n: [ "Korean" ],
                a3: "kor"
            },
            kj: {
                n: [ "Kuanyama", "Kwanyama" ],
                a3: "kua"
            },
            ku: {
                n: [ "Kurdish" ],
                a3: "kur"
            },
            lo: {
                n: [ "Lao" ],
                a3: "lao"
            },
            la: {
                n: [ "Latin" ],
                a3: "lat"
            },
            lv: {
                n: [ "Latvian" ],
                a3: "lav"
            },
            li: {
                n: [ "Limburgan", "Limburger", "Limburgish" ],
                a3: "lim"
            },
            ln: {
                n: [ "Lingala" ],
                a3: "lin"
            },
            lt: {
                n: [ "Lithuanian" ],
                a3: "lit"
            },
            lb: {
                n: [ "Luxembourgish", "Letzeburgesch" ],
                a3: "ltz"
            },
            lu: {
                n: [ "Luba-Katanga" ],
                a3: "lub"
            },
            lg: {
                n: [ "Ganda" ],
                a3: "lug"
            },
            mk: {
                n: [ "Macedonian" ],
                a3: "mac"
            },
            mh: {
                n: [ "Marshallese" ],
                a3: "mah"
            },
            ml: {
                n: [ "Malayalam" ],
                a3: "mal"
            },
            mi: {
                n: [ "Maori" ],
                a3: "mao"
            },
            mr: {
                n: [ "Marathi" ],
                a3: "mar"
            },
            ms: {
                n: [ "Malay" ],
                a3: "may"
            },
            mg: {
                n: [ "Malagasy" ],
                a3: "mlg"
            },
            mt: {
                n: [ "Maltese" ],
                a3: "mlt"
            },
            mn: {
                n: [ "Mongolian" ],
                a3: "mon"
            },
            na: {
                n: [ "Nauru" ],
                a3: "nau"
            },
            nv: {
                n: [ "Navajo", "Navaho" ],
                a3: "nav"
            },
            nr: {
                n: [ "Ndebele, South", "South Ndebele" ],
                a3: "nbl"
            },
            nd: {
                n: [ "Ndebele, North", "North Ndebele" ],
                a3: "nde"
            },
            ng: {
                n: [ "Ndonga" ],
                a3: "ndo"
            },
            ne: {
                n: [ "Nepali" ],
                a3: "nep"
            },
            nn: {
                n: [ "Norwegian Nynorsk", "Nynorsk, Norwegian" ],
                a3: "nno"
            },
            nb: {
                n: [ "Bokm\xe5l, Norwegian", "Norwegian Bokm\xe5l" ],
                a3: "nob"
            },
            no: {
                n: [ "Norwegian" ],
                a3: "nor"
            },
            ny: {
                n: [ "Chichewa", "Chewa", "Nyanja" ],
                a3: "nya"
            },
            oc: {
                n: [ "Occitan", "Proven\xe7al" ],
                a3: "oci"
            },
            oj: {
                n: [ "Ojibwa" ],
                a3: "oji"
            },
            or: {
                n: [ "Oriya" ],
                a3: "ori"
            },
            om: {
                n: [ "Oromo" ],
                a3: "orm"
            },
            os: {
                n: [ "Ossetian", "Ossetic" ],
                a3: "oss"
            },
            pa: {
                n: [ "Panjabi", "Punjabi" ],
                a3: "pan"
            },
            fa: {
                n: [ "Persian" ],
                a3: "per"
            },
            pi: {
                n: [ "Pali" ],
                a3: "pli"
            },
            pl: {
                n: [ "Polish" ],
                a3: "pol"
            },
            pt: {
                n: [ "Portuguese" ],
                a3: "por"
            },
            ps: {
                n: [ "Pushto", "Pashto" ],
                a3: "pus"
            },
            qu: {
                n: [ "Quechua" ],
                a3: "que"
            },
            rm: {
                n: [ "Romansh" ],
                a3: "roh"
            },
            ro: {
                n: [ "Romanian", "Moldavian", "Moldovan" ],
                a3: "rum"
            },
            rn: {
                n: [ "Rundi" ],
                a3: "run"
            },
            ru: {
                n: [ "Russian" ],
                a3: "rus"
            },
            sg: {
                n: [ "Sango" ],
                a3: "sag"
            },
            sa: {
                n: [ "Sanskrit" ],
                a3: "san"
            },
            si: {
                n: [ "Sinhala", "Sinhalese" ],
                a3: "sin"
            },
            sk: {
                n: [ "Slovak" ],
                a3: "slo"
            },
            sl: {
                n: [ "Slovenian" ],
                a3: "slv"
            },
            se: {
                n: [ "Northern Sami" ],
                a3: "sme"
            },
            sm: {
                n: [ "Samoan" ],
                a3: "smo"
            },
            sn: {
                n: [ "Shona" ],
                a3: "sna"
            },
            sd: {
                n: [ "Sindhi" ],
                a3: "snd"
            },
            so: {
                n: [ "Somali" ],
                a3: "som"
            },
            st: {
                n: [ "Sotho, Southern" ],
                a3: "sot"
            },
            es: {
                n: [ "Spanish", "Castilian" ],
                a3: "spa"
            },
            sc: {
                n: [ "Sardinian" ],
                a3: "srd"
            },
            sr: {
                n: [ "Serbian" ],
                a3: "srp"
            },
            ss: {
                n: [ "Swati" ],
                a3: "ssw"
            },
            su: {
                n: [ "Sundanese" ],
                a3: "sun"
            },
            sw: {
                n: [ "Swahili" ],
                a3: "swa"
            },
            sv: {
                n: [ "Swedish" ],
                a3: "swe"
            },
            ty: {
                n: [ "Tahitian" ],
                a3: "tah"
            },
            ta: {
                n: [ "Tamil" ],
                a3: "tam"
            },
            tt: {
                n: [ "Tatar" ],
                a3: "tat"
            },
            te: {
                n: [ "Telugu" ],
                a3: "tel"
            },
            tg: {
                n: [ "Tajik" ],
                a3: "tgk"
            },
            tl: {
                n: [ "Tagalog" ],
                a3: "tgl"
            },
            th: {
                n: [ "Thai" ],
                a3: "tha"
            },
            bo: {
                n: [ "Tibetan" ],
                a3: "tib"
            },
            ti: {
                n: [ "Tigrinya" ],
                a3: "tir"
            },
            to: {
                n: [ "Tonga" ],
                a3: "ton"
            },
            tn: {
                n: [ "Tswana" ],
                a3: "tsn"
            },
            ts: {
                n: [ "Tsonga" ],
                a3: "tso"
            },
            tk: {
                n: [ "Turkmen" ],
                a3: "tuk"
            },
            tr: {
                n: [ "Turkish" ],
                a3: "tur"
            },
            tw: {
                n: [ "Twi" ],
                a3: "twi"
            },
            ug: {
                n: [ "Uighur", "Uyghur" ],
                a3: "uig"
            },
            uk: {
                n: [ "Ukrainian" ],
                a3: "ukr"
            },
            ur: {
                n: [ "Urdu" ],
                a3: "urd"
            },
            uz: {
                n: [ "Uzbek" ],
                a3: "uzb"
            },
            ve: {
                n: [ "Venda" ],
                a3: "ven"
            },
            vi: {
                n: [ "Vietnamese" ],
                a3: "vie"
            },
            vo: {
                n: [ "Volap\xfck" ],
                a3: "vol"
            },
            cy: {
                n: [ "Welsh" ],
                a3: "wel"
            },
            wa: {
                n: [ "Walloon" ],
                a3: "wln"
            },
            wo: {
                n: [ "Wolof" ],
                a3: "wol"
            },
            xh: {
                n: [ "Xhosa" ],
                a3: "xho"
            },
            yi: {
                n: [ "Yiddish" ],
                a3: "yid"
            },
            yo: {
                n: [ "Yoruba" ],
                a3: "yor"
            },
            za: {
                n: [ "Zhuang", "Chuang" ],
                a3: "zha"
            },
            zu: {
                n: [ "Zulu" ],
                a3: "zul"
            }
        },
        diacriticsMap: {
            A: "A",
            "\u24b6": "A",
            "\uff21": "A",
            "\xc0": "A",
            "\xc1": "A",
            "\xc2": "A",
            "\u1ea6": "A",
            "\u1ea4": "A",
            "\u1eaa": "A",
            "\u1ea8": "A",
            "\xc3": "A",
            "\u0100": "A",
            "\u0102": "A",
            "\u1eb0": "A",
            "\u1eae": "A",
            "\u1eb4": "A",
            "\u1eb2": "A",
            "\u0226": "A",
            "\u01e0": "A",
            "\xc4": "A",
            "\u01de": "A",
            "\u1ea2": "A",
            "\xc5": "A",
            "\u01fa": "A",
            "\u01cd": "A",
            "\u0200": "A",
            "\u0202": "A",
            "\u1ea0": "A",
            "\u1eac": "A",
            "\u1eb6": "A",
            "\u1e00": "A",
            "\u0104": "A",
            "\u023a": "A",
            "\u2c6f": "A",
            "\ua732": "AA",
            "\xc6": "AE",
            "\u01fc": "AE",
            "\u01e2": "AE",
            "\ua734": "AO",
            "\ua736": "AU",
            "\ua738": "AV",
            "\ua73a": "AV",
            "\ua73c": "AY",
            B: "B",
            "\u24b7": "B",
            "\uff22": "B",
            "\u1e02": "B",
            "\u1e04": "B",
            "\u1e06": "B",
            "\u0243": "B",
            "\u0182": "B",
            "\u0181": "B",
            C: "C",
            "\u24b8": "C",
            "\uff23": "C",
            "\u0106": "C",
            "\u0108": "C",
            "\u010a": "C",
            "\u010c": "C",
            "\xc7": "C",
            "\u1e08": "C",
            "\u0187": "C",
            "\u023b": "C",
            "\ua73e": "C",
            D: "D",
            "\u24b9": "D",
            "\uff24": "D",
            "\u1e0a": "D",
            "\u010e": "D",
            "\u1e0c": "D",
            "\u1e10": "D",
            "\u1e12": "D",
            "\u1e0e": "D",
            "\u0110": "D",
            "\u018b": "D",
            "\u018a": "D",
            "\u0189": "D",
            "\ua779": "D",
            "\u01f1": "DZ",
            "\u01c4": "DZ",
            "\u01f2": "Dz",
            "\u01c5": "Dz",
            E: "E",
            "\u24ba": "E",
            "\uff25": "E",
            "\xc8": "E",
            "\xc9": "E",
            "\xca": "E",
            "\u1ec0": "E",
            "\u1ebe": "E",
            "\u1ec4": "E",
            "\u1ec2": "E",
            "\u1ebc": "E",
            "\u0112": "E",
            "\u1e14": "E",
            "\u1e16": "E",
            "\u0114": "E",
            "\u0116": "E",
            "\xcb": "E",
            "\u1eba": "E",
            "\u011a": "E",
            "\u0204": "E",
            "\u0206": "E",
            "\u1eb8": "E",
            "\u1ec6": "E",
            "\u0228": "E",
            "\u1e1c": "E",
            "\u0118": "E",
            "\u1e18": "E",
            "\u1e1a": "E",
            "\u0190": "E",
            "\u018e": "E",
            F: "F",
            "\u24bb": "F",
            "\uff26": "F",
            "\u1e1e": "F",
            "\u0191": "F",
            "\ua77b": "F",
            G: "G",
            "\u24bc": "G",
            "\uff27": "G",
            "\u01f4": "G",
            "\u011c": "G",
            "\u1e20": "G",
            "\u011e": "G",
            "\u0120": "G",
            "\u01e6": "G",
            "\u0122": "G",
            "\u01e4": "G",
            "\u0193": "G",
            "\ua7a0": "G",
            "\ua77d": "G",
            "\ua77e": "G",
            H: "H",
            "\u24bd": "H",
            "\uff28": "H",
            "\u0124": "H",
            "\u1e22": "H",
            "\u1e26": "H",
            "\u021e": "H",
            "\u1e24": "H",
            "\u1e28": "H",
            "\u1e2a": "H",
            "\u0126": "H",
            "\u2c67": "H",
            "\u2c75": "H",
            "\ua78d": "H",
            I: "I",
            "\u24be": "I",
            "\uff29": "I",
            "\xcc": "I",
            "\xcd": "I",
            "\xce": "I",
            "\u0128": "I",
            "\u012a": "I",
            "\u012c": "I",
            "\u0130": "I",
            "\xcf": "I",
            "\u1e2e": "I",
            "\u1ec8": "I",
            "\u01cf": "I",
            "\u0208": "I",
            "\u020a": "I",
            "\u1eca": "I",
            "\u012e": "I",
            "\u1e2c": "I",
            "\u0197": "I",
            J: "J",
            "\u24bf": "J",
            "\uff2a": "J",
            "\u0134": "J",
            "\u0248": "J",
            K: "K",
            "\u24c0": "K",
            "\uff2b": "K",
            "\u1e30": "K",
            "\u01e8": "K",
            "\u1e32": "K",
            "\u0136": "K",
            "\u1e34": "K",
            "\u0198": "K",
            "\u2c69": "K",
            "\ua740": "K",
            "\ua742": "K",
            "\ua744": "K",
            "\ua7a2": "K",
            L: "L",
            "\u24c1": "L",
            "\uff2c": "L",
            "\u013f": "L",
            "\u0139": "L",
            "\u013d": "L",
            "\u1e36": "L",
            "\u1e38": "L",
            "\u013b": "L",
            "\u1e3c": "L",
            "\u1e3a": "L",
            "\u0141": "L",
            "\u023d": "L",
            "\u2c62": "L",
            "\u2c60": "L",
            "\ua748": "L",
            "\ua746": "L",
            "\ua780": "L",
            "\u01c7": "LJ",
            "\u01c8": "Lj",
            M: "M",
            "\u24c2": "M",
            "\uff2d": "M",
            "\u1e3e": "M",
            "\u1e40": "M",
            "\u1e42": "M",
            "\u2c6e": "M",
            "\u019c": "M",
            N: "N",
            "\u24c3": "N",
            "\uff2e": "N",
            "\u01f8": "N",
            "\u0143": "N",
            "\xd1": "N",
            "\u1e44": "N",
            "\u0147": "N",
            "\u1e46": "N",
            "\u0145": "N",
            "\u1e4a": "N",
            "\u1e48": "N",
            "\u0220": "N",
            "\u019d": "N",
            "\ua790": "N",
            "\ua7a4": "N",
            "\u01ca": "NJ",
            "\u01cb": "Nj",
            O: "O",
            "\u24c4": "O",
            "\uff2f": "O",
            "\xd2": "O",
            "\xd3": "O",
            "\xd4": "O",
            "\u1ed2": "O",
            "\u1ed0": "O",
            "\u1ed6": "O",
            "\u1ed4": "O",
            "\xd5": "O",
            "\u1e4c": "O",
            "\u022c": "O",
            "\u1e4e": "O",
            "\u014c": "O",
            "\u1e50": "O",
            "\u1e52": "O",
            "\u014e": "O",
            "\u022e": "O",
            "\u0230": "O",
            "\xd6": "O",
            "\u022a": "O",
            "\u1ece": "O",
            "\u0150": "O",
            "\u01d1": "O",
            "\u020c": "O",
            "\u020e": "O",
            "\u01a0": "O",
            "\u1edc": "O",
            "\u1eda": "O",
            "\u1ee0": "O",
            "\u1ede": "O",
            "\u1ee2": "O",
            "\u1ecc": "O",
            "\u1ed8": "O",
            "\u01ea": "O",
            "\u01ec": "O",
            "\xd8": "O",
            "\u01fe": "O",
            "\u0186": "O",
            "\u019f": "O",
            "\ua74a": "O",
            "\ua74c": "O",
            "\u01a2": "OI",
            "\ua74e": "OO",
            "\u0222": "OU",
            P: "P",
            "\u24c5": "P",
            "\uff30": "P",
            "\u1e54": "P",
            "\u1e56": "P",
            "\u01a4": "P",
            "\u2c63": "P",
            "\ua750": "P",
            "\ua752": "P",
            "\ua754": "P",
            Q: "Q",
            "\u24c6": "Q",
            "\uff31": "Q",
            "\ua756": "Q",
            "\ua758": "Q",
            "\u024a": "Q",
            R: "R",
            "\u24c7": "R",
            "\uff32": "R",
            "\u0154": "R",
            "\u1e58": "R",
            "\u0158": "R",
            "\u0210": "R",
            "\u0212": "R",
            "\u1e5a": "R",
            "\u1e5c": "R",
            "\u0156": "R",
            "\u1e5e": "R",
            "\u024c": "R",
            "\u2c64": "R",
            "\ua75a": "R",
            "\ua7a6": "R",
            "\ua782": "R",
            S: "S",
            "\u24c8": "S",
            "\uff33": "S",
            "\u1e9e": "S",
            "\u015a": "S",
            "\u1e64": "S",
            "\u015c": "S",
            "\u1e60": "S",
            "\u0160": "S",
            "\u1e66": "S",
            "\u1e62": "S",
            "\u1e68": "S",
            "\u0218": "S",
            "\u015e": "S",
            "\u2c7e": "S",
            "\ua7a8": "S",
            "\ua784": "S",
            T: "T",
            "\u24c9": "T",
            "\uff34": "T",
            "\u1e6a": "T",
            "\u0164": "T",
            "\u1e6c": "T",
            "\u021a": "T",
            "\u0162": "T",
            "\u1e70": "T",
            "\u1e6e": "T",
            "\u0166": "T",
            "\u01ac": "T",
            "\u01ae": "T",
            "\u023e": "T",
            "\ua786": "T",
            "\ua728": "TZ",
            U: "U",
            "\u24ca": "U",
            "\uff35": "U",
            "\xd9": "U",
            "\xda": "U",
            "\xdb": "U",
            "\u0168": "U",
            "\u1e78": "U",
            "\u016a": "U",
            "\u1e7a": "U",
            "\u016c": "U",
            "\xdc": "U",
            "\u01db": "U",
            "\u01d7": "U",
            "\u01d5": "U",
            "\u01d9": "U",
            "\u1ee6": "U",
            "\u016e": "U",
            "\u0170": "U",
            "\u01d3": "U",
            "\u0214": "U",
            "\u0216": "U",
            "\u01af": "U",
            "\u1eea": "U",
            "\u1ee8": "U",
            "\u1eee": "U",
            "\u1eec": "U",
            "\u1ef0": "U",
            "\u1ee4": "U",
            "\u1e72": "U",
            "\u0172": "U",
            "\u1e76": "U",
            "\u1e74": "U",
            "\u0244": "U",
            V: "V",
            "\u24cb": "V",
            "\uff36": "V",
            "\u1e7c": "V",
            "\u1e7e": "V",
            "\u01b2": "V",
            "\ua75e": "V",
            "\u0245": "V",
            "\ua760": "VY",
            W: "W",
            "\u24cc": "W",
            "\uff37": "W",
            "\u1e80": "W",
            "\u1e82": "W",
            "\u0174": "W",
            "\u1e86": "W",
            "\u1e84": "W",
            "\u1e88": "W",
            "\u2c72": "W",
            X: "X",
            "\u24cd": "X",
            "\uff38": "X",
            "\u1e8a": "X",
            "\u1e8c": "X",
            Y: "Y",
            "\u24ce": "Y",
            "\uff39": "Y",
            "\u1ef2": "Y",
            "\xdd": "Y",
            "\u0176": "Y",
            "\u1ef8": "Y",
            "\u0232": "Y",
            "\u1e8e": "Y",
            "\u0178": "Y",
            "\u1ef6": "Y",
            "\u1ef4": "Y",
            "\u01b3": "Y",
            "\u024e": "Y",
            "\u1efe": "Y",
            Z: "Z",
            "\u24cf": "Z",
            "\uff3a": "Z",
            "\u0179": "Z",
            "\u1e90": "Z",
            "\u017b": "Z",
            "\u017d": "Z",
            "\u1e92": "Z",
            "\u1e94": "Z",
            "\u01b5": "Z",
            "\u0224": "Z",
            "\u2c7f": "Z",
            "\u2c6b": "Z",
            "\ua762": "Z",
            a: "a",
            "\u24d0": "a",
            "\uff41": "a",
            "\u1e9a": "a",
            "\xe0": "a",
            "\xe1": "a",
            "\xe2": "a",
            "\u1ea7": "a",
            "\u1ea5": "a",
            "\u1eab": "a",
            "\u1ea9": "a",
            "\xe3": "a",
            "\u0101": "a",
            "\u0103": "a",
            "\u1eb1": "a",
            "\u1eaf": "a",
            "\u1eb5": "a",
            "\u1eb3": "a",
            "\u0227": "a",
            "\u01e1": "a",
            "\xe4": "a",
            "\u01df": "a",
            "\u1ea3": "a",
            "\xe5": "a",
            "\u01fb": "a",
            "\u01ce": "a",
            "\u0201": "a",
            "\u0203": "a",
            "\u1ea1": "a",
            "\u1ead": "a",
            "\u1eb7": "a",
            "\u1e01": "a",
            "\u0105": "a",
            "\u2c65": "a",
            "\u0250": "a",
            "\ua733": "aa",
            "\xe6": "ae",
            "\u01fd": "ae",
            "\u01e3": "ae",
            "\ua735": "ao",
            "\ua737": "au",
            "\ua739": "av",
            "\ua73b": "av",
            "\ua73d": "ay",
            b: "b",
            "\u24d1": "b",
            "\uff42": "b",
            "\u1e03": "b",
            "\u1e05": "b",
            "\u1e07": "b",
            "\u0180": "b",
            "\u0183": "b",
            "\u0253": "b",
            c: "c",
            "\u24d2": "c",
            "\uff43": "c",
            "\u0107": "c",
            "\u0109": "c",
            "\u010b": "c",
            "\u010d": "c",
            "\xe7": "c",
            "\u1e09": "c",
            "\u0188": "c",
            "\u023c": "c",
            "\ua73f": "c",
            "\u2184": "c",
            d: "d",
            "\u24d3": "d",
            "\uff44": "d",
            "\u1e0b": "d",
            "\u010f": "d",
            "\u1e0d": "d",
            "\u1e11": "d",
            "\u1e13": "d",
            "\u1e0f": "d",
            "\u0111": "d",
            "\u018c": "d",
            "\u0256": "d",
            "\u0257": "d",
            "\ua77a": "d",
            "\u01f3": "dz",
            "\u01c6": "dz",
            e: "e",
            "\u24d4": "e",
            "\uff45": "e",
            "\xe8": "e",
            "\xe9": "e",
            "\xea": "e",
            "\u1ec1": "e",
            "\u1ebf": "e",
            "\u1ec5": "e",
            "\u1ec3": "e",
            "\u1ebd": "e",
            "\u0113": "e",
            "\u1e15": "e",
            "\u1e17": "e",
            "\u0115": "e",
            "\u0117": "e",
            "\xeb": "e",
            "\u1ebb": "e",
            "\u011b": "e",
            "\u0205": "e",
            "\u0207": "e",
            "\u1eb9": "e",
            "\u1ec7": "e",
            "\u0229": "e",
            "\u1e1d": "e",
            "\u0119": "e",
            "\u1e19": "e",
            "\u1e1b": "e",
            "\u0247": "e",
            "\u025b": "e",
            "\u01dd": "e",
            f: "f",
            "\u24d5": "f",
            "\uff46": "f",
            "\u1e1f": "f",
            "\u0192": "f",
            "\ua77c": "f",
            g: "g",
            "\u24d6": "g",
            "\uff47": "g",
            "\u01f5": "g",
            "\u011d": "g",
            "\u1e21": "g",
            "\u011f": "g",
            "\u0121": "g",
            "\u01e7": "g",
            "\u0123": "g",
            "\u01e5": "g",
            "\u0260": "g",
            "\ua7a1": "g",
            "\u1d79": "g",
            "\ua77f": "g",
            h: "h",
            "\u24d7": "h",
            "\uff48": "h",
            "\u0125": "h",
            "\u1e23": "h",
            "\u1e27": "h",
            "\u021f": "h",
            "\u1e25": "h",
            "\u1e29": "h",
            "\u1e2b": "h",
            "\u1e96": "h",
            "\u0127": "h",
            "\u2c68": "h",
            "\u2c76": "h",
            "\u0265": "h",
            "\u0195": "hv",
            i: "i",
            "\u24d8": "i",
            "\uff49": "i",
            "\xec": "i",
            "\xed": "i",
            "\xee": "i",
            "\u0129": "i",
            "\u012b": "i",
            "\u012d": "i",
            "\xef": "i",
            "\u1e2f": "i",
            "\u1ec9": "i",
            "\u01d0": "i",
            "\u0209": "i",
            "\u020b": "i",
            "\u1ecb": "i",
            "\u012f": "i",
            "\u1e2d": "i",
            "\u0268": "i",
            "\u0131": "i",
            j: "j",
            "\u24d9": "j",
            "\uff4a": "j",
            "\u0135": "j",
            "\u01f0": "j",
            "\u0249": "j",
            k: "k",
            "\u24da": "k",
            "\uff4b": "k",
            "\u1e31": "k",
            "\u01e9": "k",
            "\u1e33": "k",
            "\u0137": "k",
            "\u1e35": "k",
            "\u0199": "k",
            "\u2c6a": "k",
            "\ua741": "k",
            "\ua743": "k",
            "\ua745": "k",
            "\ua7a3": "k",
            l: "l",
            "\u24db": "l",
            "\uff4c": "l",
            "\u0140": "l",
            "\u013a": "l",
            "\u013e": "l",
            "\u1e37": "l",
            "\u1e39": "l",
            "\u013c": "l",
            "\u1e3d": "l",
            "\u1e3b": "l",
            "\u017f": "l",
            "\u0142": "l",
            "\u019a": "l",
            "\u026b": "l",
            "\u2c61": "l",
            "\ua749": "l",
            "\ua781": "l",
            "\ua747": "l",
            "\u01c9": "lj",
            m: "m",
            "\u24dc": "m",
            "\uff4d": "m",
            "\u1e3f": "m",
            "\u1e41": "m",
            "\u1e43": "m",
            "\u0271": "m",
            "\u026f": "m",
            n: "n",
            "\u24dd": "n",
            "\uff4e": "n",
            "\u01f9": "n",
            "\u0144": "n",
            "\xf1": "n",
            "\u1e45": "n",
            "\u0148": "n",
            "\u1e47": "n",
            "\u0146": "n",
            "\u1e4b": "n",
            "\u1e49": "n",
            "\u019e": "n",
            "\u0272": "n",
            "\u0149": "n",
            "\ua791": "n",
            "\ua7a5": "n",
            "\u01cc": "nj",
            o: "o",
            "\u24de": "o",
            "\uff4f": "o",
            "\xf2": "o",
            "\xf3": "o",
            "\xf4": "o",
            "\u1ed3": "o",
            "\u1ed1": "o",
            "\u1ed7": "o",
            "\u1ed5": "o",
            "\xf5": "o",
            "\u1e4d": "o",
            "\u022d": "o",
            "\u1e4f": "o",
            "\u014d": "o",
            "\u1e51": "o",
            "\u1e53": "o",
            "\u014f": "o",
            "\u022f": "o",
            "\u0231": "o",
            "\xf6": "o",
            "\u022b": "o",
            "\u1ecf": "o",
            "\u0151": "o",
            "\u01d2": "o",
            "\u020d": "o",
            "\u020f": "o",
            "\u01a1": "o",
            "\u1edd": "o",
            "\u1edb": "o",
            "\u1ee1": "o",
            "\u1edf": "o",
            "\u1ee3": "o",
            "\u1ecd": "o",
            "\u1ed9": "o",
            "\u01eb": "o",
            "\u01ed": "o",
            "\xf8": "o",
            "\u01ff": "o",
            "\u0254": "o",
            "\ua74b": "o",
            "\ua74d": "o",
            "\u0275": "o",
            "\u01a3": "oi",
            "\u0223": "ou",
            "\ua74f": "oo",
            p: "p",
            "\u24df": "p",
            "\uff50": "p",
            "\u1e55": "p",
            "\u1e57": "p",
            "\u01a5": "p",
            "\u1d7d": "p",
            "\ua751": "p",
            "\ua753": "p",
            "\ua755": "p",
            q: "q",
            "\u24e0": "q",
            "\uff51": "q",
            "\u024b": "q",
            "\ua757": "q",
            "\ua759": "q",
            r: "r",
            "\u24e1": "r",
            "\uff52": "r",
            "\u0155": "r",
            "\u1e59": "r",
            "\u0159": "r",
            "\u0211": "r",
            "\u0213": "r",
            "\u1e5b": "r",
            "\u1e5d": "r",
            "\u0157": "r",
            "\u1e5f": "r",
            "\u024d": "r",
            "\u027d": "r",
            "\ua75b": "r",
            "\ua7a7": "r",
            "\ua783": "r",
            s: "s",
            "\u24e2": "s",
            "\uff53": "s",
            "\xdf": "s",
            "\u015b": "s",
            "\u1e65": "s",
            "\u015d": "s",
            "\u1e61": "s",
            "\u0161": "s",
            "\u1e67": "s",
            "\u1e63": "s",
            "\u1e69": "s",
            "\u0219": "s",
            "\u015f": "s",
            "\u023f": "s",
            "\ua7a9": "s",
            "\ua785": "s",
            "\u1e9b": "s",
            t: "t",
            "\u24e3": "t",
            "\uff54": "t",
            "\u1e6b": "t",
            "\u1e97": "t",
            "\u0165": "t",
            "\u1e6d": "t",
            "\u021b": "t",
            "\u0163": "t",
            "\u1e71": "t",
            "\u1e6f": "t",
            "\u0167": "t",
            "\u01ad": "t",
            "\u0288": "t",
            "\u2c66": "t",
            "\ua787": "t",
            "\ua729": "tz",
            u: "u",
            "\u24e4": "u",
            "\uff55": "u",
            "\xf9": "u",
            "\xfa": "u",
            "\xfb": "u",
            "\u0169": "u",
            "\u1e79": "u",
            "\u016b": "u",
            "\u1e7b": "u",
            "\u016d": "u",
            "\xfc": "u",
            "\u01dc": "u",
            "\u01d8": "u",
            "\u01d6": "u",
            "\u01da": "u",
            "\u1ee7": "u",
            "\u016f": "u",
            "\u0171": "u",
            "\u01d4": "u",
            "\u0215": "u",
            "\u0217": "u",
            "\u01b0": "u",
            "\u1eeb": "u",
            "\u1ee9": "u",
            "\u1eef": "u",
            "\u1eed": "u",
            "\u1ef1": "u",
            "\u1ee5": "u",
            "\u1e73": "u",
            "\u0173": "u",
            "\u1e77": "u",
            "\u1e75": "u",
            "\u0289": "u",
            v: "v",
            "\u24e5": "v",
            "\uff56": "v",
            "\u1e7d": "v",
            "\u1e7f": "v",
            "\u028b": "v",
            "\ua75f": "v",
            "\u028c": "v",
            "\ua761": "vy",
            w: "w",
            "\u24e6": "w",
            "\uff57": "w",
            "\u1e81": "w",
            "\u1e83": "w",
            "\u0175": "w",
            "\u1e87": "w",
            "\u1e85": "w",
            "\u1e98": "w",
            "\u1e89": "w",
            "\u2c73": "w",
            x: "x",
            "\u24e7": "x",
            "\uff58": "x",
            "\u1e8b": "x",
            "\u1e8d": "x",
            y: "y",
            "\u24e8": "y",
            "\uff59": "y",
            "\u1ef3": "y",
            "\xfd": "y",
            "\u0177": "y",
            "\u1ef9": "y",
            "\u0233": "y",
            "\u1e8f": "y",
            "\xff": "y",
            "\u1ef7": "y",
            "\u1e99": "y",
            "\u1ef5": "y",
            "\u01b4": "y",
            "\u024f": "y",
            "\u1eff": "y",
            z: "z",
            "\u24e9": "z",
            "\uff5a": "z",
            "\u017a": "z",
            "\u1e91": "z",
            "\u017c": "z",
            "\u017e": "z",
            "\u1e93": "z",
            "\u1e95": "z",
            "\u01b6": "z",
            "\u0225": "z",
            "\u0240": "z",
            "\u2c6c": "z",
            "\ua763": "z"
        },
        stopwords: {
            about: 1,
            again: 1,
            all: 1,
            almost: 1,
            also: 1,
            although: 1,
            always: 1,
            among: 1,
            and: 1,
            another: 1,
            any: 1,
            are: 1,
            because: 1,
            been: 1,
            before: 1,
            being: 1,
            between: 1,
            both: 1,
            but: 1,
            can: 1,
            could: 1,
            did: 1,
            does: 1,
            done: 1,
            due: 1,
            during: 1,
            each: 1,
            either: 1,
            enough: 1,
            especially: 1,
            etc: 1,
            for: 1,
            found: 1,
            from: 1,
            further: 1,
            had: 1,
            has: 1,
            have: 1,
            having: 1,
            here: 1,
            how: 1,
            however: 1,
            into: 1,
            its: 1,
            itself: 1,
            just: 1,
            made: 1,
            mainly: 1,
            make: 1,
            may: 1,
            might: 1,
            most: 1,
            mostly: 1,
            must: 1,
            nearly: 1,
            neither: 1,
            nor: 1,
            not: 1,
            obtained: 1,
            often: 1,
            our: 1,
            overall: 1,
            perhaps: 1,
            quite: 1,
            rather: 1,
            really: 1,
            regarding: 1,
            seem: 1,
            seen: 1,
            several: 1,
            should: 1,
            show: 1,
            showed: 1,
            shown: 1,
            shows: 1,
            since: 1,
            some: 1,
            such: 1,
            than: 1,
            that: 1,
            the: 1,
            their: 1,
            theirs: 1,
            them: 1,
            then: 1,
            there: 1,
            therefore: 1,
            these: 1,
            they: 1,
            this: 1,
            those: 1,
            through: 1,
            thus: 1,
            upon: 1,
            use: 1,
            used: 1,
            using: 1,
            various: 1,
            very: 1,
            was: 1,
            were: 1,
            what: 1,
            when: 1,
            which: 1,
            while: 1,
            with: 1,
            within: 1,
            without: 1,
            would: 1,
            "[": 1,
            "]": 1,
            "{": 1,
            "}": 1,
            "(": 1,
            ")": 1,
            _: 1,
            $: 1,
            "!": 1,
            "#": 1,
            "^": 1,
            "&": 1,
            "*": 1,
            "'": 1,
            '"': 1,
            ":": 1,
            "?": 1,
            ".": 1,
            ",": 1,
            ";": 1,
            "%": 1,
            "|": 1,
            "@": 1
        },
        decode: function(a) {
            try {
                var b = JSON.parse(a);
            } catch (b) {
                PP.log({
                    type: "exception",
                    subtype: "Follow up: Invalid JSON",
                    msg: "Could not decode JSON string in Utils.decode ",
                    str: PP.Utils.escape(a),
                    stack: PP.Utils.stackTrace(),
                    error: b
                });
                throw b;
            }
            return b;
        },
        encode: function(a) {
            return JSON.stringify(a);
        },
        convertHtmlEntitiesToUnicode: function(a) {
            var b = a.split(/(&[^;]+;)/);
            for (var c = 0; c < b.length; c++) {
                if (b[c].match(/^&[^;]+;$/)) {
                    if (typeof document != "undefined") {
                        var d = document.createElement("div");
                        d.innerHTML = b[c];
                        b[c] = d.textContent;
                    } else {
                        b[c] = $("<textarea />").html(b[c]).text();
                    }
                }
            }
            return b.join("");
        },
        escapeXML: function(a) {
            if (PP.Utils.isString(a)) {
                var b = a || "";
                return b.replace(/\&/g, "&amp;").replace(/\</g, "&lt;").replace(/\>/g, "&gt;").replace(/\"/g, "&quot;").replace(/\'/g, "&apos;");
            } else {
                return a;
            }
        },
        escape: function(a, b) {
            var c = {
                exclude: []
            };
            PP.Utils.apply(c, b || {});
            a = a.replace(/&lt;/g, "<");
            a = a.replace(/&gt;/g, ">");
            a = a.replace(/&amp;/g, "&");
            var d = document.createElement("div");
            d.appendChild(document.createTextNode(a));
            var e = d.innerHTML;
            for (var f = 0; f < c.exclude.length; f++) {
                var g = new RegExp("&lt;" + c.exclude[f] + "&gt;", "g");
                e = e.replace(g, "<" + c.exclude[f] + ">");
                g = new RegExp("&lt;\\/" + c.exclude[f] + "&gt;", "g");
                e = e.replace(g, "</" + c.exclude[f] + ">");
            }
            return e;
        },
        escapeAttributeValue: function(a) {
            var b = {
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#39;",
                "/": "&#x2F;"
            };
            return String(a).replace(/[&<>"'\/]/g, function(a) {
                return b[a];
            });
        },
        addAllDiacritics: function(a) {
            var b = this;
            if (!b.reversedDiacriticsMap) {
                b.reversedDiacriticsMap = {};
                for (var c in b.diacriticsMap) {
                    if (!(b.diacriticsMap[c] in b.reversedDiacriticsMap)) {
                        b.reversedDiacriticsMap[b.diacriticsMap[c]] = [];
                    }
                    b.reversedDiacriticsMap[b.diacriticsMap[c]].push(c);
                }
                for (var c in b.reversedDiacriticsMap) {
                    b.reversedDiacriticsMap[c] = "[" + b.reversedDiacriticsMap[c].join("") + "]";
                }
            }
            var d = a.split("");
            var e = "";
            for (var f = 0; f < d.length; f++) {
                e += d[f] in b.reversedDiacriticsMap ? b.reversedDiacriticsMap[d[f]] : d[f];
            }
            return e;
        },
        replaceDiacritics: function(a) {
            var b = this;
            var c = a.split("");
            var d = "";
            for (var e = 0; e < c.length; e++) {
                d += c[e] in b.diacriticsMap ? b.diacriticsMap[c[e]] : c[e];
            }
            return d;
        },
        replaceU0308: function(a) {
            if (!a) return a;
            if (!a.match(/\u0308/)) return a;
            var b = new RegExp("(.*)([AEIOUaeiouy])(\u0308)(.*)", "g");
            var c;
            var d = 0;
            var e = {
                a: "\xe4",
                e: "\xeb",
                i: "\xef",
                o: "\xf6",
                u: "\xfc",
                y: "\xff",
                A: "\xc4",
                E: "\xcb",
                I: "\xcf",
                O: "\xd6",
                U: "\xdc"
            };
            while ((c = b.exec(a)) !== null) {
                if (d++ > 50) break;
                a = c[1] + e[c[2]] + c[4];
                b.lastIndex = 0;
            }
            a = a.replace(/\u0308/g, "");
            return a;
        },
        replaceControlChars: function(a) {
            if (!a) return a;
            a = a.replace(/[\u0000-\u0008\u000B-\u001F]/g, "");
            return a;
        },
        addWbrs: function(a) {
            if (!a) return a;
            var b, c, d;
            var e = [];
            var f = 0;
            var g = {};
            var h = 30;
            var i = new RegExp("(.{" + h + "})");
            a += "";
            d = a.replace(/\s+$/g, "").replace(/^\s+/g, "").split(/(<\/?(?:span|i|sub|sup)[^>]*>)/);
            d.forEach(function(a) {
                if (a.match(/^<\/?(?:span|i|sub|sup)[^>]*>$/)) {
                    e.push({
                        str: a,
                        type: "html"
                    });
                } else {
                    a.split(/(\s+)/).forEach(function(a) {
                        if (a.match(/^\s+$/)) {
                            e.push({
                                str: " <wbr>",
                                type: "space"
                            });
                            f++;
                        } else {
                            if (a != "") {
                                e.push({
                                    str: a,
                                    type: "text",
                                    wbrs: []
                                });
                                if (!(f in g)) g[f] = [];
                                g[f].push(e.length - 1);
                            }
                        }
                    });
                }
            });
            for (var j in g) {
                var k = "";
                g[j].forEach(function(a) {
                    k += e[a].str;
                });
                if (k.length >= h) {
                    d = k.split(/([_\/\-]+)/);
                    for (c = 0; c < d.length; c++) {
                        if (d[c].match(/^[_\/\-]+$/)) {
                            d[c] = d[c] + "<wbr>";
                        } else if (d[c].length >= h) {
                            d[c] = d[c].split(i).join("<wbr>").replace(/^<wbr>/, "");
                        }
                    }
                    var l = 0;
                    d.join("").split(/(<wbr>)/).forEach(function(a) {
                        if (a == "<wbr>") {
                            var b = 0;
                            g[j].forEach(function(a) {
                                if (l > b && l <= b + e[a].str.length) {
                                    e[a].wbrs.push(l - b - 1);
                                }
                                b += e[a].str.length;
                            });
                        } else {
                            l += a.length;
                        }
                    });
                }
            }
            a = [];
            e.forEach(function(b) {
                if (b.type == "text" && b.wbrs.length) {
                    d = b.str.split("");
                    b.wbrs.forEach(function(a) {
                        d[a] += "<wbr>";
                    });
                    b.str = d.join("");
                }
                a.push(b.str);
            });
            return a.join("");
        },
        escapeRegex: function(a) {
            if (!a) return a;
            a = a.replace(/\\/g, "\\\\");
            a = a.replace(/\^/g, "\\^");
            a = a.replace(/\|/g, "\\|");
            a = a.replace(/\$/g, "\\$");
            a = a.replace(/\?/g, "\\?");
            a = a.replace(/\+/g, "\\+");
            a = a.replace(/\(/g, "\\(");
            a = a.replace(/\)/g, "\\)");
            a = a.replace(/\[/g, "\\[");
            a = a.replace(/\]/g, "\\]");
            a = a.replace(/\*/g, "\\*");
            return a;
        },
        removeQuotationMarksAndPunctation: function(a) {
            if (!a) return "";
            var b = "[\u2018\u2019\u201b\u201c\u201d\u201e\u201f\xa8\"'`\\-\\(\\[\\{\\)\\]\\}\\.,;:\\?\\!]+";
            return a.replace(new RegExp("^" + b, "i"), "").replace(new RegExp(b + "$", "i"), "");
        },
        normalizeIdsForSearch: function(a) {
            if (!a) return a;
            a = this.removeQuotationMarksAndPunctation(a);
            if (a.match(/^(pmid|doi|pmc|arxivid|isbn):/i)) {
                return a;
            }
            if (a.match(/^10\.[^\/]+\/[^\s\>\<]+/)) {
                return "doi:" + a;
            }
            if (a.match(/^\d{7,8}$/)) {
                return "pmid:" + a;
            }
            if (a.match(/PMC\d+/i)) {
                return "pmc:" + a;
            }
            if (a.match(/\d{4}\.\d{4}/)) {
                return "arxivid:" + a;
            }
            var b = a.replace(/[-\s\.]/g, "");
            if (b.match(/^\d{10}$/) || b.match(/^\d{13}$/) || b.match(/^\d{9}X$/i) || b.match(/^\d{12}X$/i)) {
                return "isbn:" + a;
            }
            if (a.toLowerCase() in this.stopwords) a = "";
            return a;
        },
        pp: function(a) {
            console.warn(this.prettyPrint(a));
        },
        prettyPrint: function(a) {
            return JSON.stringify(PP.Utils.clone(a), null, 4);
        },
        getPath: function(a, b) {
            var c = b.split(".");
            var d = a;
            var e;
            for (var f = 0; f < c.length; f++) {
                var g = c[f];
                if (d[g] !== undefined) {
                    e = d[g];
                    d = e;
                } else {
                    return d[g];
                }
            }
            return e;
        },
        setPath: function(a, b, c) {
            var d = b.split(".");
            var e = a;
            var f;
            var g;
            for (var h = 0; h < d.length; h++) {
                g = d[h];
                if (h == d.length - 1) {
                    e[g] = c;
                    break;
                }
                if (e[g]) {
                    f = e[g];
                    e = f;
                } else {
                    e[g] = {};
                    f = e[g];
                    e = f;
                }
            }
        },
        getCslLocales: function() {
            var a = [ {
                abbr: "default",
                name: "Language: Default"
            }, {
                abbr: "af-ZA",
                name: "Afrikaans"
            }, {
                abbr: "ar",
                name: "\u0627\u0644\u0639\u0631\u0628\u064a\u0629"
            }, {
                abbr: "bg-BG",
                name: "\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438"
            }, {
                abbr: "ca-AD",
                name: "Catal\xe0"
            }, {
                abbr: "cs-CZ",
                name: "\u010ce\u0161tina"
            }, {
                abbr: "cy-GB",
                name: "Cymraeg"
            }, {
                abbr: "da-DK",
                name: "Dansk"
            }, {
                abbr: "de-AT",
                name: "Deutsch (\xd6sterreich)"
            }, {
                abbr: "de-CH",
                name: "Deutsch (Schweiz)"
            }, {
                abbr: "de-DE",
                name: "Deutsch (Deutschland)"
            }, {
                abbr: "el-GR",
                name: "\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac"
            }, {
                abbr: "en-GB",
                name: "English (UK)"
            }, {
                abbr: "en-US",
                name: "English (US)"
            }, {
                abbr: "es-CL",
                name: "Espa\xf1ol (Chile)"
            }, {
                abbr: "es-ES",
                name: "Espa\xf1ol (Espa\xf1a)"
            }, {
                abbr: "es-MX",
                name: "Espa\xf1ol (M\xe9xico)"
            }, {
                abbr: "et-EE",
                name: "Eesti"
            }, {
                abbr: "eu",
                name: "Euskara"
            }, {
                abbr: "fa-IR",
                name: "\u0641\u0627\u0631\u0633\u06cc"
            }, {
                abbr: "fi-FI",
                name: "Suomi"
            }, {
                abbr: "fr-CA",
                name: "Fran\xe7ais (Canada)"
            }, {
                abbr: "fr-FR",
                name: "Fran\xe7ais (France)"
            }, {
                abbr: "he-IL",
                name: "\u05e2\u05d1\u05e8\u05d9\u05ea"
            }, {
                abbr: "hr-HR",
                name: "Hrvatski"
            }, {
                abbr: "hu-HU",
                name: "Magyar"
            }, {
                abbr: "id-ID",
                name: "Bahasa Indonesia"
            }, {
                abbr: "is-IS",
                name: "\xcdslenska"
            }, {
                abbr: "it-IT",
                name: "Italiano"
            }, {
                abbr: "ja-JP",
                name: "\u65e5\u672c\u8a9e"
            }, {
                abbr: "km-KH",
                name: "\u1797\u17b6\u179f\u17b6\u1781\u17d2\u1798\u17c2\u179a"
            }, {
                abbr: "ko-KR",
                name: "\ud55c\uad6d\uc5b4"
            }, {
                abbr: "lt-LT",
                name: "Lietuvi\u0173"
            }, {
                abbr: "lv-LV",
                name: "Latvie\u0161u"
            }, {
                abbr: "mn-MN",
                name: "\u041c\u043e\u043d\u0433\u043e\u043b"
            }, {
                abbr: "nb-NO",
                name: "Norsk bokm\xe5l"
            }, {
                abbr: "nl-NL",
                name: "Nederlands"
            }, {
                abbr: "nn-NO",
                name: "Norsk nynorsk"
            }, {
                abbr: "pl-PL",
                name: "Polski"
            }, {
                abbr: "pt-BR",
                name: "Portugu\xeas (Brasil)"
            }, {
                abbr: "pt-PT",
                name: "Portugu\xeas (Portugal)"
            }, {
                abbr: "ro-RO",
                name: "Rom\xe2n\u0103"
            }, {
                abbr: "ru-RU",
                name: "\u0420\u0443\u0441\u0441\u043a\u0438\u0439"
            }, {
                abbr: "sk-SK",
                name: "Sloven\u010dina"
            }, {
                abbr: "sl-SI",
                name: "Sloven\u0161\u010dina"
            }, {
                abbr: "sr-RS",
                name: "\u0421\u0440\u043f\u0441\u043a\u0438 / Srpski"
            }, {
                abbr: "sv-SE",
                name: "Svenska"
            }, {
                abbr: "th-TH",
                name: "\u0e44\u0e17\u0e22"
            }, {
                abbr: "tr-TR",
                name: "T\xfcrk\xe7e"
            }, {
                abbr: "uk-UA",
                name: "\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"
            }, {
                abbr: "vi-VN",
                name: "Ti\u1ebfng Vi\u1ec7t"
            }, {
                abbr: "zh-CN",
                name: "\u4e2d\u6587 (\u4e2d\u56fd\u5927\u9646)"
            }, {
                abbr: "zh-TW",
                name: "\u4e2d\u6587 (\u53f0\u7063)"
            } ];
            return a;
        },
        merge: function(a, b) {
            var c = Object.keys(b);
            for (var d = 0; d < c.length; d++) {
                var e = c[d];
                if (a[e] && b[e] && this.isObject(a[e]) && this.isObject(b[e])) {
                    this.merge(a[e], b[e]);
                } else if (b[e] !== undefined) {
                    a[e] = b[e];
                }
            }
        },
        extend: function(a) {
            var b = Array.prototype.slice.call(arguments, 1);
            for (var c = 0, d = b.length, e; c < d; c++) {
                e = b[c] || {};
                for (var f in e) {
                    if (e.hasOwnProperty(f)) {
                        a[f] = e[f];
                    }
                }
            }
            return a;
        },
        extendIf: function(a, b) {
            var c;
            if (a) {
                for (c in b) {
                    if (a[c] === undefined) {
                        a[c] = b[c];
                    }
                }
            }
            return a;
        },
        objectEach: function(a, b, c) {
            for (var d in a) {
                if (a.hasOwnProperty(d)) {
                    if (b.call(c || a, d, a[d], a) === false) {
                        return;
                    }
                }
            }
        },
        bind: function(a, b, c, d) {
            if (arguments.length === 2) {
                return function() {
                    return a.apply(b, arguments);
                };
            }
            if (d === undefined) {
                d = true;
            }
            var e = a, f = Array.prototype.slice;
            return function() {
                var a = c || arguments;
                if (d === true && c !== undefined) {
                    a = f.call(arguments, 0);
                    a = a.concat(c);
                }
                return e.apply(b, a);
            };
        },
        strip: function(a) {
            a = a.replace(/^\s*/, "");
            a = a.replace(/\s*$/, "");
            return a;
        },
        normalizeString: function(a) {
            if (a) {
                a = a.replace(/[\t\n\s\r]+/g, " ").replace(/^\s+/, "").replace(/\s+$/, "");
            } else {
                a = "";
            }
            return a;
        },
        isPdfRestricted: function(a) {
            var b = false;
            if (a === "restricted") {
                b = true;
            } else if (a === "loginrequired") {
                b = true;
            } else if (a === "proxyrestricted") {
                b = true;
            }
            return b;
        },
        ellipsis: function(a, b, c, d) {
            if (c === undefined) {
                c = false;
            }
            if (d === undefined) {
                d = "&hellip;";
            }
            var e = Math.abs(b);
            if (a && a.length > e) {
                if (c && b > 0) {
                    var f = a.substr(0, e - 2), g = Math.max(f.lastIndexOf(" "), f.lastIndexOf("."), f.lastIndexOf("!"), f.lastIndexOf("?"));
                    if (g !== -1 && g >= e - 15) {
                        return f.substr(0, g) + d;
                    }
                } else if (c && b < 0) {
                    var f = a.substr(2);
                    var h = [ " ", ".", "!", "?" ];
                    var i = a.length;
                    for (var j = 0; j < h.length; j++) {
                        if (f.indexOf(h[j]) !== -1) {
                            i = Math.min(i, f.indexOf(h[j]));
                        }
                    }
                    if (i < 15) {
                        return d + f.substr(i + 1);
                    }
                }
                if (b > 0) {
                    return a.substr(0, b - 3) + d;
                } else {
                    return d + a.substr(a.length - e);
                }
            }
            return a;
        },
        midEllipsis: function(a, b, c) {
            if (!a) return a;
            if (b < 1) return a;
            a = a + "";
            if (a.length <= b) return a;
            if (c === undefined) {
                c = false;
            }
            var d = c ? 0 : 1;
            var e = [];
            var f = [];
            var g;
            if (c) {
                g = a.split("");
            } else {
                g = a.split(/\s/);
            }
            var h = 0;
            for (var i = 0; i < g.length; i++) {
                if (h > a.length / 2) {
                    break;
                }
                e.push(g[i]);
                h += g[i].length + d;
            }
            f = f.concat(g.slice(e.length));
            var j = e.join(" ").length;
            var k = f.join(" ").length;
            var l = a.length;
            var m = k > j;
            var n;
            while (l > b) {
                if (m) {
                    n = f.shift();
                    k -= n.length + d;
                } else {
                    n = e.pop();
                    j -= n.length + d;
                }
                l -= n.length + d;
                m = k > j;
            }
            if (c) {
                return e.join("") + " ... " + f.join("");
            } else {
                return e.join(" ") + " ... " + f.join(" ");
            }
        },
        getFilenameFromUrl: function(a, b) {
            var c = a.split("/");
            var d = "";
            if (c.length > 1) {
                var e = c[c.length - 1];
                d = e;
                if (e.match(/\./)) {
                    if (!e.match(/[&\?"']/)) {
                        return e;
                    }
                }
            }
            if (b) {
                return d;
            } else {
                return null;
            }
        },
        getDomainSuffix: function(a) {
            if (!a) {
                return "";
            }
            a = a.replace(/^(http|https|ftp):\/\//g, "");
            a = a.replace(/^www\./g, "");
            a = a.split("/")[0];
            a = this.ellipsis(a, -20, true);
            a = a.replace(/\.\.\./, "");
            a = a.replace("&hellip;", "");
            return a;
        },
        isArray: "isArray" in Array ? Array.isArray : function(a) {
            return b.call(a) === "[object Array]";
        },
        isObject: b.call(null) === "[object Object]" ? function(a) {
            return a !== null && a !== undefined && b.call(a) === "[object Object]" && a.ownerDocument === undefined;
        } : function(a) {
            return b.call(a) === "[object Object]";
        },
        isString: function(a) {
            return typeof a === "string";
        },
        isFunction: typeof document !== "undefined" && typeof document.getElementsByTagName("body") === "function" ? function(a) {
            return b.call(a) === "[object Function]";
        } : function(a) {
            return typeof a === "function";
        },
        isNumeric: function(a) {
            return !isNaN(parseFloat(a)) && isFinite(a);
        },
        isUrlLike: function(a) {
            if (!a || !this.isString(a)) {
                return false;
            }
            var b = /^(www|http|ftp|file|evernote)/i;
            var c = /\.(com|org|net|gov|edu|uk|de)/i;
            if (a.match(b) || a.match(c)) {
                return true;
            } else {
                return false;
            }
        },
        clone: function(a) {
            var c, d, e, f, g, h;
            if (a === null || a === undefined) {
                return a;
            }
            if (a.nodeType && a.cloneNode) {
                return a.cloneNode(true);
            }
            c = b.call(a);
            if (c === "[object Date]") {
                return new Date(a.getTime());
            }
            if (c === "[object Array]") {
                d = a.length;
                g = [];
                while (d--) {
                    g[d] = PP.Utils.clone(a[d]);
                }
            } else if (c === "[object Object]" && a.constructor === Object) {
                g = {};
                for (h in a) {
                    if (a[h] !== undefined) {
                        g[h] = PP.Utils.clone(a[h]);
                    }
                }
            }
            return g || a;
        },
        stamp: function() {
            var a = 0, b = "_leaflet_id";
            return function(c) {
                c[b] = c[b] || ++a;
                return c[b];
            };
        }(),
        limitExecByInterval: function(a, b, c) {
            var d, e;
            return function f() {
                var g = arguments;
                if (d) {
                    e = true;
                    return;
                }
                d = true;
                setTimeout(function() {
                    d = false;
                    if (e) {
                        f.apply(c, g);
                        e = false;
                    }
                }, b);
                a.apply(c, g);
            };
        },
        throttle: function(a, b, c, d) {
            var e, f = 0;
            if (typeof c !== "boolean") {
                d = a;
                a = c;
                c = undefined;
            }
            function g() {
                var g = this, h = +new Date() - f, i = arguments;
                function j() {
                    f = +new Date();
                    a.apply(g, i);
                }
                function k() {
                    e = undefined;
                }
                if (d && !e) {
                    j();
                }
                e && clearTimeout(e);
                if (d === undefined && h > b) {
                    j();
                } else if (c !== true) {
                    e = setTimeout(d ? k : j, d === undefined ? b - h : b);
                }
            }
            return g;
        },
        debounce: function(a, b, c) {
            var d;
            return function() {
                var e = this, f = arguments;
                var g = function() {
                    d = null;
                    if (!c) a.apply(e, f);
                };
                var h = c && !d;
                clearTimeout(d);
                d = setTimeout(g, b);
                if (h) a.apply(e, f);
            };
        },
        falseFn: function() {
            return false;
        },
        formatNum: function(a, b) {
            var c = Math.pow(10, b || 5);
            return Math.round(a * c) / c;
        },
        splitWords: function(a) {
            return a.replace(/^\s+|\s+$/g, "").split(/\s+/);
        },
        setOptions: function(a, b) {
            a.options = PP.Utils.extend({}, a.options, b);
            return a.options;
        },
        getParamString: function(a) {
            var b = [];
            for (var c in a) {
                if (a.hasOwnProperty(c)) {
                    b.push(c + "=" + a[c]);
                }
            }
            return "?" + b.join("&");
        },
        template: function(a, b) {
            return a.replace(/\{ *([\w_]+) *\}/g, function(a, c) {
                var d = b[c];
                if (!b.hasOwnProperty(c)) {
                    throw new Error("No value provided for variable " + a);
                }
                return d;
            });
        },
        callback: function(a, b, c) {
            if (a === undefined) {
                return;
            }
            if (!PP.Utils.isFunction(a)) {
                return;
            }
            a.apply(b, c);
        },
        getRegex: function(a) {
            if (a instanceof RegExp) {
                return a;
            }
            a = a.replace(/^!/, "");
            a = a.replace(/!$/, "");
            a = a.replace(/&quot;/g, '"');
            a = a.replace(/&amp;/g, "&");
            a = a.replace(/\//g, "\\/");
            return new RegExp(a);
        },
        defer: function(a, b, c, d) {
            d = d || [];
            c = c || {};
            a = PP.Utils.bind(a, c, d, true);
            var e = setTimeout(a, b);
            return e;
        },
        emptyImageUrl: "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",
        objectToHtml: function(a) {
            var b = JSON.stringify(a, null, 4);
            b = b.replace(/^\s+/gm, function(a) {
                return new Array(a.length + 1).join("&nbsp;");
            });
            b = b.replace(/\n/g, "<br/>");
            return b;
        },
        ensureAbsoluteUrl: function(a, b) {
            if (b && !b.match(/^(http|www|ftp)/gi)) {
                var c = new URI(b);
                var d = c.resolve(new URI(a)).toString();
                return d;
            } else {
                return b;
            }
        },
        keySummary: function(a) {
            var b = Object.keys(a);
            var c = "[" + PP.Utils.ellipsis(b.join(", "), 150, null, "") + "]";
            return c;
        },
        progressModulus: function(a, b) {
            if (a < 100) {
                return 1;
            } else if (a < 500) {
                return 5;
            } else if (a < 1e3) {
                return 10;
            } else if (a < 2e3) {
                return 20;
            } else {
                return Math.floor(Math.round(a / 100 / 10) * 10);
            }
        },
        extractISBNs: function(a, b) {
            var c = this;
            var d = [];
            b = b || {};
            if (!("convert" in b)) b.convert = false;
            if (!("unique" in b)) b.unique = false;
            if (a && PP.Utils.isString(a)) {
                a.split(/[^\dxX\-]/).forEach(function(a) {
                    if (a.length > 1) {
                        if (c.isISBN10(a)) {
                            d.push(a);
                        } else if (c.isISBN13(a)) {
                            d.push(a);
                        }
                    }
                });
            }
            if (b.convert) {
                var e = [];
                d.forEach(function(a) {
                    if (a.length == 10) {
                        e.push(c.isbn10To13(a));
                    } else {
                        e.push(a);
                    }
                });
                d = e;
            }
            if (b.unique) {
                d = PP.Array.unique(d);
            }
            return d;
        },
        isISBN10: function(a) {
            var b = false;
            if (a && PP.Utils.isString(a)) {
                a = a.toUpperCase().replace(/[\n\r\t\s\-]+/g, "");
                if (a.match(/^\d{9}[\dX]$/)) {
                    var c = parseInt(a.charAt(0)) * 1;
                    c += parseInt(a.charAt(1)) * 2;
                    c += parseInt(a.charAt(2)) * 3;
                    c += parseInt(a.charAt(3)) * 4;
                    c += parseInt(a.charAt(4)) * 5;
                    c += parseInt(a.charAt(5)) * 6;
                    c += parseInt(a.charAt(6)) * 7;
                    c += parseInt(a.charAt(7)) * 8;
                    c += parseInt(a.charAt(8)) * 9;
                    var d = a.charAt(9) == "X" ? 10 : parseInt(a.charAt(9));
                    c += d * 10;
                    c = c % 11;
                    if (c === 0) b = true;
                }
            }
            return b;
        },
        isISBN13: function(a) {
            var b = false;
            if (a && PP.Utils.isString(a)) {
                a = a.toUpperCase().replace(/[\n\r\t\s\-]+/g, "");
                if (a.match(/^978\d{10}$/)) {
                    var c = parseInt(a.charAt(0));
                    c += parseInt(a.charAt(1)) * 3;
                    c += parseInt(a.charAt(2));
                    c += parseInt(a.charAt(3)) * 3;
                    c += parseInt(a.charAt(4));
                    c += parseInt(a.charAt(5)) * 3;
                    c += parseInt(a.charAt(6));
                    c += parseInt(a.charAt(7)) * 3;
                    c += parseInt(a.charAt(8));
                    c += parseInt(a.charAt(9)) * 3;
                    c += parseInt(a.charAt(10));
                    c += parseInt(a.charAt(11)) * 3;
                    c = (10 - c % 10) % 10;
                    if (parseInt(a.charAt(12)) == c) b = true;
                }
            }
            return b;
        },
        isbn10To13: function(a) {
            if (!PP.Utils.isString(a)) {
                return "";
            }
            if (a.length != 10) {
                return "";
            }
            var b = 38 + 3 * (parseInt(a[0]) + parseInt(a[2]) + parseInt(a[4]) + parseInt(a[6]) + parseInt(a[8])) + parseInt(a[1]) + parseInt(a[3]) + parseInt(a[5]) + parseInt(a[7]);
            var c = (10 - b % 10) % 10;
            return "978" + a.substring(0, 9) + c;
        },
        normalizeLanguage: function(a) {
            if (!PP.Utils.isString(a)) {
                return "";
            }
            a = PP.Utils.normalizeString(a);
            if (a.toLowerCase() in PP.Utils.languages) {
                return a.toLowerCase();
            }
            if (!PP.Utils.languagesHelper) {
                PP.Utils.languagesHelper = {};
                for (var b in PP.Utils.languages) {
                    if (PP.Utils.languages[b].a3) {
                        if (PP.Utils.isString(PP.Utils.languages[b].a3)) {
                            PP.Utils.languagesHelper[PP.Utils.languages[b].a3] = b;
                        } else {
                            PP.Utils.languages[b].a3.forEach(function(a) {
                                PP.Utils.languagesHelper[a] = b;
                            });
                        }
                    }
                    if (PP.Utils.languages[b].n) {
                        PP.Utils.languages[b].n.forEach(function(a) {
                            PP.Utils.languagesHelper[a.toLowerCase()] = b;
                        });
                    }
                }
            }
            if (a.toLowerCase() in PP.Utils.languagesHelper) {
                return PP.Utils.languagesHelper[a.toLowerCase()];
            }
            return "";
        },
        formatFileSize: function(a) {
            var b = 1024 * 1024 * 1024;
            var c = 1024 * 1024;
            var d = 1024;
            var e = a;
            var f = "KB";
            if (e > b) {
                a = e / b;
                f = "GB";
            } else if (e > c) {
                a = e / c;
                f = "MB";
            } else {
                a = e / d;
                f = "KB";
            }
            return Math.round(a * 10) / 10 + " " + f;
        },
        createErrorStatus: function(a, b) {
            var c = {
                cls: "error",
                text: "Something went wrong &mdash; " + a
            };
            if (b) {
                c.links = b;
            }
            this.createStatus(c);
        },
        createStatus: function(a) {
            if (PP.Globals.isWebApp() && typeof Paperpile !== "undefined" && Paperpile.Utils) {
                return Paperpile.Utils.createStatus(a);
            } else {
                PP.Msg.sendMessage({
                    fn: "createStatus",
                    args: [ a ]
                });
            }
        },
        createErrorWindow: function(a) {
            PP.Msg.sendMessage({
                fn: "createErrorWindow",
                args: [ {
                    type: a
                } ]
            });
        },
        callSerially: function(a, b) {
            if (a.length === 0) {
                PP.Utils.callback(b);
            } else {
                var c = a.shift();
                c(function(c, d) {
                    if (d) {
                        PP.Utils.callback(b, null, [ null, d ]);
                    } else {
                        PP.Utils.callSerially(a, b);
                    }
                });
            }
        },
        cleanFileName: function(a) {
            a = a.replace(/[\/\\?:|]/g, " - ");
            a = a.replace(/[<>*]/g, " ");
            a = a.replace(/(\w)(\.\.)(\w)/g, function(a, b, c, d) {
                return b + "." + d;
            });
            a = a.replace(/"/g, "'");
            a = a.replace(/\s*-\s*$/g, "");
            a = a.replace(/\s*-\s*\./g, ".");
            a = a.replace(/(\s*\.)([^\.])/g, function(a, b, c) {
                return "." + c;
            });
            a = a.replace(/-[- ]*-/g, "-");
            a = a.replace(/-+/g, "-");
            a = a.replace(/ +/g, " ");
            a = a.replace(/^\s*/, "");
            a = a.replace(/\s*$/, "");
            if (a.length > 150) {
                a = PP.Utils.midEllipsis(a, 145, true);
            }
            return a;
        },
        createLogLevel: function(a) {
            return function() {
                return a;
            };
        },
        verifyPubResult: function(a, b) {
            var c = [];
            for (var d in a) {
                if (d.match(/^test_/g)) {
                    continue;
                }
                var e = a[d];
                var f = PP.Utils.getPath(b, d);
                e = "" + e;
                f = "" + f;
                var g = false;
                if (e.match(/!.+!/)) {
                    var h = PP.Utils.getRegex(e);
                    if (f && f.match(h)) {
                        g = true;
                    }
                } else {
                    g = e === f;
                }
                if (e === "__require_set__") {
                    if (!f) {
                        c.push(d + " not set");
                    }
                } else if (!g) {
                    c.push(d + " does not match (WANTED: " + e + " GOT: " + f + ")");
                }
            }
            return c;
        },
        deepEquals: function(a, b) {
            var c;
            for (c in a) {
                if (typeof b[c] == "undefined") {
                    return false;
                }
            }
            for (c in a) {
                if (a[c]) {
                    switch (typeof a[c]) {
                      case "object":
                        if (!this.deepEquals(a[c], b[c])) {
                            return false;
                        }
                        break;

                      case "function":
                        if (typeof b[c] == "undefined" || c != "equals" && a[c].toString() != b[c].toString()) return false;
                        break;

                      default:
                        if (a[c] != b[c]) {
                            return false;
                        }
                    }
                } else {
                    if (b[c]) return false;
                }
            }
            for (c in b) {
                if (typeof a[c] == "undefined") {
                    return false;
                }
            }
            return true;
        },
        getTabId: function(a) {
            if (a && a.tab && a.tab.id !== -1) {
                return a.tab.id;
            } else if (a) {
                return a.tabId;
            } else {
                return undefined;
            }
        },
        logToBg: function(a) {
            if (!PP.Globals.isBackgroundPage()) {
                PP.Msg.sendMessage({
                    fn: "logToBg",
                    args: [ a ]
                });
            }
        },
        decodeProxyString: function(a) {
            var b = [];
            if (a && PP.Utils.isString(a)) {
                a.split(/\^/).forEach(function(a) {
                    var c = a.split(/\|/);
                    if (c && c.length == 3) {
                        var d = {
                            name: c[0],
                            url: c[1],
                            active: false
                        };
                        if (c[2] == "1") d.active = true;
                        b.push(d);
                    }
                });
            }
            return b;
        },
        getProxyLoginUrl: function() {
            var a = PP.backend.Settings.getSetting("proxy_list");
            if (!a) return;
            var b = PP.Utils.decodeProxyString(a);
            if (b.length) {
                var c = b[0].url;
                return c;
            }
        },
        getPermalink: function(a) {
            var b = PP.Globals.getUrlBase();
            return b + "/app/p/" + a._id;
        },
        encodeProxyString: function(a) {
            var b = [];
            a.forEach(function(a) {
                b.push([ a.name, a.url, a.active ? "1" : "0" ].join("|"));
            });
            return b.join("^");
        },
        encode64: function(a) {
            var b = "", c = 0, d = a.length, e = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", f, g, h, i, j, k, l;
            while (c < d) {
                f = a.charCodeAt(c++);
                g = a.charCodeAt(c++);
                h = a.charCodeAt(c++);
                i = f >> 2;
                j = (f & 3) << 4 | g >> 4;
                k = (g & 15) << 2 | h >> 6;
                l = h & 63;
                if (isNaN(g)) k = l = 64; else if (isNaN(h)) l = 64;
                b = b + e.charAt(i) + e.charAt(j) + e.charAt(k) + e.charAt(l);
            }
            return b;
        },
        stackTrace: function() {
            var a = new Error("Custom");
            var b = "";
            if (a && a.stack) {
                b = a.stack;
            }
            return b;
        },
        getCookie: function(a) {
            if (!a) {
                return null;
            }
            return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(a).replace(/[\-\.\+\*]/g, "\\$&") + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) || null;
        },
        makeAlphaNumericID: function(a) {
            var b = "";
            var c = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            for (var d = 0; d < a; d++) {
                b += c.charAt(Math.floor(Math.random() * c.length));
            }
            return b;
        },
        convertInlineLatexToHtml: function(a) {
            var b = function(a) {
                var b = 0;
                var c = [];
                var d = "";
                var e = 0;
                if (a.indexOf("{") == -1) {
                    return [ {
                        level: 0,
                        pre: "",
                        value: a,
                        close: false
                    } ];
                }
                while (a.indexOf("{") != -1 | a.indexOf("}") != -1 && e < 100) {
                    e += 1;
                    var f = "", d = "";
                    if (a.indexOf("{") != -1 && a.indexOf("{") < a.indexOf("}")) {
                        b += 1;
                        d = a.substring(0, a.indexOf("{"));
                        a = a.substring(a.indexOf("{") + 1);
                        if (a.indexOf("{") != -1 && a.indexOf("{") < a.indexOf("}")) {
                            c.push({
                                level: b,
                                pre: d,
                                value: f,
                                close: false
                            });
                        } else if (a.indexOf("}") != -1) {
                            f = a.substring(0, a.indexOf("}"));
                            c.push({
                                level: b,
                                pre: d,
                                value: f,
                                close: true
                            });
                            a = a.substring(a.indexOf("}") + 1);
                            b -= 1;
                        } else {
                            c.push({
                                level: b,
                                pre: d,
                                value: a,
                                close: false
                            });
                            a = "";
                            b -= 1;
                        }
                    } else if (a.indexOf("}") != -1) {
                        f = a.substring(0, a.indexOf("}"));
                        c.push({
                            level: b,
                            pre: d,
                            value: f,
                            close: true
                        });
                        a = a.substring(a.indexOf("}") + 1);
                        b -= 1;
                    } else {
                        c.push({
                            level: b,
                            pre: d,
                            value: a,
                            close: false
                        });
                        a = "";
                        b -= 1;
                    }
                }
                return c;
            };
            var c = a.split("$");
            var d = "";
            for (var e = 0; e < c.length; e++) {
                if (c[e].length) {
                    var f = b(c[e]);
                    var g = 0;
                    var h = [];
                    for (var i = 0; i < f.length; i++) {
                        if (f[i].level >= g) {
                            g = f[i].level;
                            switch (f[i].pre) {
                              case "_":
                                h.push("sub");
                                d += "<sub>";
                                d += f[i].value;
                                if (f[i].close) {
                                    d += "</" + h.pop() + ">";
                                }
                                break;

                              case "^":
                                h.push("sup");
                                d += "<sup>";
                                d += f[i].value;
                                if (f[i].close) {
                                    d += "</" + h.pop() + ">";
                                }
                                break;

                              case "\\emph":
                                h.push("i");
                                d += "<i>";
                                d += f[i].value;
                                if (f[i].close) {
                                    d += "</" + h.pop() + ">";
                                }
                                break;

                              case "\\textit":
                                h.push("i");
                                d += "<i>";
                                d += f[i].value;
                                if (f[i].close) {
                                    d += "</" + h.pop() + ">";
                                }
                                break;

                              case "\\textbf":
                                h.push("b");
                                d += "<b>";
                                d += f[i].value;
                                if (f[i].close) {
                                    d += "</" + h.pop() + ">";
                                }
                                break;

                              case "\\text":
                                d += f[i].value;
                                break;

                              default:
                                d += f[i].value;
                                if (f[i].close && h.length) {
                                    d += "</" + h.pop() + ">";
                                }
                                break;
                            }
                        } else {
                            g -= 1;
                            d += f[i].value;
                            if (f[i].close && h.length) {
                                d += "</" + h.pop() + ">";
                            }
                        }
                    }
                    while (h.length) {
                        pre = h.pop();
                        if (pre !== "") d += "</" + pre + ">";
                    }
                }
            }
            return d;
        },
        getHtmlAttribute: function(a, b) {
            var c;
            if ("attribs" in a) {
                if (b in a.attribs) c = a.attribs[b];
            } else {
                c = a.getAttribute(b);
            }
            return c;
        }
    };
    function e(a) {
        var b, c, d = [ "webkit", "moz", "o", "ms" ];
        for (b = 0; b < d.length && !c; b++) {
            c = window[d[b] + a];
        }
        return c;
    }
    function f(a) {
        return window.setTimeout(a, 1e3 / 60);
    }
})();

PP.Utils.apply = PP.Utils.extend;

PP.Utils.applyIf = PP.Utils.extendIf;

PP.pp = PP.Utils.prettyPrint;

var l1 = PP.Utils.createLogLevel([ "font-weight: bold;", "color: rgb(50, 50, 100)" ].join(""));

var l2 = PP.Utils.createLogLevel([ "color: rgb(50, 50, 50);", "margin-left: 2em;" ].join(""));

var l3 = PP.Utils.createLogLevel([ "color: rgb(150, 150, 150);", "margin-left: 4em;" ].join(""));

var l4 = PP.Utils.createLogLevel([ "font-style: italic;", "color: rgb(150, 150, 150);", "margin-left: 6em;" ].join(""));

var e1 = PP.Utils.createLogLevel([ "font-weight: bold;", "color: rgb(255, 50, 50);" ].join(""));

PP.Class = function() {};

PP.Class.extend = function(a) {
    var b = function(a) {
        if (a && PP.Utils.isObject(a)) {
            PP.Utils.apply(this, a);
        }
        if (this.debug === true) {
            this.c = console;
        } else {
            this.c = {
                log: function() {},
                warn: function() {},
                error: function() {
                    console.error(arguments);
                }
            };
        }
        if (this.initialize) {
            this.initialize.apply(this, arguments);
            if (this.debug === true) {
                this.c = console;
            }
        }
    };
    var c = function() {};
    c.prototype = this.prototype;
    var d = new c();
    d.constructor = b;
    b.prototype = d;
    for (var e in this) {
        if (this.hasOwnProperty(e) && e !== "prototype") {
            b[e] = this[e];
        }
    }
    if (a.statics) {
        PP.Utils.extend(b, a.statics);
        delete a.statics;
    }
    if (a.includes) {
        PP.Utils.extend.apply(null, [ d ].concat(a.includes));
        delete a.includes;
    }
    if (a.options && d.options) {
        a.options = PP.Utils.extend({}, d.options, a.options);
    }
    PP.Utils.extend(d, a);
    return b;
};

PP.Data = {
    hasKey: function(a) {
        for (var b = 0; b < this.fields.length; b++) {
            if (this.fields[b].name === a) {
                return true;
            }
        }
        return false;
    },
    getId: function() {
        return this.get("id");
    },
    get: function(a) {
        if (!this.hasKey(a) && this.allowNonFieldValues !== true) {
            console.error("get() error: no key " + a + " in data object!");
            console.error(this);
        } else {
            return this[a];
        }
    },
    set: function(a, b) {
        if (!this.hasKey(a) && this.allowNonFieldValues !== true) {
            console.error("set() error: no key " + a + " in data object!");
            console.error(this);
        } else {
            this[a] = b;
        }
    },
    serialize: function(a) {
        var b = this.fields;
        var c = {};
        for (var d = 0; d < b.length; d++) {
            var e = b[d].name;
            if (b[d].persist !== false || a === true) {
                if (this.get(e) !== undefined) {
                    c[e] = this.get(e);
                }
            }
        }
        return c;
    },
    getDefaults: function() {
        var a = this.fields;
        var b = {};
        for (var c = 0; c < a.length; c++) {
            var d = a[c].name;
            if (a[c].defaultValue === undefined) {
                console.error("No default value for field", a[c]);
                return null;
            } else {
                b[d] = a[c].defaultValue;
            }
        }
        return b;
    },
    isMissingFields: function() {
        var a = this.fields;
        for (var b = 0; b < a.length; b++) {
            var c = a[b].name;
            if (this[c] === undefined) {
                return true;
            }
        }
        return false;
    },
    apply: function(a) {
        for (var b in a) {
            this.set(b, a[b]);
        }
    },
    saveToChromeStorage: function(a) {
        if (window.chrome && window.chrome.storage) {
            var b = {};
            var c = this.getStorageKey();
            if (c === null) {
                console.log("data NOT saved -- storage key is null!");
                return;
            }
            b[c] = this.serialize();
            chrome.storage.local.set(b, function() {
                if (chrome.runtime.lastError) {
                    PP.Utils.callback(a, null, [ null, chrome.runtime.lastError ]);
                } else {
                    PP.Utils.callback(a, null, [ true, null ]);
                }
            });
        }
    },
    loadFromChromeStorage: function(a) {
        var b = this;
        if (window.chrome && window.chrome.storage) {
            var c = this.getStorageKey();
            if (c === null) {
                console.log("data NOT loaded -- storage key is null!");
                PP.Utils.callback(a, null, [ null, "Storage key is null" ]);
                return;
            }
            chrome.storage.local.get(c, function(d) {
                if (chrome.runtime.lastError) {
                    PP.Utils.callback(a, null, [ null, chrome.runtime.lastError ]);
                } else {
                    var e = d[c];
                    b.apply(e);
                    PP.Utils.callback(a, null, [ e, null ]);
                }
            });
        }
    },
    saveToLocalStorage: function(a) {
        var b = this.getStorageKey();
        if (b === null) {
            console.log("data NOT saved -- storage key is null!");
            return;
        }
        if (a !== true) {
            this.c.log("Saving", b, "to localStorage");
        }
        window.localStorage[b] = PP.Utils.encode(this.serialize());
    },
    clearLocalStorage: function() {
        var a = this.getStorageKey();
        if (a === null) {
            console.log("data NOT cleared -- storage key is null!");
        }
        delete window.localStorage[a];
    },
    loadFromLocalStorage: function() {
        var a = this.getStorageKey();
        if (a === null) {
            console.log("data NOT loaded -- storage key is null!");
            return;
        }
        if (this.debug) {
            console.log("Loading", a, "from localStorage");
        }
        var b = window.localStorage[a] || "{}";
        if (b.match(/object object/i)) {
            b = "{}";
        }
        var c = PP.Utils.decode(b);
        var d = Object.keys(c).length;
        if (d > 0) {
            this.apply(c);
        } else {
            console.log("  no localStorage for", a);
        }
    }
};

PP._Errors = PP.Class.extend({
    includes: [ PP.Events ],
    debug: false,
    listeningForErrors: false,
    errorCount: 0,
    startListeningForErrors: function() {
        this.listeningForErrors = true;
        if (!this.addedListener) {
            window.onerror = PP.Utils.bind(this.onError, this);
            this.addedListener = true;
        }
        if (window && window["jQuery"]) {
            jQuery.find.error = function(a) {
                PP.log({
                    type: "error",
                    subtype: "JQuery Sizzle",
                    msg: "Sizzle syntax error: " + a
                });
                throw new Error("Sizzle error: " + a);
            };
        }
    },
    stopListeningForErrors: function() {
        this.listeningForErrors = false;
    },
    onError: function(a, b, c, d, e) {
        var f = PP.Globals.getWindowId();
        if (!this.listeningForErrors) {
            console.log("Ignoring uncaught error: ", a);
            return;
        }
        if (c === 0) {
            console.log("Caught a non-Paperpile error. Not logging...");
            console.log(a);
            return false;
        }
        if (a === "Script error.") {
            console.log("Caught a non-paperpile error. Not logging...");
            console.log(a);
            return false;
        }
        var g;
        if (e) {
            g = e.stack;
        } else {
            g = d;
            d = undefined;
        }
        if (f === "cs" && b && b.match(/http/)) {
            console.log("Caught a non-paperpile error. Not logging...");
            console.log(a);
            return false;
        }
        if (a && PP.Utils.isString(a) && a["match"] && a.match(/error connecting to extension/i)) {
            var h = [ "ohdohjbmdpjmodcjkknnepbnbbmkmkcb", "bomfdkbfpdhijjbeoicnfhjbdhncfhig" ];
            var i = false;
            h.forEach(function(b) {
                if (a.match(b)) {
                    i = true;
                }
            });
            if (i) {
                PP.log({
                    type: "error",
                    subtype: "Error connecting to Paperpile extension",
                    msg: a
                });
            } else {
                console.log("Chrome error connecting to extension (error msg: '" + a + "')");
            }
            return false;
        }
        console.log("PP caught an error: \n msg:", a, "\n fileLocation:", b, "\n lineNumber:", c, "\n colNumber:", d, "\n stack:", g, "\n errorObject:", e);
        if (PP.Globals.isBackgroundPage()) {
            PP.Utils.createErrorWindow("BACKGROUND_PAGE");
            PP.log({
                type: "exception",
                subtype: "Extension Javascript",
                msg: a,
                fileLocation: b,
                lineNumber: c,
                colNumber: d,
                stack: g
            });
        } else if (PP.Globals.isWebApp()) {
            var j = true;
            var k = true;
            if (a && PP.Utils.isString(a) && a.match(/installation is already pending/i)) {
                j = false;
                k = false;
            }
            if (b && PP.Utils.isString(b) && b.match(/webstore/i)) {
                j = false;
                k = false;
            }
            if (j) {
                PP.Utils.createErrorStatus("Paperpile encountered an error", [ "STATUS_PANEL_RELOAD_WEBAPP" ]);
            }
            if (k) {
                PP.log({
                    type: "exception",
                    subtype: "Webapp Javascript",
                    msg: a,
                    fileLocation: b,
                    windowLocation: window.location.href,
                    lineNumber: c,
                    colNumber: d,
                    stack: g,
                    showedErrorStatusPanel: j
                });
            }
        } else if (PP.Globals.isDocsPlugin()) {
            if (b && PP.Utils.isString(b) && b.match(/docs\.google\.com\/static/i)) {
                console.log("Ignoring docs.google.com JS error!");
                return false;
            }
            if (b && PP.Utils.isString(b) && b.match(/searcho is not defined/i)) {
                console.log("Ignoring searcho error!");
                return false;
            }
            if (c == 1) {
                console.log("Ignoring lineNumber == 1 error!");
                return false;
            }
            PP.log({
                type: "exception",
                subtype: "Google Docs Javascript",
                msg: a,
                fileLocation: b,
                lineNumber: c,
                colNumber: d,
                windowId: window.PP_WINDOW_ID,
                windowLocation: window.location.href,
                stack: g
            });
        } else {
            var l = true;
            if (a && a.match(/cannot call method .(match|appendchild). of undefined/i)) {
                l = false;
            }
            if (a && a.match(/Cannot set property .display. of null/i)) {
                l = false;
            }
            if (l) {
                var m = window.location.href;
                if (PP.crawling && PP.crawling.MetaDriver) {
                    var n = PP.crawling.MetaDriver.getSupportingDriver(m);
                    var o;
                    if (n) {
                        o = n.name;
                    }
                    var p = PP.webimport.Utils.getSupportingWebImportPlugins(m);
                    var q = p.map(function(a) {
                        return a.getName();
                    });
                    if (!n && !p.length) {
                        m = window.location.host + " (logging domain only)";
                    } else if (!n && p.length) {
                        if (PP.Array.contains(q, "Google")) {
                            m = window.location.host + " (logging domain only)";
                        }
                    }
                }
                PP.log({
                    type: "exception",
                    subtype: "Content script Javascript",
                    msg: a,
                    fileLocation: b,
                    lineNumber: c,
                    windowId: window.PP_WINDOW_ID,
                    windowLocation: m,
                    webimportPlugins: q,
                    crawlerDrivers: o,
                    stack: g
                });
            }
        }
        PP.Errors.errorCount++;
        return false;
    },
    logErrorObject: function(a) {
        if (!this.listeningForErrors) {
            return;
        }
        var b = a.name + " " + a.message;
        var c = a.stack;
        var d, e;
        var f = /(at) (\S+) \((\S+)\)/;
        if (c) {
            var g = c.split("\n");
            var h = g[1];
            var i = h.match(f);
            if (i) {
                var j = i[3];
                var k = j.split(":");
                e = k[k.length - 2];
                var l = k.slice(0, k.length - 2);
                d = l.join("");
            }
        }
        this.onError(b, d, e, c);
    }
});

createSingleton(PP, "_Errors", "Errors");

var PP_EVENTS_KEY = "_pp_events";

var protectErrors = function(a) {
    var b = this;
    return function() {
        try {
            a.apply(b, arguments);
        } catch (a) {
            logError(a);
        }
    };
};

PP.Events = {
    addEventListener: function(a, b, c) {
        var d = this[PP_EVENTS_KEY] = this[PP_EVENTS_KEY] || {}, e, f, g;
        if (typeof a === "object") {
            for (e in a) {
                if (a.hasOwnProperty(e)) {
                    this.addEventListener(e, a[e], b);
                }
            }
            return;
        }
        a = PP.Utils.splitWords(a);
        for (f = 0, g = a.length; f < g; f++) {
            d[a[f]] = d[a[f]] || [];
            d[a[f]].push({
                action: b,
                context: c || this
            });
        }
        return;
    },
    hasEventListeners: function(a) {
        return PP_EVENTS_KEY in this && a in this[PP_EVENTS_KEY] && this[PP_EVENTS_KEY][a].length > 0;
    },
    removeEventListener: function(a, b, c) {
        var d = this[PP_EVENTS_KEY], e, f, g, h, i;
        if (typeof a === "object") {
            for (e in a) {
                if (a.hasOwnProperty(e)) {
                    this.removeEventListener(e, a[e], b);
                }
            }
            return this;
        }
        a = PP.Utils.splitWords(a);
        for (f = 0, g = a.length; f < g; f++) {
            if (this.hasEventListeners(a[f])) {
                h = d[a[f]];
                for (i = h.length - 1; i >= 0; i--) {
                    if ((!b || h[i].action === b) && (!c || h[i].context === c)) {
                        h.splice(i, 1);
                    }
                }
            }
        }
        return this;
    },
    fireEvent: function(a, b) {
        if (!this.hasEventListeners(a)) {
            return this;
        }
        var c = PP.Utils.extend({
            type: a,
            target: this
        }, b);
        var d = this[PP_EVENTS_KEY][a].slice();
        for (var e = 0, f = d.length; e < f; e++) {
            try {
                d[e].action.call(d[e].context || this, c);
            } catch (a) {
                if (PP.Errors) {
                    PP.Errors.logErrorObject(a);
                } else {
                    throw new Error("Error calling listener", a);
                }
            }
        }
        return this;
    },
    clearListeners: function() {
        var a = this[PP_EVENTS_KEY], b;
        for (var b in a) {
            if (a.hasOwnProperty(b)) {
                delete a[b];
            }
        }
    },
    removeAllListeners: function() {
        this.clearListeners();
    }
};

PP.Events.on = PP.Events.addEventListener;

PP.Events.un = PP.Events.removeEventListener;

PP.Events.fire = PP.Events.fireEvent;

PP._Features = PP.Class.extend({
    getPaperReferences: function() {
        return false;
    },
    mobileView: function() {
        return false;
    }
});

PP.Features = new PP._Features();

PP._Globals = PP.Class.extend({
    flags: {
        noPdfSupport: true
    },
    getMaxSyncFileSize: function() {
        return 1024 * 1024 * 20;
    },
    getWindowId: function() {
        return window.PP_WINDOW_ID;
    },
    hasNoUserInfo: function() {
        var a = PP.Session.get("user_id");
        return !a;
    },
    isTestEnvironment: function() {
        return this.getWindowId() === "test";
    },
    isContentScript: function() {
        return this.getWindowId() === "cs";
    },
    isAttachmentContentScript: function() {
        return this.getWindowId() === "attach";
    },
    isPopupView: function() {
        return this.getWindowId() === "pop";
    },
    isBackgroundPage: function() {
        return this.getWindowId() === "bg";
    },
    isDocAddOn: function() {
        return this.getWindowId() === "addon";
    },
    isWebApp: function() {
        return this.getWindowId() === "webapp";
    },
    isDocsPlugin: function() {
        return this.getWindowId() === "write";
    },
    isUploadIframe: function() {
        return this.getWindowId() === "upload";
    },
    isPdfIframe: function() {
        return this.getWindowId() === "pdfIframe";
    },
    isDev: function() {
        if (window.PP_EXTENSION_VERSION == "0") {
            return true;
        } else {
            return false;
        }
    },
    isStaging: function() {
        var a = this.getUrlBase();
        if (!this.isDev() && a.match(/stage/i)) {
            return true;
        } else {
            return false;
        }
    },
    isProduction: function() {
        return !this.isDev() && !this.isStaging();
    },
    isChrome: function() {
        var a = navigator.userAgent;
        var b = this.getOS();
        if (a.match(/chrome/i) && b !== "Android") {
            return true;
        } else {
            return false;
        }
    },
    getOS: function() {
        var a = "Unknown OS";
        if (navigator.appVersion.indexOf("Win") != -1) {
            a = "Windows";
        }
        if (navigator.appVersion.indexOf("Mac") != -1) {
            a = "MacOS";
        }
        if (navigator.appVersion.indexOf("CrOS") != -1) {
            a = "ChromeOS";
        } else if (navigator.appVersion.indexOf("X11") != -1) {
            a = "UNIX";
        }
        if (navigator.appVersion.indexOf("Linux") != -1) {
            a = "Linux";
        }
        if (navigator.appVersion.indexOf("Android") != -1) {
            a = "Android";
        }
        return a;
    },
    isLinux: function() {
        var a = this.getOS();
        return a === "Linux";
    },
    isMac: function() {
        var a = this.getOS();
        return a === "MacOS";
    },
    isWindows: function() {
        var a = this.getOS();
        return a === "Windows";
    },
    isChromeOS: function() {
        var a = this.getOS();
        return a === "ChromeOS";
    },
    getUrlBase: function() {
        var a = "https://stage.paperpile.com";
        if (window.location && window.location.href) {
            var b = window.location.href;
            if (b.match(/stage\.paperpile\.com/i)) {
                return a;
            }
        }
        if (window.chrome && window.chrome.extension) {
            var c = chrome.extension.getURL("");
            if (c.match(/ohdohjbmdpjmodcjkknnepbnbbmkmkcb/i)) {
                return a;
            }
        }
        return window.PP_URL_BASE;
    },
    url: function(a) {
        a = a.replace(/^\//, "");
        var b = this.getUrlBase();
        if (!b) {
            console.error("  Error: no server URL base!");
            return null;
        }
        a = b + "/" + a;
        return a;
    },
    getSharedFolderLink: function(a) {
        var b = a.alias;
        if (!b) {
            b = a._id;
        }
        var c = PP.Globals.getUrlBase();
        return c + "/shared/" + b;
    },
    getPubViewAttachmentUrl: function(a) {
        return PP.library.Attachment.getPubViewAttachmentUrl(a);
    },
    getSharedAttachmentUrl: function(a, b) {
        return PP.library.Attachment.getSharedAttachmentUrl(a, b);
    }
});

createSingleton(PP, "_Globals", "Globals");

PP._Licensing = PP.Class.extend({
    licenseTrialDaysLeft: function(a) {
        if (!a.license_trial_ends) {
            a.license_trial_ends = Date.now() / 1e3;
        }
        var b = new Date();
        var c = new Date(a.license_trial_ends * 1e3);
        var d = c.getTime() - b.getTime();
        var e = Math.ceil(d / (1e3 * 60 * 60 * 24));
        return e;
    },
    licenseStatus: function(a) {
        if (PP.TestFlags.testExpiredLicense()) {
            return "trial-expired";
        }
        if (a.license_forever_free) {
            return "active";
        }
        if (a.site !== "personal" && a.site_verified_date > 0) {
            return "active";
        }
        if (a.license_grace_period_ends) {
            if (a.license_grace_period_ends * 1e3 > Date.now()) {
                return "active";
            }
        }
        if (a.license_id) {
            if (a.license_seat_type === "free") {
                return "active";
            }
            if (a.subscription && a.subscription.status === "active") {
                return "active";
            }
            if (a.subscription && a.subscription.current_period_end) {
                if (a.subscription.current_period_end * 1e3 > Date.now()) {
                    return "active";
                }
            }
            return "inactive";
        } else {
            if (this.licenseTrialDaysLeft(a) <= 0) {
                return "trial-expired";
            } else {
                return "trial-active";
            }
        }
    },
    getShortStatusString: function(a) {
        if (PP.TestFlags.testExpiredLicense()) {
            return "Your trial has expired";
        }
        var b = this.licenseStatus(a);
        if (b == "trial-active") {
            var c = this.licenseTrialDaysLeft(a);
            return "Your trial has " + c + " day(s) remaining";
        } else if (b == "trial-expired") {
            return "Your trial has expired";
        } else if (b == "inactive") {
            return "Your license has expired";
        } else if (b == "active") {
            return "You have an active license";
        }
    },
    isInGoodStanding: function(a) {
        if (PP.TestFlags.testExpiredLicense()) {
            return false;
        }
        var b = this.licenseStatus(a);
        if (b == "active" || b == "trial-active") {
            return true;
        } else {
            return false;
        }
    }
});

createSingleton(PP, "_Licensing", "Licensing");

PP.Messenger = PP.Class.extend({
    includes: [ PP.Events ],
    passSelfMessages: false,
    logMessages: false,
    debug: false,
    disabled: false,
    initialize: function() {
        this.ports = {};
        this.portsTimesReconnected = {};
        this.callbacks = {};
        this.receiptExpected = {};
        this.receiptTimeout = {};
        this.timeouts = {};
        this.persistentPorts = {};
        this.listening = false;
        this.listenForCallbacks = true;
    },
    disableAllMessaging: function() {
        this.disabled = true;
    },
    handleAppFunctionMessages: function(a) {
        var b = this;
        b.on("message", function(c) {
            var d = c.msg;
            if (d.fn) {
                if (!a[d.fn]) {
                    b.c.log([ "No app function", d.fn ]);
                } else {
                    if (d.args === undefined) {
                        d.args = [];
                    } else if (!PP.Utils.isArray(d.args)) {
                        d.args = [ d.args ];
                    }
                    var e = PP.Utils.clone(d.args);
                    delete d.args;
                    e.push(d);
                    b.c.log("Calling fn", d.fn, "with args", e);
                    PP.Utils.callback(a[d.fn], a, e);
                }
            }
        });
    },
    getId: function() {
        return window.PP_WINDOW_ID;
    },
    connectPort: function(a, b) {
        if (this.ports[a]) {
            console.error("  already have a port by the name " + a + " - not connecting!");
            return;
        }
        this.c.log("Trying to connect to port " + a);
        if (typeof window.chrome !== "undefined" && chrome.runtime && chrome.runtime.onConnect) {
            var c;
            try {
                c = chrome.runtime.connect(chrome.runtime.id, {
                    name: a
                });
            } catch (a) {
                this.c.log(a);
            }
            if (c) {
                this._listenConnect(c);
                if (b === true) {
                    this.persistentPorts[a] = true;
                }
                return true;
            } else {
                this.c.log("Failed to connect to port ", a);
            }
        } else {
            this.c.error("Can't connect port: not running as a Chrome extension!");
        }
        return false;
    },
    listen: function() {
        if (typeof window.chrome !== "undefined" && chrome.runtime && chrome.runtime.onConnect && !this.listening) {
            this.listening = true;
            chrome.runtime.onConnect.addListener(PP.Utils.bind(this._listenConnect, this));
        }
    },
    listenPost: function() {
        var a = new Date().getTime();
        window._postListener = PP.Utils.bind(this.onPostMessage, this, [ a ]);
        window.addEventListener("message", window._postListener, false);
    },
    stopListenPost: function() {
        window.removeEventListener("message", window._postListener, false);
    },
    listenForSingleMessages: function() {
        var a = this;
        chrome.runtime.onMessage.addListener(function(b, c, d) {
            var e = {};
            console.log("Heard one-off message", b, c);
            PP.Utils.apply(e, b);
            e.tab = c.tab;
            a._onMessage(e);
        });
    },
    onPostMessage: function(a, b) {
        if (this.destroyed) {
            return;
        }
        var c = a.data;
        this._onMessage(c);
    },
    _onMessage: function(a) {
        if (a.targetId !== undefined) {
            if (a.targetId !== this.getId()) {
                return;
            }
        }
        if (a.fromOutsideExtension && !a.tab) {
            if (!this.passSelfMessages) {
                return;
            }
        } else {}
        if (!PP.Utils.isObject(a)) {
            console.log("Extension message is not an object", a);
            return;
        }
        var b = Object.keys(a);
        var c = "[" + PP.Utils.ellipsis(b.join(", "), 150, null, "") + "]";
        if (a.fn) {
            c += ', app function "' + a.fn + '"';
        }
        if (this.logMessages) {
            if (a.crudResponse) {}
            console.log("<\tmsg " + c + " from " + a.source);
        }
        if (this.listenForCallbacks && a.isCallbackResponse) {
            var d = a.callbackId;
            var e = a.callbackArgs;
            if (this.callbacks[d]) {
                PP.Utils.callback(this.callbacks[d], this, e);
                delete this.callbacks[d];
                var f = this.timeouts[d];
                if (f) {
                    window.clearTimeout(f);
                    delete this.timeouts[a.callbackId];
                }
                this.clearLoadingMessage();
            } else {
                this.c.log("CALLBACK NOT FOUND", d);
            }
            return;
        }
        this.fire("message", {
            msg: a
        });
    },
    clearLoadingMessage: function() {
        if (this.loadingMessageTimeout) {
            window.clearTimeout(this.loadingMessageTimeout);
            delete this.loadingMessageTimeout;
        }
        if (this.loadingMessageObject) {
            PP.backend.Utils.clearLoadingMessage(this.loadingMessageObject);
            delete this.loadingMessageObject;
        }
    },
    onMessage: function(a, b) {
        if (this.destroyed) {
            return;
        }
        if (a) {
            var c = b.name;
            if (a.requestReceipt) {
                this.c.log("Got message with requested receipt", a.requestReceipt);
                b.postMessage({
                    sendReceipt: a.requestReceipt
                });
            }
            if (a.sendReceipt) {
                this.c.log("Got receipt with id and clear timeout", a.sendReceipt, this.receiptExpected[c]);
                if (a.sendReceipt === this.receiptExpected[c]) {
                    this.c.log("Clearing receipt timeout", this.receiptTimeout[c]);
                    window.clearTimeout(this.receiptTimeout[c]);
                    this.receiptExpected[c] = null;
                    this.receiptTimeout[c] = null;
                }
            }
        }
        if (b.sender) {
            a.tab = b.sender.tab;
        }
        this._onMessage(a);
    },
    callback: function(a, b) {
        if (!PP.Utils.isArray(b)) {
            b = [ b ];
        }
        var c = {
            isCallbackResponse: true,
            callbackId: a.callbackId,
            callbackArgs: b
        };
        this.sendMessage(c);
    },
    sendMessage: function(a) {
        var b = this;
        if (this.destroyed) {
            return;
        }
        if (this.disabled === true) {
            return;
        }
        if (!a.source) {
            a.source = this.getId();
        }
        a.isFromPaperpile = true;
        if (!this.guid) {
            this.guid = PP.UUID.generate();
        }
        a.source_guid = this.guid;
        if (a.callback) {
            if (a.loadingMessage) {
                var b = this;
                var c = a.loadingMessageDelay || 1e3;
                this.loadingMessageTimeout = window.setTimeout(function() {
                    b.loadingMessageObject = PP.backend.Utils.showLoadingMessage(a.loadingMessage);
                }, c);
            }
            var d = PP.UUID.generate();
            var e = a.callback;
            this.callbacks[d] = e;
            delete a.callback;
            a.callbackId = d;
            if (a.timeout) {
                var f = PP.Utils.bind(function() {
                    this.clearLoadingMessage();
                    PP.Utils.callback(e, this, [ null, "Callback timed out." ]);
                }, this);
                var g = window.setTimeout(f, a.timeout);
                delete a.timeout;
                this.timeouts[d] = g;
            }
        }
        if (typeof window.chrome === "undefined" || !chrome.runtime || !chrome.runtime.getManifest) {
            a.fromOutsideExtension = true;
            this.sendPostMessage(a);
            var h = Object.keys(a);
            if (a.crudResponse) {}
            var i = "[" + PP.Utils.ellipsis(h.join(", "), 150, null, "") + "]";
            if (this.logMessages) {}
            return;
        }
        if (a.targetTab !== undefined) {
            for (var j in this.ports) {
                if (this.ports.hasOwnProperty(j)) {
                    var k = this.ports[j];
                    if (k.sender && k.sender.tab && k.sender.tab.id === a.targetTab) {
                        this.c.log("--> Sending msg", a, "to target tab: ", a.targetTab);
                        this._addReceiptTimeout(k, a);
                        k.postMessage(a);
                    }
                }
            }
        } else {
            var l = false;
            for (var j in this.ports) {
                if (this.ports.hasOwnProperty(j)) {
                    l = true;
                    var k = this.ports[j];
                    j = PP.Utils.ellipsis(j, -30, null, "");
                    var h = Object.keys(a);
                    var i = "[" + PP.Utils.ellipsis(h.join(", "), 150, null, "") + "]";
                    if (a.fn) {
                        i += ', app function "' + a.fn + '"';
                    }
                    if (this.logMessages) {
                        console.log(" >\tmsg " + i + " to port " + j);
                    }
                    this._addReceiptTimeout(k, a);
                    k.postMessage(a);
                }
            }
        }
        if (!l) {
            if (a.source && a.source == "webapp") {
                if (!a.backgroundPing) {
                    b.fire("disconnect", {
                        portName: "background-dummy",
                        info: "port disconnected; no ports available"
                    });
                }
            }
        }
    },
    _addReceiptTimeout: function(a, b) {
        var c = this;
        var d = a.name;
        if (!this.receiptExpected[d] && PP.Msg.getId() !== "bg") {
            c.receiptExpected[d] = PP.UUID.generate();
            c.receiptTimeout[d] = window.setTimeout(function() {
                c.c.log("Did not get response for", c.receiptExpected[d], b, d);
                c.reconnect(d, b);
                c.receiptExpected[d] = null;
                c.receiptTimeout[d] = null;
            }, 1e3);
            b.requestReceipt = c.receiptExpected[d];
            c.c.log("Setting up receipt timeout", c.receiptTimeout[d], b.requestReceipt);
        }
    },
    sendPostMessage: function(a) {
        if (!a.source) {
            a.source = this.getId();
        }
        a.isFromPaperpile = true;
        if (window.isWorker) {
            postMessage(a);
        } else {
            window.postMessage(a, "*");
        }
    },
    _listenConnect: function(a) {
        var b = this;
        this.ports[a.name] = a;
        if (!(a.name in b.portsTimesReconnected)) {
            b.portsTimesReconnected[a.name] = 0;
        }
        for (var c in this.ports) {
            this.c.log("  [port summary ]" + c);
        }
        var d = PP.Utils.bind(this.onMessage, this, [ a ]);
        var e = a.name;
        var f = function(a) {
            delete b.ports[e];
            b.c.log("Port disconnected ", e);
            if (window._postListener) {}
            var c = true;
            if (b.persistentPorts[e]) {
                if (e in b.portsTimesReconnected && b.portsTimesReconnected[e] < 3) {
                    c = false;
                    b.portsTimesReconnected[e]++;
                    console.log("Disconnect from port received. Trying to reconnect persistent port " + e + " for the " + b.portsTimesReconnected[e] + " time");
                    b.reconnect(e, null, 500);
                }
            }
            if (c) {
                b.fire("disconnect", {
                    portName: e,
                    info: "port disconnected; tried 3 times to reconnect"
                });
            }
        };
        a.onMessage.addListener(d);
        a.onDisconnect.addListener(f);
        this.fire("connect", {
            port: a
        });
        this.c.log("Port successfully connected ", e);
    },
    reconnect: function(a, b, c) {
        if (c === null || c === undefined) {
            c = 100;
        }
        var d = this;
        delete this.ports[a];
        PP.Utils.defer(function() {
            var c = d.connectPort(a, true);
            if (!c) {
                d.fire("lost_connection", {
                    portName: a
                });
            } else {
                d.c.log("Connected again to port", a);
                d.fire("reconnected", {
                    portName: a
                });
                if (b) {
                    d.sendMessage(b);
                }
            }
        }, c);
    },
    old_reconnect: function(a, b) {
        var c = this;
        if (b === undefined) {
            b = {
                retryCount: 0,
                delay: 250
            };
        }
        if (c.ports[a]) {
            c.c.log("  reconnected to port ", a, " -- stopping reconnect loop!");
            return;
        }
        if (b.retryCount === 5) {
            c.fire("lost_connection", {
                portName: a
            });
        }
        if (b.retryCount > 10) {
            c.c.log("  taking a long time to reconnect... maybe it's really gone");
        } else {
            c.c.log("  reconnection try #", b.retryCount);
        }
        PP.Utils.defer(function() {
            b.retryCount += 1;
            b.delay *= 2;
            var d = c.connectPort(a, true);
            if (!d) {
                c.reconnect(a, b);
            } else {
                c.c.log("  Connected again to port", a);
            }
        }, b.delay);
    },
    destroy: function() {
        this.destroyed = true;
    }
});

createSingleton(PP, "Messenger", "Msg");

PP._Session = PP.Class.extend({
    includes: [ PP.Data, PP.Events ],
    debug: false,
    fields: [ {
        name: "user_id"
    }, {
        name: "google_id"
    }, {
        name: "google_name"
    }, {
        name: "google_email"
    }, {
        name: "google_access_token"
    }, {
        name: "server_url_base"
    } ],
    get: function(a) {
        var b = PP.Data.get.call(this, a);
        if (a === "user_id" && !b) {}
        return b;
    },
    isLoaded: function() {
        return this.hasUserId();
    },
    load: function() {
        if (!this.isLoaded()) {
            this.loadFromDom();
            if (!this.isLoaded()) {
                if (!this.isLoaded()) {
                    this.loadFromServer();
                    if (!this.isLoaded()) {
                        PP.Utils.defer(function() {
                            PP.Msg.sendMessage({
                                sessionInfoRequest: true
                            });
                            if (PP.bg && PP.bg.LoginState) {
                                PP.bg.LoginState.pingServer();
                            }
                        }, 1e3);
                    } else {
                        this.c.log("  loaded session from server!");
                    }
                } else {
                    this.c.log("  loaded session from localStorage!");
                }
            } else {
                this.c.log("  loaded session from DOM!");
            }
        }
    },
    loadFromDom: function() {
        (function(a) {
            a.fn.getAttributes = function() {
                var b = {};
                if (!this.length) return this;
                a.each(this[0].attributes, function(a, c) {
                    b[c.name] = c.value;
                });
                return b;
            };
        })(jQuery);
        $(PP.Utils.bind(function() {
            var a = $("#pp-session");
            if (a.length === 1) {
                var b = a.getAttributes();
                delete b["id"];
                this.apply(b);
            }
        }, this));
    },
    loadFromServer: function() {
        var a = this;
        PP.Ajax.request({
            url: PP.Globals.url("/ajax/app/ping"),
            callback: function(b, c, d) {
                if (b.session) {
                    a.apply(b.session);
                    a.fire("update");
                }
            }
        });
    },
    initialize: function() {
        PP.Msg.on("message", this.onMessage, this);
    },
    broadcastSession: function() {
        var a = this.serialize();
        PP.Msg.sendMessage({
            session: a
        });
    },
    onMessage: function(a) {
        var b = a.msg;
        if (b.session) {
            this.c.log("  loading session from message!");
            this.loadFromMessage(b);
        }
        if (b.clearSession) {
            this.c.log("  Clearing session from message!");
            this.clear();
        }
        if (b.sessionInfoRequest) {
            if (this.hasUserId()) {
                PP.Msg.sendMessage({
                    targetId: b.source,
                    session: this.serialize()
                });
            }
        }
    },
    doWhenReady: function(a) {
        if (this.isLoaded()) {
            a.call(this);
        } else {
            this.on("ready", a);
            this.load();
        }
    },
    getStorageKey: function() {
        return "PP.Session";
    },
    hasUserId: function() {
        return this["user_id"] !== undefined;
    },
    loadFromMessage: function(a) {
        this.apply(a.session);
        this.fire("update");
    },
    clear: function() {
        this.clearLocalStorage();
        var a = this.fields;
        for (var b = 0; b < a.length; b++) {
            var c = a[b].name;
            this.set(c, null);
        }
        this.c.log("  cleared Session:", this.serialize());
        this.fire("clear");
    },
    apply: function(a) {
        var b = this["user_id"];
        PP.Data.apply.call(this, a);
        var c = this["user_id"];
        if (b === undefined && c !== undefined) {
            this.fire("ready");
        } else if (b && c && b !== c) {
            this.fire("newid");
            this.c.log("  new session user ID!");
        } else if (c === undefined) {}
        if (c !== undefined) {
            this.saveToLocalStorage();
        }
    }
});

createSingleton(PP, "_Session", "Session");

PP._String = PP.Class.extend({
    truncate: function(a, b, c) {
        var d = {}, e = "", f = [ "img" ], g = [], h = 0, i = e, j = '(\\w+\\s*=\\s*"[^"]*"\\s*)*', k = "\\s*\\/?\\s*", l = "\\s*\\/\\s*", m = new RegExp("<\\/?\\w+\\s*" + j + l + ">"), n = new RegExp("<\\/?\\w+\\s*" + j + k + ">"), o = new RegExp("<img\\s*" + j + k + ">"), p = true, q, r, s, t, u;
        var v = function(a) {
            var b = o.exec(a), c, d;
            if (!b) {
                return a;
            }
            c = b.index;
            d = b[0].length;
            return a.substring(0, c) + a.substring(c + d);
        };
        var w = function(a) {
            var b = "";
            a.reverse().forEach(function(a, c) {
                if (-1 === f.indexOf(a)) {
                    b += "</" + a + ">";
                }
            });
            return b;
        };
        var x = function(a) {
            var b = a.indexOf(" ");
            if (-1 === b) {
                b = a.indexOf(">");
                if (-1 === b) {
                    console.log("HTML tag is not well-formed : " + a);
                }
            }
            return a.substring(1, b);
        };
        c = c || d;
        c.ellipsis = c.ellipsis || "...";
        while (p) {
            p = n.exec(a);
            if (!p) {
                if (h < b) {
                    i += a.substring(0, b - h);
                }
                break;
            }
            q = p[0];
            r = p.index;
            if (h + r > b) {
                i += a.substring(0, b - h);
                break;
            } else {
                h += r;
                i += a.substring(0, r);
            }
            if ("/" === q[1]) {
                g.pop();
            } else {
                u = m.exec(q);
                if (!u) {
                    t = x(q);
                    g.push(t);
                }
            }
            if (u) {
                i += u[0];
            } else {
                i += q;
            }
            a = a.substring(r + q.length);
        }
        if (a.length > b && c.ellipsis) {
            i += c.ellipsis;
        }
        i += w(g);
        if (!c.keepImageTag) {
            i = v(i);
        }
        return i;
    },
    stripHtml: function(a, b) {
        if (a === undefined) return "";
        var c = {
            replacement: "",
            exclude: []
        };
        PP.Utils.apply(c, b || {});
        var d = [ a ];
        if (c.exclude.length > 0) {
            d = [];
            for (var e = 0; e < c.exclude.length; e++) {
                d.push("<" + c.exclude[e] + "[^>]*>");
                d.push("<\\/" + c.exclude[e] + "[^>]*>");
            }
            var f = "(" + d.join("|") + ")";
            d = a.split(new RegExp(f, ""));
        }
        for (var e = 0; e < d.length; e += 2) {
            d[e] = d[e].replace(/<(?:.|\n)*?>/gm, c.replacement);
        }
        return d.join("");
    },
    escapeBraces: function(a) {
        a = a || "";
        var b = a.split("");
        for (var c = 0; c < b.length; c++) {
            if (b[c] === "{" || b[c] === "}") {
                if (c > 0) {
                    if (b[c - 1] !== "\\") {
                        b[c] = "\\" + b[c];
                    }
                } else {
                    b[c] = "\\" + b[c];
                }
            }
        }
        return b.join("");
    },
    htmlToPlainText: function(a) {
        if (a === undefined) return "";
        a = a.replace(/<br\/>/g, "\n");
        a = this.stripHtml(a, {
            replacement: "",
            exclude: []
        });
        a = $("<div/>").html(a).text();
        return a;
    },
    upperFirst: function(a) {
        a = a.charAt(0).toUpperCase() + a.substr(1);
        return a;
    },
    _stripBracesMarkup: function(a) {
        var b = a.split("");
        for (var c = 0; c < b.length; c++) {
            if (b[c] === "{" || b[c] === "}") {
                if (c > 0) {
                    if (b[c - 1] === "\\") {
                        b[c - 1] = "";
                    } else {
                        b[c] = "";
                    }
                } else {
                    b[c] = "";
                }
            }
        }
        return b.join("");
    },
    toTitleCase: function(a) {
        if (!a) return "";
        var b = [];
        b = b.concat([ "the", "a", "an", "some" ]);
        b = b.concat([ "as", "because", "for", "and", "nor", "but", "or", "yet", "so" ]);
        b = b.concat([ "a", "abaft", "aboard", "about", "above", "absent", "across", "afore", "after", "against", "along", "alongside", "amid", "amidst", "among", "amongst", "an", "apropos", "apud", "around", "as", "aside", "astride", "at", "athwart", "atop", "barring", "before", "behind", "below", "beneath", "beside", "besides", "between", "beyond", "but", "by", "circa", "concerning", "despite", "down", "during", "except", "excluding", "failing", "following", "for", "forenenst", "from", "given", "in", "including", "inside", "into", "like", "mid", "midst", "minus", "modulo", "near", "next", "notwithstanding", "o'", "of", "off", "on", "onto", "opposite", "out", "outside", "over", "pace", "past", "per", "plus", "pro", "qua", "regarding", "round", "sans", "save", "since", "than", "through", "throughout", "thru", "thruout", "till", "times", "to", "toward", "towards", "under", "underneath", "unlike", "until", "unto", "up", "upon", "versus", "via", "vice", "vis-\xe0-vis", "with", "within", "without", "worth" ]);
        a = a.split(/([\t\r\n\s])+/);
        for (var c = 0; c < a.length; c++) {
            if (!a[c].match(/[\t\r\n\s]/)) {
                a[c] = a[c].toLowerCase();
                if (b.indexOf(a[c]) == -1 || c === 0) {
                    var d = a[c].split(/(-)/);
                    for (var e = 0; e < d.length; e++) {
                        d[e] = d[e].charAt(0).toUpperCase() + d[e].substr(1).toLowerCase();
                    }
                    a[c] = d.join("");
                }
            }
        }
        a = a.join("");
        a = a.replace(/\b(rna|dna|usa|hiv)/gi, function(a) {
            return a.toUpperCase();
        });
        return a;
    },
    interconvertString: function(a, b) {
        var c = this;
        var d = {
            format: "plain"
        };
        PP.Utils.apply(d, b || {});
        var e = a || "";
        if (d.format === "nomarkup") {
            e = this._stripBracesMarkup(e);
            e = e.replace(/\\(textit|textbf|emph)/g, "");
            e = e.replace(/<(i|b|sub|sup)>/g, "");
            e = e.replace(/<\/(i|b|sub|sup)>/g, "");
        } else if (d.format === "html") {
            var f = new RegExp("(.*)(\\\\(?:textit|textbf|emph)\\{)(.*)", "g");
            var g;
            var h = 0;
            while ((g = f.exec(e)) !== null) {
                if (h++ > 100) break;
                if (g[3]) {
                    var i = g[2].match(/(textit|emph)/) ? "i" : "b";
                    var j = g[3].split("");
                    var k = 1;
                    var l = 0;
                    var m = 0;
                    for (var n = 0; n < j.length; n++) {
                        if (j[n] === "{") k++;
                        if (j[n] === "}") {
                            l++;
                            if (l == k) {
                                j[n] = "</" + i + ">";
                                g[2] = "<" + i + ">";
                                m = 1;
                                break;
                            }
                        }
                    }
                    if (m == 0) {
                        g[2] = "";
                    }
                    g[3] = j.join("");
                    e = g[1] + g[2] + g[3];
                    f.lastIndex = 0;
                }
            }
            var j = e.split(/(\$)/);
            for (var o = 0; o < j.length; o++) {
                if (j[o] == "$") {
                    if (j[o + 2] == "$") {
                        if (j[o + 1].match(/^_\{([^\}\{]+)\}$/)) {
                            j[o] = "<sub>";
                            j[o + 1] = RegExp.$1;
                            j[o + 2] = "</sub>";
                        } else if (j[o + 1].match(/^_(.)$/)) {
                            j[o] = "<sub>";
                            j[o + 1] = RegExp.$1;
                            j[o + 2] = "</sub>";
                        } else if (j[o + 1].match(/^\^\{([^\}\{]+)\}$/)) {
                            j[o] = "<sup>";
                            j[o + 1] = RegExp.$1;
                            j[o + 2] = "</sup>";
                        } else if (j[o + 1].match(/^\^(.)$/)) {
                            j[o] = "<sup>";
                            j[o + 1] = RegExp.$1;
                            j[o + 2] = "</sup>";
                        } else if (j[o + 1].match(/^(\\[a-z]+)$/i)) {
                            if (RegExp.$1 in c.latexUnicodeMath) {
                                j[o] = "";
                                j[o + 1] = c.latexUnicodeMath[RegExp.$1];
                                j[o + 2] = "";
                            }
                        } else if (j[o + 1].match(/^[^\\]+$/i)) {
                            j[o] = "";
                            j[o + 2] = "";
                        }
                    }
                }
            }
            e = j.join("");
            e = this._stripBracesMarkup(e);
        } else if (d.format === "bibtex") {
            var f = new RegExp("(.*)(<\\/?(?:i|b|sub|sup)>)(.*)", "g");
            var g;
            var h = 0;
            while ((g = f.exec(e)) !== null) {
                if (h++ > 100) break;
                if (g[2]) {
                    if (g[2].match(/\//)) {
                        if (g[2].match(/(sub|sup)/)) {
                            g[2] = "}$";
                        } else {
                            g[2] = "}";
                        }
                    } else {
                        if (g[2].match(/<\s*b\s*>/)) {
                            g[2] = "\\textbf{";
                        } else if (g[2].match(/<\s*i\s*>/)) {
                            g[2] = "\\textit{";
                        } else if (g[2].match(/sub/)) {
                            g[2] = "$_{";
                        } else if (g[2].match(/sup/)) {
                            g[2] = "$^{";
                        }
                    }
                }
                e = g[1] + g[2];
                if (g[3]) e += g[3];
                f.lastIndex = 0;
            }
            e = e.replace(/&lt;/g, "<");
            e = e.replace(/&gt;/g, ">");
            e = e.replace(/&amp;/g, "&");
        }
        return e;
    },
    removeControlChars: function(a) {
        a = a || "";
        a = a.replace(/\r\n/g, "\n");
        a = a.replace(/\r/g, "\n");
        a = a.replace(/[\x00-\x08\x0B-\x1F\x7F]/g, "");
        return a;
    },
    latexUnicodeASCII_1: {
        "'": {
            A: "\xc1",
            C: "\u0106",
            E: "\xc9",
            I: "\xcd",
            L: "\u0139",
            N: "\u0143",
            O: "\xd3",
            R: "\u0154",
            S: "\u015a",
            U: "\xda",
            Y: "\xdd",
            Z: "\u0179",
            a: "\xe1",
            c: "\u0107",
            e: "\xe9",
            g: "\u01f5",
            "\\i": "\xed",
            l: "\u013a",
            n: "\u0144",
            o: "\xf3",
            r: "\u0155",
            s: "\u015b",
            u: "\xfa",
            y: "\xfd",
            z: "\u017a"
        },
        "`": {
            A: "\xc0",
            E: "\xc8",
            I: "\xcc",
            O: "\xd2",
            U: "\xd9",
            a: "\xe0",
            e: "\xe8",
            "\\i": "\xec",
            o: "\xf2",
            u: "\xf9"
        },
        '"': {
            A: "\xc4",
            E: "\xcb",
            I: "\xcf",
            O: "\xd6",
            U: "\xdc",
            Y: "\u0178",
            a: "\xe4",
            e: "\xeb",
            "\\i": "\xef",
            o: "\xf6",
            u: "\xfc",
            y: "\xff"
        },
        "^": {
            A: "\xc2",
            C: "\u0108",
            E: "\xca",
            G: "\u011c",
            H: "\u0124",
            I: "\xce",
            J: "\u0134",
            O: "\xd4",
            S: "\u015c",
            U: "\xdb",
            W: "\u0174",
            Y: "\u0176",
            a: "\xe2",
            c: "\u0109",
            e: "\xea",
            g: "\u011d",
            h: "\u0125",
            "\\i": "\xee",
            "\\j": "\u0135",
            o: "\xf4",
            s: "\u015d",
            u: "\xfb",
            w: "\u0175",
            y: "\u0177"
        },
        "~": {
            A: "\xc3",
            I: "\u0128",
            N: "\xd1",
            O: "\xd5",
            U: "\u0168",
            a: "\xe3",
            "\\i": "\u0129",
            n: "\xf1",
            o: "\xf5",
            u: "\u0169"
        },
        "=": {
            A: "\u0100",
            E: "\u0112",
            I: "\u012a",
            O: "\u014c",
            U: "\u016a",
            a: "\u0101",
            e: "\u0113",
            "\\i": "\u012b",
            o: "\u014d",
            u: "\u016b"
        },
        ".": {
            C: "\u010a",
            E: "\u0116",
            G: "\u0120",
            I: "\u0130",
            L: "\u013f",
            Z: "\u017b",
            c: "\u010b",
            e: "\u0117",
            g: "\u0121",
            l: "\u0140",
            z: "\u017c"
        },
        H: {
            O: "\u0150",
            U: "\u0170",
            o: "\u0151",
            u: "\u0171"
        },
        c: {
            C: "\xc7",
            G: "\u0122",
            K: "\u0136",
            L: "\u013b",
            N: "\u0145",
            R: "\u0156",
            S: "\u015e",
            T: "\u0162",
            c: "\xe7",
            g: "\u0123",
            k: "\u0137",
            l: "\u013c",
            n: "\u0146",
            r: "\u0157",
            s: "\u015f",
            t: "\u0163"
        },
        k: {
            A: "\u0104",
            E: "\u0118",
            I: "\u012e",
            U: "\u0172",
            a: "\u0105",
            e: "\u0119",
            i: "\u012f",
            u: "\u0173"
        },
        r: {
            U: "\u016e",
            u: "\u016f"
        },
        u: {
            A: "\u0102",
            E: "\u0114",
            G: "\u011e",
            I: "\u012c",
            O: "\u014e",
            U: "\u016c",
            a: "\u0103",
            e: "\u0115",
            g: "\u011f",
            "\\i": "\u012d",
            o: "\u014f",
            u: "\u016d"
        },
        v: {
            C: "\u010c",
            D: "\u010e",
            E: "\u011a",
            L: "\u013d",
            N: "\u0147",
            R: "\u0158",
            S: "\u0160",
            T: "\u0164",
            Z: "\u017d",
            c: "\u010d",
            d: "\u010f",
            e: "\u011b",
            l: "\u013e",
            n: "\u0148",
            r: "\u0159",
            s: "\u0161",
            t: "\u0165",
            z: "\u017e"
        }
    },
    latexUnicodeASCII_2: {
        AA: "\xc5",
        AE: "\xc6",
        DH: "\xd0",
        DJ: "\u0110",
        L: "\u0141",
        NG: "\u014a",
        O: "\xd8",
        OE: "\u0152",
        TH: "\xde",
        aa: "\xe5",
        ae: "\xe6",
        dh: "\xf0",
        dj: "\u0111",
        i: "\u0131",
        l: "\u0142",
        ng: "\u014b",
        o: "\xf8",
        oe: "\u0153",
        ss: "\xdf",
        th: "\xfe"
    },
    latexUnicodeASCII_3: {
        "\\pounds": "\xa3",
        "\\texttimes": "\xd7",
        "\\copyright": "\xa9",
        "\\textasciimacron": "\xaf",
        "\\textcent": "\xa2",
        "\\textregistered": "\xae",
        "\\?\\`": "\xbf",
        "\\!\\`": "\xa1",
        "--": "\u2013",
        "---": "\u2014"
    },
    latexUnicodeASCII_4: {
        "\\texttildelow": "~",
        "\\textdollar": "$",
        "\\textunderscore": "_",
        "\\textbackslash": "\\",
        "\\backslash": "\\",
        "\\%": "%",
        "\\$": "$",
        "\\&": "&",
        "\\#": "#",
        "\\_": "_"
    },
    latexUnicodeMath: {
        A: "\u0391",
        B: "\u0392",
        "\\Gamma": "\u0393",
        "\\Delta": "\u0394",
        E: "\u0395",
        Z: "\u0396",
        H: "\u0397",
        "\\Theta": "\u0398",
        I: "\u0399",
        K: "\u039a",
        "\\Lambda": "\u039b",
        M: "\u039c",
        N: "\u039d",
        "\\Xi": "\u039e",
        O: "\u039f",
        "\\Pi": "\u03a0",
        P: "\u03a1",
        "\\Sigma": "\u03a3",
        T: "\u03a4",
        "\\Upsilon": "\u03a5",
        "\\Phi": "\u03a6",
        X: "\u03a7",
        "\\Psi": "\u03a8",
        "\\Omega": "\u03a9",
        "\\alpha": "\u03b1",
        "\\beta": "\u03b2",
        "\\gamma": "\u03b3",
        "\\delta": "\u03b4",
        "\\varepsilon": "\u03b5",
        "\\epsilon": "\u03b5",
        "\\zeta": "\u03b6",
        "\\eta": "\u03b7",
        "\\theta": "\u03b8",
        "\\vartheta": "\u03b8",
        "\\iota": "\u03b9",
        "\\kappa": "\u03ba",
        "\\lambda": "\u03bb",
        "\\mu": "\u03bc",
        "\\nu": "\u03bd",
        "\\xi": "\u03be",
        o: "\u03bf",
        "\\pi": "\u03c0",
        "\\varpi": "\u03d6",
        "\\rho": "\u03c1",
        "\\varrho": "\u03f1",
        "\\sigma": "\u03c3",
        "\\varsigma": "\u03c2",
        "\\tau": "\u03c4",
        "\\upsilon": "\u03c5",
        "\\phi": "\u03c6",
        "\\varphi": "\u03c6",
        "\\chi": "\u03c7",
        "\\psi": "\u03c8",
        "\\omega": "\u03c9",
        "\\leq": "\u2264",
        "\\geq": "\u2265",
        "\\in": "\u2208",
        "\\infty": "\u221e",
        "\\int": "\u222b",
        "\\exists": "\u2203",
        "\\forall": "\u2200",
        "\\partial": "\u2202",
        "\\pm": "\xb1",
        "\\prod": "\u220f",
        "\\neg": "\xac",
        "\\neq": "\u2260",
        "\\not\\in": "\u2209",
        "\\times": "\xd7",
        "\\subset": "\u2282",
        "\\sum": "\u2211",
        "\\supset": "\u2283",
        "\\surd": "\u221a",
        "\\approx": "\u2248",
        "\\bot": "\u22a5",
        "\\cap": "\u2229",
        "\\cdot": "\u22c5",
        "\\cup": "\u222a",
        "\\div": "\xf7",
        "\\emptyset": "\u2205",
        "\\equiv": "\u2261",
        "\\to": "\u2192",
        "\\vee": "\u2228",
        "\\wedge": "\u2227",
        "\\Leftrightarrow": "\u21d4",
        "\\Rightarrow": "\u21d2",
        "\\rightarrow": "\u2192"
    },
    _latex2Unicode: function(a) {
        var b;
        var c = this;
        if (a) {
            var d = a.match(/\\(['"\.=H\^`ckruv~])\s*\{*(\\?[A-Z])/i);
            if (d && d.length == 3) {
                if (c.latexUnicodeASCII_1[d[1]] && c.latexUnicodeASCII_1[d[1]][d[2]]) {
                    b = c.latexUnicodeASCII_1[d[1]][d[2]];
                }
            }
            if (!b) {
                d = a.match(/\\([A-Z])\{?([A-Z]?)\}?/i);
                if (d && d.length == 3) {
                    b = c.latexUnicodeASCII_2[d[1] + d[2]];
                }
            }
            if (!b) {
                if (c.latexUnicodeASCII_3[a]) b = c.latexUnicodeASCII_3[a];
            }
            if (!b) {
                if (c.latexUnicodeASCII_4[a]) b = c.latexUnicodeASCII_4[a];
            }
        }
        return b;
    },
    _latexMarkBraces: function(a) {
        var b = {};
        var c;
        if (a) {
            var d = 0;
            var e = 0;
            var f = {};
            var g = a.split(/([\{\}])/);
            var h = -1;
            for (var i = 0; i < g.length; i++) {
                h += g[i].length;
                if (g[i] == "{") {
                    d++;
                    c = true;
                    if (i > 0 && g[i - 1] == "\\") c = false;
                    if (c) {
                        e++;
                        f[e] = d;
                        b[h] = d;
                    }
                } else if (g[i] == "}") {
                    c = true;
                    if (i > 0 && g[i - 1] == "\\") c = false;
                    if (c) {
                        b[h] = f[e];
                        e--;
                        if (e == 0) f = {};
                    }
                }
            }
        }
        return b;
    },
    _latexRemoveBraces: function(a, b) {
        var c = this;
        var d = c._latexMarkBraces(a);
        var e = [];
        var f;
        if (b[1].match(/\{\s*$/) && b[3].match(/^\s*\}/)) {
            var g = -1;
            var h = a.length + 1;
            for (var i in d) {
                f = parseInt(i);
                if (f > g && f < b[1].length) g = f;
                if (f < h && f >= b[1].length + b[2].length) h = f;
            }
            if (g > -1 && d[g] == d[h]) {
                e.push(g);
                e.push(h);
            }
        }
        if (b[2].match(/[\{\}]/)) {
            for (var i in d) {
                f = parseInt(i);
                if (f > b[1].length && f < b[1].length + b[2].length) {
                    for (var j in d) {
                        if (d[j] == d[i]) e.push(parseInt(j));
                    }
                }
            }
        }
        var k = b[1].length;
        var l = b[2].length;
        e.forEach(function(a) {
            if (a >= 0 && a < k) {
                b[1] = b[1].substring(0, a) + b[1].substring(a + 1, k);
            } else if (a >= b[1].length + b[2].length) {
                a = a - b[1].length - b[2].length - 1;
                b[3] = b[3].substring(0, a) + b[3].substring(a + 1, b[3].length);
            }
        });
    },
    _latexSplitByMathEnvironment: function(a) {
        var b = a.split(/(\$[^\$]*\$)/);
        return b;
    },
    _initializeReverseMapping: function() {
        var a = this;
        a.unicodeLatexASCII = {};
        for (var b in a.latexUnicodeASCII_1) {
            for (var c in a.latexUnicodeASCII_1[b]) {
                var d = b.match(/[a-z]/i) ? " " : "";
                a.unicodeLatexASCII[a.latexUnicodeASCII_1[b][c]] = "{\\" + b + d + c + "}";
            }
        }
        for (var b in a.latexUnicodeASCII_2) {
            a.unicodeLatexASCII[a.latexUnicodeASCII_2[b]] = "{\\" + b + "}";
        }
        for (var b in a.latexUnicodeASCII_3) {
            a.unicodeLatexASCII[a.latexUnicodeASCII_3[b]] = b;
            if (b.match(/[a-z]+/)) a.unicodeLatexASCII[a.latexUnicodeASCII_3[b]] += "{}";
        }
        for (var b in a.latexUnicodeMath) {
            a.unicodeLatexASCII[a.latexUnicodeMath[b]] = "$" + b + "$";
        }
    },
    unicode2Latex: function(a) {
        var b = this;
        if (!a) return "";
        if (!b.unicodeLatexASCII) {
            b._initializeReverseMapping();
        }
        var c = b._latexSplitByMathEnvironment(a);
        for (var d = 0; d < c.length; d++) {
            var e = c[d].match(/^\$.*\$$/) ? true : false;
            var f = c[d].split("");
            for (var g = 0; g < f.length; g++) {
                if (f[g] in b.unicodeLatexASCII) {
                    f[g] = b.unicodeLatexASCII[f[g]];
                    if (e) {
                        f[g] = f[g].replace(/\$/g, "");
                        if (g + 1 < f.length) {
                            if (!f[g + 1].match(/[\/\s\$\}\{]/)) {
                                f[g] += "{}";
                            }
                        }
                    }
                }
            }
            c[d] = f.join("");
        }
        a = c.join("");
        return a;
    },
    latex2Unicode: function(a) {
        var b = this;
        if (!a) return "";
        var c = "\\\\['\"\\.=H\\^`ckruv~]\\s*";
        var d = [ new RegExp("(.*)(\\\\(?:%|\\$|&|#|_|\\?\\`|\\!\\`))(.*)", "g"), new RegExp("(.*)(\\\\[a-z][a-z]+)(.*)", "g"), new RegExp("(.*)(" + c + "\\{(?:[A-Za-z]|\\\\i|\\\\j)\\})(.*)", "g"), new RegExp("(.*)(" + c + "(?:[A-Za-z]|\\\\i|\\\\j))(.*)", "g"), new RegExp("(.*)(\\\\(?:A{?A}?|A{?E}?|D{?H}?|D{?J}?|L|N{?G}?|O|O{?E}?|T{?H}?|S{?S}?|a{?a}?|a{?e}?|d{?h}?|d{?j}?|i|j|l|n{?g}?|o|o{?e}?|s{?s}?|t{?h}?|P|S))(.*)", "g") ];
        a = a.replace(/\\\$/g, "\\textdollar");
        var e = b._latexSplitByMathEnvironment(a);
        for (var f = 0; f < e.length; f++) {
            if (e[f].match(/^\$.*\$$/)) continue;
            e[f] = e[f].replace(/\\\'i/g, "\\'\\i{}");
            e[f] = e[f].replace(/\\\'\{i\}/g, "\\'{\\i}");
            var g = {};
            var h = 0;
            d.forEach(function(a) {
                var c = null;
                var d = 0;
                while ((c = a.exec(e[f])) !== null) {
                    d++;
                    if (d > 500) {
                        break;
                    }
                    var i = b._latex2Unicode(c[2]);
                    if (i) {
                        b._latexRemoveBraces(e[f], c);
                    } else {
                        h++;
                        var j = "__82650A8ABPppP__" + h + "__";
                        g[j] = c[2];
                        i = j;
                    }
                    e[f] = c[1] + i + c[3];
                    a.lastIndex = 0;
                }
            });
            for (var i in g) {
                e[f] = e[f].replace(new RegExp(i), g[i]);
            }
            e[f] = e[f].replace(/\{\s*\}/g, "");
        }
        a = e.join("");
        return a;
    }
});

PP.String = new PP._String();

PP._TestFlags = PP.Class.extend({
    failWebImport: function() {
        return false;
    },
    timeoutWebImport: function() {
        return false;
    },
    skipAllGuides: function() {
        return false;
    },
    alwaysShowGuides: function() {
        return false;
    },
    alwaysLoggedOut: function() {
        return false;
    },
    failAttachByUrlDownload: function() {
        return false;
    },
    testExtensionInstallWindow: function() {
        return false;
    },
    testExtensionUpdateWindow: function() {
        return false;
    },
    testNotChromeWindow: function() {
        return false;
    },
    testStatusPanel: function() {
        return false;
    },
    alwaysShowAnnouncements: function() {
        return false;
    },
    triggerExtensionJavascriptErrors: function() {
        return false;
    },
    triggerWebappJavascriptErrors: function() {
        return false;
    },
    triggerContentScriptJavascriptErrors: function() {
        return false;
    },
    testNewUser: function() {
        return false;
    },
    docsTestNotAllowedResponse: function() {
        return false;
    },
    docsTestServerTimeoutResponse: function() {
        return false;
    },
    docsTestFormattingErrorResponse: function() {
        return false;
    },
    filesystemUseLegacyLocalAttachments: function() {
        return false;
    },
    filesystemTestFailedLegacyRemoval: function() {
        return false;
    },
    testContactsAuth: function() {
        return false;
    },
    clearContacts: function() {
        return false;
    },
    testExpiredLicense: function() {
        return false;
    },
    testReadOnlyWebapp: function() {
        return false;
    },
    testMobileWebapp: function() {
        return false;
    },
    testTablet: function() {
        return false;
    },
    testPhone: function() {
        return false;
    },
    testWizardTaskFailures: function() {
        return false;
    },
    testWizardDupsFailure: function() {
        return false;
    },
    testWizardRefreshToken: function() {
        return false;
    },
    testLocalAttachmentNotFoundErrors: function() {
        return false;
    },
    testLocalAttachmentDriveDownloadFailure: function() {
        return false;
    }
});

PP.TestFlags = new PP._TestFlags();

PP.UUID = {
    parts: [],
    salt: {},
    timestamp: {}
};

(function() {
    var a = Math.pow(2, 14), b = Math.pow(2, 16), c = Math.pow(2, 28), d = Math.pow(2, 32);
    function e(a, b, c) {
        var d = String(a);
        c = c || " ";
        while (d.length < b) {
            d = c + d;
        }
        return d;
    }
    function f(a, b) {
        var c = a.toString(16);
        if (c.length > b) {
            c = c.substring(c.length - b);
        } else if (c.length < b) {
            c = e(c, b, "0");
        }
        return c;
    }
    function g(a, b) {
        var c = Math.random() * (b - a + 1);
        return Math.floor(c) + a;
    }
    function h(a) {
        if (typeof a === "number") {
            var b = Math.floor(a / d);
            return {
                lo: Math.floor(a - b * d),
                hi: b
            };
        }
        return a;
    }
    PP.UUID.init = function() {
        var e = this, f, h;
        e.clockSeq = g(0, a - 1);
        f = e.salt || (e.salt = {});
        h = e.timestamp || (e.timestamp = {});
        f.lo = g(0, d - 1);
        f.hi = g(0, b - 1);
        h.lo = g(0, d - 1);
        h.hi = g(0, c - 1);
    };
    PP.UUID.generate = function() {
        var a = this, b = a.parts, c = a.timestamp;
        b[0] = f(c.lo, 8);
        b[1] = f(c.hi & 65535, 4);
        b[2] = f(c.hi >>> 16 & 4095 | a.version << 12, 4);
        b[3] = f(128 | a.clockSeq >>> 8 & 63, 2) + f(a.clockSeq & 255, 2);
        b[4] = f(a.salt.hi, 4) + f(a.salt.lo, 8);
        a.init();
        return b.join("-").toLowerCase();
    };
})();

PP.UUID.init();

PP._Versioning = PP.Class.extend({
    includes: [ PP.Events ],
    debug: false,
    initialize: function() {
        PP.Msg.on("message", this.onMessage, this);
    },
    checkVersions: function(a) {
        var b = a.version_info;
        this.c.log("  incoming version info");
        this.c.log(PP.pp(b));
        var c = this.getInfo();
        var d = window.PP_WINDOW_ID;
        if (d === "bg") {
            if (c.PP_WEBAPP_VERSION == "0" || c.PP_EXTENSION_VERSION == "0" || b.PP_WEBAPP_VERSION == "0" || b.PP_EXTENSION_VERSION == "0") {
                this.c.log("Webapp or extension version is 0 --- must be dev mode!");
                return;
            }
            if (parseInt(c.PP_WEBAPP_VERSION) > parseInt(b.PP_WEBAPP_VERSION)) {
                this.fire("webapp_needsupdate", {
                    latestVersion: c.PP_WEBAPP_VERSION,
                    myInfo: c,
                    incomingInfo: b
                });
            }
            if (parseInt(c.PP_EXTENSION_VERSION) < parseInt(b.PP_EXTENSION_VERSION)) {
                this.fire("extension_needsupdate", {
                    latestVersion: b.PP_EXTENSION_VERSION,
                    myInfo: c,
                    incomingInfo: b
                });
            }
        } else {
            console.error("Shouldn't get here from a non-bg tab!");
        }
    },
    onMessage: function(a) {
        var b = a.msg;
        if (b.version_info) {
            this.checkVersions(b);
        }
    },
    getInfo: function() {
        return {
            PP_EXTENSION_VERSION: window.PP_EXTENSION_VERSION,
            PP_WEBAPP_VERSION: window.PP_WEBAPP_VERSION
        };
    }
});

createSingleton(PP, "_Versioning", "Versioning");

(function(a, b) {
    var c = a.document, d = a.navigator, e = a.location;
    var f = function() {
        var e = function(a, b) {
            return new e.fn.init(a, b, h);
        }, f = a.jQuery, g = a.$, h, i = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/, j = /\S/, k = /^\s+/, l = /\s+$/, m = /^<(\w+)\s*\/?>(?:<\/\1>)?$/, n = /^[\],:{}\s]*$/, o = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, p = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, q = /(?:^|:|,)(?:\s*\[)+/g, r = /(webkit)[ \/]([\w.]+)/, s = /(opera)(?:.*version)?[ \/]([\w.]+)/, t = /(msie) ([\w.]+)/, u = /(mozilla)(?:.*? rv:([\w.]+))?/, v = /-([a-z]|[0-9])/gi, w = /^-ms-/, x = function(a, b) {
            return (b + "").toUpperCase();
        }, y = d.userAgent, z, A, B, C = Object.prototype.toString, D = Object.prototype.hasOwnProperty, E = Array.prototype.push, F = Array.prototype.slice, G = String.prototype.trim, H = Array.prototype.indexOf, I = {};
        e.fn = e.prototype = {
            constructor: e,
            init: function(a, d, f) {
                var g, h, j, k;
                if (!a) {
                    return this;
                }
                if (a.nodeType) {
                    this.context = this[0] = a;
                    this.length = 1;
                    return this;
                }
                if (a === "body" && !d && c.body) {
                    this.context = c;
                    this[0] = c.body;
                    this.selector = a;
                    this.length = 1;
                    return this;
                }
                if (typeof a === "string") {
                    if (a.charAt(0) === "<" && a.charAt(a.length - 1) === ">" && a.length >= 3) {
                        g = [ null, a, null ];
                    } else {
                        g = i.exec(a);
                    }
                    if (g && (g[1] || !d)) {
                        if (g[1]) {
                            d = d instanceof e ? d[0] : d;
                            k = d ? d.ownerDocument || d : c;
                            j = m.exec(a);
                            if (j) {
                                if (e.isPlainObject(d)) {
                                    a = [ c.createElement(j[1]) ];
                                    e.fn.attr.call(a, d, true);
                                } else {
                                    a = [ k.createElement(j[1]) ];
                                }
                            } else {
                                j = e.buildFragment([ g[1] ], [ k ]);
                                a = (j.cacheable ? e.clone(j.fragment) : j.fragment).childNodes;
                            }
                            return e.merge(this, a);
                        } else {
                            h = c.getElementById(g[2]);
                            if (h && h.parentNode) {
                                if (h.id !== g[2]) {
                                    return f.find(a);
                                }
                                this.length = 1;
                                this[0] = h;
                            }
                            this.context = c;
                            this.selector = a;
                            return this;
                        }
                    } else if (!d || d.jquery) {
                        return (d || f).find(a);
                    } else {
                        return this.constructor(d).find(a);
                    }
                } else if (e.isFunction(a)) {
                    return f.ready(a);
                }
                if (a.selector !== b) {
                    this.selector = a.selector;
                    this.context = a.context;
                }
                return e.makeArray(a, this);
            },
            selector: "",
            jquery: "1.7.2",
            length: 0,
            size: function() {
                return this.length;
            },
            toArray: function() {
                return F.call(this, 0);
            },
            get: function(a) {
                return a == null ? this.toArray() : a < 0 ? this[this.length + a] : this[a];
            },
            pushStack: function(a, b, c) {
                var d = this.constructor();
                if (e.isArray(a)) {
                    E.apply(d, a);
                } else {
                    e.merge(d, a);
                }
                d.prevObject = this;
                d.context = this.context;
                if (b === "find") {
                    d.selector = this.selector + (this.selector ? " " : "") + c;
                } else if (b) {
                    d.selector = this.selector + "." + b + "(" + c + ")";
                }
                return d;
            },
            each: function(a, b) {
                return e.each(this, a, b);
            },
            ready: function(a) {
                e.bindReady();
                A.add(a);
                return this;
            },
            eq: function(a) {
                a = +a;
                return a === -1 ? this.slice(a) : this.slice(a, a + 1);
            },
            first: function() {
                return this.eq(0);
            },
            last: function() {
                return this.eq(-1);
            },
            slice: function() {
                return this.pushStack(F.apply(this, arguments), "slice", F.call(arguments).join(","));
            },
            map: function(a) {
                return this.pushStack(e.map(this, function(b, c) {
                    return a.call(b, c, b);
                }));
            },
            end: function() {
                return this.prevObject || this.constructor(null);
            },
            push: E,
            sort: [].sort,
            splice: [].splice
        };
        e.fn.init.prototype = e.fn;
        e.extend = e.fn.extend = function() {
            var a, c, d, f, g, h, i = arguments[0] || {}, j = 1, k = arguments.length, l = false;
            if (typeof i === "boolean") {
                l = i;
                i = arguments[1] || {};
                j = 2;
            }
            if (typeof i !== "object" && !e.isFunction(i)) {
                i = {};
            }
            if (k === j) {
                i = this;
                --j;
            }
            for (;j < k; j++) {
                if ((a = arguments[j]) != null) {
                    for (c in a) {
                        d = i[c];
                        f = a[c];
                        if (i === f) {
                            continue;
                        }
                        if (l && f && (e.isPlainObject(f) || (g = e.isArray(f)))) {
                            if (g) {
                                g = false;
                                h = d && e.isArray(d) ? d : [];
                            } else {
                                h = d && e.isPlainObject(d) ? d : {};
                            }
                            i[c] = e.extend(l, h, f);
                        } else if (f !== b) {
                            i[c] = f;
                        }
                    }
                }
            }
            return i;
        };
        e.extend({
            noConflict: function(b) {
                if (a.$ === e) {
                    a.$ = g;
                }
                if (b && a.jQuery === e) {
                    a.jQuery = f;
                }
                return e;
            },
            isReady: false,
            readyWait: 1,
            holdReady: function(a) {
                if (a) {
                    e.readyWait++;
                } else {
                    e.ready(true);
                }
            },
            ready: function(a) {
                if (a === true && !--e.readyWait || a !== true && !e.isReady) {
                    if (!c.body) {
                        return setTimeout(e.ready, 1);
                    }
                    e.isReady = true;
                    if (a !== true && --e.readyWait > 0) {
                        return;
                    }
                    A.fireWith(c, [ e ]);
                    if (e.fn.trigger) {
                        e(c).trigger("ready").off("ready");
                    }
                }
            },
            bindReady: function() {
                if (A) {
                    return;
                }
                A = e.Callbacks("once memory");
                if (c.readyState === "complete") {
                    return setTimeout(e.ready, 1);
                }
                if (c.addEventListener) {
                    c.addEventListener("DOMContentLoaded", B, false);
                    a.addEventListener("load", e.ready, false);
                } else if (c.attachEvent) {
                    c.attachEvent("onreadystatechange", B);
                    a.attachEvent("onload", e.ready);
                    var b = false;
                    try {
                        b = a.frameElement == null;
                    } catch (a) {}
                    if (c.documentElement.doScroll && b) {
                        J();
                    }
                }
            },
            isFunction: function(a) {
                return e.type(a) === "function";
            },
            isArray: Array.isArray || function(a) {
                return e.type(a) === "array";
            },
            isWindow: function(a) {
                return a != null && a == a.window;
            },
            isNumeric: function(a) {
                return !isNaN(parseFloat(a)) && isFinite(a);
            },
            type: function(a) {
                return a == null ? String(a) : I[C.call(a)] || "object";
            },
            isPlainObject: function(a) {
                if (!a || e.type(a) !== "object" || a.nodeType || e.isWindow(a)) {
                    return false;
                }
                try {
                    if (a.constructor && !D.call(a, "constructor") && !D.call(a.constructor.prototype, "isPrototypeOf")) {
                        return false;
                    }
                } catch (a) {
                    return false;
                }
                var c;
                for (c in a) {}
                return c === b || D.call(a, c);
            },
            isEmptyObject: function(a) {
                for (var b in a) {
                    return false;
                }
                return true;
            },
            error: function(a) {
                throw new Error(a);
            },
            parseJSON: function(b) {
                if (typeof b !== "string" || !b) {
                    return null;
                }
                b = e.trim(b);
                if (a.JSON && a.JSON.parse) {
                    return a.JSON.parse(b);
                }
                if (n.test(b.replace(o, "@").replace(p, "]").replace(q, ""))) {
                    return new Function("return " + b)();
                }
                e.error("Invalid JSON: " + b);
            },
            parseXML: function(c) {
                if (typeof c !== "string" || !c) {
                    return null;
                }
                var d, f;
                try {
                    if (a.DOMParser) {
                        f = new DOMParser();
                        d = f.parseFromString(c, "text/xml");
                    } else {
                        d = new ActiveXObject("Microsoft.XMLDOM");
                        d.async = "false";
                        d.loadXML(c);
                    }
                } catch (a) {
                    d = b;
                }
                if (!d || !d.documentElement || d.getElementsByTagName("parsererror").length) {
                    e.error("Invalid XML: " + c);
                }
                return d;
            },
            noop: function() {},
            globalEval: function(b) {
                if (b && j.test(b)) {
                    (a.execScript || function(b) {
                        a["eval"].call(a, b);
                    })(b);
                }
            },
            camelCase: function(a) {
                return a.replace(w, "ms-").replace(v, x);
            },
            nodeName: function(a, b) {
                return a.nodeName && a.nodeName.toUpperCase() === b.toUpperCase();
            },
            each: function(a, c, d) {
                var f, g = 0, h = a.length, i = h === b || e.isFunction(a);
                if (d) {
                    if (i) {
                        for (f in a) {
                            if (c.apply(a[f], d) === false) {
                                break;
                            }
                        }
                    } else {
                        for (;g < h; ) {
                            if (c.apply(a[g++], d) === false) {
                                break;
                            }
                        }
                    }
                } else {
                    if (i) {
                        for (f in a) {
                            if (c.call(a[f], f, a[f]) === false) {
                                break;
                            }
                        }
                    } else {
                        for (;g < h; ) {
                            if (c.call(a[g], g, a[g++]) === false) {
                                break;
                            }
                        }
                    }
                }
                return a;
            },
            trim: G ? function(a) {
                return a == null ? "" : G.call(a);
            } : function(a) {
                return a == null ? "" : a.toString().replace(k, "").replace(l, "");
            },
            makeArray: function(a, b) {
                var c = b || [];
                if (a != null) {
                    var d = e.type(a);
                    if (a.length == null || d === "string" || d === "function" || d === "regexp" || e.isWindow(a)) {
                        E.call(c, a);
                    } else {
                        e.merge(c, a);
                    }
                }
                return c;
            },
            inArray: function(a, b, c) {
                var d;
                if (b) {
                    if (H) {
                        return H.call(b, a, c);
                    }
                    d = b.length;
                    c = c ? c < 0 ? Math.max(0, d + c) : c : 0;
                    for (;c < d; c++) {
                        if (c in b && b[c] === a) {
                            return c;
                        }
                    }
                }
                return -1;
            },
            merge: function(a, c) {
                var d = a.length, e = 0;
                if (typeof c.length === "number") {
                    for (var f = c.length; e < f; e++) {
                        a[d++] = c[e];
                    }
                } else {
                    while (c[e] !== b) {
                        a[d++] = c[e++];
                    }
                }
                a.length = d;
                return a;
            },
            grep: function(a, b, c) {
                var d = [], e;
                c = !!c;
                for (var f = 0, g = a.length; f < g; f++) {
                    e = !!b(a[f], f);
                    if (c !== e) {
                        d.push(a[f]);
                    }
                }
                return d;
            },
            map: function(a, c, d) {
                var f, g, h = [], i = 0, j = a.length, k = a instanceof e || j !== b && typeof j === "number" && (j > 0 && a[0] && a[j - 1] || j === 0 || e.isArray(a));
                if (k) {
                    for (;i < j; i++) {
                        f = c(a[i], i, d);
                        if (f != null) {
                            h[h.length] = f;
                        }
                    }
                } else {
                    for (g in a) {
                        f = c(a[g], g, d);
                        if (f != null) {
                            h[h.length] = f;
                        }
                    }
                }
                return h.concat.apply([], h);
            },
            guid: 1,
            proxy: function(a, c) {
                if (typeof c === "string") {
                    var d = a[c];
                    c = a;
                    a = d;
                }
                if (!e.isFunction(a)) {
                    return b;
                }
                var f = F.call(arguments, 2), g = function() {
                    return a.apply(c, f.concat(F.call(arguments)));
                };
                g.guid = a.guid = a.guid || g.guid || e.guid++;
                return g;
            },
            access: function(a, c, d, f, g, h, i) {
                var j, k = d == null, l = 0, m = a.length;
                if (d && typeof d === "object") {
                    for (l in d) {
                        e.access(a, c, l, d[l], 1, h, f);
                    }
                    g = 1;
                } else if (f !== b) {
                    j = i === b && e.isFunction(f);
                    if (k) {
                        if (j) {
                            j = c;
                            c = function(a, b, c) {
                                return j.call(e(a), c);
                            };
                        } else {
                            c.call(a, f);
                            c = null;
                        }
                    }
                    if (c) {
                        for (;l < m; l++) {
                            c(a[l], d, j ? f.call(a[l], l, c(a[l], d)) : f, i);
                        }
                    }
                    g = 1;
                }
                return g ? a : k ? c.call(a) : m ? c(a[0], d) : h;
            },
            now: function() {
                return new Date().getTime();
            },
            uaMatch: function(a) {
                a = a.toLowerCase();
                var b = r.exec(a) || s.exec(a) || t.exec(a) || a.indexOf("compatible") < 0 && u.exec(a) || [];
                return {
                    browser: b[1] || "",
                    version: b[2] || "0"
                };
            },
            sub: function() {
                function a(b, c) {
                    return new a.fn.init(b, c);
                }
                e.extend(true, a, this);
                a.superclass = this;
                a.fn = a.prototype = this();
                a.fn.constructor = a;
                a.sub = this.sub;
                a.fn.init = function c(d, f) {
                    if (f && f instanceof e && !(f instanceof a)) {
                        f = a(f);
                    }
                    return e.fn.init.call(this, d, f, b);
                };
                a.fn.init.prototype = a.fn;
                var b = a(c);
                return a;
            },
            browser: {}
        });
        e.each("Boolean Number String Function Array Date RegExp Object".split(" "), function(a, b) {
            I["[object " + b + "]"] = b.toLowerCase();
        });
        z = e.uaMatch(y);
        if (z.browser) {
            e.browser[z.browser] = true;
            e.browser.version = z.version;
        }
        if (e.browser.webkit) {
            e.browser.safari = true;
        }
        if (j.test("\xa0")) {
            k = /^[\s\xA0]+/;
            l = /[\s\xA0]+$/;
        }
        h = e(c);
        if (c.addEventListener) {
            B = function() {
                c.removeEventListener("DOMContentLoaded", B, false);
                e.ready();
            };
        } else if (c.attachEvent) {
            B = function() {
                if (c.readyState === "complete") {
                    c.detachEvent("onreadystatechange", B);
                    e.ready();
                }
            };
        }
        function J() {
            if (e.isReady) {
                return;
            }
            try {
                c.documentElement.doScroll("left");
            } catch (a) {
                setTimeout(J, 1);
                return;
            }
            e.ready();
        }
        return e;
    }();
    var g = {};
    function h(a) {
        var b = g[a] = {}, c, d;
        a = a.split(/\s+/);
        for (c = 0, d = a.length; c < d; c++) {
            b[a[c]] = true;
        }
        return b;
    }
    f.Callbacks = function(a) {
        a = a ? g[a] || h(a) : {};
        var c = [], d = [], e, i, j, k, l, m, n = function(b) {
            var d, e, g, h, i;
            for (d = 0, e = b.length; d < e; d++) {
                g = b[d];
                h = f.type(g);
                if (h === "array") {
                    n(g);
                } else if (h === "function") {
                    if (!a.unique || !p.has(g)) {
                        c.push(g);
                    }
                }
            }
        }, o = function(b, f) {
            f = f || [];
            e = !a.memory || [ b, f ];
            i = true;
            j = true;
            m = k || 0;
            k = 0;
            l = c.length;
            for (;c && m < l; m++) {
                if (c[m].apply(b, f) === false && a.stopOnFalse) {
                    e = true;
                    break;
                }
            }
            j = false;
            if (c) {
                if (!a.once) {
                    if (d && d.length) {
                        e = d.shift();
                        p.fireWith(e[0], e[1]);
                    }
                } else if (e === true) {
                    p.disable();
                } else {
                    c = [];
                }
            }
        }, p = {
            add: function() {
                if (c) {
                    var a = c.length;
                    n(arguments);
                    if (j) {
                        l = c.length;
                    } else if (e && e !== true) {
                        k = a;
                        o(e[0], e[1]);
                    }
                }
                return this;
            },
            remove: function() {
                if (c) {
                    var b = arguments, d = 0, e = b.length;
                    for (;d < e; d++) {
                        for (var f = 0; f < c.length; f++) {
                            if (b[d] === c[f]) {
                                if (j) {
                                    if (f <= l) {
                                        l--;
                                        if (f <= m) {
                                            m--;
                                        }
                                    }
                                }
                                c.splice(f--, 1);
                                if (a.unique) {
                                    break;
                                }
                            }
                        }
                    }
                }
                return this;
            },
            has: function(a) {
                if (c) {
                    var b = 0, d = c.length;
                    for (;b < d; b++) {
                        if (a === c[b]) {
                            return true;
                        }
                    }
                }
                return false;
            },
            empty: function() {
                c = [];
                return this;
            },
            disable: function() {
                c = d = e = b;
                return this;
            },
            disabled: function() {
                return !c;
            },
            lock: function() {
                d = b;
                if (!e || e === true) {
                    p.disable();
                }
                return this;
            },
            locked: function() {
                return !d;
            },
            fireWith: function(b, c) {
                if (d) {
                    if (j) {
                        if (!a.once) {
                            d.push([ b, c ]);
                        }
                    } else if (!(a.once && e)) {
                        o(b, c);
                    }
                }
                return this;
            },
            fire: function() {
                p.fireWith(this, arguments);
                return this;
            },
            fired: function() {
                return !!i;
            }
        };
        return p;
    };
    var i = [].slice;
    f.extend({
        Deferred: function(a) {
            var b = f.Callbacks("once memory"), c = f.Callbacks("once memory"), d = f.Callbacks("memory"), e = "pending", g = {
                resolve: b,
                reject: c,
                notify: d
            }, h = {
                done: b.add,
                fail: c.add,
                progress: d.add,
                state: function() {
                    return e;
                },
                isResolved: b.fired,
                isRejected: c.fired,
                then: function(a, b, c) {
                    i.done(a).fail(b).progress(c);
                    return this;
                },
                always: function() {
                    i.done.apply(i, arguments).fail.apply(i, arguments);
                    return this;
                },
                pipe: function(a, b, c) {
                    return f.Deferred(function(d) {
                        f.each({
                            done: [ a, "resolve" ],
                            fail: [ b, "reject" ],
                            progress: [ c, "notify" ]
                        }, function(a, b) {
                            var c = b[0], e = b[1], g;
                            if (f.isFunction(c)) {
                                i[a](function() {
                                    g = c.apply(this, arguments);
                                    if (g && f.isFunction(g.promise)) {
                                        g.promise().then(d.resolve, d.reject, d.notify);
                                    } else {
                                        d[e + "With"](this === i ? d : this, [ g ]);
                                    }
                                });
                            } else {
                                i[a](d[e]);
                            }
                        });
                    }).promise();
                },
                promise: function(a) {
                    if (a == null) {
                        a = h;
                    } else {
                        for (var b in h) {
                            a[b] = h[b];
                        }
                    }
                    return a;
                }
            }, i = h.promise({}), j;
            for (j in g) {
                i[j] = g[j].fire;
                i[j + "With"] = g[j].fireWith;
            }
            i.done(function() {
                e = "resolved";
            }, c.disable, d.lock).fail(function() {
                e = "rejected";
            }, b.disable, d.lock);
            if (a) {
                a.call(i, i);
            }
            return i;
        },
        when: function(a) {
            var b = i.call(arguments, 0), c = 0, d = b.length, e = new Array(d), g = d, h = d, j = d <= 1 && a && f.isFunction(a.promise) ? a : f.Deferred(), k = j.promise();
            function l(a) {
                return function(c) {
                    b[a] = arguments.length > 1 ? i.call(arguments, 0) : c;
                    if (!--g) {
                        j.resolveWith(j, b);
                    }
                };
            }
            function m(a) {
                return function(b) {
                    e[a] = arguments.length > 1 ? i.call(arguments, 0) : b;
                    j.notifyWith(k, e);
                };
            }
            if (d > 1) {
                for (;c < d; c++) {
                    if (b[c] && b[c].promise && f.isFunction(b[c].promise)) {
                        b[c].promise().then(l(c), j.reject, m(c));
                    } else {
                        --g;
                    }
                }
                if (!g) {
                    j.resolveWith(j, b);
                }
            } else if (j !== a) {
                j.resolveWith(j, d ? [ a ] : []);
            }
            return k;
        }
    });
    f.support = function() {
        var b, d, e, g, h, i, j, k, l, m, n, o, p = c.createElement("div"), q = c.documentElement;
        p.setAttribute("className", "t");
        p.innerHTML = "   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";
        d = p.getElementsByTagName("*");
        e = p.getElementsByTagName("a")[0];
        if (!d || !d.length || !e) {
            return {};
        }
        g = c.createElement("select");
        h = g.appendChild(c.createElement("option"));
        i = p.getElementsByTagName("input")[0];
        b = {
            leadingWhitespace: p.firstChild.nodeType === 3,
            tbody: !p.getElementsByTagName("tbody").length,
            htmlSerialize: !!p.getElementsByTagName("link").length,
            style: /top/.test(e.getAttribute("style")),
            hrefNormalized: e.getAttribute("href") === "/a",
            opacity: /^0.55/.test(e.style.opacity),
            cssFloat: !!e.style.cssFloat,
            checkOn: i.value === "on",
            optSelected: h.selected,
            getSetAttribute: p.className !== "t",
            enctype: !!c.createElement("form").enctype,
            html5Clone: c.createElement("nav").cloneNode(true).outerHTML !== "<:nav></:nav>",
            submitBubbles: true,
            changeBubbles: true,
            focusinBubbles: false,
            deleteExpando: true,
            noCloneEvent: true,
            inlineBlockNeedsLayout: false,
            shrinkWrapBlocks: false,
            reliableMarginRight: true,
            pixelMargin: true
        };
        f.boxModel = b.boxModel = c.compatMode === "CSS1Compat";
        i.checked = true;
        b.noCloneChecked = i.cloneNode(true).checked;
        g.disabled = true;
        b.optDisabled = !h.disabled;
        try {
            delete p.test;
        } catch (a) {
            b.deleteExpando = false;
        }
        if (!p.addEventListener && p.attachEvent && p.fireEvent) {
            p.attachEvent("onclick", function() {
                b.noCloneEvent = false;
            });
            p.cloneNode(true).fireEvent("onclick");
        }
        i = c.createElement("input");
        i.value = "t";
        i.setAttribute("type", "radio");
        b.radioValue = i.value === "t";
        i.setAttribute("checked", "checked");
        i.setAttribute("name", "t");
        p.appendChild(i);
        j = c.createDocumentFragment();
        j.appendChild(p.lastChild);
        b.checkClone = j.cloneNode(true).cloneNode(true).lastChild.checked;
        b.appendChecked = i.checked;
        j.removeChild(i);
        j.appendChild(p);
        if (p.attachEvent) {
            for (n in {
                submit: 1,
                change: 1,
                focusin: 1
            }) {
                m = "on" + n;
                o = m in p;
                if (!o) {
                    p.setAttribute(m, "return;");
                    o = typeof p[m] === "function";
                }
                b[n + "Bubbles"] = o;
            }
        }
        j.removeChild(p);
        j = g = h = p = i = null;
        f(function() {
            var d, e, g, h, i, j, l, m, n, q, r, s, t, u = c.getElementsByTagName("body")[0];
            if (!u) {
                return;
            }
            m = 1;
            t = "padding:0;margin:0;border:";
            r = "position:absolute;top:0;left:0;width:1px;height:1px;";
            s = t + "0;visibility:hidden;";
            n = "style='" + r + t + "5px solid #000;";
            q = "<div " + n + "display:block;'><div style='" + t + "0;display:block;overflow:hidden;'></div></div>" + "<table " + n + "' cellpadding='0' cellspacing='0'>" + "<tr><td></td></tr></table>";
            d = c.createElement("div");
            d.style.cssText = s + "width:0;height:0;position:static;top:0;margin-top:" + m + "px";
            u.insertBefore(d, u.firstChild);
            p = c.createElement("div");
            d.appendChild(p);
            p.innerHTML = "<table><tr><td style='" + t + "0;display:none'></td><td>t</td></tr></table>";
            k = p.getElementsByTagName("td");
            o = k[0].offsetHeight === 0;
            k[0].style.display = "";
            k[1].style.display = "none";
            b.reliableHiddenOffsets = o && k[0].offsetHeight === 0;
            if (a.getComputedStyle) {
                p.innerHTML = "";
                l = c.createElement("div");
                l.style.width = "0";
                l.style.marginRight = "0";
                p.style.width = "2px";
                p.appendChild(l);
                b.reliableMarginRight = (parseInt((a.getComputedStyle(l, null) || {
                    marginRight: 0
                }).marginRight, 10) || 0) === 0;
            }
            if (typeof p.style.zoom !== "undefined") {
                p.innerHTML = "";
                p.style.width = p.style.padding = "1px";
                p.style.border = 0;
                p.style.overflow = "hidden";
                p.style.display = "inline";
                p.style.zoom = 1;
                b.inlineBlockNeedsLayout = p.offsetWidth === 3;
                p.style.display = "block";
                p.style.overflow = "visible";
                p.innerHTML = "<div style='width:5px;'></div>";
                b.shrinkWrapBlocks = p.offsetWidth !== 3;
            }
            p.style.cssText = r + s;
            p.innerHTML = q;
            e = p.firstChild;
            g = e.firstChild;
            i = e.nextSibling.firstChild.firstChild;
            j = {
                doesNotAddBorder: g.offsetTop !== 5,
                doesAddBorderForTableAndCells: i.offsetTop === 5
            };
            g.style.position = "fixed";
            g.style.top = "20px";
            j.fixedPosition = g.offsetTop === 20 || g.offsetTop === 15;
            g.style.position = g.style.top = "";
            e.style.overflow = "hidden";
            e.style.position = "relative";
            j.subtractsBorderForOverflowNotVisible = g.offsetTop === -5;
            j.doesNotIncludeMarginInBodyOffset = u.offsetTop !== m;
            if (a.getComputedStyle) {
                p.style.marginTop = "1%";
                b.pixelMargin = (a.getComputedStyle(p, null) || {
                    marginTop: 0
                }).marginTop !== "1%";
            }
            if (typeof d.style.zoom !== "undefined") {
                d.style.zoom = 1;
            }
            u.removeChild(d);
            l = p = d = null;
            f.extend(b, j);
        });
        return b;
    }();
    var j = /^(?:\{.*\}|\[.*\])$/, k = /([A-Z])/g;
    f.extend({
        cache: {},
        uuid: 0,
        expando: "jQuery" + (f.fn.jquery + Math.random()).replace(/\D/g, ""),
        noData: {
            embed: true,
            object: "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",
            applet: true
        },
        hasData: function(a) {
            a = a.nodeType ? f.cache[a[f.expando]] : a[f.expando];
            return !!a && !m(a);
        },
        data: function(a, c, d, e) {
            if (!f.acceptData(a)) {
                return;
            }
            var g, h, i, j = f.expando, k = typeof c === "string", l = a.nodeType, m = l ? f.cache : a, n = l ? a[j] : a[j] && j, o = c === "events";
            if ((!n || !m[n] || !o && !e && !m[n].data) && k && d === b) {
                return;
            }
            if (!n) {
                if (l) {
                    a[j] = n = ++f.uuid;
                } else {
                    n = j;
                }
            }
            if (!m[n]) {
                m[n] = {};
                if (!l) {
                    m[n].toJSON = f.noop;
                }
            }
            if (typeof c === "object" || typeof c === "function") {
                if (e) {
                    m[n] = f.extend(m[n], c);
                } else {
                    m[n].data = f.extend(m[n].data, c);
                }
            }
            g = h = m[n];
            if (!e) {
                if (!h.data) {
                    h.data = {};
                }
                h = h.data;
            }
            if (d !== b) {
                h[f.camelCase(c)] = d;
            }
            if (o && !h[c]) {
                return g.events;
            }
            if (k) {
                i = h[c];
                if (i == null) {
                    i = h[f.camelCase(c)];
                }
            } else {
                i = h;
            }
            return i;
        },
        removeData: function(a, b, c) {
            if (!f.acceptData(a)) {
                return;
            }
            var d, e, g, h = f.expando, i = a.nodeType, j = i ? f.cache : a, k = i ? a[h] : h;
            if (!j[k]) {
                return;
            }
            if (b) {
                d = c ? j[k] : j[k].data;
                if (d) {
                    if (!f.isArray(b)) {
                        if (b in d) {
                            b = [ b ];
                        } else {
                            b = f.camelCase(b);
                            if (b in d) {
                                b = [ b ];
                            } else {
                                b = b.split(" ");
                            }
                        }
                    }
                    for (e = 0, g = b.length; e < g; e++) {
                        delete d[b[e]];
                    }
                    if (!(c ? m : f.isEmptyObject)(d)) {
                        return;
                    }
                }
            }
            if (!c) {
                delete j[k].data;
                if (!m(j[k])) {
                    return;
                }
            }
            if (f.support.deleteExpando || !j.setInterval) {
                delete j[k];
            } else {
                j[k] = null;
            }
            if (i) {
                if (f.support.deleteExpando) {
                    delete a[h];
                } else if (a.removeAttribute) {
                    a.removeAttribute(h);
                } else {
                    a[h] = null;
                }
            }
        },
        _data: function(a, b, c) {
            return f.data(a, b, c, true);
        },
        acceptData: function(a) {
            if (a.nodeName) {
                var b = f.noData[a.nodeName.toLowerCase()];
                if (b) {
                    return !(b === true || a.getAttribute("classid") !== b);
                }
            }
            return true;
        }
    });
    f.fn.extend({
        data: function(a, c) {
            var d, e, g, h, i, j = this[0], k = 0, m = null;
            if (a === b) {
                if (this.length) {
                    m = f.data(j);
                    if (j.nodeType === 1 && !f._data(j, "parsedAttrs")) {
                        g = j.attributes;
                        for (i = g.length; k < i; k++) {
                            h = g[k].name;
                            if (h.indexOf("data-") === 0) {
                                h = f.camelCase(h.substring(5));
                                l(j, h, m[h]);
                            }
                        }
                        f._data(j, "parsedAttrs", true);
                    }
                }
                return m;
            }
            if (typeof a === "object") {
                return this.each(function() {
                    f.data(this, a);
                });
            }
            d = a.split(".", 2);
            d[1] = d[1] ? "." + d[1] : "";
            e = d[1] + "!";
            return f.access(this, function(c) {
                if (c === b) {
                    m = this.triggerHandler("getData" + e, [ d[0] ]);
                    if (m === b && j) {
                        m = f.data(j, a);
                        m = l(j, a, m);
                    }
                    return m === b && d[1] ? this.data(d[0]) : m;
                }
                d[1] = c;
                this.each(function() {
                    var b = f(this);
                    b.triggerHandler("setData" + e, d);
                    f.data(this, a, c);
                    b.triggerHandler("changeData" + e, d);
                });
            }, null, c, arguments.length > 1, null, false);
        },
        removeData: function(a) {
            return this.each(function() {
                f.removeData(this, a);
            });
        }
    });
    function l(a, c, d) {
        if (d === b && a.nodeType === 1) {
            var e = "data-" + c.replace(k, "-$1").toLowerCase();
            d = a.getAttribute(e);
            if (typeof d === "string") {
                try {
                    d = d === "true" ? true : d === "false" ? false : d === "null" ? null : f.isNumeric(d) ? +d : j.test(d) ? f.parseJSON(d) : d;
                } catch (a) {}
                f.data(a, c, d);
            } else {
                d = b;
            }
        }
        return d;
    }
    function m(a) {
        for (var b in a) {
            if (b === "data" && f.isEmptyObject(a[b])) {
                continue;
            }
            if (b !== "toJSON") {
                return false;
            }
        }
        return true;
    }
    function n(a, b, c) {
        var d = b + "defer", e = b + "queue", g = b + "mark", h = f._data(a, d);
        if (h && (c === "queue" || !f._data(a, e)) && (c === "mark" || !f._data(a, g))) {
            setTimeout(function() {
                if (!f._data(a, e) && !f._data(a, g)) {
                    f.removeData(a, d, true);
                    h.fire();
                }
            }, 0);
        }
    }
    f.extend({
        _mark: function(a, b) {
            if (a) {
                b = (b || "fx") + "mark";
                f._data(a, b, (f._data(a, b) || 0) + 1);
            }
        },
        _unmark: function(a, b, c) {
            if (a !== true) {
                c = b;
                b = a;
                a = false;
            }
            if (b) {
                c = c || "fx";
                var d = c + "mark", e = a ? 0 : (f._data(b, d) || 1) - 1;
                if (e) {
                    f._data(b, d, e);
                } else {
                    f.removeData(b, d, true);
                    n(b, c, "mark");
                }
            }
        },
        queue: function(a, b, c) {
            var d;
            if (a) {
                b = (b || "fx") + "queue";
                d = f._data(a, b);
                if (c) {
                    if (!d || f.isArray(c)) {
                        d = f._data(a, b, f.makeArray(c));
                    } else {
                        d.push(c);
                    }
                }
                return d || [];
            }
        },
        dequeue: function(a, b) {
            b = b || "fx";
            var c = f.queue(a, b), d = c.shift(), e = {};
            if (d === "inprogress") {
                d = c.shift();
            }
            if (d) {
                if (b === "fx") {
                    c.unshift("inprogress");
                }
                f._data(a, b + ".run", e);
                d.call(a, function() {
                    f.dequeue(a, b);
                }, e);
            }
            if (!c.length) {
                f.removeData(a, b + "queue " + b + ".run", true);
                n(a, b, "queue");
            }
        }
    });
    f.fn.extend({
        queue: function(a, c) {
            var d = 2;
            if (typeof a !== "string") {
                c = a;
                a = "fx";
                d--;
            }
            if (arguments.length < d) {
                return f.queue(this[0], a);
            }
            return c === b ? this : this.each(function() {
                var b = f.queue(this, a, c);
                if (a === "fx" && b[0] !== "inprogress") {
                    f.dequeue(this, a);
                }
            });
        },
        dequeue: function(a) {
            return this.each(function() {
                f.dequeue(this, a);
            });
        },
        delay: function(a, b) {
            a = f.fx ? f.fx.speeds[a] || a : a;
            b = b || "fx";
            return this.queue(b, function(b, c) {
                var d = setTimeout(b, a);
                c.stop = function() {
                    clearTimeout(d);
                };
            });
        },
        clearQueue: function(a) {
            return this.queue(a || "fx", []);
        },
        promise: function(a, c) {
            if (typeof a !== "string") {
                c = a;
                a = b;
            }
            a = a || "fx";
            var d = f.Deferred(), e = this, g = e.length, h = 1, i = a + "defer", j = a + "queue", k = a + "mark", l;
            function m() {
                if (!--h) {
                    d.resolveWith(e, [ e ]);
                }
            }
            while (g--) {
                if (l = f.data(e[g], i, b, true) || (f.data(e[g], j, b, true) || f.data(e[g], k, b, true)) && f.data(e[g], i, f.Callbacks("once memory"), true)) {
                    h++;
                    l.add(m);
                }
            }
            m();
            return d.promise(c);
        }
    });
    var o = /[\n\t\r]/g, p = /\s+/, q = /\r/g, r = /^(?:button|input)$/i, s = /^(?:button|input|object|select|textarea)$/i, t = /^a(?:rea)?$/i, u = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i, v = f.support.getSetAttribute, w, x, y;
    f.fn.extend({
        attr: function(a, b) {
            return f.access(this, f.attr, a, b, arguments.length > 1);
        },
        removeAttr: function(a) {
            return this.each(function() {
                f.removeAttr(this, a);
            });
        },
        prop: function(a, b) {
            return f.access(this, f.prop, a, b, arguments.length > 1);
        },
        removeProp: function(a) {
            a = f.propFix[a] || a;
            return this.each(function() {
                try {
                    this[a] = b;
                    delete this[a];
                } catch (a) {}
            });
        },
        addClass: function(a) {
            var b, c, d, e, g, h, i;
            if (f.isFunction(a)) {
                return this.each(function(b) {
                    f(this).addClass(a.call(this, b, this.className));
                });
            }
            if (a && typeof a === "string") {
                b = a.split(p);
                for (c = 0, d = this.length; c < d; c++) {
                    e = this[c];
                    if (e.nodeType === 1) {
                        if (!e.className && b.length === 1) {
                            e.className = a;
                        } else {
                            g = " " + e.className + " ";
                            for (h = 0, i = b.length; h < i; h++) {
                                if (!~g.indexOf(" " + b[h] + " ")) {
                                    g += b[h] + " ";
                                }
                            }
                            e.className = f.trim(g);
                        }
                    }
                }
            }
            return this;
        },
        removeClass: function(a) {
            var c, d, e, g, h, i, j;
            if (f.isFunction(a)) {
                return this.each(function(b) {
                    f(this).removeClass(a.call(this, b, this.className));
                });
            }
            if (a && typeof a === "string" || a === b) {
                c = (a || "").split(p);
                for (d = 0, e = this.length; d < e; d++) {
                    g = this[d];
                    if (g.nodeType === 1 && g.className) {
                        if (a) {
                            h = (" " + g.className + " ").replace(o, " ");
                            for (i = 0, j = c.length; i < j; i++) {
                                h = h.replace(" " + c[i] + " ", " ");
                            }
                            g.className = f.trim(h);
                        } else {
                            g.className = "";
                        }
                    }
                }
            }
            return this;
        },
        toggleClass: function(a, b) {
            var c = typeof a, d = typeof b === "boolean";
            if (f.isFunction(a)) {
                return this.each(function(c) {
                    f(this).toggleClass(a.call(this, c, this.className, b), b);
                });
            }
            return this.each(function() {
                if (c === "string") {
                    var e, g = 0, h = f(this), i = b, j = a.split(p);
                    while (e = j[g++]) {
                        i = d ? i : !h.hasClass(e);
                        h[i ? "addClass" : "removeClass"](e);
                    }
                } else if (c === "undefined" || c === "boolean") {
                    if (this.className) {
                        f._data(this, "__className__", this.className);
                    }
                    this.className = this.className || a === false ? "" : f._data(this, "__className__") || "";
                }
            });
        },
        hasClass: function(a) {
            var b = " " + a + " ", c = 0, d = this.length;
            for (;c < d; c++) {
                if (this[c].nodeType === 1 && (" " + this[c].className + " ").replace(o, " ").indexOf(b) > -1) {
                    return true;
                }
            }
            return false;
        },
        val: function(a) {
            var c, d, e, g = this[0];
            if (!arguments.length) {
                if (g) {
                    c = f.valHooks[g.type] || f.valHooks[g.nodeName.toLowerCase()];
                    if (c && "get" in c && (d = c.get(g, "value")) !== b) {
                        return d;
                    }
                    d = g.value;
                    return typeof d === "string" ? d.replace(q, "") : d == null ? "" : d;
                }
                return;
            }
            e = f.isFunction(a);
            return this.each(function(d) {
                var g = f(this), h;
                if (this.nodeType !== 1) {
                    return;
                }
                if (e) {
                    h = a.call(this, d, g.val());
                } else {
                    h = a;
                }
                if (h == null) {
                    h = "";
                } else if (typeof h === "number") {
                    h += "";
                } else if (f.isArray(h)) {
                    h = f.map(h, function(a) {
                        return a == null ? "" : a + "";
                    });
                }
                c = f.valHooks[this.type] || f.valHooks[this.nodeName.toLowerCase()];
                if (!c || !("set" in c) || c.set(this, h, "value") === b) {
                    this.value = h;
                }
            });
        }
    });
    f.extend({
        valHooks: {
            option: {
                get: function(a) {
                    var b = a.attributes.value;
                    return !b || b.specified ? a.value : a.text;
                }
            },
            select: {
                get: function(a) {
                    var b, c, d, e, g = a.selectedIndex, h = [], i = a.options, j = a.type === "select-one";
                    if (g < 0) {
                        return null;
                    }
                    c = j ? g : 0;
                    d = j ? g + 1 : i.length;
                    for (;c < d; c++) {
                        e = i[c];
                        if (e.selected && (f.support.optDisabled ? !e.disabled : e.getAttribute("disabled") === null) && (!e.parentNode.disabled || !f.nodeName(e.parentNode, "optgroup"))) {
                            b = f(e).val();
                            if (j) {
                                return b;
                            }
                            h.push(b);
                        }
                    }
                    if (j && !h.length && i.length) {
                        return f(i[g]).val();
                    }
                    return h;
                },
                set: function(a, b) {
                    var c = f.makeArray(b);
                    f(a).find("option").each(function() {
                        this.selected = f.inArray(f(this).val(), c) >= 0;
                    });
                    if (!c.length) {
                        a.selectedIndex = -1;
                    }
                    return c;
                }
            }
        },
        attrFn: {
            val: true,
            css: true,
            html: true,
            text: true,
            data: true,
            width: true,
            height: true,
            offset: true
        },
        attr: function(a, c, d, e) {
            var g, h, i, j = a.nodeType;
            if (!a || j === 3 || j === 8 || j === 2) {
                return;
            }
            if (e && c in f.attrFn) {
                return f(a)[c](d);
            }
            if (typeof a.getAttribute === "undefined") {
                return f.prop(a, c, d);
            }
            i = j !== 1 || !f.isXMLDoc(a);
            if (i) {
                c = c.toLowerCase();
                h = f.attrHooks[c] || (u.test(c) ? x : w);
            }
            if (d !== b) {
                if (d === null) {
                    f.removeAttr(a, c);
                    return;
                } else if (h && "set" in h && i && (g = h.set(a, d, c)) !== b) {
                    return g;
                } else {
                    a.setAttribute(c, "" + d);
                    return d;
                }
            } else if (h && "get" in h && i && (g = h.get(a, c)) !== null) {
                return g;
            } else {
                g = a.getAttribute(c);
                return g === null ? b : g;
            }
        },
        removeAttr: function(a, b) {
            var c, d, e, g, h, i = 0;
            if (b && a.nodeType === 1) {
                d = b.toLowerCase().split(p);
                g = d.length;
                for (;i < g; i++) {
                    e = d[i];
                    if (e) {
                        c = f.propFix[e] || e;
                        h = u.test(e);
                        if (!h) {
                            f.attr(a, e, "");
                        }
                        a.removeAttribute(v ? e : c);
                        if (h && c in a) {
                            a[c] = false;
                        }
                    }
                }
            }
        },
        attrHooks: {
            type: {
                set: function(a, b) {
                    if (r.test(a.nodeName) && a.parentNode) {
                        f.error("type property can't be changed");
                    } else if (!f.support.radioValue && b === "radio" && f.nodeName(a, "input")) {
                        var c = a.value;
                        a.setAttribute("type", b);
                        if (c) {
                            a.value = c;
                        }
                        return b;
                    }
                }
            },
            value: {
                get: function(a, b) {
                    if (w && f.nodeName(a, "button")) {
                        return w.get(a, b);
                    }
                    return b in a ? a.value : null;
                },
                set: function(a, b, c) {
                    if (w && f.nodeName(a, "button")) {
                        return w.set(a, b, c);
                    }
                    a.value = b;
                }
            }
        },
        propFix: {
            tabindex: "tabIndex",
            readonly: "readOnly",
            for: "htmlFor",
            class: "className",
            maxlength: "maxLength",
            cellspacing: "cellSpacing",
            cellpadding: "cellPadding",
            rowspan: "rowSpan",
            colspan: "colSpan",
            usemap: "useMap",
            frameborder: "frameBorder",
            contenteditable: "contentEditable"
        },
        prop: function(a, c, d) {
            var e, g, h, i = a.nodeType;
            if (!a || i === 3 || i === 8 || i === 2) {
                return;
            }
            h = i !== 1 || !f.isXMLDoc(a);
            if (h) {
                c = f.propFix[c] || c;
                g = f.propHooks[c];
            }
            if (d !== b) {
                if (g && "set" in g && (e = g.set(a, d, c)) !== b) {
                    return e;
                } else {
                    return a[c] = d;
                }
            } else {
                if (g && "get" in g && (e = g.get(a, c)) !== null) {
                    return e;
                } else {
                    return a[c];
                }
            }
        },
        propHooks: {
            tabIndex: {
                get: function(a) {
                    var c = a.getAttributeNode("tabindex");
                    return c && c.specified ? parseInt(c.value, 10) : s.test(a.nodeName) || t.test(a.nodeName) && a.href ? 0 : b;
                }
            }
        }
    });
    f.attrHooks.tabindex = f.propHooks.tabIndex;
    x = {
        get: function(a, c) {
            var d, e = f.prop(a, c);
            return e === true || typeof e !== "boolean" && (d = a.getAttributeNode(c)) && d.nodeValue !== false ? c.toLowerCase() : b;
        },
        set: function(a, b, c) {
            var d;
            if (b === false) {
                f.removeAttr(a, c);
            } else {
                d = f.propFix[c] || c;
                if (d in a) {
                    a[d] = true;
                }
                a.setAttribute(c, c.toLowerCase());
            }
            return c;
        }
    };
    if (!v) {
        y = {
            name: true,
            id: true,
            coords: true
        };
        w = f.valHooks.button = {
            get: function(a, c) {
                var d;
                d = a.getAttributeNode(c);
                return d && (y[c] ? d.nodeValue !== "" : d.specified) ? d.nodeValue : b;
            },
            set: function(a, b, d) {
                var e = a.getAttributeNode(d);
                if (!e) {
                    e = c.createAttribute(d);
                    a.setAttributeNode(e);
                }
                return e.nodeValue = b + "";
            }
        };
        f.attrHooks.tabindex.set = w.set;
        f.each([ "width", "height" ], function(a, b) {
            f.attrHooks[b] = f.extend(f.attrHooks[b], {
                set: function(a, c) {
                    if (c === "") {
                        a.setAttribute(b, "auto");
                        return c;
                    }
                }
            });
        });
        f.attrHooks.contenteditable = {
            get: w.get,
            set: function(a, b, c) {
                if (b === "") {
                    b = "false";
                }
                w.set(a, b, c);
            }
        };
    }
    if (!f.support.hrefNormalized) {
        f.each([ "href", "src", "width", "height" ], function(a, c) {
            f.attrHooks[c] = f.extend(f.attrHooks[c], {
                get: function(a) {
                    var d = a.getAttribute(c, 2);
                    return d === null ? b : d;
                }
            });
        });
    }
    if (!f.support.style) {
        f.attrHooks.style = {
            get: function(a) {
                return a.style.cssText.toLowerCase() || b;
            },
            set: function(a, b) {
                return a.style.cssText = "" + b;
            }
        };
    }
    if (!f.support.optSelected) {
        f.propHooks.selected = f.extend(f.propHooks.selected, {
            get: function(a) {
                var b = a.parentNode;
                if (b) {
                    b.selectedIndex;
                    if (b.parentNode) {
                        b.parentNode.selectedIndex;
                    }
                }
                return null;
            }
        });
    }
    if (!f.support.enctype) {
        f.propFix.enctype = "encoding";
    }
    if (!f.support.checkOn) {
        f.each([ "radio", "checkbox" ], function() {
            f.valHooks[this] = {
                get: function(a) {
                    return a.getAttribute("value") === null ? "on" : a.value;
                }
            };
        });
    }
    f.each([ "radio", "checkbox" ], function() {
        f.valHooks[this] = f.extend(f.valHooks[this], {
            set: function(a, b) {
                if (f.isArray(b)) {
                    return a.checked = f.inArray(f(a).val(), b) >= 0;
                }
            }
        });
    });
    var z = /^(?:textarea|input|select)$/i, A = /^([^\.]*)?(?:\.(.+))?$/, B = /(?:^|\s)hover(\.\S+)?\b/, C = /^key/, D = /^(?:mouse|contextmenu)|click/, E = /^(?:focusinfocus|focusoutblur)$/, F = /^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/, G = function(a) {
        var b = F.exec(a);
        if (b) {
            b[1] = (b[1] || "").toLowerCase();
            b[3] = b[3] && new RegExp("(?:^|\\s)" + b[3] + "(?:\\s|$)");
        }
        return b;
    }, H = function(a, b) {
        var c = a.attributes || {};
        return (!b[1] || a.nodeName.toLowerCase() === b[1]) && (!b[2] || (c.id || {}).value === b[2]) && (!b[3] || b[3].test((c["class"] || {}).value));
    }, I = function(a) {
        return f.event.special.hover ? a : a.replace(B, "mouseenter$1 mouseleave$1");
    };
    f.event = {
        add: function(a, c, d, e, g) {
            var h, i, j, k, l, m, n, o, p, q, r, s;
            if (a.nodeType === 3 || a.nodeType === 8 || !c || !d || !(h = f._data(a))) {
                return;
            }
            if (d.handler) {
                p = d;
                d = p.handler;
                g = p.selector;
            }
            if (!d.guid) {
                d.guid = f.guid++;
            }
            j = h.events;
            if (!j) {
                h.events = j = {};
            }
            i = h.handle;
            if (!i) {
                h.handle = i = function(a) {
                    return typeof f !== "undefined" && (!a || f.event.triggered !== a.type) ? f.event.dispatch.apply(i.elem, arguments) : b;
                };
                i.elem = a;
            }
            c = f.trim(I(c)).split(" ");
            for (k = 0; k < c.length; k++) {
                l = A.exec(c[k]) || [];
                m = l[1];
                n = (l[2] || "").split(".").sort();
                s = f.event.special[m] || {};
                m = (g ? s.delegateType : s.bindType) || m;
                s = f.event.special[m] || {};
                o = f.extend({
                    type: m,
                    origType: l[1],
                    data: e,
                    handler: d,
                    guid: d.guid,
                    selector: g,
                    quick: g && G(g),
                    namespace: n.join(".")
                }, p);
                r = j[m];
                if (!r) {
                    r = j[m] = [];
                    r.delegateCount = 0;
                    if (!s.setup || s.setup.call(a, e, n, i) === false) {
                        if (a.addEventListener) {
                            a.addEventListener(m, i, false);
                        } else if (a.attachEvent) {
                            a.attachEvent("on" + m, i);
                        }
                    }
                }
                if (s.add) {
                    s.add.call(a, o);
                    if (!o.handler.guid) {
                        o.handler.guid = d.guid;
                    }
                }
                if (g) {
                    r.splice(r.delegateCount++, 0, o);
                } else {
                    r.push(o);
                }
                f.event.global[m] = true;
            }
            a = null;
        },
        global: {},
        remove: function(a, b, c, d, e) {
            var g = f.hasData(a) && f._data(a), h, i, j, k, l, m, n, o, p, q, r, s;
            if (!g || !(o = g.events)) {
                return;
            }
            b = f.trim(I(b || "")).split(" ");
            for (h = 0; h < b.length; h++) {
                i = A.exec(b[h]) || [];
                j = k = i[1];
                l = i[2];
                if (!j) {
                    for (j in o) {
                        f.event.remove(a, j + b[h], c, d, true);
                    }
                    continue;
                }
                p = f.event.special[j] || {};
                j = (d ? p.delegateType : p.bindType) || j;
                r = o[j] || [];
                m = r.length;
                l = l ? new RegExp("(^|\\.)" + l.split(".").sort().join("\\.(?:.*\\.)?") + "(\\.|$)") : null;
                for (n = 0; n < r.length; n++) {
                    s = r[n];
                    if ((e || k === s.origType) && (!c || c.guid === s.guid) && (!l || l.test(s.namespace)) && (!d || d === s.selector || d === "**" && s.selector)) {
                        r.splice(n--, 1);
                        if (s.selector) {
                            r.delegateCount--;
                        }
                        if (p.remove) {
                            p.remove.call(a, s);
                        }
                    }
                }
                if (r.length === 0 && m !== r.length) {
                    if (!p.teardown || p.teardown.call(a, l) === false) {
                        f.removeEvent(a, j, g.handle);
                    }
                    delete o[j];
                }
            }
            if (f.isEmptyObject(o)) {
                q = g.handle;
                if (q) {
                    q.elem = null;
                }
                f.removeData(a, [ "events", "handle" ], true);
            }
        },
        customEvent: {
            getData: true,
            setData: true,
            changeData: true
        },
        trigger: function(c, d, e, g) {
            if (e && (e.nodeType === 3 || e.nodeType === 8)) {
                return;
            }
            var h = c.type || c, i = [], j, k, l, m, n, o, p, q, r, s;
            if (E.test(h + f.event.triggered)) {
                return;
            }
            if (h.indexOf("!") >= 0) {
                h = h.slice(0, -1);
                k = true;
            }
            if (h.indexOf(".") >= 0) {
                i = h.split(".");
                h = i.shift();
                i.sort();
            }
            if ((!e || f.event.customEvent[h]) && !f.event.global[h]) {
                return;
            }
            c = typeof c === "object" ? c[f.expando] ? c : new f.Event(h, c) : new f.Event(h);
            c.type = h;
            c.isTrigger = true;
            c.exclusive = k;
            c.namespace = i.join(".");
            c.namespace_re = c.namespace ? new RegExp("(^|\\.)" + i.join("\\.(?:.*\\.)?") + "(\\.|$)") : null;
            o = h.indexOf(":") < 0 ? "on" + h : "";
            if (!e) {
                j = f.cache;
                for (l in j) {
                    if (j[l].events && j[l].events[h]) {
                        f.event.trigger(c, d, j[l].handle.elem, true);
                    }
                }
                return;
            }
            c.result = b;
            if (!c.target) {
                c.target = e;
            }
            d = d != null ? f.makeArray(d) : [];
            d.unshift(c);
            p = f.event.special[h] || {};
            if (p.trigger && p.trigger.apply(e, d) === false) {
                return;
            }
            r = [ [ e, p.bindType || h ] ];
            if (!g && !p.noBubble && !f.isWindow(e)) {
                s = p.delegateType || h;
                m = E.test(s + h) ? e : e.parentNode;
                n = null;
                for (;m; m = m.parentNode) {
                    r.push([ m, s ]);
                    n = m;
                }
                if (n && n === e.ownerDocument) {
                    r.push([ n.defaultView || n.parentWindow || a, s ]);
                }
            }
            for (l = 0; l < r.length && !c.isPropagationStopped(); l++) {
                m = r[l][0];
                c.type = r[l][1];
                q = (f._data(m, "events") || {})[c.type] && f._data(m, "handle");
                if (q) {
                    q.apply(m, d);
                }
                q = o && m[o];
                if (q && f.acceptData(m) && q.apply(m, d) === false) {
                    c.preventDefault();
                }
            }
            c.type = h;
            if (!g && !c.isDefaultPrevented()) {
                if ((!p._default || p._default.apply(e.ownerDocument, d) === false) && !(h === "click" && f.nodeName(e, "a")) && f.acceptData(e)) {
                    if (o && e[h] && (h !== "focus" && h !== "blur" || c.target.offsetWidth !== 0) && !f.isWindow(e)) {
                        n = e[o];
                        if (n) {
                            e[o] = null;
                        }
                        f.event.triggered = h;
                        e[h]();
                        f.event.triggered = b;
                        if (n) {
                            e[o] = n;
                        }
                    }
                }
            }
            return c.result;
        },
        dispatch: function(c) {
            c = f.event.fix(c || a.event);
            var d = (f._data(this, "events") || {})[c.type] || [], e = d.delegateCount, g = [].slice.call(arguments, 0), h = !c.exclusive && !c.namespace, i = f.event.special[c.type] || {}, j = [], k, l, m, n, o, p, q, r, s, t, u;
            g[0] = c;
            c.delegateTarget = this;
            if (i.preDispatch && i.preDispatch.call(this, c) === false) {
                return;
            }
            if (e && !(c.button && c.type === "click")) {
                n = f(this);
                n.context = this.ownerDocument || this;
                for (m = c.target; m != this; m = m.parentNode || this) {
                    if (m.disabled !== true) {
                        p = {};
                        r = [];
                        n[0] = m;
                        for (k = 0; k < e; k++) {
                            s = d[k];
                            t = s.selector;
                            if (p[t] === b) {
                                p[t] = s.quick ? H(m, s.quick) : n.is(t);
                            }
                            if (p[t]) {
                                r.push(s);
                            }
                        }
                        if (r.length) {
                            j.push({
                                elem: m,
                                matches: r
                            });
                        }
                    }
                }
            }
            if (d.length > e) {
                j.push({
                    elem: this,
                    matches: d.slice(e)
                });
            }
            for (k = 0; k < j.length && !c.isPropagationStopped(); k++) {
                q = j[k];
                c.currentTarget = q.elem;
                for (l = 0; l < q.matches.length && !c.isImmediatePropagationStopped(); l++) {
                    s = q.matches[l];
                    if (h || !c.namespace && !s.namespace || c.namespace_re && c.namespace_re.test(s.namespace)) {
                        c.data = s.data;
                        c.handleObj = s;
                        o = ((f.event.special[s.origType] || {}).handle || s.handler).apply(q.elem, g);
                        if (o !== b) {
                            c.result = o;
                            if (o === false) {
                                c.preventDefault();
                                c.stopPropagation();
                            }
                        }
                    }
                }
            }
            if (i.postDispatch) {
                i.postDispatch.call(this, c);
            }
            return c.result;
        },
        props: "attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
        fixHooks: {},
        keyHooks: {
            props: "char charCode key keyCode".split(" "),
            filter: function(a, b) {
                if (a.which == null) {
                    a.which = b.charCode != null ? b.charCode : b.keyCode;
                }
                return a;
            }
        },
        mouseHooks: {
            props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
            filter: function(a, d) {
                var e, f, g, h = d.button, i = d.fromElement;
                if (a.pageX == null && d.clientX != null) {
                    e = a.target.ownerDocument || c;
                    f = e.documentElement;
                    g = e.body;
                    a.pageX = d.clientX + (f && f.scrollLeft || g && g.scrollLeft || 0) - (f && f.clientLeft || g && g.clientLeft || 0);
                    a.pageY = d.clientY + (f && f.scrollTop || g && g.scrollTop || 0) - (f && f.clientTop || g && g.clientTop || 0);
                }
                if (!a.relatedTarget && i) {
                    a.relatedTarget = i === a.target ? d.toElement : i;
                }
                if (!a.which && h !== b) {
                    a.which = h & 1 ? 1 : h & 2 ? 3 : h & 4 ? 2 : 0;
                }
                return a;
            }
        },
        fix: function(a) {
            if (a[f.expando]) {
                return a;
            }
            var d, e, g = a, h = f.event.fixHooks[a.type] || {}, i = h.props ? this.props.concat(h.props) : this.props;
            a = f.Event(g);
            for (d = i.length; d; ) {
                e = i[--d];
                a[e] = g[e];
            }
            if (!a.target) {
                a.target = g.srcElement || c;
            }
            if (a.target.nodeType === 3) {
                a.target = a.target.parentNode;
            }
            if (a.metaKey === b) {
                a.metaKey = a.ctrlKey;
            }
            return h.filter ? h.filter(a, g) : a;
        },
        special: {
            ready: {
                setup: f.bindReady
            },
            load: {
                noBubble: true
            },
            focus: {
                delegateType: "focusin"
            },
            blur: {
                delegateType: "focusout"
            },
            beforeunload: {
                setup: function(a, b, c) {
                    if (f.isWindow(this)) {
                        this.onbeforeunload = c;
                    }
                },
                teardown: function(a, b) {
                    if (this.onbeforeunload === b) {
                        this.onbeforeunload = null;
                    }
                }
            }
        },
        simulate: function(a, b, c, d) {
            var e = f.extend(new f.Event(), c, {
                type: a,
                isSimulated: true,
                originalEvent: {}
            });
            if (d) {
                f.event.trigger(e, null, b);
            } else {
                f.event.dispatch.call(b, e);
            }
            if (e.isDefaultPrevented()) {
                c.preventDefault();
            }
        }
    };
    f.event.handle = f.event.dispatch;
    f.removeEvent = c.removeEventListener ? function(a, b, c) {
        if (a.removeEventListener) {
            a.removeEventListener(b, c, false);
        }
    } : function(a, b, c) {
        if (a.detachEvent) {
            a.detachEvent("on" + b, c);
        }
    };
    f.Event = function(a, b) {
        if (!(this instanceof f.Event)) {
            return new f.Event(a, b);
        }
        if (a && a.type) {
            this.originalEvent = a;
            this.type = a.type;
            this.isDefaultPrevented = a.defaultPrevented || a.returnValue === false || a.getPreventDefault && a.getPreventDefault() ? K : J;
        } else {
            this.type = a;
        }
        if (b) {
            f.extend(this, b);
        }
        this.timeStamp = a && a.timeStamp || f.now();
        this[f.expando] = true;
    };
    function J() {
        return false;
    }
    function K() {
        return true;
    }
    f.Event.prototype = {
        preventDefault: function() {
            this.isDefaultPrevented = K;
            var a = this.originalEvent;
            if (!a) {
                return;
            }
            if (a.preventDefault) {
                a.preventDefault();
            } else {
                a.returnValue = false;
            }
        },
        stopPropagation: function() {
            this.isPropagationStopped = K;
            var a = this.originalEvent;
            if (!a) {
                return;
            }
            if (a.stopPropagation) {
                a.stopPropagation();
            }
            a.cancelBubble = true;
        },
        stopImmediatePropagation: function() {
            this.isImmediatePropagationStopped = K;
            this.stopPropagation();
        },
        isDefaultPrevented: J,
        isPropagationStopped: J,
        isImmediatePropagationStopped: J
    };
    f.each({
        mouseenter: "mouseover",
        mouseleave: "mouseout"
    }, function(a, b) {
        f.event.special[a] = {
            delegateType: b,
            bindType: b,
            handle: function(a) {
                var c = this, d = a.relatedTarget, e = a.handleObj, g = e.selector, h;
                if (!d || d !== c && !f.contains(c, d)) {
                    a.type = e.origType;
                    h = e.handler.apply(this, arguments);
                    a.type = b;
                }
                return h;
            }
        };
    });
    if (!f.support.submitBubbles) {
        f.event.special.submit = {
            setup: function() {
                if (f.nodeName(this, "form")) {
                    return false;
                }
                f.event.add(this, "click._submit keypress._submit", function(a) {
                    var c = a.target, d = f.nodeName(c, "input") || f.nodeName(c, "button") ? c.form : b;
                    if (d && !d._submit_attached) {
                        f.event.add(d, "submit._submit", function(a) {
                            a._submit_bubble = true;
                        });
                        d._submit_attached = true;
                    }
                });
            },
            postDispatch: function(a) {
                if (a._submit_bubble) {
                    delete a._submit_bubble;
                    if (this.parentNode && !a.isTrigger) {
                        f.event.simulate("submit", this.parentNode, a, true);
                    }
                }
            },
            teardown: function() {
                if (f.nodeName(this, "form")) {
                    return false;
                }
                f.event.remove(this, "._submit");
            }
        };
    }
    if (!f.support.changeBubbles) {
        f.event.special.change = {
            setup: function() {
                if (z.test(this.nodeName)) {
                    if (this.type === "checkbox" || this.type === "radio") {
                        f.event.add(this, "propertychange._change", function(a) {
                            if (a.originalEvent.propertyName === "checked") {
                                this._just_changed = true;
                            }
                        });
                        f.event.add(this, "click._change", function(a) {
                            if (this._just_changed && !a.isTrigger) {
                                this._just_changed = false;
                                f.event.simulate("change", this, a, true);
                            }
                        });
                    }
                    return false;
                }
                f.event.add(this, "beforeactivate._change", function(a) {
                    var b = a.target;
                    if (z.test(b.nodeName) && !b._change_attached) {
                        f.event.add(b, "change._change", function(a) {
                            if (this.parentNode && !a.isSimulated && !a.isTrigger) {
                                f.event.simulate("change", this.parentNode, a, true);
                            }
                        });
                        b._change_attached = true;
                    }
                });
            },
            handle: function(a) {
                var b = a.target;
                if (this !== b || a.isSimulated || a.isTrigger || b.type !== "radio" && b.type !== "checkbox") {
                    return a.handleObj.handler.apply(this, arguments);
                }
            },
            teardown: function() {
                f.event.remove(this, "._change");
                return z.test(this.nodeName);
            }
        };
    }
    if (!f.support.focusinBubbles) {
        f.each({
            focus: "focusin",
            blur: "focusout"
        }, function(a, b) {
            var d = 0, e = function(a) {
                f.event.simulate(b, a.target, f.event.fix(a), true);
            };
            f.event.special[b] = {
                setup: function() {
                    if (d++ === 0) {
                        c.addEventListener(a, e, true);
                    }
                },
                teardown: function() {
                    if (--d === 0) {
                        c.removeEventListener(a, e, true);
                    }
                }
            };
        });
    }
    f.fn.extend({
        on: function(a, c, d, e, g) {
            var h, i;
            if (typeof a === "object") {
                if (typeof c !== "string") {
                    d = d || c;
                    c = b;
                }
                for (i in a) {
                    this.on(i, c, d, a[i], g);
                }
                return this;
            }
            if (d == null && e == null) {
                e = c;
                d = c = b;
            } else if (e == null) {
                if (typeof c === "string") {
                    e = d;
                    d = b;
                } else {
                    e = d;
                    d = c;
                    c = b;
                }
            }
            if (e === false) {
                e = J;
            } else if (!e) {
                return this;
            }
            if (g === 1) {
                h = e;
                e = function(a) {
                    f().off(a);
                    return h.apply(this, arguments);
                };
                e.guid = h.guid || (h.guid = f.guid++);
            }
            return this.each(function() {
                f.event.add(this, a, e, d, c);
            });
        },
        one: function(a, b, c, d) {
            return this.on(a, b, c, d, 1);
        },
        off: function(a, c, d) {
            if (a && a.preventDefault && a.handleObj) {
                var e = a.handleObj;
                f(a.delegateTarget).off(e.namespace ? e.origType + "." + e.namespace : e.origType, e.selector, e.handler);
                return this;
            }
            if (typeof a === "object") {
                for (var g in a) {
                    this.off(g, c, a[g]);
                }
                return this;
            }
            if (c === false || typeof c === "function") {
                d = c;
                c = b;
            }
            if (d === false) {
                d = J;
            }
            return this.each(function() {
                f.event.remove(this, a, d, c);
            });
        },
        bind: function(a, b, c) {
            return this.on(a, null, b, c);
        },
        unbind: function(a, b) {
            return this.off(a, null, b);
        },
        live: function(a, b, c) {
            f(this.context).on(a, this.selector, b, c);
            return this;
        },
        die: function(a, b) {
            f(this.context).off(a, this.selector || "**", b);
            return this;
        },
        delegate: function(a, b, c, d) {
            return this.on(b, a, c, d);
        },
        undelegate: function(a, b, c) {
            return arguments.length == 1 ? this.off(a, "**") : this.off(b, a, c);
        },
        trigger: function(a, b) {
            return this.each(function() {
                f.event.trigger(a, b, this);
            });
        },
        triggerHandler: function(a, b) {
            if (this[0]) {
                return f.event.trigger(a, b, this[0], true);
            }
        },
        toggle: function(a) {
            var b = arguments, c = a.guid || f.guid++, d = 0, e = function(c) {
                var e = (f._data(this, "lastToggle" + a.guid) || 0) % d;
                f._data(this, "lastToggle" + a.guid, e + 1);
                c.preventDefault();
                return b[e].apply(this, arguments) || false;
            };
            e.guid = c;
            while (d < b.length) {
                b[d++].guid = c;
            }
            return this.click(e);
        },
        hover: function(a, b) {
            return this.mouseenter(a).mouseleave(b || a);
        }
    });
    f.each(("blur focus focusin focusout load resize scroll unload click dblclick " + "mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " + "change select submit keydown keypress keyup error contextmenu").split(" "), function(a, b) {
        f.fn[b] = function(a, c) {
            if (c == null) {
                c = a;
                a = null;
            }
            return arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b);
        };
        if (f.attrFn) {
            f.attrFn[b] = true;
        }
        if (C.test(b)) {
            f.event.fixHooks[b] = f.event.keyHooks;
        }
        if (D.test(b)) {
            f.event.fixHooks[b] = f.event.mouseHooks;
        }
    });
    (function() {
        var a = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g, d = "sizcache" + (Math.random() + "").replace(".", ""), e = 0, g = Object.prototype.toString, h = false, i = true, j = /\\/g, k = /\r\n/g, l = /\W/;
        [ 0, 0 ].sort(function() {
            i = false;
            return 0;
        });
        var m = function(b, d, e, f) {
            e = e || [];
            d = d || c;
            var h = d;
            if (d.nodeType !== 1 && d.nodeType !== 9) {
                return [];
            }
            if (!b || typeof b !== "string") {
                return e;
            }
            var i, j, k, l, n, q, r, t, u = true, v = m.isXML(d), w = [], y = b;
            do {
                a.exec("");
                i = a.exec(y);
                if (i) {
                    y = i[3];
                    w.push(i[1]);
                    if (i[2]) {
                        l = i[3];
                        break;
                    }
                }
            } while (i);
            if (w.length > 1 && p.exec(b)) {
                if (w.length === 2 && o.relative[w[0]]) {
                    j = x(w[0] + w[1], d, f);
                } else {
                    j = o.relative[w[0]] ? [ d ] : m(w.shift(), d);
                    while (w.length) {
                        b = w.shift();
                        if (o.relative[b]) {
                            b += w.shift();
                        }
                        j = x(b, j, f);
                    }
                }
            } else {
                if (!f && w.length > 1 && d.nodeType === 9 && !v && o.match.ID.test(w[0]) && !o.match.ID.test(w[w.length - 1])) {
                    n = m.find(w.shift(), d, v);
                    d = n.expr ? m.filter(n.expr, n.set)[0] : n.set[0];
                }
                if (d) {
                    n = f ? {
                        expr: w.pop(),
                        set: s(f)
                    } : m.find(w.pop(), w.length === 1 && (w[0] === "~" || w[0] === "+") && d.parentNode ? d.parentNode : d, v);
                    j = n.expr ? m.filter(n.expr, n.set) : n.set;
                    if (w.length > 0) {
                        k = s(j);
                    } else {
                        u = false;
                    }
                    while (w.length) {
                        q = w.pop();
                        r = q;
                        if (!o.relative[q]) {
                            q = "";
                        } else {
                            r = w.pop();
                        }
                        if (r == null) {
                            r = d;
                        }
                        o.relative[q](k, r, v);
                    }
                } else {
                    k = w = [];
                }
            }
            if (!k) {
                k = j;
            }
            if (!k) {
                m.error(q || b);
            }
            if (g.call(k) === "[object Array]") {
                if (!u) {
                    e.push.apply(e, k);
                } else if (d && d.nodeType === 1) {
                    for (t = 0; k[t] != null; t++) {
                        if (k[t] && (k[t] === true || k[t].nodeType === 1 && m.contains(d, k[t]))) {
                            e.push(j[t]);
                        }
                    }
                } else {
                    for (t = 0; k[t] != null; t++) {
                        if (k[t] && k[t].nodeType === 1) {
                            e.push(j[t]);
                        }
                    }
                }
            } else {
                s(k, e);
            }
            if (l) {
                m(l, h, e, f);
                m.uniqueSort(e);
            }
            return e;
        };
        m.uniqueSort = function(a) {
            if (t) {
                h = i;
                a.sort(t);
                if (h) {
                    for (var b = 1; b < a.length; b++) {
                        if (a[b] === a[b - 1]) {
                            a.splice(b--, 1);
                        }
                    }
                }
            }
            return a;
        };
        m.matches = function(a, b) {
            return m(a, null, null, b);
        };
        m.matchesSelector = function(a, b) {
            return m(b, null, null, [ a ]).length > 0;
        };
        m.find = function(a, b, c) {
            var d, e, f, g, h, i;
            if (!a) {
                return [];
            }
            for (e = 0, f = o.order.length; e < f; e++) {
                h = o.order[e];
                if (g = o.leftMatch[h].exec(a)) {
                    i = g[1];
                    g.splice(1, 1);
                    if (i.substr(i.length - 1) !== "\\") {
                        g[1] = (g[1] || "").replace(j, "");
                        d = o.find[h](g, b, c);
                        if (d != null) {
                            a = a.replace(o.match[h], "");
                            break;
                        }
                    }
                }
            }
            if (!d) {
                d = typeof b.getElementsByTagName !== "undefined" ? b.getElementsByTagName("*") : [];
            }
            return {
                set: d,
                expr: a
            };
        };
        m.filter = function(a, c, d, e) {
            var f, g, h, i, j, k, l, n, p, q = a, r = [], s = c, t = c && c[0] && m.isXML(c[0]);
            while (a && c.length) {
                for (h in o.filter) {
                    if ((f = o.leftMatch[h].exec(a)) != null && f[2]) {
                        k = o.filter[h];
                        l = f[1];
                        g = false;
                        f.splice(1, 1);
                        if (l.substr(l.length - 1) === "\\") {
                            continue;
                        }
                        if (s === r) {
                            r = [];
                        }
                        if (o.preFilter[h]) {
                            f = o.preFilter[h](f, s, d, r, e, t);
                            if (!f) {
                                g = i = true;
                            } else if (f === true) {
                                continue;
                            }
                        }
                        if (f) {
                            for (n = 0; (j = s[n]) != null; n++) {
                                if (j) {
                                    i = k(j, f, n, s);
                                    p = e ^ i;
                                    if (d && i != null) {
                                        if (p) {
                                            g = true;
                                        } else {
                                            s[n] = false;
                                        }
                                    } else if (p) {
                                        r.push(j);
                                        g = true;
                                    }
                                }
                            }
                        }
                        if (i !== b) {
                            if (!d) {
                                s = r;
                            }
                            a = a.replace(o.match[h], "");
                            if (!g) {
                                return [];
                            }
                            break;
                        }
                    }
                }
                if (a === q) {
                    if (g == null) {
                        m.error(a);
                    } else {
                        break;
                    }
                }
                q = a;
            }
            return s;
        };
        m.error = function(a) {
            throw new Error("Syntax error, unrecognized expression: " + a);
        };
        var n = m.getText = function(a) {
            var b, c, d = a.nodeType, e = "";
            if (d) {
                if (d === 1 || d === 9 || d === 11) {
                    if (typeof a.textContent === "string") {
                        return a.textContent;
                    } else if (typeof a.innerText === "string") {
                        return a.innerText.replace(k, "");
                    } else {
                        for (a = a.firstChild; a; a = a.nextSibling) {
                            e += n(a);
                        }
                    }
                } else if (d === 3 || d === 4) {
                    return a.nodeValue;
                }
            } else {
                for (b = 0; c = a[b]; b++) {
                    if (c.nodeType !== 8) {
                        e += n(c);
                    }
                }
            }
            return e;
        };
        var o = m.selectors = {
            order: [ "ID", "NAME", "TAG" ],
            match: {
                ID: /#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,
                CLASS: /\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,
                NAME: /\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,
                ATTR: /\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,
                TAG: /^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,
                CHILD: /:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,
                POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,
                PSEUDO: /:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/
            },
            leftMatch: {},
            attrMap: {
                class: "className",
                for: "htmlFor"
            },
            attrHandle: {
                href: function(a) {
                    return a.getAttribute("href");
                },
                type: function(a) {
                    return a.getAttribute("type");
                }
            },
            relative: {
                "+": function(a, b) {
                    var c = typeof b === "string", d = c && !l.test(b), e = c && !d;
                    if (d) {
                        b = b.toLowerCase();
                    }
                    for (var f = 0, g = a.length, h; f < g; f++) {
                        if (h = a[f]) {
                            while ((h = h.previousSibling) && h.nodeType !== 1) {}
                            a[f] = e || h && h.nodeName.toLowerCase() === b ? h || false : h === b;
                        }
                    }
                    if (e) {
                        m.filter(b, a, true);
                    }
                },
                ">": function(a, b) {
                    var c, d = typeof b === "string", e = 0, f = a.length;
                    if (d && !l.test(b)) {
                        b = b.toLowerCase();
                        for (;e < f; e++) {
                            c = a[e];
                            if (c) {
                                var g = c.parentNode;
                                a[e] = g.nodeName.toLowerCase() === b ? g : false;
                            }
                        }
                    } else {
                        for (;e < f; e++) {
                            c = a[e];
                            if (c) {
                                a[e] = d ? c.parentNode : c.parentNode === b;
                            }
                        }
                        if (d) {
                            m.filter(b, a, true);
                        }
                    }
                },
                "": function(a, b, c) {
                    var d, f = e++, g = w;
                    if (typeof b === "string" && !l.test(b)) {
                        b = b.toLowerCase();
                        d = b;
                        g = v;
                    }
                    g("parentNode", b, f, a, d, c);
                },
                "~": function(a, b, c) {
                    var d, f = e++, g = w;
                    if (typeof b === "string" && !l.test(b)) {
                        b = b.toLowerCase();
                        d = b;
                        g = v;
                    }
                    g("previousSibling", b, f, a, d, c);
                }
            },
            find: {
                ID: function(a, b, c) {
                    if (typeof b.getElementById !== "undefined" && !c) {
                        var d = b.getElementById(a[1]);
                        return d && d.parentNode ? [ d ] : [];
                    }
                },
                NAME: function(a, b) {
                    if (typeof b.getElementsByName !== "undefined") {
                        var c = [], d = b.getElementsByName(a[1]);
                        for (var e = 0, f = d.length; e < f; e++) {
                            if (d[e].getAttribute("name") === a[1]) {
                                c.push(d[e]);
                            }
                        }
                        return c.length === 0 ? null : c;
                    }
                },
                TAG: function(a, b) {
                    if (typeof b.getElementsByTagName !== "undefined") {
                        return b.getElementsByTagName(a[1]);
                    }
                }
            },
            preFilter: {
                CLASS: function(a, b, c, d, e, f) {
                    a = " " + a[1].replace(j, "") + " ";
                    if (f) {
                        return a;
                    }
                    for (var g = 0, h; (h = b[g]) != null; g++) {
                        if (h) {
                            if (e ^ (h.className && (" " + h.className + " ").replace(/[\t\n\r]/g, " ").indexOf(a) >= 0)) {
                                if (!c) {
                                    d.push(h);
                                }
                            } else if (c) {
                                b[g] = false;
                            }
                        }
                    }
                    return false;
                },
                ID: function(a) {
                    return a[1].replace(j, "");
                },
                TAG: function(a, b) {
                    return a[1].replace(j, "").toLowerCase();
                },
                CHILD: function(a) {
                    if (a[1] === "nth") {
                        if (!a[2]) {
                            m.error(a[0]);
                        }
                        a[2] = a[2].replace(/^\+|\s*/g, "");
                        var b = /(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2] === "even" && "2n" || a[2] === "odd" && "2n+1" || !/\D/.test(a[2]) && "0n+" + a[2] || a[2]);
                        a[2] = b[1] + (b[2] || 1) - 0;
                        a[3] = b[3] - 0;
                    } else if (a[2]) {
                        m.error(a[0]);
                    }
                    a[0] = e++;
                    return a;
                },
                ATTR: function(a, b, c, d, e, f) {
                    var g = a[1] = a[1].replace(j, "");
                    if (!f && o.attrMap[g]) {
                        a[1] = o.attrMap[g];
                    }
                    a[4] = (a[4] || a[5] || "").replace(j, "");
                    if (a[2] === "~=") {
                        a[4] = " " + a[4] + " ";
                    }
                    return a;
                },
                PSEUDO: function(b, c, d, e, f) {
                    if (b[1] === "not") {
                        if ((a.exec(b[3]) || "").length > 1 || /^\w/.test(b[3])) {
                            b[3] = m(b[3], null, null, c);
                        } else {
                            var g = m.filter(b[3], c, d, true ^ f);
                            if (!d) {
                                e.push.apply(e, g);
                            }
                            return false;
                        }
                    } else if (o.match.POS.test(b[0]) || o.match.CHILD.test(b[0])) {
                        return true;
                    }
                    return b;
                },
                POS: function(a) {
                    a.unshift(true);
                    return a;
                }
            },
            filters: {
                enabled: function(a) {
                    return a.disabled === false && a.type !== "hidden";
                },
                disabled: function(a) {
                    return a.disabled === true;
                },
                checked: function(a) {
                    return a.checked === true;
                },
                selected: function(a) {
                    if (a.parentNode) {
                        a.parentNode.selectedIndex;
                    }
                    return a.selected === true;
                },
                parent: function(a) {
                    return !!a.firstChild;
                },
                empty: function(a) {
                    return !a.firstChild;
                },
                has: function(a, b, c) {
                    return !!m(c[3], a).length;
                },
                header: function(a) {
                    return /h\d/i.test(a.nodeName);
                },
                text: function(a) {
                    var b = a.getAttribute("type"), c = a.type;
                    return a.nodeName.toLowerCase() === "input" && "text" === c && (b === c || b === null);
                },
                radio: function(a) {
                    return a.nodeName.toLowerCase() === "input" && "radio" === a.type;
                },
                checkbox: function(a) {
                    return a.nodeName.toLowerCase() === "input" && "checkbox" === a.type;
                },
                file: function(a) {
                    return a.nodeName.toLowerCase() === "input" && "file" === a.type;
                },
                password: function(a) {
                    return a.nodeName.toLowerCase() === "input" && "password" === a.type;
                },
                submit: function(a) {
                    var b = a.nodeName.toLowerCase();
                    return (b === "input" || b === "button") && "submit" === a.type;
                },
                image: function(a) {
                    return a.nodeName.toLowerCase() === "input" && "image" === a.type;
                },
                reset: function(a) {
                    var b = a.nodeName.toLowerCase();
                    return (b === "input" || b === "button") && "reset" === a.type;
                },
                button: function(a) {
                    var b = a.nodeName.toLowerCase();
                    return b === "input" && "button" === a.type || b === "button";
                },
                input: function(a) {
                    return /input|select|textarea|button/i.test(a.nodeName);
                },
                focus: function(a) {
                    return a === a.ownerDocument.activeElement;
                }
            },
            setFilters: {
                first: function(a, b) {
                    return b === 0;
                },
                last: function(a, b, c, d) {
                    return b === d.length - 1;
                },
                even: function(a, b) {
                    return b % 2 === 0;
                },
                odd: function(a, b) {
                    return b % 2 === 1;
                },
                lt: function(a, b, c) {
                    return b < c[3] - 0;
                },
                gt: function(a, b, c) {
                    return b > c[3] - 0;
                },
                nth: function(a, b, c) {
                    return c[3] - 0 === b;
                },
                eq: function(a, b, c) {
                    return c[3] - 0 === b;
                }
            },
            filter: {
                PSEUDO: function(a, b, c, d) {
                    var e = b[1], f = o.filters[e];
                    if (f) {
                        return f(a, c, b, d);
                    } else if (e === "contains") {
                        return (a.textContent || a.innerText || n([ a ]) || "").indexOf(b[3]) >= 0;
                    } else if (e === "not") {
                        var g = b[3];
                        for (var h = 0, i = g.length; h < i; h++) {
                            if (g[h] === a) {
                                return false;
                            }
                        }
                        return true;
                    } else {
                        m.error(e);
                    }
                },
                CHILD: function(a, b) {
                    var c, e, f, g, h, i, j, k = b[1], l = a;
                    switch (k) {
                      case "only":
                      case "first":
                        while (l = l.previousSibling) {
                            if (l.nodeType === 1) {
                                return false;
                            }
                        }
                        if (k === "first") {
                            return true;
                        }
                        l = a;

                      case "last":
                        while (l = l.nextSibling) {
                            if (l.nodeType === 1) {
                                return false;
                            }
                        }
                        return true;

                      case "nth":
                        c = b[2];
                        e = b[3];
                        if (c === 1 && e === 0) {
                            return true;
                        }
                        f = b[0];
                        g = a.parentNode;
                        if (g && (g[d] !== f || !a.nodeIndex)) {
                            i = 0;
                            for (l = g.firstChild; l; l = l.nextSibling) {
                                if (l.nodeType === 1) {
                                    l.nodeIndex = ++i;
                                }
                            }
                            g[d] = f;
                        }
                        j = a.nodeIndex - e;
                        if (c === 0) {
                            return j === 0;
                        } else {
                            return j % c === 0 && j / c >= 0;
                        }
                    }
                },
                ID: function(a, b) {
                    return a.nodeType === 1 && a.getAttribute("id") === b;
                },
                TAG: function(a, b) {
                    return b === "*" && a.nodeType === 1 || !!a.nodeName && a.nodeName.toLowerCase() === b;
                },
                CLASS: function(a, b) {
                    return (" " + (a.className || a.getAttribute("class")) + " ").indexOf(b) > -1;
                },
                ATTR: function(a, b) {
                    var c = b[1], d = m.attr ? m.attr(a, c) : o.attrHandle[c] ? o.attrHandle[c](a) : a[c] != null ? a[c] : a.getAttribute(c), e = d + "", f = b[2], g = b[4];
                    return d == null ? f === "!=" : !f && m.attr ? d != null : f === "=" ? e === g : f === "*=" ? e.indexOf(g) >= 0 : f === "~=" ? (" " + e + " ").indexOf(g) >= 0 : !g ? e && d !== false : f === "!=" ? e !== g : f === "^=" ? e.indexOf(g) === 0 : f === "$=" ? e.substr(e.length - g.length) === g : f === "|=" ? e === g || e.substr(0, g.length + 1) === g + "-" : false;
                },
                POS: function(a, b, c, d) {
                    var e = b[2], f = o.setFilters[e];
                    if (f) {
                        return f(a, c, b, d);
                    }
                }
            }
        };
        var p = o.match.POS, q = function(a, b) {
            return "\\" + (b - 0 + 1);
        };
        for (var r in o.match) {
            o.match[r] = new RegExp(o.match[r].source + /(?![^\[]*\])(?![^\(]*\))/.source);
            o.leftMatch[r] = new RegExp(/(^(?:.|\r|\n)*?)/.source + o.match[r].source.replace(/\\(\d+)/g, q));
        }
        o.match.globalPOS = p;
        var s = function(a, b) {
            a = Array.prototype.slice.call(a, 0);
            if (b) {
                b.push.apply(b, a);
                return b;
            }
            return a;
        };
        try {
            Array.prototype.slice.call(c.documentElement.childNodes, 0)[0].nodeType;
        } catch (a) {
            s = function(a, b) {
                var c = 0, d = b || [];
                if (g.call(a) === "[object Array]") {
                    Array.prototype.push.apply(d, a);
                } else {
                    if (typeof a.length === "number") {
                        for (var e = a.length; c < e; c++) {
                            d.push(a[c]);
                        }
                    } else {
                        for (;a[c]; c++) {
                            d.push(a[c]);
                        }
                    }
                }
                return d;
            };
        }
        var t, u;
        if (c.documentElement.compareDocumentPosition) {
            t = function(a, b) {
                if (a === b) {
                    h = true;
                    return 0;
                }
                if (!a.compareDocumentPosition || !b.compareDocumentPosition) {
                    return a.compareDocumentPosition ? -1 : 1;
                }
                return a.compareDocumentPosition(b) & 4 ? -1 : 1;
            };
        } else {
            t = function(a, b) {
                if (a === b) {
                    h = true;
                    return 0;
                } else if (a.sourceIndex && b.sourceIndex) {
                    return a.sourceIndex - b.sourceIndex;
                }
                var c, d, e = [], f = [], g = a.parentNode, i = b.parentNode, j = g;
                if (g === i) {
                    return u(a, b);
                } else if (!g) {
                    return -1;
                } else if (!i) {
                    return 1;
                }
                while (j) {
                    e.unshift(j);
                    j = j.parentNode;
                }
                j = i;
                while (j) {
                    f.unshift(j);
                    j = j.parentNode;
                }
                c = e.length;
                d = f.length;
                for (var k = 0; k < c && k < d; k++) {
                    if (e[k] !== f[k]) {
                        return u(e[k], f[k]);
                    }
                }
                return k === c ? u(a, f[k], -1) : u(e[k], b, 1);
            };
            u = function(a, b, c) {
                if (a === b) {
                    return c;
                }
                var d = a.nextSibling;
                while (d) {
                    if (d === b) {
                        return -1;
                    }
                    d = d.nextSibling;
                }
                return 1;
            };
        }
        (function() {
            var a = c.createElement("div"), d = "script" + new Date().getTime(), e = c.documentElement;
            a.innerHTML = "<a name='" + d + "'/>";
            e.insertBefore(a, e.firstChild);
            if (c.getElementById(d)) {
                o.find.ID = function(a, c, d) {
                    if (typeof c.getElementById !== "undefined" && !d) {
                        var e = c.getElementById(a[1]);
                        return e ? e.id === a[1] || typeof e.getAttributeNode !== "undefined" && e.getAttributeNode("id").nodeValue === a[1] ? [ e ] : b : [];
                    }
                };
                o.filter.ID = function(a, b) {
                    var c = typeof a.getAttributeNode !== "undefined" && a.getAttributeNode("id");
                    return a.nodeType === 1 && c && c.nodeValue === b;
                };
            }
            e.removeChild(a);
            e = a = null;
        })();
        (function() {
            var a = c.createElement("div");
            a.appendChild(c.createComment(""));
            if (a.getElementsByTagName("*").length > 0) {
                o.find.TAG = function(a, b) {
                    var c = b.getElementsByTagName(a[1]);
                    if (a[1] === "*") {
                        var d = [];
                        for (var e = 0; c[e]; e++) {
                            if (c[e].nodeType === 1) {
                                d.push(c[e]);
                            }
                        }
                        c = d;
                    }
                    return c;
                };
            }
            a.innerHTML = "<a href='#'></a>";
            if (a.firstChild && typeof a.firstChild.getAttribute !== "undefined" && a.firstChild.getAttribute("href") !== "#") {
                o.attrHandle.href = function(a) {
                    return a.getAttribute("href", 2);
                };
            }
            a = null;
        })();
        if (c.querySelectorAll) {
            (function() {
                var a = m, b = c.createElement("div"), d = "__sizzle__";
                b.innerHTML = "<p class='TEST'></p>";
                if (b.querySelectorAll && b.querySelectorAll(".TEST").length === 0) {
                    return;
                }
                m = function(b, e, f, g) {
                    e = e || c;
                    if (!g && !m.isXML(e)) {
                        var h = /^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);
                        if (h && (e.nodeType === 1 || e.nodeType === 9)) {
                            if (h[1]) {
                                return s(e.getElementsByTagName(b), f);
                            } else if (h[2] && o.find.CLASS && e.getElementsByClassName) {
                                return s(e.getElementsByClassName(h[2]), f);
                            }
                        }
                        if (e.nodeType === 9) {
                            if (b === "body" && e.body) {
                                return s([ e.body ], f);
                            } else if (h && h[3]) {
                                var i = e.getElementById(h[3]);
                                if (i && i.parentNode) {
                                    if (i.id === h[3]) {
                                        return s([ i ], f);
                                    }
                                } else {
                                    return s([], f);
                                }
                            }
                            try {
                                return s(e.querySelectorAll(b), f);
                            } catch (a) {}
                        } else if (e.nodeType === 1 && e.nodeName.toLowerCase() !== "object") {
                            var j = e, k = e.getAttribute("id"), l = k || d, n = e.parentNode, p = /^\s*[+~]/.test(b);
                            if (!k) {
                                e.setAttribute("id", l);
                            } else {
                                l = l.replace(/'/g, "\\$&");
                            }
                            if (p && n) {
                                e = e.parentNode;
                            }
                            try {
                                if (!p || n) {
                                    return s(e.querySelectorAll("[id='" + l + "'] " + b), f);
                                }
                            } catch (a) {} finally {
                                if (!k) {
                                    j.removeAttribute("id");
                                }
                            }
                        }
                    }
                    return a(b, e, f, g);
                };
                for (var e in a) {
                    m[e] = a[e];
                }
                b = null;
            })();
        }
        (function() {
            var a = c.documentElement, b = a.matchesSelector || a.mozMatchesSelector || a.webkitMatchesSelector || a.msMatchesSelector;
            if (b) {
                var d = !b.call(c.createElement("div"), "div"), e = false;
                try {
                    b.call(c.documentElement, "[test!='']:sizzle");
                } catch (a) {
                    e = true;
                }
                m.matchesSelector = function(a, c) {
                    c = c.replace(/\=\s*([^'"\]]*)\s*\]/g, "='$1']");
                    if (!m.isXML(a)) {
                        try {
                            if (e || !o.match.PSEUDO.test(c) && !/!=/.test(c)) {
                                var f = b.call(a, c);
                                if (f || !d || a.document && a.document.nodeType !== 11) {
                                    return f;
                                }
                            }
                        } catch (a) {}
                    }
                    return m(c, null, null, [ a ]).length > 0;
                };
            }
        })();
        (function() {
            var a = c.createElement("div");
            a.innerHTML = "<div class='test e'></div><div class='test'></div>";
            if (!a.getElementsByClassName || a.getElementsByClassName("e").length === 0) {
                return;
            }
            a.lastChild.className = "e";
            if (a.getElementsByClassName("e").length === 1) {
                return;
            }
            o.order.splice(1, 0, "CLASS");
            o.find.CLASS = function(a, b, c) {
                if (typeof b.getElementsByClassName !== "undefined" && !c) {
                    return b.getElementsByClassName(a[1]);
                }
            };
            a = null;
        })();
        function v(a, b, c, e, f, g) {
            for (var h = 0, i = e.length; h < i; h++) {
                var j = e[h];
                if (j) {
                    var k = false;
                    j = j[a];
                    while (j) {
                        if (j[d] === c) {
                            k = e[j.sizset];
                            break;
                        }
                        if (j.nodeType === 1 && !g) {
                            j[d] = c;
                            j.sizset = h;
                        }
                        if (j.nodeName.toLowerCase() === b) {
                            k = j;
                            break;
                        }
                        j = j[a];
                    }
                    e[h] = k;
                }
            }
        }
        function w(a, b, c, e, f, g) {
            for (var h = 0, i = e.length; h < i; h++) {
                var j = e[h];
                if (j) {
                    var k = false;
                    j = j[a];
                    while (j) {
                        if (j[d] === c) {
                            k = e[j.sizset];
                            break;
                        }
                        if (j.nodeType === 1) {
                            if (!g) {
                                j[d] = c;
                                j.sizset = h;
                            }
                            if (typeof b !== "string") {
                                if (j === b) {
                                    k = true;
                                    break;
                                }
                            } else if (m.filter(b, [ j ]).length > 0) {
                                k = j;
                                break;
                            }
                        }
                        j = j[a];
                    }
                    e[h] = k;
                }
            }
        }
        if (c.documentElement.contains) {
            m.contains = function(a, b) {
                return a !== b && (a.contains ? a.contains(b) : true);
            };
        } else if (c.documentElement.compareDocumentPosition) {
            m.contains = function(a, b) {
                return !!(a.compareDocumentPosition(b) & 16);
            };
        } else {
            m.contains = function() {
                return false;
            };
        }
        m.isXML = function(a) {
            var b = (a ? a.ownerDocument || a : 0).documentElement;
            return b ? b.nodeName !== "HTML" : false;
        };
        var x = function(a, b, c) {
            var d, e = [], f = "", g = b.nodeType ? [ b ] : b;
            while (d = o.match.PSEUDO.exec(a)) {
                f += d[0];
                a = a.replace(o.match.PSEUDO, "");
            }
            a = o.relative[a] ? a + "*" : a;
            for (var h = 0, i = g.length; h < i; h++) {
                m(a, g[h], e, c);
            }
            return m.filter(f, e);
        };
        m.attr = f.attr;
        m.selectors.attrMap = {};
        f.find = m;
        f.expr = m.selectors;
        f.expr[":"] = f.expr.filters;
        f.unique = m.uniqueSort;
        f.text = m.getText;
        f.isXMLDoc = m.isXML;
        f.contains = m.contains;
    })();
    var L = /Until$/, M = /^(?:parents|prevUntil|prevAll)/, N = /,/, O = /^.[^:#\[\.,]*$/, P = Array.prototype.slice, Q = f.expr.match.globalPOS, R = {
        children: true,
        contents: true,
        next: true,
        prev: true
    };
    f.fn.extend({
        find: function(a) {
            var b = this, c, d;
            if (typeof a !== "string") {
                return f(a).filter(function() {
                    for (c = 0, d = b.length; c < d; c++) {
                        if (f.contains(b[c], this)) {
                            return true;
                        }
                    }
                });
            }
            var e = this.pushStack("", "find", a), g, h, i;
            for (c = 0, d = this.length; c < d; c++) {
                g = e.length;
                f.find(a, this[c], e);
                if (c > 0) {
                    for (h = g; h < e.length; h++) {
                        for (i = 0; i < g; i++) {
                            if (e[i] === e[h]) {
                                e.splice(h--, 1);
                                break;
                            }
                        }
                    }
                }
            }
            return e;
        },
        has: function(a) {
            var b = f(a);
            return this.filter(function() {
                for (var a = 0, c = b.length; a < c; a++) {
                    if (f.contains(this, b[a])) {
                        return true;
                    }
                }
            });
        },
        not: function(a) {
            return this.pushStack(T(this, a, false), "not", a);
        },
        filter: function(a) {
            return this.pushStack(T(this, a, true), "filter", a);
        },
        is: function(a) {
            return !!a && (typeof a === "string" ? Q.test(a) ? f(a, this.context).index(this[0]) >= 0 : f.filter(a, this).length > 0 : this.filter(a).length > 0);
        },
        closest: function(a, b) {
            var c = [], d, e, g = this[0];
            if (f.isArray(a)) {
                var h = 1;
                while (g && g.ownerDocument && g !== b) {
                    for (d = 0; d < a.length; d++) {
                        if (f(g).is(a[d])) {
                            c.push({
                                selector: a[d],
                                elem: g,
                                level: h
                            });
                        }
                    }
                    g = g.parentNode;
                    h++;
                }
                return c;
            }
            var i = Q.test(a) || typeof a !== "string" ? f(a, b || this.context) : 0;
            for (d = 0, e = this.length; d < e; d++) {
                g = this[d];
                while (g) {
                    if (i ? i.index(g) > -1 : f.find.matchesSelector(g, a)) {
                        c.push(g);
                        break;
                    } else {
                        g = g.parentNode;
                        if (!g || !g.ownerDocument || g === b || g.nodeType === 11) {
                            break;
                        }
                    }
                }
            }
            c = c.length > 1 ? f.unique(c) : c;
            return this.pushStack(c, "closest", a);
        },
        index: function(a) {
            if (!a) {
                return this[0] && this[0].parentNode ? this.prevAll().length : -1;
            }
            if (typeof a === "string") {
                return f.inArray(this[0], f(a));
            }
            return f.inArray(a.jquery ? a[0] : a, this);
        },
        add: function(a, b) {
            var c = typeof a === "string" ? f(a, b) : f.makeArray(a && a.nodeType ? [ a ] : a), d = f.merge(this.get(), c);
            return this.pushStack(S(c[0]) || S(d[0]) ? d : f.unique(d));
        },
        andSelf: function() {
            return this.add(this.prevObject);
        }
    });
    function S(a) {
        return !a || !a.parentNode || a.parentNode.nodeType === 11;
    }
    f.each({
        parent: function(a) {
            var b = a.parentNode;
            return b && b.nodeType !== 11 ? b : null;
        },
        parents: function(a) {
            return f.dir(a, "parentNode");
        },
        parentsUntil: function(a, b, c) {
            return f.dir(a, "parentNode", c);
        },
        next: function(a) {
            return f.nth(a, 2, "nextSibling");
        },
        prev: function(a) {
            return f.nth(a, 2, "previousSibling");
        },
        nextAll: function(a) {
            return f.dir(a, "nextSibling");
        },
        prevAll: function(a) {
            return f.dir(a, "previousSibling");
        },
        nextUntil: function(a, b, c) {
            return f.dir(a, "nextSibling", c);
        },
        prevUntil: function(a, b, c) {
            return f.dir(a, "previousSibling", c);
        },
        siblings: function(a) {
            return f.sibling((a.parentNode || {}).firstChild, a);
        },
        children: function(a) {
            return f.sibling(a.firstChild);
        },
        contents: function(a) {
            return f.nodeName(a, "iframe") ? a.contentDocument || a.contentWindow.document : f.makeArray(a.childNodes);
        }
    }, function(a, b) {
        f.fn[a] = function(c, d) {
            var e = f.map(this, b, c);
            if (!L.test(a)) {
                d = c;
            }
            if (d && typeof d === "string") {
                e = f.filter(d, e);
            }
            e = this.length > 1 && !R[a] ? f.unique(e) : e;
            if ((this.length > 1 || N.test(d)) && M.test(a)) {
                e = e.reverse();
            }
            return this.pushStack(e, a, P.call(arguments).join(","));
        };
    });
    f.extend({
        filter: function(a, b, c) {
            if (c) {
                a = ":not(" + a + ")";
            }
            return b.length === 1 ? f.find.matchesSelector(b[0], a) ? [ b[0] ] : [] : f.find.matches(a, b);
        },
        dir: function(a, c, d) {
            var e = [], g = a[c];
            while (g && g.nodeType !== 9 && (d === b || g.nodeType !== 1 || !f(g).is(d))) {
                if (g.nodeType === 1) {
                    e.push(g);
                }
                g = g[c];
            }
            return e;
        },
        nth: function(a, b, c, d) {
            b = b || 1;
            var e = 0;
            for (;a; a = a[c]) {
                if (a.nodeType === 1 && ++e === b) {
                    break;
                }
            }
            return a;
        },
        sibling: function(a, b) {
            var c = [];
            for (;a; a = a.nextSibling) {
                if (a.nodeType === 1 && a !== b) {
                    c.push(a);
                }
            }
            return c;
        }
    });
    function T(a, b, c) {
        b = b || 0;
        if (f.isFunction(b)) {
            return f.grep(a, function(a, d) {
                var e = !!b.call(a, d, a);
                return e === c;
            });
        } else if (b.nodeType) {
            return f.grep(a, function(a, d) {
                return a === b === c;
            });
        } else if (typeof b === "string") {
            var d = f.grep(a, function(a) {
                return a.nodeType === 1;
            });
            if (O.test(b)) {
                return f.filter(b, d, !c);
            } else {
                b = f.filter(b, d);
            }
        }
        return f.grep(a, function(a, d) {
            return f.inArray(a, b) >= 0 === c;
        });
    }
    function U(a) {
        var b = V.split("|"), c = a.createDocumentFragment();
        if (c.createElement) {
            while (b.length) {
                c.createElement(b.pop());
            }
        }
        return c;
    }
    var V = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|" + "header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", W = / jQuery\d+="(?:\d+|null)"/g, X = /^\s+/, Y = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, Z = /<([\w:]+)/, $ = /<tbody/i, _ = /<|&#?\w+;/, aa = /<(?:script|style)/i, ba = /<(?:script|object|embed|option|style)/i, ca = new RegExp("<(?:" + V + ")[\\s/>]", "i"), da = /checked\s*(?:[^=]|=\s*.checked.)/i, ea = /\/(java|ecma)script/i, fa = /^\s*<!(?:\[CDATA\[|\-\-)/, ga = {
        option: [ 1, "<select multiple='multiple'>", "</select>" ],
        legend: [ 1, "<fieldset>", "</fieldset>" ],
        thead: [ 1, "<table>", "</table>" ],
        tr: [ 2, "<table><tbody>", "</tbody></table>" ],
        td: [ 3, "<table><tbody><tr>", "</tr></tbody></table>" ],
        col: [ 2, "<table><tbody></tbody><colgroup>", "</colgroup></table>" ],
        area: [ 1, "<map>", "</map>" ],
        _default: [ 0, "", "" ]
    }, ha = U(c);
    ga.optgroup = ga.option;
    ga.tbody = ga.tfoot = ga.colgroup = ga.caption = ga.thead;
    ga.th = ga.td;
    if (!f.support.htmlSerialize) {
        ga._default = [ 1, "div<div>", "</div>" ];
    }
    f.fn.extend({
        text: function(a) {
            return f.access(this, function(a) {
                return a === b ? f.text(this) : this.empty().append((this[0] && this[0].ownerDocument || c).createTextNode(a));
            }, null, a, arguments.length);
        },
        wrapAll: function(a) {
            if (f.isFunction(a)) {
                return this.each(function(b) {
                    f(this).wrapAll(a.call(this, b));
                });
            }
            if (this[0]) {
                var b = f(a, this[0].ownerDocument).eq(0).clone(true);
                if (this[0].parentNode) {
                    b.insertBefore(this[0]);
                }
                b.map(function() {
                    var a = this;
                    while (a.firstChild && a.firstChild.nodeType === 1) {
                        a = a.firstChild;
                    }
                    return a;
                }).append(this);
            }
            return this;
        },
        wrapInner: function(a) {
            if (f.isFunction(a)) {
                return this.each(function(b) {
                    f(this).wrapInner(a.call(this, b));
                });
            }
            return this.each(function() {
                var b = f(this), c = b.contents();
                if (c.length) {
                    c.wrapAll(a);
                } else {
                    b.append(a);
                }
            });
        },
        wrap: function(a) {
            var b = f.isFunction(a);
            return this.each(function(c) {
                f(this).wrapAll(b ? a.call(this, c) : a);
            });
        },
        unwrap: function() {
            return this.parent().each(function() {
                if (!f.nodeName(this, "body")) {
                    f(this).replaceWith(this.childNodes);
                }
            }).end();
        },
        append: function() {
            return this.domManip(arguments, true, function(a) {
                if (this.nodeType === 1) {
                    this.appendChild(a);
                }
            });
        },
        prepend: function() {
            return this.domManip(arguments, true, function(a) {
                if (this.nodeType === 1) {
                    this.insertBefore(a, this.firstChild);
                }
            });
        },
        before: function() {
            if (this[0] && this[0].parentNode) {
                return this.domManip(arguments, false, function(a) {
                    this.parentNode.insertBefore(a, this);
                });
            } else if (arguments.length) {
                var a = f.clean(arguments);
                a.push.apply(a, this.toArray());
                return this.pushStack(a, "before", arguments);
            }
        },
        after: function() {
            if (this[0] && this[0].parentNode) {
                return this.domManip(arguments, false, function(a) {
                    this.parentNode.insertBefore(a, this.nextSibling);
                });
            } else if (arguments.length) {
                var a = this.pushStack(this, "after", arguments);
                a.push.apply(a, f.clean(arguments));
                return a;
            }
        },
        remove: function(a, b) {
            for (var c = 0, d; (d = this[c]) != null; c++) {
                if (!a || f.filter(a, [ d ]).length) {
                    if (!b && d.nodeType === 1) {
                        f.cleanData(d.getElementsByTagName("*"));
                        f.cleanData([ d ]);
                    }
                    if (d.parentNode) {
                        d.parentNode.removeChild(d);
                    }
                }
            }
            return this;
        },
        empty: function() {
            for (var a = 0, b; (b = this[a]) != null; a++) {
                if (b.nodeType === 1) {
                    f.cleanData(b.getElementsByTagName("*"));
                }
                while (b.firstChild) {
                    b.removeChild(b.firstChild);
                }
            }
            return this;
        },
        clone: function(a, b) {
            a = a == null ? false : a;
            b = b == null ? a : b;
            return this.map(function() {
                return f.clone(this, a, b);
            });
        },
        html: function(a) {
            return f.access(this, function(a) {
                var c = this[0] || {}, d = 0, e = this.length;
                if (a === b) {
                    return c.nodeType === 1 ? c.innerHTML.replace(W, "") : null;
                }
                if (typeof a === "string" && !aa.test(a) && (f.support.leadingWhitespace || !X.test(a)) && !ga[(Z.exec(a) || [ "", "" ])[1].toLowerCase()]) {
                    a = a.replace(Y, "<$1></$2>");
                    try {
                        for (;d < e; d++) {
                            c = this[d] || {};
                            if (c.nodeType === 1) {
                                f.cleanData(c.getElementsByTagName("*"));
                                c.innerHTML = a;
                            }
                        }
                        c = 0;
                    } catch (a) {}
                }
                if (c) {
                    this.empty().append(a);
                }
            }, null, a, arguments.length);
        },
        replaceWith: function(a) {
            if (this[0] && this[0].parentNode) {
                if (f.isFunction(a)) {
                    return this.each(function(b) {
                        var c = f(this), d = c.html();
                        c.replaceWith(a.call(this, b, d));
                    });
                }
                if (typeof a !== "string") {
                    a = f(a).detach();
                }
                return this.each(function() {
                    var b = this.nextSibling, c = this.parentNode;
                    f(this).remove();
                    if (b) {
                        f(b).before(a);
                    } else {
                        f(c).append(a);
                    }
                });
            } else {
                return this.length ? this.pushStack(f(f.isFunction(a) ? a() : a), "replaceWith", a) : this;
            }
        },
        detach: function(a) {
            return this.remove(a, true);
        },
        domManip: function(a, c, d) {
            var e, g, h, i, j = a[0], k = [];
            if (!f.support.checkClone && arguments.length === 3 && typeof j === "string" && da.test(j)) {
                return this.each(function() {
                    f(this).domManip(a, c, d, true);
                });
            }
            if (f.isFunction(j)) {
                return this.each(function(e) {
                    var g = f(this);
                    a[0] = j.call(this, e, c ? g.html() : b);
                    g.domManip(a, c, d);
                });
            }
            if (this[0]) {
                i = j && j.parentNode;
                if (f.support.parentNode && i && i.nodeType === 11 && i.childNodes.length === this.length) {
                    e = {
                        fragment: i
                    };
                } else {
                    e = f.buildFragment(a, this, k);
                }
                h = e.fragment;
                if (h.childNodes.length === 1) {
                    g = h = h.firstChild;
                } else {
                    g = h.firstChild;
                }
                if (g) {
                    c = c && f.nodeName(g, "tr");
                    for (var l = 0, m = this.length, n = m - 1; l < m; l++) {
                        d.call(c ? ia(this[l], g) : this[l], e.cacheable || m > 1 && l < n ? f.clone(h, true, true) : h);
                    }
                }
                if (k.length) {
                    f.each(k, function(a, b) {
                        if (b.src) {
                            f.ajax({
                                type: "GET",
                                global: false,
                                url: b.src,
                                async: false,
                                dataType: "script"
                            });
                        } else {
                            f.globalEval((b.text || b.textContent || b.innerHTML || "").replace(fa, "/*$0*/"));
                        }
                        if (b.parentNode) {
                            b.parentNode.removeChild(b);
                        }
                    });
                }
            }
            return this;
        }
    });
    function ia(a, b) {
        return f.nodeName(a, "table") ? a.getElementsByTagName("tbody")[0] || a.appendChild(a.ownerDocument.createElement("tbody")) : a;
    }
    function ja(a, b) {
        if (b.nodeType !== 1 || !f.hasData(a)) {
            return;
        }
        var c, d, e, g = f._data(a), h = f._data(b, g), i = g.events;
        if (i) {
            delete h.handle;
            h.events = {};
            for (c in i) {
                for (d = 0, e = i[c].length; d < e; d++) {
                    f.event.add(b, c, i[c][d]);
                }
            }
        }
        if (h.data) {
            h.data = f.extend({}, h.data);
        }
    }
    function ka(a, b) {
        var c;
        if (b.nodeType !== 1) {
            return;
        }
        if (b.clearAttributes) {
            b.clearAttributes();
        }
        if (b.mergeAttributes) {
            b.mergeAttributes(a);
        }
        c = b.nodeName.toLowerCase();
        if (c === "object") {
            b.outerHTML = a.outerHTML;
        } else if (c === "input" && (a.type === "checkbox" || a.type === "radio")) {
            if (a.checked) {
                b.defaultChecked = b.checked = a.checked;
            }
            if (b.value !== a.value) {
                b.value = a.value;
            }
        } else if (c === "option") {
            b.selected = a.defaultSelected;
        } else if (c === "input" || c === "textarea") {
            b.defaultValue = a.defaultValue;
        } else if (c === "script" && b.text !== a.text) {
            b.text = a.text;
        }
        b.removeAttribute(f.expando);
        b.removeAttribute("_submit_attached");
        b.removeAttribute("_change_attached");
    }
    f.buildFragment = function(a, b, d) {
        var e, g, h, i, j = a[0];
        if (b && b[0]) {
            i = b[0].ownerDocument || b[0];
        }
        if (!i.createDocumentFragment) {
            i = c;
        }
        if (a.length === 1 && typeof j === "string" && j.length < 512 && i === c && j.charAt(0) === "<" && !ba.test(j) && (f.support.checkClone || !da.test(j)) && (f.support.html5Clone || !ca.test(j))) {
            g = true;
            h = f.fragments[j];
            if (h && h !== 1) {
                e = h;
            }
        }
        if (!e) {
            e = i.createDocumentFragment();
            f.clean(a, i, e, d);
        }
        if (g) {
            f.fragments[j] = h ? e : 1;
        }
        return {
            fragment: e,
            cacheable: g
        };
    };
    f.fragments = {};
    f.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function(a, b) {
        f.fn[a] = function(c) {
            var d = [], e = f(c), g = this.length === 1 && this[0].parentNode;
            if (g && g.nodeType === 11 && g.childNodes.length === 1 && e.length === 1) {
                e[b](this[0]);
                return this;
            } else {
                for (var h = 0, i = e.length; h < i; h++) {
                    var j = (h > 0 ? this.clone(true) : this).get();
                    f(e[h])[b](j);
                    d = d.concat(j);
                }
                return this.pushStack(d, a, e.selector);
            }
        };
    });
    function la(a) {
        if (typeof a.getElementsByTagName !== "undefined") {
            return a.getElementsByTagName("*");
        } else if (typeof a.querySelectorAll !== "undefined") {
            return a.querySelectorAll("*");
        } else {
            return [];
        }
    }
    function ma(a) {
        if (a.type === "checkbox" || a.type === "radio") {
            a.defaultChecked = a.checked;
        }
    }
    function na(a) {
        var b = (a.nodeName || "").toLowerCase();
        if (b === "input") {
            ma(a);
        } else if (b !== "script" && typeof a.getElementsByTagName !== "undefined") {
            f.grep(a.getElementsByTagName("input"), ma);
        }
    }
    function oa(a) {
        var b = c.createElement("div");
        ha.appendChild(b);
        b.innerHTML = a.outerHTML;
        return b.firstChild;
    }
    f.extend({
        clone: function(a, b, c) {
            var d, e, g, h = f.support.html5Clone || f.isXMLDoc(a) || !ca.test("<" + a.nodeName + ">") ? a.cloneNode(true) : oa(a);
            if ((!f.support.noCloneEvent || !f.support.noCloneChecked) && (a.nodeType === 1 || a.nodeType === 11) && !f.isXMLDoc(a)) {
                ka(a, h);
                d = la(a);
                e = la(h);
                for (g = 0; d[g]; ++g) {
                    if (e[g]) {
                        ka(d[g], e[g]);
                    }
                }
            }
            if (b) {
                ja(a, h);
                if (c) {
                    d = la(a);
                    e = la(h);
                    for (g = 0; d[g]; ++g) {
                        ja(d[g], e[g]);
                    }
                }
            }
            d = e = null;
            return h;
        },
        clean: function(a, b, d, e) {
            var g, h, i, j = [];
            b = b || c;
            if (typeof b.createElement === "undefined") {
                b = b.ownerDocument || b[0] && b[0].ownerDocument || c;
            }
            for (var k = 0, l; (l = a[k]) != null; k++) {
                if (typeof l === "number") {
                    l += "";
                }
                if (!l) {
                    continue;
                }
                if (typeof l === "string") {
                    if (!_.test(l)) {
                        l = b.createTextNode(l);
                    } else {
                        l = l.replace(Y, "<$1></$2>");
                        var m = (Z.exec(l) || [ "", "" ])[1].toLowerCase(), n = ga[m] || ga._default, o = n[0], p = b.createElement("div"), q = ha.childNodes, r;
                        if (b === c) {
                            ha.appendChild(p);
                        } else {
                            U(b).appendChild(p);
                        }
                        p.innerHTML = n[1] + l + n[2];
                        while (o--) {
                            p = p.lastChild;
                        }
                        if (!f.support.tbody) {
                            var s = $.test(l), t = m === "table" && !s ? p.firstChild && p.firstChild.childNodes : n[1] === "<table>" && !s ? p.childNodes : [];
                            for (i = t.length - 1; i >= 0; --i) {
                                if (f.nodeName(t[i], "tbody") && !t[i].childNodes.length) {
                                    t[i].parentNode.removeChild(t[i]);
                                }
                            }
                        }
                        if (!f.support.leadingWhitespace && X.test(l)) {
                            p.insertBefore(b.createTextNode(X.exec(l)[0]), p.firstChild);
                        }
                        l = p.childNodes;
                        if (p) {
                            p.parentNode.removeChild(p);
                            if (q.length > 0) {
                                r = q[q.length - 1];
                                if (r && r.parentNode) {
                                    r.parentNode.removeChild(r);
                                }
                            }
                        }
                    }
                }
                var u;
                if (!f.support.appendChecked) {
                    if (l[0] && typeof (u = l.length) === "number") {
                        for (i = 0; i < u; i++) {
                            na(l[i]);
                        }
                    } else {
                        na(l);
                    }
                }
                if (l.nodeType) {
                    j.push(l);
                } else {
                    j = f.merge(j, l);
                }
            }
            if (d) {
                g = function(a) {
                    return !a.type || ea.test(a.type);
                };
                for (k = 0; j[k]; k++) {
                    h = j[k];
                    if (e && f.nodeName(h, "script") && (!h.type || ea.test(h.type))) {
                        e.push(h.parentNode ? h.parentNode.removeChild(h) : h);
                    } else {
                        if (h.nodeType === 1) {
                            var v = f.grep(h.getElementsByTagName("script"), g);
                            j.splice.apply(j, [ k + 1, 0 ].concat(v));
                        }
                        d.appendChild(h);
                    }
                }
            }
            return j;
        },
        cleanData: function(a) {
            var b, c, d = f.cache, e = f.event.special, g = f.support.deleteExpando;
            for (var h = 0, i; (i = a[h]) != null; h++) {
                if (i.nodeName && f.noData[i.nodeName.toLowerCase()]) {
                    continue;
                }
                c = i[f.expando];
                if (c) {
                    b = d[c];
                    if (b && b.events) {
                        for (var j in b.events) {
                            if (e[j]) {
                                f.event.remove(i, j);
                            } else {
                                f.removeEvent(i, j, b.handle);
                            }
                        }
                        if (b.handle) {
                            b.handle.elem = null;
                        }
                    }
                    if (g) {
                        delete i[f.expando];
                    } else if (i.removeAttribute) {
                        i.removeAttribute(f.expando);
                    }
                    delete d[c];
                }
            }
        }
    });
    var pa = /alpha\([^)]*\)/i, qa = /opacity=([^)]*)/, ra = /([A-Z]|^ms)/g, sa = /^[\-+]?(?:\d*\.)?\d+$/i, ta = /^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i, ua = /^([\-+])=([\-+.\de]+)/, va = /^margin/, wa = {
        position: "absolute",
        visibility: "hidden",
        display: "block"
    }, xa = [ "Top", "Right", "Bottom", "Left" ], ya, za, Aa;
    f.fn.css = function(a, c) {
        return f.access(this, function(a, c, d) {
            return d !== b ? f.style(a, c, d) : f.css(a, c);
        }, a, c, arguments.length > 1);
    };
    f.extend({
        cssHooks: {
            opacity: {
                get: function(a, b) {
                    if (b) {
                        var c = ya(a, "opacity");
                        return c === "" ? "1" : c;
                    } else {
                        return a.style.opacity;
                    }
                }
            }
        },
        cssNumber: {
            fillOpacity: true,
            fontWeight: true,
            lineHeight: true,
            opacity: true,
            orphans: true,
            widows: true,
            zIndex: true,
            zoom: true
        },
        cssProps: {
            float: f.support.cssFloat ? "cssFloat" : "styleFloat"
        },
        style: function(a, c, d, e) {
            if (!a || a.nodeType === 3 || a.nodeType === 8 || !a.style) {
                return;
            }
            var g, h, i = f.camelCase(c), j = a.style, k = f.cssHooks[i];
            c = f.cssProps[i] || i;
            if (d !== b) {
                h = typeof d;
                if (h === "string" && (g = ua.exec(d))) {
                    d = +(g[1] + 1) * +g[2] + parseFloat(f.css(a, c));
                    h = "number";
                }
                if (d == null || h === "number" && isNaN(d)) {
                    return;
                }
                if (h === "number" && !f.cssNumber[i]) {
                    d += "px";
                }
                if (!k || !("set" in k) || (d = k.set(a, d)) !== b) {
                    try {
                        j[c] = d;
                    } catch (a) {}
                }
            } else {
                if (k && "get" in k && (g = k.get(a, false, e)) !== b) {
                    return g;
                }
                return j[c];
            }
        },
        css: function(a, c, d) {
            var e, g;
            c = f.camelCase(c);
            g = f.cssHooks[c];
            c = f.cssProps[c] || c;
            if (c === "cssFloat") {
                c = "float";
            }
            if (g && "get" in g && (e = g.get(a, true, d)) !== b) {
                return e;
            } else if (ya) {
                return ya(a, c);
            }
        },
        swap: function(a, b, c) {
            var d = {}, e, f;
            for (f in b) {
                d[f] = a.style[f];
                a.style[f] = b[f];
            }
            e = c.call(a);
            for (f in b) {
                a.style[f] = d[f];
            }
            return e;
        }
    });
    f.curCSS = f.css;
    if (c.defaultView && c.defaultView.getComputedStyle) {
        za = function(a, b) {
            var c, d, e, g, h = a.style;
            b = b.replace(ra, "-$1").toLowerCase();
            if ((d = a.ownerDocument.defaultView) && (e = d.getComputedStyle(a, null))) {
                c = e.getPropertyValue(b);
                if (c === "" && !f.contains(a.ownerDocument.documentElement, a)) {
                    c = f.style(a, b);
                }
            }
            if (!f.support.pixelMargin && e && va.test(b) && ta.test(c)) {
                g = h.width;
                h.width = c;
                c = e.width;
                h.width = g;
            }
            return c;
        };
    }
    if (c.documentElement.currentStyle) {
        Aa = function(a, b) {
            var c, d, e, f = a.currentStyle && a.currentStyle[b], g = a.style;
            if (f == null && g && (e = g[b])) {
                f = e;
            }
            if (ta.test(f)) {
                c = g.left;
                d = a.runtimeStyle && a.runtimeStyle.left;
                if (d) {
                    a.runtimeStyle.left = a.currentStyle.left;
                }
                g.left = b === "fontSize" ? "1em" : f;
                f = g.pixelLeft + "px";
                g.left = c;
                if (d) {
                    a.runtimeStyle.left = d;
                }
            }
            return f === "" ? "auto" : f;
        };
    }
    ya = za || Aa;
    function Ba(a, b, c) {
        var d = b === "width" ? a.offsetWidth : a.offsetHeight, e = b === "width" ? 1 : 0, g = 4;
        if (d > 0) {
            if (c !== "border") {
                for (;e < g; e += 2) {
                    if (!c) {
                        d -= parseFloat(f.css(a, "padding" + xa[e])) || 0;
                    }
                    if (c === "margin") {
                        d += parseFloat(f.css(a, c + xa[e])) || 0;
                    } else {
                        d -= parseFloat(f.css(a, "border" + xa[e] + "Width")) || 0;
                    }
                }
            }
            return d + "px";
        }
        d = ya(a, b);
        if (d < 0 || d == null) {
            d = a.style[b];
        }
        if (ta.test(d)) {
            return d;
        }
        d = parseFloat(d) || 0;
        if (c) {
            for (;e < g; e += 2) {
                d += parseFloat(f.css(a, "padding" + xa[e])) || 0;
                if (c !== "padding") {
                    d += parseFloat(f.css(a, "border" + xa[e] + "Width")) || 0;
                }
                if (c === "margin") {
                    d += parseFloat(f.css(a, c + xa[e])) || 0;
                }
            }
        }
        return d + "px";
    }
    f.each([ "height", "width" ], function(a, b) {
        f.cssHooks[b] = {
            get: function(a, c, d) {
                if (c) {
                    if (a.offsetWidth !== 0) {
                        return Ba(a, b, d);
                    } else {
                        return f.swap(a, wa, function() {
                            return Ba(a, b, d);
                        });
                    }
                }
            },
            set: function(a, b) {
                return sa.test(b) ? b + "px" : b;
            }
        };
    });
    if (!f.support.opacity) {
        f.cssHooks.opacity = {
            get: function(a, b) {
                return qa.test((b && a.currentStyle ? a.currentStyle.filter : a.style.filter) || "") ? parseFloat(RegExp.$1) / 100 + "" : b ? "1" : "";
            },
            set: function(a, b) {
                var c = a.style, d = a.currentStyle, e = f.isNumeric(b) ? "alpha(opacity=" + b * 100 + ")" : "", g = d && d.filter || c.filter || "";
                c.zoom = 1;
                if (b >= 1 && f.trim(g.replace(pa, "")) === "") {
                    c.removeAttribute("filter");
                    if (d && !d.filter) {
                        return;
                    }
                }
                c.filter = pa.test(g) ? g.replace(pa, e) : g + " " + e;
            }
        };
    }
    f(function() {
        if (!f.support.reliableMarginRight) {
            f.cssHooks.marginRight = {
                get: function(a, b) {
                    return f.swap(a, {
                        display: "inline-block"
                    }, function() {
                        if (b) {
                            return ya(a, "margin-right");
                        } else {
                            return a.style.marginRight;
                        }
                    });
                }
            };
        }
    });
    if (f.expr && f.expr.filters) {
        f.expr.filters.hidden = function(a) {
            var b = a.offsetWidth, c = a.offsetHeight;
            return b === 0 && c === 0 || !f.support.reliableHiddenOffsets && (a.style && a.style.display || f.css(a, "display")) === "none";
        };
        f.expr.filters.visible = function(a) {
            return !f.expr.filters.hidden(a);
        };
    }
    f.each({
        margin: "",
        padding: "",
        border: "Width"
    }, function(a, b) {
        f.cssHooks[a + b] = {
            expand: function(c) {
                var d, e = typeof c === "string" ? c.split(" ") : [ c ], f = {};
                for (d = 0; d < 4; d++) {
                    f[a + xa[d] + b] = e[d] || e[d - 2] || e[0];
                }
                return f;
            }
        };
    });
    var Ca = /%20/g, Da = /\[\]$/, Ea = /\r?\n/g, Fa = /#.*$/, Ga = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, Ha = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i, Ia = /^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/, Ja = /^(?:GET|HEAD)$/, Ka = /^\/\//, La = /\?/, Ma = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, Na = /^(?:select|textarea)/i, Oa = /\s+/, Pa = /([?&])_=[^&]*/, Qa = /^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/, Ra = f.fn.load, Sa = {}, Ta = {}, Ua, Va, Wa = [ "*/" ] + [ "*" ];
    try {
        Ua = e.href;
    } catch (a) {
        Ua = c.createElement("a");
        Ua.href = "";
        Ua = Ua.href;
    }
    Va = Qa.exec(Ua.toLowerCase()) || [];
    function Xa(a) {
        return function(b, c) {
            if (typeof b !== "string") {
                c = b;
                b = "*";
            }
            if (f.isFunction(c)) {
                var d = b.toLowerCase().split(Oa), e = 0, g = d.length, h, i, j;
                for (;e < g; e++) {
                    h = d[e];
                    j = /^\+/.test(h);
                    if (j) {
                        h = h.substr(1) || "*";
                    }
                    i = a[h] = a[h] || [];
                    i[j ? "unshift" : "push"](c);
                }
            }
        };
    }
    function Ya(a, c, d, e, f, g) {
        f = f || c.dataTypes[0];
        g = g || {};
        g[f] = true;
        var h = a[f], i = 0, j = h ? h.length : 0, k = a === Sa, l;
        for (;i < j && (k || !l); i++) {
            l = h[i](c, d, e);
            if (typeof l === "string") {
                if (!k || g[l]) {
                    l = b;
                } else {
                    c.dataTypes.unshift(l);
                    l = Ya(a, c, d, e, l, g);
                }
            }
        }
        if ((k || !l) && !g["*"]) {
            l = Ya(a, c, d, e, "*", g);
        }
        return l;
    }
    function Za(a, c) {
        var d, e, g = f.ajaxSettings.flatOptions || {};
        for (d in c) {
            if (c[d] !== b) {
                (g[d] ? a : e || (e = {}))[d] = c[d];
            }
        }
        if (e) {
            f.extend(true, a, e);
        }
    }
    f.fn.extend({
        load: function(a, c, d) {
            if (typeof a !== "string" && Ra) {
                return Ra.apply(this, arguments);
            } else if (!this.length) {
                return this;
            }
            var e = a.indexOf(" ");
            if (e >= 0) {
                var g = a.slice(e, a.length);
                a = a.slice(0, e);
            }
            var h = "GET";
            if (c) {
                if (f.isFunction(c)) {
                    d = c;
                    c = b;
                } else if (typeof c === "object") {
                    c = f.param(c, f.ajaxSettings.traditional);
                    h = "POST";
                }
            }
            var i = this;
            f.ajax({
                url: a,
                type: h,
                dataType: "html",
                data: c,
                complete: function(a, b, c) {
                    c = a.responseText;
                    if (a.isResolved()) {
                        a.done(function(a) {
                            c = a;
                        });
                        i.html(g ? f("<div>").append(c.replace(Ma, "")).find(g) : c);
                    }
                    if (d) {
                        i.each(d, [ c, b, a ]);
                    }
                }
            });
            return this;
        },
        serialize: function() {
            return f.param(this.serializeArray());
        },
        serializeArray: function() {
            return this.map(function() {
                return this.elements ? f.makeArray(this.elements) : this;
            }).filter(function() {
                return this.name && !this.disabled && (this.checked || Na.test(this.nodeName) || Ha.test(this.type));
            }).map(function(a, b) {
                var c = f(this).val();
                return c == null ? null : f.isArray(c) ? f.map(c, function(a, c) {
                    return {
                        name: b.name,
                        value: a.replace(Ea, "\r\n")
                    };
                }) : {
                    name: b.name,
                    value: c.replace(Ea, "\r\n")
                };
            }).get();
        }
    });
    f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "), function(a, b) {
        f.fn[b] = function(a) {
            return this.on(b, a);
        };
    });
    f.each([ "get", "post" ], function(a, c) {
        f[c] = function(a, d, e, g) {
            if (f.isFunction(d)) {
                g = g || e;
                e = d;
                d = b;
            }
            return f.ajax({
                type: c,
                url: a,
                data: d,
                success: e,
                dataType: g
            });
        };
    });
    f.extend({
        getScript: function(a, c) {
            return f.get(a, b, c, "script");
        },
        getJSON: function(a, b, c) {
            return f.get(a, b, c, "json");
        },
        ajaxSetup: function(a, b) {
            if (b) {
                Za(a, f.ajaxSettings);
            } else {
                b = a;
                a = f.ajaxSettings;
            }
            Za(a, b);
            return a;
        },
        ajaxSettings: {
            url: Ua,
            isLocal: Ia.test(Va[1]),
            global: true,
            type: "GET",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            processData: true,
            async: true,
            accepts: {
                xml: "application/xml, text/xml",
                html: "text/html",
                text: "text/plain",
                json: "application/json, text/javascript",
                "*": Wa
            },
            contents: {
                xml: /xml/,
                html: /html/,
                json: /json/
            },
            responseFields: {
                xml: "responseXML",
                text: "responseText"
            },
            converters: {
                "* text": a.String,
                "text html": true,
                "text json": f.parseJSON,
                "text xml": f.parseXML
            },
            flatOptions: {
                context: true,
                url: true
            }
        },
        ajaxPrefilter: Xa(Sa),
        ajaxTransport: Xa(Ta),
        ajax: function(a, c) {
            if (typeof a === "object") {
                c = a;
                a = b;
            }
            c = c || {};
            var d = f.ajaxSetup({}, c), e = d.context || d, g = e !== d && (e.nodeType || e instanceof f) ? f(e) : f.event, h = f.Deferred(), i = f.Callbacks("once memory"), j = d.statusCode || {}, k, l = {}, m = {}, n, o, p, q, r, s = 0, t, u, v = {
                readyState: 0,
                setRequestHeader: function(a, b) {
                    if (!s) {
                        var c = a.toLowerCase();
                        a = m[c] = m[c] || a;
                        l[a] = b;
                    }
                    return this;
                },
                getAllResponseHeaders: function() {
                    return s === 2 ? n : null;
                },
                getResponseHeader: function(a) {
                    var c;
                    if (s === 2) {
                        if (!o) {
                            o = {};
                            while (c = Ga.exec(n)) {
                                o[c[1].toLowerCase()] = c[2];
                            }
                        }
                        c = o[a.toLowerCase()];
                    }
                    return c === b ? null : c;
                },
                overrideMimeType: function(a) {
                    if (!s) {
                        d.mimeType = a;
                    }
                    return this;
                },
                abort: function(a) {
                    a = a || "abort";
                    if (p) {
                        p.abort(a);
                    }
                    w(0, a);
                    return this;
                }
            };
            function w(a, c, l, m) {
                if (s === 2) {
                    return;
                }
                s = 2;
                if (q) {
                    clearTimeout(q);
                }
                p = b;
                n = m || "";
                v.readyState = a > 0 ? 4 : 0;
                var o, r, u, w = c, x = l ? _a(d, v, l) : b, y, z;
                if (a >= 200 && a < 300 || a === 304) {
                    if (d.ifModified) {
                        if (y = v.getResponseHeader("Last-Modified")) {
                            f.lastModified[k] = y;
                        }
                        if (z = v.getResponseHeader("Etag")) {
                            f.etag[k] = z;
                        }
                    }
                    if (a === 304) {
                        w = "notmodified";
                        o = true;
                    } else {
                        try {
                            r = ab(d, x);
                            w = "success";
                            o = true;
                        } catch (a) {
                            w = "parsererror";
                            u = a;
                        }
                    }
                } else {
                    u = w;
                    if (!w || a) {
                        w = "error";
                        if (a < 0) {
                            a = 0;
                        }
                    }
                }
                v.status = a;
                v.statusText = "" + (c || w);
                if (o) {
                    h.resolveWith(e, [ r, w, v ]);
                } else {
                    h.rejectWith(e, [ v, w, u ]);
                }
                v.statusCode(j);
                j = b;
                if (t) {
                    g.trigger("ajax" + (o ? "Success" : "Error"), [ v, d, o ? r : u ]);
                }
                i.fireWith(e, [ v, w ]);
                if (t) {
                    g.trigger("ajaxComplete", [ v, d ]);
                    if (!--f.active) {
                        f.event.trigger("ajaxStop");
                    }
                }
            }
            h.promise(v);
            v.success = v.done;
            v.error = v.fail;
            v.complete = i.add;
            v.statusCode = function(a) {
                if (a) {
                    var b;
                    if (s < 2) {
                        for (b in a) {
                            j[b] = [ j[b], a[b] ];
                        }
                    } else {
                        b = a[v.status];
                        v.then(b, b);
                    }
                }
                return this;
            };
            d.url = ((a || d.url) + "").replace(Fa, "").replace(Ka, Va[1] + "//");
            d.dataTypes = f.trim(d.dataType || "*").toLowerCase().split(Oa);
            if (d.crossDomain == null) {
                r = Qa.exec(d.url.toLowerCase());
                d.crossDomain = !!(r && (r[1] != Va[1] || r[2] != Va[2] || (r[3] || (r[1] === "http:" ? 80 : 443)) != (Va[3] || (Va[1] === "http:" ? 80 : 443))));
            }
            if (d.data && d.processData && typeof d.data !== "string") {
                d.data = f.param(d.data, d.traditional);
            }
            Ya(Sa, d, c, v);
            if (s === 2) {
                return false;
            }
            t = d.global;
            d.type = d.type.toUpperCase();
            d.hasContent = !Ja.test(d.type);
            if (t && f.active++ === 0) {
                f.event.trigger("ajaxStart");
            }
            if (!d.hasContent) {
                if (d.data) {
                    d.url += (La.test(d.url) ? "&" : "?") + d.data;
                    delete d.data;
                }
                k = d.url;
                if (d.cache === false) {
                    var x = f.now(), y = d.url.replace(Pa, "$1_=" + x);
                    d.url = y + (y === d.url ? (La.test(d.url) ? "&" : "?") + "_=" + x : "");
                }
            }
            if (d.data && d.hasContent && d.contentType !== false || c.contentType) {
                v.setRequestHeader("Content-Type", d.contentType);
            }
            if (d.ifModified) {
                k = k || d.url;
                if (f.lastModified[k]) {
                    v.setRequestHeader("If-Modified-Since", f.lastModified[k]);
                }
                if (f.etag[k]) {
                    v.setRequestHeader("If-None-Match", f.etag[k]);
                }
            }
            v.setRequestHeader("Accept", d.dataTypes[0] && d.accepts[d.dataTypes[0]] ? d.accepts[d.dataTypes[0]] + (d.dataTypes[0] !== "*" ? ", " + Wa + "; q=0.01" : "") : d.accepts["*"]);
            for (u in d.headers) {
                v.setRequestHeader(u, d.headers[u]);
            }
            if (d.beforeSend && (d.beforeSend.call(e, v, d) === false || s === 2)) {
                v.abort();
                return false;
            }
            for (u in {
                success: 1,
                error: 1,
                complete: 1
            }) {
                v[u](d[u]);
            }
            p = Ya(Ta, d, c, v);
            if (!p) {
                w(-1, "No Transport");
            } else {
                v.readyState = 1;
                if (t) {
                    g.trigger("ajaxSend", [ v, d ]);
                }
                if (d.async && d.timeout > 0) {
                    q = setTimeout(function() {
                        v.abort("timeout");
                    }, d.timeout);
                }
                try {
                    s = 1;
                    p.send(l, w);
                } catch (a) {
                    if (s < 2) {
                        w(-1, a);
                    } else {
                        throw a;
                    }
                }
            }
            return v;
        },
        param: function(a, c) {
            var d = [], e = function(a, b) {
                b = f.isFunction(b) ? b() : b;
                d[d.length] = encodeURIComponent(a) + "=" + encodeURIComponent(b);
            };
            if (c === b) {
                c = f.ajaxSettings.traditional;
            }
            if (f.isArray(a) || a.jquery && !f.isPlainObject(a)) {
                f.each(a, function() {
                    e(this.name, this.value);
                });
            } else {
                for (var g in a) {
                    $a(g, a[g], c, e);
                }
            }
            return d.join("&").replace(Ca, "+");
        }
    });
    function $a(a, b, c, d) {
        if (f.isArray(b)) {
            f.each(b, function(b, e) {
                if (c || Da.test(a)) {
                    d(a, e);
                } else {
                    $a(a + "[" + (typeof e === "object" ? b : "") + "]", e, c, d);
                }
            });
        } else if (!c && f.type(b) === "object") {
            for (var e in b) {
                $a(a + "[" + e + "]", b[e], c, d);
            }
        } else {
            d(a, b);
        }
    }
    f.extend({
        active: 0,
        lastModified: {},
        etag: {}
    });
    function _a(a, c, d) {
        var e = a.contents, f = a.dataTypes, g = a.responseFields, h, i, j, k;
        for (i in g) {
            if (i in d) {
                c[g[i]] = d[i];
            }
        }
        while (f[0] === "*") {
            f.shift();
            if (h === b) {
                h = a.mimeType || c.getResponseHeader("content-type");
            }
        }
        if (h) {
            for (i in e) {
                if (e[i] && e[i].test(h)) {
                    f.unshift(i);
                    break;
                }
            }
        }
        if (f[0] in d) {
            j = f[0];
        } else {
            for (i in d) {
                if (!f[0] || a.converters[i + " " + f[0]]) {
                    j = i;
                    break;
                }
                if (!k) {
                    k = i;
                }
            }
            j = j || k;
        }
        if (j) {
            if (j !== f[0]) {
                f.unshift(j);
            }
            return d[j];
        }
    }
    function ab(a, c) {
        if (a.dataFilter) {
            c = a.dataFilter(c, a.dataType);
        }
        var d = a.dataTypes, e = {}, g, h, i = d.length, j, k = d[0], l, m, n, o, p;
        for (g = 1; g < i; g++) {
            if (g === 1) {
                for (h in a.converters) {
                    if (typeof h === "string") {
                        e[h.toLowerCase()] = a.converters[h];
                    }
                }
            }
            l = k;
            k = d[g];
            if (k === "*") {
                k = l;
            } else if (l !== "*" && l !== k) {
                m = l + " " + k;
                n = e[m] || e["* " + k];
                if (!n) {
                    p = b;
                    for (o in e) {
                        j = o.split(" ");
                        if (j[0] === l || j[0] === "*") {
                            p = e[j[1] + " " + k];
                            if (p) {
                                o = e[o];
                                if (o === true) {
                                    n = p;
                                } else if (p === true) {
                                    n = o;
                                }
                                break;
                            }
                        }
                    }
                }
                if (!(n || p)) {
                    f.error("No conversion from " + m.replace(" ", " to "));
                }
                if (n !== true) {
                    c = n ? n(c) : p(o(c));
                }
            }
        }
        return c;
    }
    var bb = f.now(), cb = /(\=)\?(&|$)|\?\?/i;
    f.ajaxSetup({
        jsonp: "callback",
        jsonpCallback: function() {
            return f.expando + "_" + bb++;
        }
    });
    f.ajaxPrefilter("json jsonp", function(b, c, d) {
        var e = typeof b.data === "string" && /^application\/x\-www\-form\-urlencoded/.test(b.contentType);
        if (b.dataTypes[0] === "jsonp" || b.jsonp !== false && (cb.test(b.url) || e && cb.test(b.data))) {
            var g, h = b.jsonpCallback = f.isFunction(b.jsonpCallback) ? b.jsonpCallback() : b.jsonpCallback, i = a[h], j = b.url, k = b.data, l = "$1" + h + "$2";
            if (b.jsonp !== false) {
                j = j.replace(cb, l);
                if (b.url === j) {
                    if (e) {
                        k = k.replace(cb, l);
                    }
                    if (b.data === k) {
                        j += (/\?/.test(j) ? "&" : "?") + b.jsonp + "=" + h;
                    }
                }
            }
            b.url = j;
            b.data = k;
            a[h] = function(a) {
                g = [ a ];
            };
            d.always(function() {
                a[h] = i;
                if (g && f.isFunction(i)) {
                    a[h](g[0]);
                }
            });
            b.converters["script json"] = function() {
                if (!g) {
                    f.error(h + " was not called");
                }
                return g[0];
            };
            b.dataTypes[0] = "json";
            return "script";
        }
    });
    f.ajaxSetup({
        accepts: {
            script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
        },
        contents: {
            script: /javascript|ecmascript/
        },
        converters: {
            "text script": function(a) {
                f.globalEval(a);
                return a;
            }
        }
    });
    f.ajaxPrefilter("script", function(a) {
        if (a.cache === b) {
            a.cache = false;
        }
        if (a.crossDomain) {
            a.type = "GET";
            a.global = false;
        }
    });
    f.ajaxTransport("script", function(a) {
        if (a.crossDomain) {
            var d, e = c.head || c.getElementsByTagName("head")[0] || c.documentElement;
            return {
                send: function(f, g) {
                    d = c.createElement("script");
                    d.async = "async";
                    if (a.scriptCharset) {
                        d.charset = a.scriptCharset;
                    }
                    d.src = a.url;
                    d.onload = d.onreadystatechange = function(a, c) {
                        if (c || !d.readyState || /loaded|complete/.test(d.readyState)) {
                            d.onload = d.onreadystatechange = null;
                            if (e && d.parentNode) {
                                e.removeChild(d);
                            }
                            d = b;
                            if (!c) {
                                g(200, "success");
                            }
                        }
                    };
                    e.insertBefore(d, e.firstChild);
                },
                abort: function() {
                    if (d) {
                        d.onload(0, 1);
                    }
                }
            };
        }
    });
    var db = a.ActiveXObject ? function() {
        for (var a in fb) {
            fb[a](0, 1);
        }
    } : false, eb = 0, fb;
    function gb() {
        try {
            return new a.XMLHttpRequest();
        } catch (a) {}
    }
    function hb() {
        try {
            return new a.ActiveXObject("Microsoft.XMLHTTP");
        } catch (a) {}
    }
    f.ajaxSettings.xhr = a.ActiveXObject ? function() {
        return !this.isLocal && gb() || hb();
    } : gb;
    (function(a) {
        f.extend(f.support, {
            ajax: !!a,
            cors: !!a && "withCredentials" in a
        });
    })(f.ajaxSettings.xhr());
    if (f.support.ajax) {
        f.ajaxTransport(function(c) {
            if (!c.crossDomain || f.support.cors) {
                var d;
                return {
                    send: function(e, g) {
                        var h = c.xhr(), i, j;
                        if (c.username) {
                            h.open(c.type, c.url, c.async, c.username, c.password);
                        } else {
                            h.open(c.type, c.url, c.async);
                        }
                        if (c.xhrFields) {
                            for (j in c.xhrFields) {
                                h[j] = c.xhrFields[j];
                            }
                        }
                        if (c.mimeType && h.overrideMimeType) {
                            h.overrideMimeType(c.mimeType);
                        }
                        if (!c.crossDomain && !e["X-Requested-With"]) {
                            e["X-Requested-With"] = "XMLHttpRequest";
                        }
                        try {
                            for (j in e) {
                                h.setRequestHeader(j, e[j]);
                            }
                        } catch (a) {}
                        h.send(c.hasContent && c.data || null);
                        d = function(a, e) {
                            var j, k, l, m, n;
                            try {
                                if (d && (e || h.readyState === 4)) {
                                    d = b;
                                    if (i) {
                                        h.onreadystatechange = f.noop;
                                        if (db) {
                                            delete fb[i];
                                        }
                                    }
                                    if (e) {
                                        if (h.readyState !== 4) {
                                            h.abort();
                                        }
                                    } else {
                                        j = h.status;
                                        l = h.getAllResponseHeaders();
                                        m = {};
                                        n = h.responseXML;
                                        if (n && n.documentElement) {
                                            m.xml = n;
                                        }
                                        try {
                                            m.text = h.responseText;
                                        } catch (a) {}
                                        try {
                                            k = h.statusText;
                                        } catch (a) {
                                            k = "";
                                        }
                                        if (!j && c.isLocal && !c.crossDomain) {
                                            j = m.text ? 200 : 404;
                                        } else if (j === 1223) {
                                            j = 204;
                                        }
                                    }
                                }
                            } catch (a) {
                                if (!e) {
                                    g(-1, a);
                                }
                            }
                            if (m) {
                                g(j, k, m, l);
                            }
                        };
                        if (!c.async || h.readyState === 4) {
                            d();
                        } else {
                            i = ++eb;
                            if (db) {
                                if (!fb) {
                                    fb = {};
                                    f(a).unload(db);
                                }
                                fb[i] = d;
                            }
                            h.onreadystatechange = d;
                        }
                    },
                    abort: function() {
                        if (d) {
                            d(0, 1);
                        }
                    }
                };
            }
        });
    }
    var ib = {}, jb, kb, lb = /^(?:toggle|show|hide)$/, mb = /^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i, nb, ob = [ [ "height", "marginTop", "marginBottom", "paddingTop", "paddingBottom" ], [ "width", "marginLeft", "marginRight", "paddingLeft", "paddingRight" ], [ "opacity" ] ], pb;
    f.fn.extend({
        show: function(a, b, c) {
            var d, e;
            if (a || a === 0) {
                return this.animate(sb("show", 3), a, b, c);
            } else {
                for (var g = 0, h = this.length; g < h; g++) {
                    d = this[g];
                    if (d.style) {
                        e = d.style.display;
                        if (!f._data(d, "olddisplay") && e === "none") {
                            e = d.style.display = "";
                        }
                        if (e === "" && f.css(d, "display") === "none" || !f.contains(d.ownerDocument.documentElement, d)) {
                            f._data(d, "olddisplay", tb(d.nodeName));
                        }
                    }
                }
                for (g = 0; g < h; g++) {
                    d = this[g];
                    if (d.style) {
                        e = d.style.display;
                        if (e === "" || e === "none") {
                            d.style.display = f._data(d, "olddisplay") || "";
                        }
                    }
                }
                return this;
            }
        },
        hide: function(a, b, c) {
            if (a || a === 0) {
                return this.animate(sb("hide", 3), a, b, c);
            } else {
                var d, e, g = 0, h = this.length;
                for (;g < h; g++) {
                    d = this[g];
                    if (d.style) {
                        e = f.css(d, "display");
                        if (e !== "none" && !f._data(d, "olddisplay")) {
                            f._data(d, "olddisplay", e);
                        }
                    }
                }
                for (g = 0; g < h; g++) {
                    if (this[g].style) {
                        this[g].style.display = "none";
                    }
                }
                return this;
            }
        },
        _toggle: f.fn.toggle,
        toggle: function(a, b, c) {
            var d = typeof a === "boolean";
            if (f.isFunction(a) && f.isFunction(b)) {
                this._toggle.apply(this, arguments);
            } else if (a == null || d) {
                this.each(function() {
                    var b = d ? a : f(this).is(":hidden");
                    f(this)[b ? "show" : "hide"]();
                });
            } else {
                this.animate(sb("toggle", 3), a, b, c);
            }
            return this;
        },
        fadeTo: function(a, b, c, d) {
            return this.filter(":hidden").css("opacity", 0).show().end().animate({
                opacity: b
            }, a, c, d);
        },
        animate: function(a, b, c, d) {
            var e = f.speed(b, c, d);
            if (f.isEmptyObject(a)) {
                return this.each(e.complete, [ false ]);
            }
            a = f.extend({}, a);
            function g() {
                if (e.queue === false) {
                    f._mark(this);
                }
                var b = f.extend({}, e), c = this.nodeType === 1, d = c && f(this).is(":hidden"), g, h, i, j, k, l, m, n, o, p, q;
                b.animatedProperties = {};
                for (i in a) {
                    g = f.camelCase(i);
                    if (i !== g) {
                        a[g] = a[i];
                        delete a[i];
                    }
                    if ((k = f.cssHooks[g]) && "expand" in k) {
                        l = k.expand(a[g]);
                        delete a[g];
                        for (i in l) {
                            if (!(i in a)) {
                                a[i] = l[i];
                            }
                        }
                    }
                }
                for (g in a) {
                    h = a[g];
                    if (f.isArray(h)) {
                        b.animatedProperties[g] = h[1];
                        h = a[g] = h[0];
                    } else {
                        b.animatedProperties[g] = b.specialEasing && b.specialEasing[g] || b.easing || "swing";
                    }
                    if (h === "hide" && d || h === "show" && !d) {
                        return b.complete.call(this);
                    }
                    if (c && (g === "height" || g === "width")) {
                        b.overflow = [ this.style.overflow, this.style.overflowX, this.style.overflowY ];
                        if (f.css(this, "display") === "inline" && f.css(this, "float") === "none") {
                            if (!f.support.inlineBlockNeedsLayout || tb(this.nodeName) === "inline") {
                                this.style.display = "inline-block";
                            } else {
                                this.style.zoom = 1;
                            }
                        }
                    }
                }
                if (b.overflow != null) {
                    this.style.overflow = "hidden";
                }
                for (i in a) {
                    j = new f.fx(this, b, i);
                    h = a[i];
                    if (lb.test(h)) {
                        q = f._data(this, "toggle" + i) || (h === "toggle" ? d ? "show" : "hide" : 0);
                        if (q) {
                            f._data(this, "toggle" + i, q === "show" ? "hide" : "show");
                            j[q]();
                        } else {
                            j[h]();
                        }
                    } else {
                        m = mb.exec(h);
                        n = j.cur();
                        if (m) {
                            o = parseFloat(m[2]);
                            p = m[3] || (f.cssNumber[i] ? "" : "px");
                            if (p !== "px") {
                                f.style(this, i, (o || 1) + p);
                                n = (o || 1) / j.cur() * n;
                                f.style(this, i, n + p);
                            }
                            if (m[1]) {
                                o = (m[1] === "-=" ? -1 : 1) * o + n;
                            }
                            j.custom(n, o, p);
                        } else {
                            j.custom(n, h, "");
                        }
                    }
                }
                return true;
            }
            return e.queue === false ? this.each(g) : this.queue(e.queue, g);
        },
        stop: function(a, c, d) {
            if (typeof a !== "string") {
                d = c;
                c = a;
                a = b;
            }
            if (c && a !== false) {
                this.queue(a || "fx", []);
            }
            return this.each(function() {
                var b, c = false, e = f.timers, g = f._data(this);
                if (!d) {
                    f._unmark(true, this);
                }
                function h(a, b, c) {
                    var e = b[c];
                    f.removeData(a, c, true);
                    e.stop(d);
                }
                if (a == null) {
                    for (b in g) {
                        if (g[b] && g[b].stop && b.indexOf(".run") === b.length - 4) {
                            h(this, g, b);
                        }
                    }
                } else if (g[b = a + ".run"] && g[b].stop) {
                    h(this, g, b);
                }
                for (b = e.length; b--; ) {
                    if (e[b].elem === this && (a == null || e[b].queue === a)) {
                        if (d) {
                            e[b](true);
                        } else {
                            e[b].saveState();
                        }
                        c = true;
                        e.splice(b, 1);
                    }
                }
                if (!(d && c)) {
                    f.dequeue(this, a);
                }
            });
        }
    });
    function qb() {
        setTimeout(rb, 0);
        return pb = f.now();
    }
    function rb() {
        pb = b;
    }
    function sb(a, b) {
        var c = {};
        f.each(ob.concat.apply([], ob.slice(0, b)), function() {
            c[this] = a;
        });
        return c;
    }
    f.each({
        slideDown: sb("show", 1),
        slideUp: sb("hide", 1),
        slideToggle: sb("toggle", 1),
        fadeIn: {
            opacity: "show"
        },
        fadeOut: {
            opacity: "hide"
        },
        fadeToggle: {
            opacity: "toggle"
        }
    }, function(a, b) {
        f.fn[a] = function(a, c, d) {
            return this.animate(b, a, c, d);
        };
    });
    f.extend({
        speed: function(a, b, c) {
            var d = a && typeof a === "object" ? f.extend({}, a) : {
                complete: c || !c && b || f.isFunction(a) && a,
                duration: a,
                easing: c && b || b && !f.isFunction(b) && b
            };
            d.duration = f.fx.off ? 0 : typeof d.duration === "number" ? d.duration : d.duration in f.fx.speeds ? f.fx.speeds[d.duration] : f.fx.speeds._default;
            if (d.queue == null || d.queue === true) {
                d.queue = "fx";
            }
            d.old = d.complete;
            d.complete = function(a) {
                if (f.isFunction(d.old)) {
                    d.old.call(this);
                }
                if (d.queue) {
                    f.dequeue(this, d.queue);
                } else if (a !== false) {
                    f._unmark(this);
                }
            };
            return d;
        },
        easing: {
            linear: function(a) {
                return a;
            },
            swing: function(a) {
                return -Math.cos(a * Math.PI) / 2 + .5;
            }
        },
        timers: [],
        fx: function(a, b, c) {
            this.options = b;
            this.elem = a;
            this.prop = c;
            b.orig = b.orig || {};
        }
    });
    f.fx.prototype = {
        update: function() {
            if (this.options.step) {
                this.options.step.call(this.elem, this.now, this);
            }
            (f.fx.step[this.prop] || f.fx.step._default)(this);
        },
        cur: function() {
            if (this.elem[this.prop] != null && (!this.elem.style || this.elem.style[this.prop] == null)) {
                return this.elem[this.prop];
            }
            var a, b = f.css(this.elem, this.prop);
            return isNaN(a = parseFloat(b)) ? !b || b === "auto" ? 0 : b : a;
        },
        custom: function(a, c, d) {
            var e = this, g = f.fx;
            this.startTime = pb || qb();
            this.end = c;
            this.now = this.start = a;
            this.pos = this.state = 0;
            this.unit = d || this.unit || (f.cssNumber[this.prop] ? "" : "px");
            function h(a) {
                return e.step(a);
            }
            h.queue = this.options.queue;
            h.elem = this.elem;
            h.saveState = function() {
                if (f._data(e.elem, "fxshow" + e.prop) === b) {
                    if (e.options.hide) {
                        f._data(e.elem, "fxshow" + e.prop, e.start);
                    } else if (e.options.show) {
                        f._data(e.elem, "fxshow" + e.prop, e.end);
                    }
                }
            };
            if (h() && f.timers.push(h) && !nb) {
                nb = setInterval(g.tick, g.interval);
            }
        },
        show: function() {
            var a = f._data(this.elem, "fxshow" + this.prop);
            this.options.orig[this.prop] = a || f.style(this.elem, this.prop);
            this.options.show = true;
            if (a !== b) {
                this.custom(this.cur(), a);
            } else {
                this.custom(this.prop === "width" || this.prop === "height" ? 1 : 0, this.cur());
            }
            f(this.elem).show();
        },
        hide: function() {
            this.options.orig[this.prop] = f._data(this.elem, "fxshow" + this.prop) || f.style(this.elem, this.prop);
            this.options.hide = true;
            this.custom(this.cur(), 0);
        },
        step: function(a) {
            var b, c, d, e = pb || qb(), g = true, h = this.elem, i = this.options;
            if (a || e >= i.duration + this.startTime) {
                this.now = this.end;
                this.pos = this.state = 1;
                this.update();
                i.animatedProperties[this.prop] = true;
                for (b in i.animatedProperties) {
                    if (i.animatedProperties[b] !== true) {
                        g = false;
                    }
                }
                if (g) {
                    if (i.overflow != null && !f.support.shrinkWrapBlocks) {
                        f.each([ "", "X", "Y" ], function(a, b) {
                            h.style["overflow" + b] = i.overflow[a];
                        });
                    }
                    if (i.hide) {
                        f(h).hide();
                    }
                    if (i.hide || i.show) {
                        for (b in i.animatedProperties) {
                            f.style(h, b, i.orig[b]);
                            f.removeData(h, "fxshow" + b, true);
                            f.removeData(h, "toggle" + b, true);
                        }
                    }
                    d = i.complete;
                    if (d) {
                        i.complete = false;
                        d.call(h);
                    }
                }
                return false;
            } else {
                if (i.duration == Infinity) {
                    this.now = e;
                } else {
                    c = e - this.startTime;
                    this.state = c / i.duration;
                    this.pos = f.easing[i.animatedProperties[this.prop]](this.state, c, 0, 1, i.duration);
                    this.now = this.start + (this.end - this.start) * this.pos;
                }
                this.update();
            }
            return true;
        }
    };
    f.extend(f.fx, {
        tick: function() {
            var a, b = f.timers, c = 0;
            for (;c < b.length; c++) {
                a = b[c];
                if (!a() && b[c] === a) {
                    b.splice(c--, 1);
                }
            }
            if (!b.length) {
                f.fx.stop();
            }
        },
        interval: 13,
        stop: function() {
            clearInterval(nb);
            nb = null;
        },
        speeds: {
            slow: 600,
            fast: 200,
            _default: 400
        },
        step: {
            opacity: function(a) {
                f.style(a.elem, "opacity", a.now);
            },
            _default: function(a) {
                if (a.elem.style && a.elem.style[a.prop] != null) {
                    a.elem.style[a.prop] = a.now + a.unit;
                } else {
                    a.elem[a.prop] = a.now;
                }
            }
        }
    });
    f.each(ob.concat.apply([], ob), function(a, b) {
        if (b.indexOf("margin")) {
            f.fx.step[b] = function(a) {
                f.style(a.elem, b, Math.max(0, a.now) + a.unit);
            };
        }
    });
    if (f.expr && f.expr.filters) {
        f.expr.filters.animated = function(a) {
            return f.grep(f.timers, function(b) {
                return a === b.elem;
            }).length;
        };
    }
    function tb(a) {
        if (!ib[a]) {
            var b = c.body, d = f("<" + a + ">").appendTo(b), e = d.css("display");
            d.remove();
            if (e === "none" || e === "") {
                if (!jb) {
                    jb = c.createElement("iframe");
                    jb.frameBorder = jb.width = jb.height = 0;
                }
                b.appendChild(jb);
                if (!kb || !jb.createElement) {
                    kb = (jb.contentWindow || jb.contentDocument).document;
                    kb.write((f.support.boxModel ? "<!doctype html>" : "") + "<html><body>");
                    kb.close();
                }
                d = kb.createElement(a);
                kb.body.appendChild(d);
                e = f.css(d, "display");
                b.removeChild(jb);
            }
            ib[a] = e;
        }
        return ib[a];
    }
    var ub, vb = /^t(?:able|d|h)$/i, wb = /^(?:body|html)$/i;
    if ("getBoundingClientRect" in c.documentElement) {
        ub = function(a, b, c, d) {
            try {
                d = a.getBoundingClientRect();
            } catch (a) {}
            if (!d || !f.contains(c, a)) {
                return d ? {
                    top: d.top,
                    left: d.left
                } : {
                    top: 0,
                    left: 0
                };
            }
            var e = b.body, g = xb(b), h = c.clientTop || e.clientTop || 0, i = c.clientLeft || e.clientLeft || 0, j = g.pageYOffset || f.support.boxModel && c.scrollTop || e.scrollTop, k = g.pageXOffset || f.support.boxModel && c.scrollLeft || e.scrollLeft, l = d.top + j - h, m = d.left + k - i;
            return {
                top: l,
                left: m
            };
        };
    } else {
        ub = function(a, b, c) {
            var d, e = a.offsetParent, g = a, h = b.body, i = b.defaultView, j = i ? i.getComputedStyle(a, null) : a.currentStyle, k = a.offsetTop, l = a.offsetLeft;
            while ((a = a.parentNode) && a !== h && a !== c) {
                if (f.support.fixedPosition && j.position === "fixed") {
                    break;
                }
                d = i ? i.getComputedStyle(a, null) : a.currentStyle;
                k -= a.scrollTop;
                l -= a.scrollLeft;
                if (a === e) {
                    k += a.offsetTop;
                    l += a.offsetLeft;
                    if (f.support.doesNotAddBorder && !(f.support.doesAddBorderForTableAndCells && vb.test(a.nodeName))) {
                        k += parseFloat(d.borderTopWidth) || 0;
                        l += parseFloat(d.borderLeftWidth) || 0;
                    }
                    g = e;
                    e = a.offsetParent;
                }
                if (f.support.subtractsBorderForOverflowNotVisible && d.overflow !== "visible") {
                    k += parseFloat(d.borderTopWidth) || 0;
                    l += parseFloat(d.borderLeftWidth) || 0;
                }
                j = d;
            }
            if (j.position === "relative" || j.position === "static") {
                k += h.offsetTop;
                l += h.offsetLeft;
            }
            if (f.support.fixedPosition && j.position === "fixed") {
                k += Math.max(c.scrollTop, h.scrollTop);
                l += Math.max(c.scrollLeft, h.scrollLeft);
            }
            return {
                top: k,
                left: l
            };
        };
    }
    f.fn.offset = function(a) {
        if (arguments.length) {
            return a === b ? this : this.each(function(b) {
                f.offset.setOffset(this, a, b);
            });
        }
        var c = this[0], d = c && c.ownerDocument;
        if (!d) {
            return null;
        }
        if (c === d.body) {
            return f.offset.bodyOffset(c);
        }
        return ub(c, d, d.documentElement);
    };
    f.offset = {
        bodyOffset: function(a) {
            var b = a.offsetTop, c = a.offsetLeft;
            if (f.support.doesNotIncludeMarginInBodyOffset) {
                b += parseFloat(f.css(a, "marginTop")) || 0;
                c += parseFloat(f.css(a, "marginLeft")) || 0;
            }
            return {
                top: b,
                left: c
            };
        },
        setOffset: function(a, b, c) {
            var d = f.css(a, "position");
            if (d === "static") {
                a.style.position = "relative";
            }
            var e = f(a), g = e.offset(), h = f.css(a, "top"), i = f.css(a, "left"), j = (d === "absolute" || d === "fixed") && f.inArray("auto", [ h, i ]) > -1, k = {}, l = {}, m, n;
            if (j) {
                l = e.position();
                m = l.top;
                n = l.left;
            } else {
                m = parseFloat(h) || 0;
                n = parseFloat(i) || 0;
            }
            if (f.isFunction(b)) {
                b = b.call(a, c, g);
            }
            if (b.top != null) {
                k.top = b.top - g.top + m;
            }
            if (b.left != null) {
                k.left = b.left - g.left + n;
            }
            if ("using" in b) {
                b.using.call(a, k);
            } else {
                e.css(k);
            }
        }
    };
    f.fn.extend({
        position: function() {
            if (!this[0]) {
                return null;
            }
            var a = this[0], b = this.offsetParent(), c = this.offset(), d = wb.test(b[0].nodeName) ? {
                top: 0,
                left: 0
            } : b.offset();
            c.top -= parseFloat(f.css(a, "marginTop")) || 0;
            c.left -= parseFloat(f.css(a, "marginLeft")) || 0;
            d.top += parseFloat(f.css(b[0], "borderTopWidth")) || 0;
            d.left += parseFloat(f.css(b[0], "borderLeftWidth")) || 0;
            return {
                top: c.top - d.top,
                left: c.left - d.left
            };
        },
        offsetParent: function() {
            return this.map(function() {
                var a = this.offsetParent || c.body;
                while (a && (!wb.test(a.nodeName) && f.css(a, "position") === "static")) {
                    a = a.offsetParent;
                }
                return a;
            });
        }
    });
    f.each({
        scrollLeft: "pageXOffset",
        scrollTop: "pageYOffset"
    }, function(a, c) {
        var d = /Y/.test(c);
        f.fn[a] = function(e) {
            return f.access(this, function(a, e, g) {
                var h = xb(a);
                if (g === b) {
                    return h ? c in h ? h[c] : f.support.boxModel && h.document.documentElement[e] || h.document.body[e] : a[e];
                }
                if (h) {
                    h.scrollTo(!d ? g : f(h).scrollLeft(), d ? g : f(h).scrollTop());
                } else {
                    a[e] = g;
                }
            }, a, e, arguments.length, null);
        };
    });
    function xb(a) {
        return f.isWindow(a) ? a : a.nodeType === 9 ? a.defaultView || a.parentWindow : false;
    }
    f.each({
        Height: "height",
        Width: "width"
    }, function(a, c) {
        var d = "client" + a, e = "scroll" + a, g = "offset" + a;
        f.fn["inner" + a] = function() {
            var a = this[0];
            return a ? a.style ? parseFloat(f.css(a, c, "padding")) : this[c]() : null;
        };
        f.fn["outer" + a] = function(a) {
            var b = this[0];
            return b ? b.style ? parseFloat(f.css(b, c, a ? "margin" : "border")) : this[c]() : null;
        };
        f.fn[c] = function(a) {
            return f.access(this, function(a, c, h) {
                var i, j, k, l;
                if (f.isWindow(a)) {
                    i = a.document;
                    j = i.documentElement[d];
                    return f.support.boxModel && j || i.body && i.body[d] || j;
                }
                if (a.nodeType === 9) {
                    i = a.documentElement;
                    if (i[d] >= i[e]) {
                        return i[d];
                    }
                    return Math.max(a.body[e], i[e], a.body[g], i[g]);
                }
                if (h === b) {
                    k = f.css(a, c);
                    l = parseFloat(k);
                    return f.isNumeric(l) ? l : k;
                }
                f(a).css(c, h);
            }, c, a, arguments.length, null);
        };
    });
    a.jQuery = a.$ = f;
    if (typeof define === "function" && define.amd && define.amd.jQuery) {
        define("jquery", [], function() {
            return f;
        });
    }
})(window);

(function(a) {
    function b(a, b) {
        return typeof a == "function" ? a.call(b) : a;
    }
    function c(b, c) {
        this.$element = a(b);
        this.options = c;
        this.enabled = true;
        this.fixTitle();
    }
    c.prototype = {
        getEl: function() {
            var b;
            if (this.delegatedEl) {
                b = a(this.delegatedEl);
            } else {
                b = this.$element;
            }
            return b;
        },
        show: function() {
            var c = this.getEl();
            this.quickShowState = "in";
            clearTimeout(this.showTimeout);
            clearTimeout(this.hideTimeout);
            this.isShown = true;
            var d = this.getTitle();
            if (d && this.enabled) {
                var e = this.tip();
                e.find(".tipsy-inner")[this.options.html ? "html" : "text"](d);
                e[0].className = "tipsy";
                e.remove().css({
                    top: 0,
                    left: 0,
                    visibility: "hidden",
                    display: "block"
                }).prependTo(document.body);
                var f = a.extend({}, c.offset(), {
                    width: c[0].offsetWidth,
                    height: c[0].offsetHeight
                });
                var g = e[0].offsetWidth, h = e[0].offsetHeight, i = b(this.options.gravity, c[0]);
                var j;
                switch (i.charAt(0)) {
                  case "n":
                    j = {
                        top: f.top + f.height + this.options.offset,
                        left: f.left + f.width / 2 - g / 2
                    };
                    break;

                  case "s":
                    j = {
                        top: f.top - h - this.options.offset,
                        left: f.left + f.width / 2 - g / 2
                    };
                    break;

                  case "e":
                    j = {
                        top: f.top + f.height / 2 - h / 2,
                        left: f.left - g - this.options.offset
                    };
                    break;

                  case "w":
                    j = {
                        top: f.top + f.height / 2 - h / 2,
                        left: f.left + f.width + this.options.offset
                    };
                    break;
                }
                if (i.length == 2) {
                    if (i.charAt(1) == "w") {
                        j.left = f.left + f.width / 2 - 15;
                    } else {
                        j.left = f.left + f.width / 2 - g + 15;
                    }
                }
                e.css(j).addClass("tipsy-" + i);
                e.find(".tipsy-arrow")[0].className = "tipsy-arrow tipsy-arrow-" + i.charAt(0);
                if (this.options.className) {
                    e.addClass(b(this.options.className, c[0]));
                }
                if (this.options.fade) {
                    e.stop().css({
                        opacity: 0,
                        display: "block",
                        visibility: "visible"
                    }).animate({
                        opacity: this.options.opacity
                    });
                } else {
                    e.css({
                        visibility: "visible",
                        opacity: this.options.opacity
                    });
                }
            }
        },
        showDelegate: function(a) {
            this.delegatedEl = a;
            this.show();
        },
        hideDelegate: function(a) {
            this.delegatedEl = a;
            this.hide();
        },
        hide: function() {
            clearTimeout(this.showTimeout);
            clearTimeout(this.hideTimeout);
            this.isShown = false;
            if (this.options.fade) {
                this.tip().stop().fadeOut(function() {
                    a(this).remove();
                });
            } else {
                this.tip().remove();
            }
        },
        fixTitle: function() {
            var a = this.getEl();
            var b = a;
            if (b.attr("title") || typeof b.attr("original-title") != "string") {
                b.attr("original-title", b.attr("title") || "").removeAttr("title");
            }
        },
        getTitle: function() {
            var a = this.getEl();
            var b, c = this.options;
            this.fixTitle();
            var b, c = this.options;
            if (typeof c.title == "string") {
                b = a.attr(c.title == "title" ? "original-title" : c.title);
            } else if (typeof c.title == "function") {
                b = c.title.call(a[0]);
            }
            b = ("" + b).replace(/(^\s*|\s*$)/, "");
            return b || c.fallback;
        },
        tip: function() {
            if (!this.$tip) {
                this.$tip = a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');
            }
            return this.$tip;
        },
        validate: function() {
            var a = this.getEl();
            if (this.delegatedEl && !this.delegatedEl.parentNode) {
                this.hide();
            }
            if (a && !a.parentNode) {
                this.hide();
            } else {
                console.log("No el right now...");
            }
        },
        enable: function() {
            this.enabled = true;
        },
        disable: function() {
            this.enabled = false;
        },
        toggleEnabled: function() {
            this.enabled = !this.enabled;
        }
    };
    a.fn.tipsy = function(b) {
        if (b === true) {
            return this.data("tipsy");
        } else if (typeof b == "string") {
            var d = this.data("tipsy");
            if (d) {
                d[b]();
            } else {
                console.log("Calling tipsy but no tipsy", b);
            }
            return this;
        }
        b = a.extend({}, a.fn.tipsy.defaults, b);
        function e(d) {
            var e = a.data(d, "tipsy");
            if (!e) {
                e = new c(d, a.fn.tipsy.elementOptions(d, b));
                a.data(d, "tipsy", e);
            }
            return e;
        }
        function f(b) {
            var c = b.currentTarget;
            var d = e(this);
            a(c).attr("ppover", true);
            var f = a(c).find('[ppover="true"]');
            if (f.length) {
                return;
            }
            d.delegatedEl = c;
            j.call(this);
        }
        function g(b) {
            var c = b.currentTarget;
            var d = e(this);
            a(c).attr("ppover", false);
            var f = a(c).parents('[ppover="true"]');
            if (f.length) {
                d.delegatedEl = f[0];
                j.call(this);
                return;
            }
            d.delegatedEl = c;
            k.call(this);
        }
        function h(a) {
            var b = a.currentTarget;
            var c = e(this);
            if (b === c.delegatedEl) {
                l.call(this);
            }
        }
        function i(a) {
            var b = a.currentTarget;
            var c = e(this);
            if (b === c.delegatedEl) {
                m.call(this);
            }
        }
        function j(a) {
            var c = e(this);
            c.hoverState = "in";
            var d = b.delayIn;
            var f = c.getEl();
            if (f.attr("delayIn")) {
                d = f.attr("delayIn");
            }
            if (d == 0 || c.quickShowState === "in") {
                c.show();
            } else {
                c.fixTitle();
                c.showTimeout = setTimeout(function() {
                    if (c.hoverState == "in") {
                        c.show();
                    }
                }, d);
            }
            clearTimeout(c.quickShowTimeout);
            if (b.cancelEvent) {
                a.preventDefault();
            }
        }
        function k(a) {
            var c = e(this);
            c.hoverState = "out";
            clearTimeout(c.showTimeout);
            c.quickShowTimeout = setTimeout(function() {
                c.quickShowState = "out";
            }, b.quickShowDelay);
            if (b.delayOut == 0) {
                c.hide();
            } else {
                c.hideTimeout = setTimeout(function() {
                    if (c.hoverState == "out") c.hide();
                }, b.delayOut);
            }
            if (b.cancelEvent) {
                a.preventDefault();
            }
        }
        function l() {
            var a = e(this);
            a.hide();
            a.hoverState = "out";
            a.quickShowState = "out";
            clearTimeout(a.quickShowTimeout);
            clearTimeout(a.showTimeout);
            clearTimeout(a.hideTimeout);
        }
        function m() {
            var a = e(this);
            a.hide();
            a.hoverState = "out";
            a.quickShowState = "out";
            clearTimeout(a.quickShowTimeout);
            clearTimeout(a.showTimeout);
            clearTimeout(a.hideTimeout);
        }
        if (!b.live && !b.delegate) this.each(function() {
            e(this);
        });
        if (b.delegate) {
            var d = e(this);
            this.tipsy = d;
        }
        if (b.trigger != "manual") {
            var n = b.trigger == "hover" ? "mouseenter" : "focus", o = b.trigger == "hover" ? "mouseleave" : "blur";
            if (b.delegate) {
                var p = this;
                this.on(n, b.delegate, function(a) {
                    f.call(p, a);
                });
                this.on(o, b.delegate, function(a) {
                    g.call(p, a);
                });
                this.on("mousedown", b.delegate, function(a) {
                    i.call(p, a);
                });
            } else {
                var q = b.live ? "live" : "bind";
                this[q](n, j)[q](o, k);
            }
        }
        return this;
    };
    a.fn.tipsy.defaults = {
        className: null,
        delayIn: 0,
        delayOut: 0,
        quickShowDelay: 500,
        fade: false,
        fallback: "",
        gravity: "n",
        html: false,
        delegate: false,
        live: false,
        offset: 0,
        opacity: .8,
        title: "title",
        trigger: "hover"
    };
    a.fn.tipsy.elementOptions = function(b, c) {
        return a.metadata ? a.extend({}, c, a(b).metadata()) : c;
    };
    a.fn.tipsy.autoNS = function() {
        return a(this).offset().top > a(document).scrollTop() + 50 ? "s" : "n";
    };
    a.fn.tipsy.autoWE = function() {
        return a(this).offset().left > a(document).scrollLeft() + 50 ? "e" : "w";
    };
    a.fn.tipsy.autoNESW = function() {
        var b = a(this);
        var c = b.offset().left > a(document).scrollLeft() + 50 ? "e" : "w";
        var d = b.offset().top > a(document).scrollTop() + 50 ? "s" : "n";
        return d + "" + $ew;
    };
    a.fn.tipsy.autoBounds = function(b, c) {
        return function() {
            var d = {
                ns: c[0],
                ew: c.length > 1 ? c[1] : false
            }, e = a(document).scrollTop() + b, f = a(document).scrollLeft() + b, g = a(this);
            if (g.offset().top < e) d.ns = "n";
            if (g.offset().left < f) d.ew = "w";
            if (a(window).width() + a(document).scrollLeft() - g.offset().left < b) d.ew = "e";
            if (a(window).height() + a(document).scrollTop() - g.offset().top < b) d.ns = "s";
            return d.ns + (d.ew ? d.ew : "");
        };
    };
})(jQuery);

PP.library._Attachment = PP.Class.extend({
    getFields: function() {
        var a = [ {
            name: "_id",
            description: "Internal GUID"
        }, {
            name: "owner",
            description: "User_id of the attachment owner (internal use)"
        }, {
            name: "deleted",
            description: 'flag for deleted / "hanging" attachments.'
        }, {
            name: "filename",
            description: "File name (including extension, i.e. my_file.pdf)"
        }, {
            name: "mimeType",
            description: "MIME type of the file"
        }, {
            name: "source_filename",
            description: 'The "source" filename, i.e. the original filename of the attached or downloaded file.'
        }, {
            name: "article_pdf",
            description: "Flags an attachment as the article PDF. 1 if yes, otherwise 0."
        }, {
            name: "pub_id",
            description: "The Paperpile GUID of the associated publication object."
        }, {
            name: "pub_trashed",
            description: "1 if the associated pub is trashed."
        }, {
            name: "filesize",
            description: "File size (in bytes)"
        }, {
            name: "md5",
            description: "MD5 checksum of the file contents"
        }, {
            name: "description",
            description: "Description of the attachment (if any)"
        }, {
            name: "gdrive_id",
            description: "ID of the cloud backup of the file (if any)"
        }, {
            name: "gdrive_needs_sync",
            description: "Flag indicating whether google drive still needs to be synced."
        }, {
            name: "gdrive_trashed",
            description: "ID of the cloud backup of the file (if any)"
        }, {
            name: "gdrive_deleted",
            description: "ID of the cloud backup of the file (if any)"
        }, {
            name: "subfolders",
            description: "List of subfolders this article should be stored in Google Drive."
        }, {
            name: "web_url",
            description: "Online URL of the file (if any)"
        }, {
            name: "download_progress",
            description: "The current download progress (if attachment is being downloaded)"
        }, {
            name: "download_status",
            description: "The download state of the attachment (if being downloaded)"
        } ];
        return a;
    },
    autoClean: function(a, b) {
        if (!b._id) {
            b._id = PP.UUID.generate();
        }
        var c = PP.Utils.clone(b);
        b.pub_id = a._id;
        b.owner = a.owner;
        if (b.owner === undefined) {}
        if (b.pub_id === undefined) {
            throw new Error("Attachment pub_id cannot be undefined!");
        }
        if (b.gdrive_needs_sync === undefined) {
            b.gdrive_needs_sync = 1;
        }
        if (b.pub_trashed === undefined) {
            b.pub_trashed = 0;
        }
        b.subfolders = a.subfolders || [];
        if (!b.filename) {
            b.filename = this.getDefaultFilename(a, b);
        } else {
            b.filename = this.ensureFilenameContainsAuthorYear(a, b);
        }
        b.filename = this.removeFilenameDoubleSuffix(b);
        b.filename = PP.Utils.cleanFileName(b.filename);
        var d = b.mimeType;
        if (this.couldBePdf(b)) {
            var e = PP.library.Publication.getPdfAttachment(a);
            if (!e) {
                b.article_pdf = 1;
                b.source_filename = "[article_pdf].pdf";
                b.filename = this.getDefaultFilename(a, b);
                b.filename = PP.Utils.cleanFileName(b.filename);
            }
        }
        if (this.couldBePdf(b)) {
            b.filename = this.ensureFilenameHasPdfSuffix(b);
        }
        if (!PP.Utils.deepEquals(c, b)) {
            b.hasUpdates = true;
        }
    },
    removeFilenameDoubleSuffix: function(a) {
        var b = a.filename;
        var c = /\.([^\.]{1,5})\.(\1)$/;
        if (b && b.match(c)) {
            var d = "." + RegExp.$1 + "." + RegExp.$2;
            var e = "." + RegExp.$1;
            b = b.replace(d, e);
        }
        return b;
    },
    ensureFilenameHasPdfSuffix: function(a) {
        var b = a.filename;
        if (b && !b.match(/\.pdf$/i)) {
            b = b + ".pdf";
        }
        return b;
    },
    ensureFilenameContainsAuthorYear: function(a, b) {
        var c = b.filename;
        if (b.source_filename === "[article_pdf].pdf" && b.article_pdf == 1) {
            return this.getDefaultFilename(a, b);
        }
        var d = PP.library.Publication.formatAuthorYear(a);
        var e = new RegExp(PP.Utils.escapeRegex(d) + " - ", "i");
        if (!c.match(e)) {
            if (c.match(/^(\w+\s+){1,4}- /)) {
                c = c.replace(/^(\w+\s+){1,4}- /, "");
            }
            c = d + " - " + c;
        }
        return c;
    },
    getDefaultFilename: function(a, b) {
        var c = b.source_filename;
        var d = /(?:\.([^.]+))?$/;
        var e = d.exec(c)[1];
        var f = PP.library.Publication.formatAuthorYear(a);
        var g;
        if (!a.title) {
            g = "[No title]";
        } else {
            g = PP.Utils.ellipsis(a.title, 200, false, "[...]");
        }
        var h;
        if (c === "[article_pdf].pdf") {
            g = g.replace(/\.pdf$/i, "");
            h = f + " - " + g + "." + e;
        } else {
            h = f + " - " + c;
        }
        h = PP.String.interconvertString(h, {
            format: "nomarkup"
        });
        return h;
    },
    couldBePdf: function(a) {
        var b = false;
        if (a.filename && a.filename.match(/\.pdf/gi)) {
            b = true;
        }
        if (a.mimeType && a.mimeType.match(/application.pdf/i)) {
            b = true;
        }
        return b;
    },
    getSyncServiceLink: function(a, b) {
        if (b !== "gdrive") {
            console.error("Only support gdrive for now!");
        }
        if (b === "gdrive") {
            var c = [];
            a.forEach(function(a) {
                if (a.gdrive_id) {
                    c.push(a.filename);
                }
            });
            var d = "https://drive.google.com/#search/";
            var e = [];
            c.forEach(function(a) {
                e.push('title:"' + a + '"');
            });
            query = e.join(" OR ");
            query = encodeURIComponent(query);
            d += query;
            return {
                n_links: c.length,
                url: d
            };
        }
    },
    openAttachment: function(a, b) {
        var c = a.pub;
        var d;
        if (a.attachment) {
            d = a.attachment;
        } else if (a.attachment_id) {
            d = PP.library.Publication.getAttachment(c, a.attachment_id);
        } else {
            throw new Error("No attachment or attachment_id!");
        }
        var e = a.preferredViewer;
        if (!e) {
            e = PP.backend.Settings.get("pubview_preferredViewer");
        }
        if (window && window.UAParser) {
            var f = new UAParser();
            var g = f.getResult();
            if (g && g.browser && "major" in g.browser) {
                if (e == "pubview" && g.browser.major == "55") {
                    e = "raw";
                }
            }
        }
        if (e == "drive" && this.isSynced(d)) {
            b.openDrive(a);
        } else if (e == "raw") {
            b.openRaw(a);
        } else if (e == "saveToDisk") {
            b.saveToDisk(a);
        } else if (e == "metapdf" && PP.backend.Attachments.canShowInPubView(d)) {
            b.openMetaPDF(a);
        } else {
            if (this.isSynced(d) && this.worksBestInDriveViewer(d)) {
                b.openDrive(a);
            } else if (PP.backend.Attachments.canShowInPubView(d)) {
                b.openPubView(a);
            } else {
                b.openRaw(a);
            }
        }
    },
    canShowInPubView: function(a) {
        return this.isPdfAttachment(a);
    },
    isPdfAttachment: function(a) {
        return a.article_pdf == 1 || a.mimeType && a.mimeType.match(/pdf/i) || a.filename && a.filename.match(/\.pdf$/i);
    },
    worksBestInDriveViewer: function(a) {
        var b = [ "doc", "docx", "eps", "odt", "svg", "xls", "xlsx" ];
        var c = false;
        b.forEach(function(b) {
            var d = new RegExp("." + b + "$", "i");
            if (a.filename && a.filename.match(d)) {
                c = true;
            }
        });
        return c;
    },
    isSynced: function(a) {
        return a.gdrive_id ? true : false;
    },
    getPubViewUrl: function(a) {
        var b;
        if (a.article_pdf == 1) {
            b = PP.Globals.url("/view/" + a.pub_id);
        } else {
            b = PP.Globals.url("/view/file/" + a._id);
        }
        return b;
    },
    getDriveDesktopWebUrl: function(a) {
        if (!this.isSynced(a)) {
            return null;
        }
        var b = "https://docs.google.com/file/d/" + a.gdrive_id + "/edit";
        return b;
    },
    getDriveMobileWebUrl: function(a) {
        if (!this.isSynced(a)) {
            return null;
        }
        var b = "https://docs.google.com/viewer?a=v&pid=explorer&srcid=" + a.gdrive_id;
        return b;
    },
    getDriveDownloadUrl: function(a) {
        if (!this.isSynced(a)) {
            return null;
        }
        var b = "https://drive.google.com/uc?export=download&id=" + a.gdrive_id;
        return b;
    },
    getDriveRawContentUrl: function(a) {
        if (!this.isSynced(a)) {
            return null;
        }
        var b = "https://drive.google.com/uc?id=" + a.gdrive_id;
        return b;
    },
    addViewDrivePermissions: function(a, b) {
        if (this.isSynced(a)) {
            PP.Utils.callback(b, null, [ null, "Attachment is not synced!" ]);
            return;
        }
        var c = this.getSharedAttachmentUrl(a);
        c += "?no_redirect=1";
        var d = PP.Ajax.request({
            url: c,
            trackRedirects: true,
            progress: function(a) {
                d.abort();
            },
            callback: function(a, c, d) {
                if (c !== "success") {
                    PP.Utils.callback(b, null, [ null, d.status ]);
                } else {
                    PP.Utils.callback(b, null, [ a, null ]);
                }
            }
        });
    },
    getPubViewAttachmentUrl: function(a) {
        return this.getSharedAttachmentUrl(a, "pubview");
    },
    getSharedAttachmentUrl: function(a, b) {
        var c = PP.Globals.getUrlBase();
        if (!b) {
            b = "internal";
        }
        var d = a._id;
        return c + "/shared/" + b + "/download/" + d;
    }
});

PP.library.Attachment = new PP.library._Attachment();

PP.library._Author = PP.Class.extend({
    getFields: function() {
        var a = [ {
            name: "last"
        }, {
            name: "first"
        }, {
            name: "jr"
        }, {
            name: "initials"
        }, {
            name: "collective"
        }, {
            name: "bak"
        }, {
            name: "formatted"
        }, {
            name: "_id"
        } ];
        return a;
    },
    toBibtex: function(a) {
        if (a.collective === "others") {
            return "{" + a.collective + "}";
        } else if (a.collective) {
            return "{" + a.collective + "}";
        } else {
            var b = [];
            if (a.last && a.first) {
                b.push(a.last);
                if (a.jr) b.push(a.jr);
                b.push(a.first);
                return b.join(", ");
            } else if (a.last && a.initials) {
                b.push(a.last);
                if (a.jr) b.push(a.jr);
                b.push(a.initials);
                return b.join(", ");
            } else if (a.last) {
                return "{" + a.last + "}";
            } else if (a.first) {
                return "{" + a.first + "}";
            } else if (a.initials) {
                return "{" + a.initials + "}";
            }
        }
        return "";
    },
    toRis: function(a) {
        if (a.collective === "others") {
            return a.collective;
        } else if (a.collective) {
            return a.collective;
        } else {
            var b = [];
            if (a.last && a.first) {
                b.push(a.last);
                b.push(a.first);
                if (a.jr) b.push(a.jr);
                return b.join(", ");
            } else if (a.last && a.initials) {
                b.push(a.last);
                b.push(a.initials);
                if (a.jr) b.push(a.jr);
                return b.join(", ");
            } else if (a.last) {
                return a.last + ", ";
            } else if (a.first) {
                return ", " + a.first;
            } else if (a.initials) {
                return ", " + a.initials;
            }
        }
        return "";
    },
    toCSL: function(a) {
        var b = {};
        if (a.collective && a.collective === "others") {
            return null;
        } else if (a.collective) {
            b.family = PP.String.removeControlChars(a.collective);
            return b;
        }
        if (a.first && a.first != "") {
            b.given = PP.String.removeControlChars(a.first);
        }
        if (a.last && a.last != "") {
            b.family = PP.String.removeControlChars(a.last);
        }
        if (a.jr) {
            b.suffix = PP.String.removeControlChars(a.jr);
        }
        if (!b.given && a.initials != "") {
            b.given = PP.String.removeControlChars(a.initials);
        }
        if (b.given && !b.family) {
            b.family = b.given;
            delete b.given;
        }
        this.removeCommas(b, "given");
        this.removeCommas(b, "family");
        this.addPeriods(b);
        return b;
    },
    addPeriods: function(a) {
        if (!a.given) return;
        var b = a.given.split(/\s+/);
        for (var c = 0; c < b.length; c++) {
            if (b[c].match(/^.$/)) {
                b[c] += ".";
            }
        }
        a.given = b.join(" ");
    },
    removeCommas: function(a, b) {
        if (a[b] && a[b].match(/,/g)) {
            a[b] = a[b].replace(/,/g, "");
        }
    },
    toString: function(a, b) {
        var c = {
            prefixWrap: "",
            suffixWrap: "",
            prefix: "",
            suffix: "",
            delim: ",",
            includeItalics: true,
            output: "display",
            etAl: false,
            othersString: "et al."
        };
        if (b === undefined) {
            b = c;
        } else {
            PP.Utils.applyIf(b, c);
        }
        if (!a) {
            return "";
        }
        if (PP.Utils.isArray(a)) {
            if (b.etAl) {
                var d;
                if (a.length > 2) {
                    var e = this.toString(a[0], b);
                    if (b.includeItalics) {
                        e += " <i>et al.</i>";
                    } else {
                        e += " et al.";
                    }
                    return e;
                } else {
                    d = PP.Array.map(a, function(a) {
                        return this.toString(a, b);
                    }, this);
                    return d.join(" and ");
                }
            } else {
                var d = PP.Array.map(a, function(a) {
                    return this.toString(a, b);
                }, this);
                if (b.prefixWrap != "") {
                    var e = "";
                    for (var f = 0; f < d.length; f++) {
                        if (f < d.length - 1) {
                            e += b.prefixWrap + d[f] + b.delim + b.suffixWrap + " ";
                        } else {
                            e += b.prefixWrap + d[f] + b.suffixWrap;
                        }
                    }
                    return e;
                } else {
                    return d.join(b.delim);
                }
            }
        }
        var g = a.first, h = a.collective, i = a.last, j = a.initials, k = a.jr, l = a._id;
        var m = [];
        if (h) {
            if (b.output === "serialize" || b.output === "forDiff") {
                m.push("{" + h + "}");
            } else if (h === "others") {
                m.push(b.othersString);
            } else {
                m.push(h);
            }
        } else {
            if (b.output === "serialize") {
                if (i) {
                    m.push(i);
                }
                if (k) {
                    m.push(" " + k);
                }
                if (g || j) {
                    m.push(", ");
                    m.push(g || j);
                }
            }
            if (b.output === "full") {
                if (g) {
                    m.push(g);
                }
                if (!g && j) {
                    m.push(j);
                }
                if (i) {
                    m.push(i);
                }
                if (k) {
                    m.push(k);
                }
            } else if (b.output === "forDiff") {
                if (g) {
                    m.push(g);
                }
                if (!g && j) {
                    m.push(j);
                }
                m.push(",");
                if (i) {
                    m.push(i);
                }
                m.push(",");
                if (k) {
                    m.push(k);
                }
            } else if (b.output === "display") {
                if (i) {
                    m.push(i);
                }
                if (k) {
                    m.push(k);
                }
                if (j) {
                    m.push(j);
                }
            } else if (b.output === "last") {
                if (h) {
                    m.push(h);
                } else if (i) {
                    m.push(i);
                }
            } else if (b.output === "firstlast") {
                if (g) {
                    m.push(g);
                }
                if (i) {
                    m.push(i);
                }
            }
        }
        var n;
        if (b.output === "serialize") {
            n = m.join("");
        } else {
            n = m.join(" ");
        }
        if (h === "others" && b.othersString === "et al." && b.prefix && b.prefix.match(/span/i)) {
            n = " <i>" + n + "</i>";
        } else {
            if (b.prefix) {
                n = b.prefix + n;
            }
            if (b.suffix) {
                n = n + b.suffix;
            }
        }
        n = n.replace(/{_id}/g, l);
        return n;
    },
    hasValue: function(a) {
        return PP.Utils.isArray(a) && a.length > 0;
    },
    parseAuthorList: function(a, b) {
        var c = {
            delimiter: ",",
            commasWithinNames: false,
            familyNameFirst: true,
            auto: false
        };
        b = PP.Utils.apply(c, b);
        var d = [];
        a = a.replace(/\s+/g, " ");
        a = a.replace(/[,;:]\s*$/, "");
        if (b.auto) {
            var e = {};
            var f = a.split("");
            for (var g = 0; g < f.length; g++) {
                if (!f[g].match(/[,;:]/)) continue;
                if (!e[f[g]]) e[f[g]] = 0;
                e[f[g]]++;
            }
            var h = [];
            for (var i in e) {
                h.push({
                    key: i,
                    cnt: e[i]
                });
            }
            if (h.length > 0) {
                h = h.sort(function(a, b) {
                    return b.cnt - a.cnt;
                });
                b.delimiter = h[0].key;
                if (h.length > 1) {
                    if (h[0].key == "," && h[1].key == ";") {
                        if (h[1].cnt / h[0].cnt >= .5) {
                            b.delimiter = ";";
                        }
                    }
                }
            }
            var j = new RegExp("(?:" + b.delimiter + "|\\s+and\\s+|\\s+&\\s+)");
            f = a.split(j);
            var k = [];
            for (var g = 0; g < f.length; g++) {
                if (f[g] === "") continue;
                if (f[g].match(/^\s+$/)) continue;
                if (!f[g].match(/[A-Z]/i)) continue;
                f[g] = f[g].replace(/^\s+/, "");
                f[g] = f[g].replace(/\s+$/, "");
                var l = {
                    text: f[g],
                    anno: "N"
                };
                if (l.text.match(/^([A-Z]{1,2}\.?\s*)+$/)) {
                    l.anno = "I";
                } else if (l.text.match(/^([A-Z]{1,2}\.?\s*)+\s/)) {
                    if (l.text.match(/[A-Z][a-z]+/) || l.text.match(/[a-z]+\s/)) {
                        l.anno = "B";
                    }
                }
                if (l.anno == "N") {
                    if (l.text.match(/\s+([A-Z]{1,2}\.?\s*)+$/)) {
                        if (l.text.match(/[A-Z][a-z]+/) || l.text.match(/[a-z]+\s/)) {
                            l.anno = "A";
                        }
                    } else {
                        if (l.text.match(/[A-Z][a-z]+/) || l.text.match(/[a-z]+\s/)) {
                            l.anno = "L";
                        }
                    }
                }
                if (l.anno == "L") {
                    var m = 0;
                    var n = 0;
                    l.text.split(/\s+/).forEach(function(a) {
                        if (a.match(/^[A-Z][a-z]/)) m++;
                        if (a.match(/^[A-Z]\.?$/)) n++;
                    });
                    if (m > 1 && m <= 3 && n <= 1) {
                        l.anno = "D";
                    }
                }
                if (l.text.match(/^The\s/)) {
                    l.anno = "C";
                }
                if (l.text.match(/(consortium|group|ENCODE|FANTOM|ATLAS)/i)) {
                    l.anno = "C";
                }
                k.push(l);
            }
            while (k.length > 0) {
                var o = k.shift();
                if (o.anno === "C") {
                    d.push({
                        collective: o.text
                    });
                } else if (o.anno === "B" || o.anno === "D") {
                    d.push(this.parseAuthor(o.text, {
                        familyNameFirst: false
                    }));
                } else if (o.anno === "A") {
                    d.push(this.parseAuthor(o.text, {
                        familyNameFirst: true
                    }));
                } else if (o.anno === "I") {
                    if (k[0] && k[0].anno === "L") {
                        var p = k.shift();
                        d.push({
                            last: p.text,
                            first: o.text
                        });
                    }
                } else if (o.anno === "L") {
                    if (k[0] && k[0].anno === "I") {
                        var p = k.shift();
                        d.push({
                            last: o.text,
                            first: p.text
                        });
                    }
                }
            }
        } else {
            var f = a.split(b.delimiter);
            if (b.delimiter === "," && b.commasWithinNames === true) {
                var q = [];
                for (var g = 1; g < f.length; g++) {
                    if ((g + 1) % 2 === 0) {
                        q.push(f[g - 1] + f[g]);
                    }
                }
                f = q;
            }
            for (var g = 0; g < f.length; g++) {
                d.push(this.parseAuthor(f[g], b));
            }
        }
        return d;
    },
    parseAuthor: function(a, b) {
        var c, d;
        var e = {
            familyNameFirst: true
        };
        b = PP.Utils.apply(e, b);
        if (PP.Utils.isArray(a)) {
            var f = PP.Array.map(a, function(a) {
                return this.parseAuthor(a, b);
            }, this);
            return f;
        }
        var g = this._parseAuthorStringHelper(a, b);
        if (g.level === undefined) {
            g.collective = g.bak;
        }
        this.autoClean(g);
        return g;
    },
    getFirstNameStopRegex: function() {
        return /^(aus|auf|da|das|de|del|der|do|dos|la|las|van|von|von|zu|)$/i;
    },
    autoClean: function(a) {
        var b = this.getFields();
        for (var c = 0; c < b.length; c++) {
            var d = b[c].name;
            if (a[d]) {
                a[d] = a[d].replace(/^\s*/, "");
                a[d] = a[d].replace(/\s*$/, "");
                a[d] = PP.Utils.replaceU0308(a[d]);
                a[d] = PP.Utils.replaceControlChars(a[d]);
            }
        }
        if (a.first !== undefined) {
            var e = a.first;
            e = e.replace(/\./g, " ");
            e = e.replace(/\s+$/, "");
            if (!a.initials && e.length > 0 && e.length < 4 && e.toUpperCase() === e) {
                a.initials = e;
                a.initials = a.initials.replace(/-/g, "");
                a.first = e;
            } else {
                var f = a.first.replace(/\./g, ". ");
                f = f.replace(/\s+$/, "");
                var g = f.split(/\s+/);
                for (c = 0; c < g.length; c++) {
                    g[c] = g[c].replace(/\.$/, "");
                    if (g[c].length <= 2) {
                        continue;
                    }
                    var h = g[c].split(/\s*-\s*/);
                    for (var i = 0; i < h.length; i++) {
                        if (h[i].match(this.getFirstNameStopRegex())) {} else {
                            h[i] = this.wordToLowerCase(h[i]);
                        }
                    }
                    g[c] = h.join("-");
                }
                a.first = g.join(" ");
                a.first = a.first.replace(/(.+)\s+(-\S.*)/g, "$1$2");
            }
        }
        if (a.first === undefined && a.initials !== undefined && PP.Utils.isString(a.initials)) {
            a.first = a.initials;
        }
        if (a.first !== undefined && PP.Utils.isString(a.first)) {
            var h = a.first.split(/\s+/);
            for (var i = 0; i < h.length; i++) {
                if (h[i].match(/^[A-Z]{1,2}$/)) {
                    h[i] = h[i].split("").join(" ");
                }
            }
            a.first = h.join(" ");
        }
        if (a.last !== undefined && PP.Utils.isString(a.last)) {
            if (a.last.match(/^[A-Z\u00C0-\u00D6\u00D8-\u00DD\xdf\s\-]+$/) || a.last.toUpperCase() === a.last) {
                g = [ a.last ];
                if (a.last.match(/-/)) {
                    g = a.last.split(/\s*-\s*/);
                }
                for (c = 0; c < g.length; c++) {
                    h = [ g[c] ];
                    if (g[c].match(/\s/)) {
                        h = g[c].split(/\s+/);
                    }
                    for (i = 0; i < h.length; i++) {
                        if (h[i].match(/^(del|de\sla|de|da|do)$/i)) {
                            h[i] = h[i].toLowerCase();
                        } else {
                            h[i] = this.wordToLowerCase(h[i]);
                        }
                    }
                    g[c] = h.join(" ");
                }
                a.last = g.join("-");
            }
            if (a.last.match(/^[a-z\s]+$/)) {
                a.last = PP.String.upperFirst(a.last);
            }
        }
        if (a.first !== undefined && PP.Utils.isString(a.first)) {
            if (a.first.match(/^[a-z\s]+$/)) {
                a.first = PP.String.upperFirst(a.first);
            }
        }
        if (a.last) {
            var j = a.last.match(/(.*)(\sJr\.?|\sV|\sIV|\sIII|\s3rd|\sII|\s2nd)$/i);
            if (j !== null && j.length >= 3) {
                a.jr = j[2];
                a.jr = PP.Utils.strip(a.jr);
                a.last = j[1];
                a.last = a.last.replace(/,?\s*$/, "");
            }
        }
        if (!a.initials) {
            this.loadInitials(a);
        } else {
            this.cleanInitials(a);
        }
        if (!a.formatted) {
            this.loadFormatted(a);
        }
        if (!a._id) {
            a._id = PP.UUID.generate();
        }
    },
    isInitials: function(a) {
        return a.match(/^([A-Z]\.?){1,4}$/);
    },
    loadFormatted: function(a) {
        a.formatted = this.toString(a, {
            output: "display"
        });
    },
    loadInitials: function(a) {
        var b = this;
        var c = "";
        var d = a.first;
        if (d && this.isInitials(d)) {
            c = d.replace(/[\.\s\-]/g, "");
            a.initials = c;
            return;
        }
        var e = [];
        if (d) {
            var f = d.replace(/-/g, " ");
            e = f.split(/\s+/g);
        }
        e = e.filter(function(a) {
            if (a.match(b.getFirstNameStopRegex())) {
                return false;
            } else {
                return true;
            }
        });
        if (e.length > 2) {
            e = [ e[0], e[1] ];
        }
        c = "";
        var g = /([A-Z\u00C0-\u00DF]+)/;
        var h = /(\w)\w+/;
        for (var i = 0; i < e.length; i++) {
            var j = e[i];
            var k = g.exec(j);
            var l = h.exec(j);
            if (k && k.length > 0) {
                c += k[0];
            } else if (l && l.length > 0) {
                c += l[0];
            }
        }
        c = c.replace(/[\.\s\-]/g, "");
        a.initials = c;
    },
    cleanInitials: function(a) {
        var b = a.initials;
        b = b.replace(/\./g, "");
        b = b.replace(/\s/g, "");
        a.initials = b;
    },
    _parseAuthorStringHelper: function(a, b) {
        var c = {
            first: undefined,
            last: undefined,
            collective: undefined,
            jr: undefined,
            level: undefined,
            bak: undefined
        };
        if (a && a.match(/\{(.*?)\}/i)) {
            c.collective = RegExp.$1;
            c.level = "collective";
            c.bak = a;
            return c;
        }
        if (b.collective) {
            c.collective = a;
            c.level = "collective";
            c.bak = a;
            return c;
        }
        var d = [ "Op\\sde", "van\\sder", "von\\sder", "von\\szu", "van\\sde", "van\\sden", "auf\\sden", "de\\sla", "de\\slas" ];
        var e = [ "al", "au", "af", "el", "do", "del", "della", "dello", "des", "da", "de", "di", "dos", "du", "la", "le", "lo", "les", "Mc", "lou", "pietro", "st.", "st", "ter", "vanden", "van", "vel", "ver", "vere", "vom", "von", "zur", "ten", "te", "den", "sir" ];
        var f = {
            Andreas: 1,
            Bruno: 1
        };
        var g = "([A-Z\x80-\u017f\u0400-\u042f]\\.?)";
        var h = new RegExp([ "^", g, "{1,3}", "$" ].join(""), "");
        var i = new RegExp("^[A-Z\x80-\u017f\u0400-\u042f]\\.?$", "");
        var j = new RegExp("(.+)\\s(" + d.join("|") + ")\\s(.+)", "i");
        var k = new RegExp("^(" + d.join("|") + ")\\s(.+)\\s([A-Z]{1,3})$", "");
        var l = new RegExp("(.+)\\s(" + e.join("|") + ")\\s(.+)", "i");
        var m = new RegExp("^(" + e.join("|") + ")\\s(.+)\\s([A-Z]{1,3})$", "i");
        var n = new RegExp("^[A-Z-]*$");
        var o = 0;
        while (a.match(/\d\s*$/)) {
            a = a.replace(/(.*)(\s*,\s*\d+\s*)$/g, "$1");
            a = a.replace(/(.*)(\s*\d+\s*)$/g, "$1");
            o++;
            if (o > 10) break;
        }
        a = a.replace(/^\s+/, "");
        a = a.replace(/\s+$/, "");
        a = a.replace(/\s+/g, " ");
        a = a.replace(/\s-\s/, "-");
        a = a.replace(/^Prof\.\s*/, "");
        a = a.replace(/^Dr\.\s*/, "");
        a = a.replace(/,?\s?Ph\.?\s?D\.?$/i, "");
        a = a.replace(/,?\s?D.?\s?Phil\.?$/i, "");
        a = a.replace(/,?\s?M\.?D\.?$/i, "");
        a = a.replace(/,?\s?Pharm\.?\s?D\.$/i, "");
        a = a.replace(/,\s?Dr\.?$/, "");
        a = a.replace(/,\s?Professor$/i, "");
        c.bak = a;
        var p = a.match(/(.*)(\sJr\.?|\sSr\.?|\sII|\sIII|\sIV|\s1st|\s2nd|\s3rd|\s4th|\s5th)$/i);
        if (p !== null) {
            var q = 0;
            var r = d.concat(e);
            p[1].split(/\s+/).forEach(function(a) {
                var b = 1;
                d.concat(e).forEach(function(c) {
                    if (c.toUpperCase() == a.toUpperCase()) {
                        b = 0;
                    }
                });
                if (b) q++;
            });
            var s = 0;
            if (p[2].match(/I/)) {
                if (p[1].match(/.*,.*,.*/)) {
                    s = 1;
                }
            } else {
                if (q >= 2) {
                    s = 1;
                }
            }
            if (s) {
                c.jr = p[2];
                a = p[1];
                a = a.replace(/,?\s*$/, "");
            }
        }
        p = a.match(/(.+),\s*(Jr\.?|Sr\.?|II|III|IV|1st|2nd|3rd|4th|5th)\s*,\s*(.+)/i);
        if (p !== null && p.length == 4) {
            c.jr = p[2];
            a = p[1] + ", " + p[3];
        }
        var t = [ "Consortium", "Group", "Member", "Network", "Cancer", "Association", "American", "Committee", "Initiative", "Investigators", "Society", "Collaborators", "Cohort", "Clinical", "Supreme Court", "Court of", "Canadian", "Centers for", "Team", "Working Party", "Editorial", "European", "College", "Task Force", "Grupo", "Gruppo", "International", "National", "Council", "Platform", "U\\.S\\.", "United", "Organization", "Institute", "Corporation" ];
        var u = new RegExp("\\b(" + t.join("|") + ")\\b", "i");
        if (a.match(u)) {
            c.collective = a;
            c.level = "9.0";
            return c;
        }
        var v;
        if (a === "et al." || a === "et al") {
            c.collective = "others";
            c.level = "0.0 <et al.>";
            return c;
        }
        if (a.match(/,/)) {
            v = a.split(/,/);
            if (v.length === 2) {
                c.first = v[1];
                c.last = v[0];
                c.level = "0.0";
                return c;
            }
        }
        v = a.split(/\s+/);
        if (v.length === 2) {
            if (v[1].match(h) && !v[0].match(h) && !v[0].match(n)) {
                c.first = v[1];
                c.last = v[0];
                c.level = "0.9 <Last FM>";
                return c;
            }
            if (v[0].match(h) && !v[1].match(h) && !v[1].match(n)) {
                c.first = v[0];
                c.last = v[1];
                c.level = "0.9 <FM Last>";
                return c;
            }
            if (b.familyNameFirst === true) {
                c.first = v[1];
                c.last = v[0];
                c.level = "1.0 familyFirst";
            } else {
                c.first = v[0];
                c.last = v[1];
                c.level = "1.0 familyLast";
            }
            return c;
        }
        var w = a.match(j);
        var x = a.match(k);
        var y = a.match(l);
        var z = a.match(m);
        if (w !== null) {
            c.first = w[1];
            c.last = w[2] + " " + w[3];
            c.level = "1.1";
            return c;
        }
        if (x !== null) {
            c.first = x[3];
            c.last = x[1] + " " + x[2];
            c.level = "1.1a";
            return c;
        }
        if (y !== null) {
            c.first = y[1];
            c.last = y[2] + " " + y[3];
            c.level = "1.2";
            return c;
        }
        if (z !== null) {
            c.first = z[3];
            c.last = z[1] + " " + z[2];
            c.level = "1.2a";
            return c;
        }
        if (v.length === 3) {
            if (v[0].match(i) && !v[1].match(i)) {
                if (f[v[1]]) {
                    c.first = v[0] + " " + v[1];
                    c.last = v[2];
                } else {
                    c.first = v[0];
                    c.last = v[1] + " " + v[2];
                }
                c.level = "2.0";
                return c;
            }
            if (v[1].match(i) && v[2].match(i)) {
                c.first = v[1] + " " + v[2];
                c.last = v[0];
                c.level = "2.0.5";
                return c;
            }
            if (!v[0].match(i) && v[1].match(i)) {
                c.first = v[0] + " " + v[1];
                c.last = v[2];
                c.level = "2.1";
                return c;
            }
            if (v[0].match(i) && v[1].match(i)) {
                c.first = v[0] + " " + v[1];
                c.last = v[2];
                c.level = "2.2";
                return c;
            }
            if (!v[0].match(i) && !v[1].match(i)) {
                if (v[1] === "Ben" || v[1] === "Castro") {
                    c.first = v[0];
                    c.last = v[1] + " " + v[2];
                } else {
                    c.first = v[0] + " " + v[1];
                    c.last = v[2];
                }
                c.level = "2.3";
                return c;
            }
            if (v[1].match(/^[a-z]+$/)) {
                c.first = v[0] + " " + v[1];
                c.last = v[2];
                c.level = "2.4";
                return c;
            }
        }
        if (v.length === 4) {
            if (v[2].match(i)) {
                c.first = v[0] + " " + v[1] + " " + v[2];
                c.last = v[3];
                c.level = "3.1";
                return c;
            }
            if (v[1].match(i)) {
                if (f[v[2]]) {
                    c.first = v[0] + " " + v[1] + " " + v[2];
                    c.last = v[3];
                } else {
                    c.first = v[0] + " " + v[1];
                    c.last = v[2] + " " + v[3];
                }
                c.level = "3.1";
                return c;
            }
            if (v[0].match(i)) {
                if (f[v[1]] && f[v[2]]) {
                    c.first = v[0] + " " + v[1] + " " + v[2];
                    c.last = v[3];
                } else if (f[v[1]] && !f[v[2]]) {
                    c.first = v[0] + " " + v[1];
                    c.last = v[2] + " " + v[3];
                } else {
                    c.first = v[0];
                    c.last = v[1] + " " + v[2] + " " + v[3];
                }
                c.level = "3.2";
                return c;
            }
            if (!v[0].match(i)) {
                c.first = v[0] + " " + v[1] + " " + v[2];
                c.last = v[3];
                c.level = "3.3";
                return c;
            }
        }
        if (v.length > 4 && v.length <= 6) {
            var A;
            for (var B = v.length - 1; B >= 0; B--) {
                if (v[B].match(i)) {
                    A = B;
                    break;
                }
            }
            if (A) {
                c.first = v.slice(0, A).join(" ");
                c.last = v.slice(A + 1, v.length - 1).join(" ");
                c.level = "4.0";
                return c;
            } else {
                c.first = v.slice(0, v.length - 2).join(" ");
                c.last = v.slice(v.length - 1, v.length - 1).join(" ");
                c.level = "4.1";
                return c;
            }
        }
        return c;
    },
    wordToLowerCase: function(a) {
        var b = a.charAt(0).toUpperCase();
        var c = a.substring(1, a.length).toLowerCase();
        return b + c;
    }
});

PP.library.Author = new PP.library._Author();

PP.library._BibliographicData = PP.Class.extend({
    rules: [ "_journal_ _monthNum_ \\/ _year_ _volume_ \\( _issue_ \\) : _pages_", "_journal_ _monthNum_ \\/ _year_ _volume_ : _pages_", "_journal_ _monthNum_ \\/ _year_ _volume_ \\( _issue_ \\)", "_journal_ _period_ _year_ _month_ _day_ ; _volume_ _issueParens_ : _pages_ _any_", "_journal_ _period_ _year_ _month_ _day_ _period_ _any_", "_journal_ _period_ _year_ _month_ _day_ ; _volume_ : _pages_ _any_", "_journal_ _period_ _volume_ _issueParens_ _seperator_ _pages_ _seperator_ _year_", "_journal_ _period_ _volume_ _issueParens_ _seperator_ _pages_ _seperator_ _month_ _year_", "_journal_ _period_ _volume_ _issueParens_ _seperator_ _pages_ _seperator_ _month_ _day_ _seperator_ _year_", "_journal_ _period_ _volume_ _seperator_ _pagesSingle_ _seperator_ _month_ _day_ _seperator_ _year_", "_journal_ _VOL_ _volume_ _PP_ _pagesSingle_ _yearAny_", "_journal_ _VOL_ _volume_ _PP_ _pages_ _yearAny_", "_journal_ _VOL_ _volume_ _NO_ _issue_ _PP_ _pages_ _yearAny_", "_journal_ _yearParens_ _volume_ _pages_", "_journal_ _volumeParens_ _pages_ _year_", "_journal_ _volume_ _issueParens_ _yearAny_ _pages_", "_journal_ _volume_ _issueParens_ _pages_ _yearAny_", "_journal_ _volume_ _issueParens_ _pagesSingle_ _yearAny_", "_journal_ _volume_ _yearParens_ _pages_", "_journal_ _volume_ _yearParens_ _pagesSingle_", "_journal_ _volume_ _pages_ _yearAny_", "_journal_ _volume_ _seperator_ _pagesSingle_ _seperator_ _yearAny_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ \\( _any_ _year_ \\) , pp\\. _pages_", "_journal_ _VOL_ _volume_ _NO_ _issue_ _year_ _pages_", "_journal_ , _any_ _year_ _seperator_ _PP_ _pages_ _VOL_ _volume_ _seperator_ _NO_ _issue_", ".* University Press _journal_ _seperator_ _year_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _pages_", "_journal_ VOL _volume_ \\S+ \\S+ _year_", ".* _year_ _VOL_ _volume_ _journal_", "_journal_ _VOL_ _volume_ _NO_ _issue_ \\S+ \\S+ _year_", ".* \\| _journal_ \\| _VOL_ _volume_ \\| .* _year_", "_journal_ _volume_ _seperator_ _pages_ Published .* _year_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ \\S+ _year_", "_journal_ _yearParens_ _volume_ _seperator_ _pages_", "_journal_ _yearParens_ _seperator_ _volume_ _seperator_ _pages_", "_journal_ _yearParens_ _volume_ _issueParens_ _seperator_ _pages_", "_journal_ _year_ _seperator_ _volume_ _issueParens_ _seperator_ _pages_", "_journal_ _year_ _month_ _seperator_ _volume_ _seperator_ _pages_", "_journal_ \\s _year_ _seperator_ _volume_ _seperator_ _pages_", "_journal_ _seperator_ _any_ _year_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _pages_", "_journal_ _seperator_ _year_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _pages_", "_journal_ _seperator_ _year_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _PP_ _pages_", "_journal_  _volume_ _seperator_ _month_ _year_ _seperator_ _PP_ _pages_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ \\S+ _year_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _year_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _pages_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _PP_ _pages_ _seperator_ _year_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _pages_ _seperator_ [^,]+ _seperator_ _year_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _pages_ _seperator_ \\S+ _year_", "_journal_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _any_ _seperator_ _PP_ _pages_ _seperator_ _year_", "_journal_ _volume_ _seperator_ _issue_ _seperator_ _pages_ _seperator_ .+\\/.+ _year_", "_journal_ _volume_ _issueParens_ _seperator_ _pages_ _seperator_ _year_", "_journal_ _volume_ _seperator_ _pages_ . _year_", "_journal_ _volume_ _seperator_ _pages_ _seperator_ [^,]+ _seperator_ _year_", "_journal_ _year_ , _volume_ : _pagesSingle_ $", "_journal_ _period_ _year_ _month_ _seperator_ _volume_ _issueParens_ _seperator_ _pages_", "_journal_ _month_ _year_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _pages_", "_journal_ _seperator_ _VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _PP_ _pages_ _seperator_ _month_ _year_", "_journal_ _seperator_ _volume_ _issueParens_ _seperator_ _pages_ _seperator_ _month_ .* _year_", "_journal_ _seperator_ _any_ _year_ _seperator_ _VOL_ _volume_ _issueParens_ _seperator_ _PP_ _pages_", "_journal_ _seperator_  _VOL_ _volume_ _issueParens_ _seperator_ _month_ _day_ _seperator_ _year_", "_journal_ _seperator_  _VOL_ _volume_ _seperator_ _NO_ _issue_ \\( _month_  _seperator_ _year_ \\) _seperator_ _pages_", "_journal_ _period_ _year_ _month_ _day_ _period_ _volume_ _issueParens_ p _period_ _pages_", "_place_ _colon_ _institution_ , _year_ _period_ _journal_ _semicolon_ _NO_ _number_", "_journal_ _period_ _PP_ _pages_ _period_ _period_", "_journal_ _period_ _any_ _VOL_ _volume_ , _issueParens_ _PP_ _pages_ _period_ _period_", "_journal_ _period_ _VOL_ _volume_ n _issue_ _PP_ _pages_ _month_ _year_", "_journal_ _period_ _VOL_ _volume_ n _issue_ p _any_ _month_ - _month_ _year_", "_journal_ _period_ _volume_ _issueParens_ \\( _PP_ _pages_ \\), _year_ _period_ _any_", "_journal_ _period_ Conference: _conference_ _year_ _period_ _conferenceLocation_ , _any_ _period_ Conference Start: _conferenceDate_ Conference End: _any_", "_journal_ _period_ _VOL_ _volume_ _issueParens_ _seperator_ _month_ _year_ _seperator_ _PP_ _pages_ _seperator_", "_journal_ _period_ _any_ _year_ _period_ Article Number: _number_ _period_ Date of Publication: _day_ _month_ _year_ _period_", "_journal_ _period_ _year_ _day_ _month_ _seperator_ _volume_ _issueParens_ _seperator_ _pages_", "_editor_ _period_ _yearParens_ _journal_ _period_ \\( _PP_ _pages_ \\) _any_ \\. _place_ _colon_ _institution_ _semicolon_ _any_", "_editor_ _semicolon_ _editor_ _period_ _yearParens_ _journal_ _period_ \\( _PP_ _pages_ \\) _any_ \\. _place_ _colon_ _institution_ _semicolon_ _any_", "_editor_ _semicolon_ _editor_ _semicolon_ _editor_ _period_ _yearParens_ _journal_ _period_ \\( _PP_ _pages_ \\) _any_ \\. _place_ _colon_ _institution_ _semicolon_ _any_", "_editor_ _semicolon_ _editor_ _semicolon_ _editor_ _semicolon_ _editor_ _period_ _yearParens_ _journal_ _period_ \\( _PP_ _pages_ \\) _any_ \\. _place_ _colon_ _institution_ _semicolon_ _any_", "_editor_ _semicolon_ _editor_ _semicolon_ _editor_ _semicolon_ _editor_ _semicolon_ _editor_ _period_ _yearParens_ _journal_ _period_ \\( _PP_ _pages_ \\) _any_ \\. _place_ _colon_ _institution_ _semicolon_ _any_", "_journal_ _period_ _volume_ _issueParens_ \\( _any_ _colon_ _any_ \\) _colon_ _pages_ , _month_ _year_", "_journal_ _period_ _volume_ _issueParens_ _colon_ _pagesSingle_ , _month_ _year_", "_journal_ _period_ _volume_ \\( _any_ \\) _colon_ _pages_ , _month_ _year_", "_journal_ _period_ _volume_ _issueParens_ _colon_ _pagesSingle_ , _month_ _day_ , _year_", "_journal_ _period_ _volume_ _issueParens_ \\( _any_ \\) _colon_ _pages_ , _month_ _year_", "_journal_ _period_ _volume_ _any_ _colon_ _pages_ , _month_ _any_ _year_", "_any_ \\. _title_ \\. _journal_ \\. _volume_ _issueParens_ _colon_ _pages_", "_journal_ _year_ Issue _NO_  , _any_ \\. _any_ \\. .*", "_any_ : _authors_ \\. _title_ \\. _journal_ \\. _pagesSingle_ _PP_ _year_", "_editor_ \\. \\( _any_ \\) \\. _journal_ \\. \\( _PP_ _pages_ \\) \\. _any_ _PP_ _place_ : _publisher_", "_journal_ _volume_ _issueParens_ _colon_ _pages_ , _any_ _year_", "_journal_ \\. _volume_ \\( _any_ \\) \\( _any_ \\) _colon_ _pagesSingle_ , _month_ _year_ .*", "_journal_ \\. _volume_ \\( _any_ \\) _colon_ _any_ , _month_ _year_ .*", "_journal_ \\. _volume_ \\( _any_ \\) _colon_ _pages_ , _any_ _year_", "_journal_ \\. _VOL_ _volume_ _issueParens_ \\. _PP_ _pages_ \\. _month_ _year_", "_publisher_ , Inc, _journal_ _colon_ _number_ \\. _year_", "_journal_ \\. _VOL_ _volume_ _issueParens_ \\. _PP_ _pages_ \\. _any_ _year_", "_journal_ \\. _volume_ , _year_", "_journal_ _VOL_ _volume_ _NO_ _issue_ _month_ _year_", "_authors_ _yearParens_ \\. _title_ \\. _journal_ , _volume_ _issueParens_ , _pages_", "_journal_ \\. _volume_ _any_ _colon_ _pages_ , _year_ _month_", "_journal_ \\[ _any_ \\] \\. _volume_ _issueParens_ _colon_ _pagesSingle_ , _year_", "_authors_ _yearParens_ \\. _title_ \\. In _editor_ , _journal_ \\( _PP_ _pagesSingle_ \\) \\. _place_ _colon_ _publisher_", "_journal _VOL_ _volume_ _NO_ _issue_ _PP_ _pages_ _month_ _year_", "_journal_ _VOL_ _volume_ _PP_ _pages_ _month_ _year_", "_journal_ _VOL_ _volume_ _PP_ _pages_ _year_", "_authors_ _year_ _title_", "_authors_ _year_ _title_ _pages_", "_journal_ _seperator_ _VOL_ _volume_ _issueParens_ _seperator_ _month_ _year_ _seperator_ _pages_", "_VOL_ _volume_ _seperator_ _NO_ _number_ _issueParens_ _seperator_ _year_ _month_ _day_ _seperator_ _PP_ _pages_ \\.", "_VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _year_ _month_ _seperator_ _PP_ _pagesSingle_", "_VOL_ _volume_ _seperator_ _NO_ _issue_ _seperator_ _pages_ _journal_" ],
    patterns: {
        any: "(.*)",
        year: "(\\d{4}[a-z]?)",
        yearParens: "\\((\\s?\\d{4}[a-z]?\\s?)\\)",
        yearAny: "\\(?(\\s?\\d{4}[a-z]?\\s?)\\)?",
        colon: ":",
        semicolon: ";",
        period: "\\.",
        seperator: "[\\.;,:\\|\u2013\u2014\\-]",
        stop: "[\\.\\?\\!:]",
        journal: "([^\\d\\|]+)",
        volume: "(\\d+[A-Z]?)",
        volumeParens: "\\((\\d+[A-Z]?)\\)",
        VOL: "([Vv]olume|VOLUME|VOL|[Vv]ol|v)\\.?",
        NO: "([Ii]ssue|ISSUE|[Nn]umber|NUMBER|NO|[Nn]o|n)\\.?",
        month: "(Jan|JAN|January|Feb|FEB|February|Mar|MAR|March|Apr|APR|April|May|MAY|June?|JUN|July?|JUL|Aug|AUG|August|Sep|SEP|September|Oct|OCT|October|Nov|NOV|November|Dec|DEC|December)\\.?",
        monthNum: "(0?1|0?2|0?3|0?4|0?5|0?6|0?7|0?8|0?9|10|11|12)",
        day: "(\\d+)",
        PP: "(p{1,2}\\.?|[Pp]ages?)",
        issue: "(\\d+[c]?)",
        issueParens: "\\((\\d+[c]?|\\d\\s*-\\s*\\d+)\\)",
        pages: "([RrEeSsNnAa]?\\d+[^\\/,]{1,3}[RrEeSsNn]?\\d+|e\\d+)",
        pagesSingle: "([RrEeSsNnAa]\\d+|\\d+)",
        title: "([^\\.]*?)",
        authors: "([\\w,\\.\\; \\n]+?)",
        place: "(.*)",
        institution: "(.*)",
        publisher: "(.*)",
        number: "([0-9]*)",
        conference: "(.*)",
        conferenceLocation: "(.*)",
        conferenceDate: "(.*)",
        editor: "(.+?)(?:\\[Ed\\]|\\(Ed.\\))"
    },
    getExtractors: function(a) {
        if (this._extractors) {
            return this._extractors;
        }
        this.extractors = [];
        for (var b = 0; b < this.rules.length; b++) {
            this.extractors.push(this.buildReferenceExtractor(b, this.rules[b], a));
        }
        return this.extractors;
    },
    buildReferenceExtractor: function(a, b, c) {
        var d = this;
        var e = b.split(/\s+/);
        var f = 1;
        var g = {};
        var h = [];
        if (c === undefined) {
            c = {
                authorParseParams: {
                    familyNameFirst: true,
                    commasWithinNames: false
                }
            };
        }
        e.forEach(function(a) {
            var b = a.replace(/_/g, "");
            if (d.patterns[b]) {
                var c = d.patterns[b];
                var e = false;
                if (c.match(/\(/)) {
                    e = true;
                }
                if (e) {
                    g[b] = f++;
                }
                h.push(c);
            } else {
                h.push(b);
            }
        });
        var i = new RegExp(h.join("\\s?"), "g");
        var j = {
            name: a,
            captureMap: g,
            regexp: i,
            params: c,
            getCount: function(a) {
                var b = 0, c = null;
                while ((c = this.regexp.exec(a)) !== null) {
                    b++;
                }
                return b;
            },
            getRefs: function(a, b) {
                var c = [], d = null;
                while ((d = this.regexp.exec(a)) !== null) {
                    var e = this.getData(d, b);
                    c.push(e);
                }
                return c;
            },
            getData: function(a, b) {
                var c = {};
                c._origText = a[0];
                c._extractor = this.name;
                var d = PP.Utils.apply(this.params.authorParseParams, b.authorParseParams);
                for (var e in this.captureMap) {
                    if (!e.match(/^(NO|VOL)$/)) {
                        var f = this.captureMap[e];
                        var g = a[f];
                        g = PP.Utils.strip(g);
                        var h = e;
                        switch (e) {
                          case "authors":
                            h = "author";
                            g = PP.library.Author.parseAuthorList(g, d);
                            break;

                          case "yearParens":
                            h = "year";
                            break;

                          case "yearAny":
                            h = "year";
                            break;

                          case "issueParens":
                            h = "issue";
                            break;

                          case "volumeParens":
                            h = "volume";
                            break;

                          case "pagesSingle":
                            h = "pages";
                            break;

                          case "monthNum":
                            h = "month";
                            break;

                          case "conferenceLocation":
                            h = "conference_location";
                            break;

                          case "conferenceDate":
                            h = "conference_date";
                            break;

                          default:
                            break;
                        }
                        c[h] = g;
                    }
                }
                return c;
            }
        };
        return j;
    },
    addExtractor: function(a, b, c) {
        this.extractors.push(this.buildReferenceExtractor(a, b, c));
    },
    parse: function(a, b) {
        var c = this;
        if (b === undefined) b = {};
        a = a.replace(/[\n\t\s]+/g, " ");
        a = a.replace(/^\s+/, "").replace(/\s+\.$/, "");
        a = a.replace(/^Source:\s*/, "");
        a = a.replace(/\s*www\.[a-z]+\.(org|com)\s*/, "");
        var d = null;
        if (a.match(/(.+)(10\.\d{4,5}\/[^\s]+)(.*)/)) {
            d = RegExp.$2;
            a = RegExp.$1 + RegExp.$3;
            a = a.replace(/\s+/g, " ");
        }
        var e = {};
        var f = 0;
        c.getExtractors(b).forEach(function(b) {
            var d = b.getRefs(a, {});
            if (d && d.length == 1) {
                var f = c.rateData(d[0]);
                if (f > 0 && f > c.rateData(e)) {
                    e = d[0];
                }
            }
        });
        if (d) {
            e.doi = d.replace(/[\.\s]*$/, "");
        }
        if (e.journal) {
            e.journal = e.journal.replace(/.*et\s+al\s+\.?\s+/, "");
            e.journal = e.journal.replace(/^[^A-Z]\s+/i, "");
            e.journal = e.journal.replace(/\s*[,;]+\s*$/, "");
            e.journal = e.journal.replace(/,\s+Vol[\.\s]*$/, "");
        }
        if (e.pages) {
            e.pages = e.pages.replace(/^(e\d+)\s.*/, "$1");
        }
        return e;
    },
    rateData: function(a) {
        var b = 0;
        if (a.journal) {
            if (!a.journal.match(/[A-Z]/i)) {
                return 0;
            }
            if (a.journal.length == 1) {
                return 0;
            }
            b += 3;
        }
        if (a.volume) b += 2;
        if (a.year) {
            var c = new Date();
            var d = parseInt(c.getFullYear());
            if (parseInt(a.year) > d + 2) {
                return 0;
            }
            b += 2;
        }
        if (a.pages) {
            if (a.pages.match(/(\d+)\s*[-\u2013]\s*(\d+)/)) {
                var e = RegExp.$1;
                var f = RegExp.$2;
                if (parseInt(f) - parseInt(e) > 1e3) {
                    return 0;
                }
                if (f.length < e.length) {
                    var g = e.slice(f.length * -1);
                    if (parseInt(g) > parseInt(f)) {
                        return 0;
                    }
                }
                b += 3;
            } else if (a.pages.match(/\d+\:\d+/)) {
                return 0;
            }
            if (a.year) {
                if (a.pages == a.year) {
                    return 0;
                }
            }
            b += 2;
        }
        if (a.month) b += 1;
        if (a.issue) {
            if (a.issue.match(/(\d+)\s*-\s*(\d+)/)) {
                var h = RegExp.$1;
                var i = RegExp.$2;
                if (parseInt(i) < parseInt(h)) {
                    return 0;
                }
            }
            b += 1;
        }
        if (a.doi) b += 1;
        return b;
    }
});

PP.library.BibliographicData = new PP.library._BibliographicData();

PP.library._BibliographicInferer = PP.Class.extend({
    parse: function(a) {
        var b = this;
        b.c = {
            str: a,
            pub: {
                pubtype: "PP_ARTICLE"
            },
            got: {},
            claimed: [],
            matches: {}
        };
        b.parseNumbers();
        b.parseStrings();
        b.useLastNumbers();
        b.postProcess();
        PP.library.Publication.autoClean(b.c.pub);
        return b.c.pub;
    },
    parseNumbers: function() {
        var a = this;
        a.c.matches.dashNumbers = a.matchAll(a.c.str, /\w?\d+\s?[\-\u2013]\s?\w?\d+/);
        a.c.matches.slashNumbers = a.matchAll(a.c.str, /\d+\/\d+/);
        a.c.matches.parensNumbers = a.matchAll(a.c.str, /\(\d+[\-\u2013\d]*\)/);
        a.c.matches.allNumbers = a.matchAll(a.c.str, /\d+[A-Z]?/);
        a.c.matches.yearNumbers = a.matchAll(a.c.str, /\d{4}/);
        a.c.matches.allNumberSegments = a.matchAll(a.c.str, /[\d\s\:\-\u2013\,\.\/\(\)]+/);
        a.c.matches.pagesP = a.matchAll(a.c.str, /[\(\s]p+a?g?e?s?\.?\s*\d+[\-\u2013]*\d*/i);
        a.c.matches.numPages = a.matchAll(a.c.str, /\d+\s?p+a?g?e?s?\.?/i);
        a.c.matches.yearMonthDays = a.matchAll(a.c.str, a.constructMonthRegEx("\\d{4}\\s", "\\.?\\s\\d{1,2}"));
        a.c.matches.monthDayYears = a.matchAll(a.c.str, a.constructMonthRegEx("", "\\.?\\s\\d{1,2},?\\s\\d{4}"));
        a.c.matches.dayMonthYears = a.matchAll(a.c.str, a.constructMonthRegEx("\\d{1,2}\\s", "\\.?,?\\s\\d{4}"));
        a.c.matches.yearDayMonths = a.matchAll(a.c.str, a.constructMonthRegEx("\\d{4}\\s\\d{1,2}\\s", "\\.?"));
        a.c.matches.monthYears = a.matchAll(a.c.str, a.constructMonthRegEx("", "\\.?,?\\s\\d{4}"));
        a.c.matches.yearMonths = a.matchAll(a.c.str, a.constructMonthRegEx("\\d{4},?\\s", ""));
        a.c.matches.monthDays = a.matchAll(a.c.str, a.constructMonthRegEx("", "\\.?\\s\\d{1,2}"));
        a.c.matches.plosPages = a.matchAll(a.c.str, /[ae]\d+/i);
        a.c.matches.volumeNumbers = a.matchAll(a.c.str, /\Wvo?l?u?m?e?\.?\s?\d+|^vo?l?u?m?e?\.?\s?\d+/i);
        a.c.matches.issueNumbers = a.matchAll(a.c.str, /\Wis?s?u?e?\.?\s?\d+|no?\.?\s?\d+|numb?e?r?\.?\:?\s\d+/i);
        a.getPages();
        a.getYears();
        a.getVolumeIssue();
    },
    parseStrings: function() {
        var a = this;
        a.c.matches.quotes = a.matchAll(a.c.str, /"[^"]+"/);
        a.c.matches.nonNumbers = a.matchAll(a.c.str, /[^\W\d][^\d]*[^\W\d]\.?\??\)?\]?/);
        a.c.matches.wordsAndSuch = a.matchAll(a.c.str, /[\w\.\,\s]+/);
        a.c.matches.dois = a.matchAll(a.c.str, /10\.\S+/);
        a.c.matches.publishers = a.matchAll(a.c.str, /published by [\w\.\,\s]+/i);
        a.getAuthorTitleJournal();
        a.getEditors();
        a.getPublisher();
        a.getJournal();
        a.getDoi();
    },
    useLastNumbers: function() {
        var a = this;
        var b = a.c.matches;
        var c = a.unused(b.yearNumbers);
        if (c.length === 1) {
            a.useSegment(c[0], "year", c[0][0]);
            d = a.unused(b.allNumbers);
        } else if (c.length > 1) {
            console.log("MORE THAN ONE UNUSED YEAR");
        }
        var d = a.unused(b.allNumbers);
        if (!a.c.pub.volume && a.c.pub.journal) {
            for (var e = 0; e < d.length; e++) {
                if (d[e].index === a.c.got.journal.index + a.c.got.journal[0].length + 1) {
                    a.useSegment(d[e], "volume", d[e][0]);
                    e = d.length;
                    d = a.unused(b.allNumbers);
                }
            }
        }
        if (a.c.pub.volume && !a.c.pub.issue) {
            for (var e = 0; e < d.length; e++) {
                if (d[e].index === a.c.got.volume.index + a.c.got.volume[0].length + 1 && a.c.str.charAt(a.c.got.volume.index + a.c.got.volume[0].length) !== ":") {
                    a.useSegment(d[e], "issue", d[e][0]);
                    e = d.length;
                    d = a.unused(b.allNumbers);
                }
            }
        }
        if (!a.c.pub.volume && d.length && a.c.pub.pubtype !== "PP_BOOK") {
            a.useSegment(d[0], "volume", d[0][0]);
            d = a.unused(b.allNumbers);
        }
        if ((a.c.pub.volume || a.c.pub.pubtype === "PP_BOOK") && !a.c.pub.pages && d.length) {
            a.useSegment(d[0], "pages", d[0][0]);
        }
    },
    postProcess: function() {
        var a = this;
        var b = a.c.pub;
        if (b.issue && !b.volume) {
            b.volume = b.issue;
            delete b.issue;
        }
        if (b.editor && b.editor.length && b.address && b.publisher) {
            b.pubtype = "PP_BOOK";
            delete b.volume;
            b.booktitle = b.journal;
            delete b.journal;
        }
        a.c.pub = b;
    },
    constructMonthRegEx: function(a, b) {
        var c = [ "january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december", "jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec" ];
        var d = "";
        for (var e = 0; e < c.length; e++) {
            d += a + c[e] + b;
            if (e != c.length - 1) d += "|";
        }
        return new RegExp(d, "i");
    },
    matchAll: function(a, b) {
        var c = a + "";
        var d = 0;
        var e = [];
        var f = c.match(b);
        while (f) {
            f.index += d;
            if (f[0].trim() !== "") e.push(f);
            c = a.substring(f.index + f[0].length);
            if (c && c.length) {
                d = f.index + f[0].length;
                f = c.match(b);
            } else {
                f = null;
            }
        }
        return e;
    },
    removePresses: function(a) {
        return a.replace(/^.*university press /i, "").trim();
    },
    removeHyperlinks: function(a) {
        return a.replace(/h?t?t?p?:?\/?\/?www\S+/i, "").trim();
    },
    removeAbbreviatedAuthors: function(a) {
        return a.replace(/^.*\set\.?\sal[\.\s]+/i, "").trim();
    },
    countInstances: function(a, b) {
        var c = 0;
        var d = a.match(new Regex(b, "g"));
        if (d) c = d.length;
        return c;
    },
    unused: function(a) {
        var b = this.c.claimed;
        var c = [];
        for (var d = 0; d < a.length; d++) {
            if (b.indexOf(a[d].index) < 0 && b.indexOf(a[d].index + a[d][0].length - 1) < 0) {
                c.push(a[d]);
            }
        }
        return c;
    },
    useSegment: function(a, b, c) {
        var d = this;
        if (d.c.pub[b]) {
            console.log("KEY:", b, "ALREDY SET");
            return;
        }
        d.c.pub[b] = c;
        d.c.got[b] = a;
        d.claimSegment(a);
    },
    claimSegment: function(a) {
        var b = this;
        for (var c = a.index; c < a.index + a[0].length; c++) {
            b.c.claimed.push(c);
        }
    },
    unclaimedString: function(a) {
        var b = this;
        var c = "";
        for (var d = 0; d < a[0].length; d++) {
            if (b.c.claimed.indexOf(d + a.index) < 0) {
                c += a[0][d];
            }
        }
        return c;
    },
    parseAuthor: function(a) {
        var b = [];
        a = a.replace(/^[^\w]+/, "").replace(/[^\w\.\)]+$/, "").replace(/[\+\*\[\(\d].*$/g, "").replace(/\s*(MD|PhD|MSc)\s*,?\s*/g, "").replace(/[0-9]{4}-[0-9]{4}/g, "").replace(/[0-9]{4}-/g, "");
        auSplit = a.split(/,\s*/);
        if (auSplit.length >= 2) {
            b.push({
                last: auSplit[0].trim(),
                first: auSplit[1].trim()
            });
        }
        return b;
    },
    removeExtraCharacters: function(a) {
        a = a.replace(/^[^\w]+/, "").replace(/[^\w\.\)]+$/, "");
        var b = a.split(" ").length;
        var c = 0;
        var d = a.match(/\./g);
        if (d) c = d.length;
        if ((c <= b / 2 || c === 1) && a.charAt(a.length - 1) === ".") {
            a = a.substring(0, a.length - 1);
        }
        if (a.charAt(a.length - 1) === ",") {
            a = a.substring(0, a.length - 1);
        }
        a = a.replace(/^\s*\|\s*/g, "");
        a = a.replace(/\|.*/g, "");
        a = a.replace(/\[.*/g, "");
        return a.trim();
    },
    getAuthorTitleJournal: function() {
        var a = this;
        var b = a.c.matches;
        var c = false;
        if (b.nonNumbers.length > 1) {
            var d = a.c.str.substring(b.nonNumbers[0].index + b.nonNumbers[0][0].length, b.nonNumbers[1].index);
            if (d && d.match(/\(?\d{4}\)?/)) {
                c = true;
            }
        }
        for (var e = 0; e < 1; e++) {
            var f = b.nonNumbers[e][0].split(".");
            if (c && b.nonNumbers[e + 1]) {
                f = [ b.nonNumbers[e][0] ].concat(b.nonNumbers[e + 1][0].split("."));
            }
            if (f.length === 3 || f.length === 4 && f[3] === "" || f.length === 2 && b.nonNumbers.length === 2 && c) {
                if (f[0].length < 8 || f[1].length < 8 || f[2] && f[2].length < 8) continue;
                var g = f[0];
                g = g.replace(/original article: /i, "");
                var h = a.splitAuthors([], [ g ], ",", false);
                if (h && h.length) {
                    if (g.indexOf("[Ed]") >= 0) {
                        a.c.pub.editor = h;
                        a.c.pub.booktitle = f[1];
                        a.c.pub.pubtype = "PP_BOOK";
                    } else if (f.length === 2) {
                        a.c.pub.author = h;
                        a.c.pub.booktitle = f[1].trim();
                        a.c.pub.pubtype = "PP_BOOK";
                    } else {
                        a.c.pub.author = h;
                        a.c.pub.title = f[1].trim();
                        a.c.pub.journal = f[2].trim();
                    }
                    a.claimSegment(b.nonNumbers[e]);
                    if (c) a.claimSegment(b.nonNumbers[e + 1]);
                }
            }
        }
    },
    splitAuthors: function(a, b, c, d, e) {
        var f = this;
        var g = b[0].split(c);
        var h = a.length;
        var i = a.concat([]);
        var j = false;
        for (var k = 0; k < g.length; k++) {
            if (g[k].match(/\w/)) {
                var l = g[k];
                if (c === "," && g[k + 1]) {
                    l += "," + g[k + 1];
                    k++;
                } else if (c === " " && e) {
                    while (g[k + 1] && g[k + 1].match(/^[A-Z\s\.,]+$/)) {
                        l += g[k + 1];
                        k++;
                    }
                }
                var m = f.parseAuthor(l);
                if (m[0] && m[0].first && m[0].last || m[0] && m[0].collective) {
                    if (m[0].last && m[0].last.indexOf(" ") >= 0) {
                        j = true;
                    }
                    a.push(m[0]);
                }
            }
        }
        if (j) a = f.splitAuthors(i, b, " ", false, true);
        if (d && a.length > h) f.claimSegment(b);
        return a;
    },
    getPublisher: function() {
        var a = this;
        var b = a.c.matches;
        for (var c = 0; c < b.publishers.length; c++) {
            var d = a.unclaimedString(b.publishers[c]).trim().replace(/published by /i, "");
            a.useSegment(b.publishers[c], "publisher", d);
        }
        var e = a.unused(b.nonNumbers);
        for (var c = 0; c < e.length; c++) {
            if (e[c][0].toLowerCase().indexOf("journal") >= 0) continue;
            if (e.indexOf(":") > 0) ;
            var f = e[c][0].split(/[ -]/);
            var g = "";
            f.map(function(b) {
                if (g) return;
                if (b.replace(/\W/g, "") in a.publisherCities) g = b;
            });
            if (g) {
                var h = e[c][0].split("Ltd.");
                if (h.length > 1) {
                    h[0] = h[0] + "Ltd.";
                } else {
                    h = e[c][0].split(":");
                }
                if (h.length > 1) {
                    if (h[0].indexOf(g) >= 0) {
                        a.c.pub.address = h[0].replace(/^[^\w]+/, "").replace(/[^\w\.\)]+$/, "").replace(/^p+\.\s+/i, "");
                        a.c.pub.publisher = h[1].replace(/^[^\w]+/, "").replace(/[^\w\.\)]+$/, "");
                    } else {
                        a.c.pub.address = h[1].replace(/^[^\w]+/, "").replace(/[^\w\.\)]+$/, "");
                        a.c.pub.publisher = h[0].replace(/^[^\w]+/, "").replace(/[^\w\.\)]+$/, "");
                    }
                    a.claimSegment(e[c]);
                }
            }
        }
    },
    getDoi: function() {
        var a = this;
        var b = a.c.matches;
        var c;
        if (b.dois.length === 1) {
            c = b.dois[0][0];
            if (c.charAt(c.length - 1) === ".") c = c.substring(0, c.length - 1);
            a.useSegment(b.dois[0], "doi", c);
        }
    },
    getJournal: function() {
        var a = this;
        var b = a.c.matches;
        var c = b.nonNumbers;
        for (var d = 0; d < c.length; d++) {
            var e = a.unclaimedString(c[d]).trim();
            if (e.indexOf("ublished") >= 0) continue;
            e = e.replace(/^source:\s*/i, "");
            if (e.charAt(e.length - 1) === "(") e = e.substring(0, e.length - 1);
            e = a.removeExtraCharacters(e);
            e = a.removePresses(e);
            e = a.removeHyperlinks(e);
            e = a.removeAbbreviatedAuthors(e);
            e = e.replace(/^[^\w]+/, "").replace(/[^\w\.\)]+$/, "");
            if (e === "reprinted") continue;
            if (e && e.length) {
                a.useSegment(c[0], "journal", e);
                return;
            }
        }
    },
    getEditors: function() {
        var a = this;
        var b = a.c.matches;
        var c = b.nonNumbers[0];
        var d = c[0].toLowerCase();
        var e = [];
        if (c[0].indexOf("[Ed]") >= 0) {
            e = a.splitAuthors(e, c, "[Ed]", true);
        }
        if (e && e.length) {
            a.c.pub.editor = e;
        }
    },
    getPages: function() {
        var a = this;
        var b = a.c.matches;
        for (var c = 0; c < b.dashNumbers.length; c++) {
            if (!a.overlapping(b.dashNumbers[c], b.parensNumbers)) {
                var d = b.dashNumbers[c][0].replace(/\s/g, "").replace(/\u2013/g, "-");
                var e = a.overlapping(b.dashNumbers[c], b.pagesP);
                if (e) {
                    a.useSegment(b.pagesP[e - 1], "pages", d);
                } else {
                    a.useSegment(b.dashNumbers[c], "pages", d);
                }
                return;
            }
        }
        if (b.plosPages.length) {
            for (var c = 0; c < b.plosPages.length; c++) {
                if (a.c.str.charAt(b.plosPages[c].index - 1) === ":" || a.c.str.charAt(b.plosPages[c].index - 1) === " ") {
                    a.useSegment(b.plosPages[c], "pages", b.plosPages[c][0]);
                    return;
                }
            }
        }
        if (b.pagesP.length) {
            var f = a.unused(b.allNumbers);
            for (var c = 0; c < f.length; c++) {
                var e = a.overlapping(f[c], b.pagesP);
                if (e) {
                    var d = b.pagesP[e - 1][0].replace(/[\(\s]p+a?g?e?s?\.?\s*/, "").replace(/\s/g, "").replace(/\u2013/g, "-");
                    a.useSegment(b.pagesP[e - 1], "pages", d);
                    return;
                }
            }
        }
    },
    getYears: function() {
        var a = this;
        var b = a.c.matches;
        if (a.c.pub.year) return;
        var c = [ "jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec", "january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december" ];
        var d, e, f;
        for (var g = 0; g < b.yearMonthDays.length; g++) {
            d = b.yearMonthDays[g][0].replace(".", "").match(/(\d{4})\s(\w+)\s(\d+)/);
            e = d[2].toLowerCase();
            f = c.indexOf(e);
            if (f >= 0) {
                f++;
                if (f > 12) f = f - 12;
                a.c.pub.year = d[1];
                a.c.pub.month = f;
                a.c.pub.day = d[3];
                a.claimSegment(b.yearMonthDays[g]);
                return;
            }
        }
        for (var g = 0; g < b.monthDayYears.length; g++) {
            d = b.monthDayYears[g][0].replace(".", "").replace(",", "").match(/(\w+)\s(\d+)\s(\d{4})/);
            e = d[1].toLowerCase();
            f = c.indexOf(e);
            if (f >= 0) {
                f++;
                if (f > 12) f = f - 12;
                a.c.pub.year = d[3];
                a.c.pub.month = f;
                a.c.pub.day = d[2];
                a.claimSegment(b.monthDayYears[g]);
                return;
            }
        }
        for (var g = 0; g < b.dayMonthYears.length; g++) {
            if (a.overlapping(b.dayMonthYears[g], b.volumeNumbers)) continue;
            if (a.overlapping(b.dayMonthYears[g], b.issueNumbers)) continue;
            d = b.dayMonthYears[g][0].replace(".", "").replace(",", "").match(/(\d+)\s(\w+)\s(\d{4})/);
            e = d[2].toLowerCase();
            f = c.indexOf(e);
            if (f >= 0) {
                f++;
                if (f > 12) f = f - 12;
                a.c.pub.year = d[3];
                a.c.pub.month = f;
                a.c.pub.day = d[1];
                a.claimSegment(b.dayMonthYears[g]);
                return;
            }
        }
        for (var g = 0; g < b.yearDayMonths.length; g++) {
            if (a.overlapping(b.yearDayMonths[g], b.volumeNumbers)) continue;
            if (a.overlapping(b.yearDayMonths[g], b.issueNumbers)) continue;
            d = b.yearDayMonths[g][0].replace(".", "").replace(",", "").match(/(\d{4})\s(\d{1,2})\s(\w+)/);
            e = d[3].toLowerCase();
            f = c.indexOf(e);
            if (f >= 0) {
                f++;
                if (f > 12) f = f - 12;
                a.c.pub.year = d[1];
                a.c.pub.month = f;
                a.c.pub.day = d[2];
                a.claimSegment(b.yearDayMonths[g]);
                return;
            }
        }
        var h = [];
        var i = [];
        for (var j = 0; j < b.yearNumbers.length; j++) {
            if (a.overlapping(b.yearNumbers[j], b.dashNumbers)) h.push(j);
            if (a.overlapping(b.yearNumbers[j], b.volumeNumbers)) h.push(j);
            if (a.overlapping(b.yearNumbers[j], b.issueNumbers)) h.push(j);
            if (a.c.claimed.indexOf(b.yearNumbers[j].index) >= 0) h.push(j);
            if (a.c.str.charAt(b.yearNumbers[j].index + b.yearNumbers[j][0].length) === "(") h.push(j);
            if (a.c.str.charAt(b.yearNumbers[j].index + b.yearNumbers[j][0].length) === ":") h.push(j);
            if (a.c.str.charAt(b.yearNumbers[j].index - 1) === ".") h.push(j);
            if (a.c.str.charAt(b.yearNumbers[j].index + b.yearNumbers[j][0].length).match(/\d/)) h.push(j);
            if (a.c.str.charAt(b.yearNumbers[j].index - 1).match(/\d/)) h.push(j);
            if (a.c.str.charAt(b.yearNumbers[j].index + b.yearNumbers[j][0].length).match(/[a-zA-Z]/)) h.push(j);
            if (a.c.str.charAt(b.yearNumbers[j].index - 1).match(/[a-zA-Z]/)) h.push(j);
            if (a.c.str.substring(b.yearNumbers[j].index - 10, b.yearNumbers[j].index).match(/reprinted/i)) h.push(j);
            if (h.indexOf(j) < 0) i.push(j);
        }
        var k = true;
        for (var j = 0; j < i.length - 1; j++) {
            if (b.yearNumbers[i[j]][0] !== b.yearNumbers[i[j + 1]][0]) k = false;
        }
        if (k && i.length > 1) {
            var l = [];
            for (var j = 0; j < i.length; j++) {
                var m = false;
                if (a.overlapping(b.yearNumbers[i[j]], b.monthYears)) m = true;
                if (a.overlapping(b.yearNumbers[i[j]], b.yearMonths)) m = true;
                if (m) {
                    l.push(i[j]);
                } else {
                    a.claimSegment(b.yearNumbers[i[j]]);
                }
            }
            if (l.length === 0) l.push(i[0]);
            i = l;
        }
        if (i.length === 1) {
            a.useSegment(b.yearNumbers[i[0]], "year", b.yearNumbers[i[0]][0]);
            var n = a.overlapping(b.yearNumbers[i[0]], b.slashNumbers);
            if (n) {
                var o = b.slashNumbers[n - 1];
                var p = o[0].match(/(\d{2})\/\d{4}/);
                if (!p || !p[1]) p = o[0].match(/\d{4}\/(\d{2})/);
                if (p && p[1]) {
                    a.useSegment(o, "month", p[1]);
                }
            }
            var q = a.overlapping(b.yearNumbers[i[0]], b.monthYears);
            if (q) {
                var r = b.monthYears[q - 1];
                d = r[0].replace(".", "").replace(",", "").match(/(\w+)\s(\d{4})/);
                e = d[1].toLowerCase();
                f = c.indexOf(e);
                if (f >= 0) {
                    f++;
                    if (f > 12) f = f - 12;
                    a.useSegment(r, "month", f);
                    return;
                }
            }
            var s = a.overlapping(b.yearNumbers[i[0]], b.yearMonths);
            if (s) {
                var t = b.yearMonths[s - 1];
                d = t[0].replace(".", "").replace(",", "").match(/(\d{4})\s(\w+)/);
                e = d[2].toLowerCase();
                f = c.indexOf(e);
                if (f >= 0) {
                    f++;
                    if (f > 12) f = f - 12;
                    a.useSegment(t, "month", f);
                    return;
                }
            }
        } else {
            console.log("MORE THAN ONE LIKELY YEAR");
        }
        var u = a.unused(b.monthDays);
        for (var j = 0; j < u.length; j++) {
            if (a.c.pub.month) continue;
            var v = u[j];
            d = v[0].replace(".", "").replace(",", "").match(/(\w+)\s(\d{1,2})/);
            e = d[1].toLowerCase();
            f = c.indexOf(e);
            if (f >= 0) {
                f++;
                if (f > 12) f = f - 12;
                a.c.pub.day = d[2];
                a.useSegment(v, "month", f);
            }
        }
    },
    getVolumeIssue: function() {
        var a = this;
        var b = a.c.matches;
        var c = a.unused(b.allNumbers);
        for (var d = 0; d < c.length - 1; d++) {
            var e = a.c.str.substring(c[d].index + c[d][0].length);
            if (e.match(/^\s?\(?suppl/i)) {
                a.useSegment(c[d], "volume", c[d][0]);
                c = a.unused(b.allNumbers);
            }
        }
        for (var d = 0; d < c.length; d++) {
            var f = a.overlapping(c[d], b.volumeNumbers);
            if (f) {
                a.useSegment(b.volumeNumbers[f - 1], "volume", c[d][0]);
                c = a.unused(b.allNumbers);
            }
        }
        for (var d = 0; d < c.length - 1; d++) {
            if (a.c.pub.volume) continue;
            var g = a.overlapping(c[d + 1], b.parensNumbers);
            if (g && (c[d].index + c[d][0].length === b.parensNumbers[g - 1].index || c[d].index + c[d][0].length + 1 === b.parensNumbers[g - 1].index)) {
                var f = a.overlapping(c[d], b.volumeNumbers);
                if (f) {
                    a.useSegment(b.volumeNumbers[f - 1], "volume", c[d][0]);
                } else {
                    a.useSegment(c[d], "volume", c[d][0]);
                }
                var h = b.parensNumbers[g - 1][0].replace("(", "").replace(")", "");
                a.useSegment(b.parensNumbers[g - 1], "issue", h);
                return;
            }
        }
        for (var d = 0; d < c.length; d++) {
            if (a.c.str.charAt(c[d].index + c[d][0].length) === ":") {
                a.useSegment(c[d], "volume", c[d][0]);
                c = a.unused(b.allNumbers);
            }
        }
        for (var d = 0; d < c.length; d++) {
            var i = a.overlapping(c[d], b.issueNumbers);
            if (i) {
                a.useSegment(b.issueNumbers[i - 1], "issue", c[d][0]);
                c = a.unused(b.allNumbers);
            }
        }
        for (var d = 0; d < c.length; d++) {
            var j = a.overlapping(c[d], b.parensNumbers);
            if (j) {
                a.useSegment(b.parensNumbers[j - 1], "issue", c[d][0]);
                c = a.unused(b.allNumbers);
            }
        }
        if (!a.c.pub.volume && c.length === 1) {
            a.useSegment(c[0], "volume", c[0][0]);
            c = a.unused(b.allNumbers);
        }
        if (a.c.pub.volume && a.c.pub.pages && !a.c.pub.issue && c.length === 1) {
            a.useSegment(c[0], "issue", c[0][0]);
            c = a.unused(b.allNumbers);
        }
    },
    overlapping: function(a, b) {
        var c = 0;
        for (var d = 0; d < b.length; d++) {
            if (a.index >= b[d].index && a.index < b[d].index + b[d][0].length) {
                c = d + 1;
            }
        }
        return c;
    },
    publisherCities: {
        Aberdeen: 1,
        Abilene: 1,
        Abingdon: 1,
        Acton: 1,
        Adelaide: 1,
        Aignan: 1,
        Akron: 1,
        Alabama: 1,
        Albans: 1,
        Albany: 1,
        Alberquerque: 1,
        Alessandria: 1,
        Alexandria: 1,
        Alresford: 1,
        Alto: 1,
        Amenia: 1,
        Amherst: 1,
        Amsterdam: 1,
        Andover: 1,
        Angeles: 1,
        Angers: 1,
        Annandale: 1,
        Annapolis: 1,
        Antonio: 1,
        Antwerp: 1,
        Arbor: 1,
        Argyll: 1,
        Arlington: 1,
        Armidale: 1,
        Armonk: 1,
        Artamon: 1,
        Artarmon: 1,
        Ashcroft: 1,
        Asheville: 1,
        Ashfield: 1,
        Ashland: 1,
        Athens: 1,
        Atlanta: 1,
        Auckland: 1,
        Austin: 1,
        Baltimore: 1,
        Banff: 1,
        Barbara: 1,
        Barmenda: 1,
        Barrytown: 1,
        Basingstoke: 1,
        Bath: 1,
        Baton: 1,
        Bayreuth: 1,
        Bayswater: 1,
        Beach: 1,
        Belfast: 1,
        Bellatera: 1,
        Berkeley: 1,
        Berks: 1,
        Berlin: 1,
        Bern: 1,
        Bielefeld: 1,
        Binghampton: 1,
        Bingley: 1,
        Birkenhead: 1,
        Birmingham: 1,
        Blackrock: 1,
        Bloomington: 1,
        "Boca Raton": 1,
        Boise: 1,
        Bologna: 1,
        Bondi: 1,
        Borehamwood: 1,
        Boston: 1,
        Boulder: 1,
        Bridgewater: 1,
        Brisbane: 1,
        Bristol: 1,
        Brixton: 1,
        Broadway: 1,
        Bronx: 1,
        Brooklyn: 1,
        Broomall: 1,
        Brouzils: 1,
        Brussels: 1,
        Buckingham: 1,
        Buckinghamshire: 1,
        Budapest: 1,
        Calcutta: 1,
        Calgary: 1,
        Camberwell: 1,
        Cambridge: 1,
        Cambridgeshire: 1,
        Campbell: 1,
        Canberra: 1,
        Carbondale: 1,
        Cardiff: 1,
        Carlton: 1,
        Carnforth: 1,
        Carolina: 1,
        Castle: 1,
        Cedar: 1,
        Champaign: 1,
        Charleston: 1,
        Charlotte: 1,
        Charlottenlund: 1,
        Charlottesville: 1,
        Charnwood: 1,
        Cheltenham: 1,
        Chester: 1,
        Chicago: 1,
        Chichester: 1,
        Christchurch: 1,
        Cincinatti: 1,
        Clark: 1,
        Clayton: 1,
        Clemson: 1,
        Clifton: 1,
        Colchester: 1,
        Collingwood: 1,
        Collins: 1,
        Colombo: 1,
        Columbia: 1,
        Columbus: 1,
        Conway: 1,
        Copenhagen: 1,
        Cornwall: 1,
        Corvallis: 1,
        County: 1,
        "Covent Garden": 1,
        Cranbury: 1,
        Cresskill: 1,
        Cruz: 1,
        Dallas: 1,
        Dame: 1,
        Darmstadt: 1,
        DeKalb: 1,
        Delaware: 1,
        Delhi: 1,
        Denver: 1,
        Derbyshire: 1,
        Detroit: 1,
        Devon: 1,
        Diego: 1,
        Dijon: 1,
        Dingwall: 1,
        Dorset: 1,
        Dublin: 1,
        Dunedin: 1,
        Durban: 1,
        Durham: 1,
        Easthampton: 1,
        Edinburgh: 1,
        Edison: 1,
        Edmonton: 1,
        Enfield: 1,
        Escondido: 1,
        Essex: 1,
        Eugene: 1,
        Evanston: 1,
        Ewing: 1,
        Exeter: 1,
        Fairview: 1,
        Faisalabad: 1,
        Farmington: 1,
        Fayetteville: 1,
        Fishponds: 1,
        Fitzroy: 1,
        Florence: 1,
        Francisco: 1,
        Frankfurt: 1,
        Freeport: 1,
        Fremantle: 1,
        Frenchs: 1,
        Gainesville: 1,
        Gendale: 1,
        Geneva: 1,
        "Gen\xe8ve": 1,
        Gent: 1,
        Georgetown: 1,
        Ghaziabad: 1,
        Glasgow: 1,
        Gloucester: 1,
        Gloucestershire: 1,
        Gosford: 1,
        Goteborg: 1,
        Gottingen: 1,
        "G\xf6ttingen": 1,
        Grahamstown: 1,
        "Grand Rapids": 1,
        Green: 1,
        Greensboro: 1,
        Grenoble: 1,
        Hackney: 1,
        Hadley: 1,
        Hague: 1,
        Halifax: 1,
        Hamburg: 1,
        Hamilton: 1,
        Hampshire: 1,
        Handsowrth: 1,
        Hants: 1,
        Haren: 1,
        Harrogate: 1,
        Harrow: 1,
        Hastings: 1,
        Hauppauge: 1,
        Haven: 1,
        Heidelberg: 1,
        Helsinki: 1,
        Herefordshire: 1,
        Herts: 1,
        Hexham: 1,
        Hildesheim: 1,
        Hillsdale: 1,
        Hiroshima: 1,
        Hoboken: 1,
        Honolulu: 1,
        Houston: 1,
        Houten: 1,
        Huddersfield: 1,
        Hueva: 1,
        Huntington: 1,
        Huntsville: 1,
        Iceland: 1,
        Idaho: 1,
        Illinois: 1,
        Indianapolis: 1,
        Inverness: 1,
        Iowa: 1,
        Ireland: 1,
        Ithaca: 1,
        Jaipur: 1,
        Johannesburg: 1,
        Jyvaskyla: 1,
        Kalamazoo: 1,
        Kansas: 1,
        "Kansas City": 1,
        Kassel: 1,
        Kemptville: 1,
        Kensington: 1,
        Kent: 1,
        Kenthurst: 1,
        Keswick: 1,
        Keynes: 1,
        Kilda: 1,
        Kildare: 1,
        Kingsbury: 1,
        Kingston: 1,
        Kirksville: 1,
        Knoxville: 1,
        Krakow: 1,
        "Krak\xf3w": 1,
        Lancaster: 1,
        Lanham: 1,
        Lansing: 1,
        Laurent: 1,
        Lausanne: 1,
        Lawrence: 1,
        Lebanon: 1,
        Leeds: 1,
        Leicester: 1,
        Leicestershire: 1,
        Leichardt: 1,
        Leiden: 1,
        Lerwick: 1,
        Leuven: 1,
        Lewisburg: 1,
        Lewiston: 1,
        Lexington: 1,
        Lincoln: 1,
        Lincolnshire: 1,
        Liverpool: 1,
        Llandysul: 1,
        Lleida: 1,
        London: 1,
        Lothian: 1,
        Louis: 1,
        Louisville: 1,
        Louvain: 1,
        Loveland: 1,
        Lubbock: 1,
        Lucia: 1,
        Lumpur: 1,
        Lund: 1,
        Luton: 1,
        Macon: 1,
        Madison: 1,
        Madrid: 1,
        Manchester: 1,
        Manila: 1,
        Manningtree: 1,
        Mansfield: 1,
        Marino: 1,
        Markham: 1,
        Maryland: 1,
        Marylebone: 1,
        Meath: 1,
        Melbourne: 1,
        Middlesex: 1,
        Middleton: 1,
        Middletown: 1,
        Milan: 1,
        Milsons: 1,
        "Milton Keynes": 1,
        Mineola: 1,
        Minneapolis: 1,
        Mississippi: 1,
        Montpellier: 1,
        Montreal: 1,
        "Montr\xe9al": 1,
        Monza: 1,
        Morgantown: 1,
        Moro: 1,
        Msida: 1,
        Mulgrave: 1,
        Munchen: 1,
        Munich: 1,
        Munster: 1,
        Nanterre: 1,
        Nashville: 1,
        Nedlands: 1,
        Neuilly: 1,
        Nevada: 1,
        "New South Wales": 1,
        "New York": 1,
        Newark: 1,
        Newcastle: 1,
        "Newcastle-upon-tyne": 1,
        Norfolk: 1,
        Norman: 1,
        Northam: 1,
        Northampton: 1,
        Northumberland: 1,
        Norwich: 1,
        Norwood: 1,
        Nottingham: 1,
        Novato: 1,
        NSW: 1,
        Oakland: 1,
        Oakville: 1,
        Odense: 1,
        Okayama: 1,
        Ontario: 1,
        Orchard: 1,
        Oslo: 1,
        Ottawa: 1,
        Oxford: 1,
        Oxfordshire: 1,
        Oxon: 1,
        Paderborn: 1,
        Pahrump: 1,
        Paris: 1,
        Park: 1,
        Parker: 1,
        Parkville: 1,
        Pasadena: 1,
        Pathumthani: 1,
        Paul: 1,
        Penrith: 1,
        Philadelphia: 1,
        Pietermaritzburg: 1,
        Piscataway: 1,
        Pittsburg: 1,
        Pittsburgh: 1,
        Plymouth: 1,
        Pokfulam: 1,
        Pomfret: 1,
        Pontefract: 1,
        Portland: 1,
        Portsmouth: 1,
        Potsdam: 1,
        Pradesh: 1,
        Praha: 1,
        Pretoria: 1,
        Princeton: 1,
        Providence: 1,
        Provo: 1,
        Pullman: 1,
        Pymble: 1,
        Quebec: 1,
        "Qu\xe9bec": 1,
        Queensland: 1,
        Rajasthan: 1,
        Raleigh: 1,
        Rapids: 1,
        Raton: 1,
        Raynaud: 1,
        Reading: 1,
        Redwood: 1,
        Regina: 1,
        Rennes: 1,
        Reno: 1,
        "Richland Hills": 1,
        Ridgewood: 1,
        Ringwood: 1,
        Riverside: 1,
        Roanoke: 1,
        Rochester: 1,
        Rockaway: 1,
        Rockville: 1,
        Roma: 1,
        Rondebosch: 1,
        "Rose Bay": 1,
        Rossshire: 1,
        Rouge: 1,
        Rushcutters: 1,
        Saarbrucken: 1,
        Sacranebti: 1,
        "Saint-denis": 1,
        Etienne: 1,
        Sakai: 1,
        Salem: 1,
        Sandpoint: 1,
        Scotia: 1,
        Scotsville: 1,
        Seattle: 1,
        Selinsgrove: 1,
        Seoul: 1,
        Sevitengasse: 1,
        Sewanee: 1,
        Sheffield: 1,
        Shropshire: 1,
        Sioux: 1,
        "S\xf6dert\xe4lje": 1,
        Soignies: 1,
        Somerset: 1,
        Somerville: 1,
        Southport: 1,
        Southville: 1,
        Staffs: 1,
        Stanford: 1,
        Stirling: 1,
        Stockbridge: 1,
        Stockholm: 1,
        Stocksfield: 1,
        Street: 1,
        Stroud: 1,
        Stuttgart: 1,
        Suffolk: 1,
        Surrey: 1,
        Sussex: 1,
        Sydney: 1,
        Tampa: 1,
        Tasmania: 1,
        Temecula: 1,
        Tempe: 1,
        Texas: 1,
        Tokyo: 1,
        Toronto: 1,
        Toulouse: 1,
        Townsend: 1,
        Trenton: 1,
        Trier: 1,
        Tubingen: 1,
        "T\xfcbingen": 1,
        Tucson: 1,
        Turku: 1,
        Turnhout: 1,
        Tuscaloosa: 1,
        Tuscon: 1,
        Udine: 1,
        Uppsala: 1,
        Urbana: 1,
        Utah: 1,
        Utrecht: 1,
        Vancouver: 1,
        Vaxjo: 1,
        Venice: 1,
        Vergne: 1,
        Victoria: 1,
        Waco: 1,
        Wales: 1,
        Warwickshire: 1,
        Washington: 1,
        Waterloo: 1,
        Weinheim: 1,
        Wellington: 1,
        Wells: 1,
        Westport: 1,
        Whitefish: 1,
        Willowdale: 1,
        Wilmington: 1,
        Winchester: 1,
        Winfield: 1,
        Winnipeg: 1,
        Woodstock: 1,
        Woollongong: 1,
        Wurzburg: 1,
        Yarra: 1,
        York: 1,
        Yorkshire: 1,
        Zollikofen: 1,
        Zurich: 1
    }
});

PP.library.BibliographicInferer = new PP.library._BibliographicInferer();

PP.library._Date = PP.Class.extend({
    getFields: function() {
        var a = [ {
            name: "year"
        }, {
            name: "month"
        }, {
            name: "day"
        }, {
            name: "unparsed"
        }, {
            name: "literal"
        }, {
            name: "season"
        } ];
        return a;
    },
    autoClean: function(a) {
        var b = this.getFields();
        if (PP.Utils.isNumeric(a)) {
            a = this.format(a, "MMM DD, YYYY");
        }
        if (PP.Utils.isString(a)) {
            a = this.parseDate(a);
        }
        for (var c = 0; c < b.length; c++) {
            var d = b[c].name;
            if (a[d] && PP.Utils.isString(a[d])) {
                a[d] = a[d].replace(/^\s*/, "");
                a[d] = a[d].replace(/\s*$/, "");
                if (d == "year" || d == "day" || d == "month") {
                    if (a[d].match(/^\d+$/)) a[d] = a[d];
                }
            }
        }
        if (a.month && PP.Utils.isString(a.month)) {
            var e = this.monthMap();
            var f = a.month.toUpperCase();
            if (e[f]) {
                a.month = e[f];
            }
        }
        return a;
    },
    yearString: function(a) {
        return a.year || "";
    },
    toString: function(a, b) {
        if (!a) {
            return "";
        }
        b = b || {};
        if (this.isTimestamp(a)) {
            var c = new Date(a * 1e3);
            return this.format(c, "MMM DD, YYYY, h:mm:ss a");
        }
        var d = a.unparsed;
        var e = false;
        if (d !== "" && d !== null && d !== undefined) {
            e = true;
        }
        var f = a.year;
        var g = false;
        if (f !== "" && f !== null && f !== undefined) {
            g = true;
        }
        var h = a.month;
        var i = false;
        if (h !== "" && h !== null && h !== undefined) {
            i = true;
        }
        var j = a.day;
        var k = false;
        if (j !== "" && j !== null && j !== undefined) {
            k = true;
        }
        var l = a.season;
        var m = false;
        if (l !== "" && l !== null && l !== undefined) {
            m = true;
        }
        var n = a.literal;
        var o = false;
        if (n !== "" && n !== null && n !== undefined) {
            o = true;
        }
        f = f || 0;
        h = h || 1;
        if (!PP.Utils.isNumeric(h)) {
            h = 1;
        }
        j = j || 1;
        if (!PP.Utils.isNumeric(j)) {
            j = 1;
        }
        var c = new Date(f, h - 1, j);
        if (g && i && k) {
            return b && b.dashed ? this.format(c, "YYYY-MM-DD") : this.format(c, "MMM DD, YYYY");
        } else if (g && i) {
            return b && b.dashed ? this.format(c, "YYYY-MM") : this.format(c, "MMMM YYYY");
        } else if (i && k) {
            return b && b.dashed ? this.format(c, "MM-DD") : this.format(c, "MMMM DD");
        } else if (g && m) {
            return b && b.dashed ? this.format(c, "YYYY") : l + " " + f;
        } else if (o) {
            if (b && b.escape) {
                n = "{" + n + "}";
            }
            return n;
        } else if (g) {
            return this.format(c, "YYYY");
        } else if (e) {
            return a.unparsed;
        } else {
            return "";
        }
    },
    toCSL: function(a) {
        var b = {};
        var c = [];
        if (a.year && a.month && a.day) {
            c.push(a.year + "");
            c.push(a.month + "");
            c.push(a.day + "");
        } else if (a.year && a.month) {
            c.push(a.year + "");
            c.push(a.month + "");
        } else if (a.year) {
            c.push(a.year + "");
        }
        if (a.literal) {
            b.literal = a.literal;
        } else if (c.length) {
            b["date-parts"] = [ c ];
            if (a.season) {
                if (a.season == "Spring") {
                    b.season = 1;
                } else if (a.season == "Summer") {
                    b.season = 2;
                } else if (a.season == "Autumn" || a.season == "Fall") {
                    b.season = 3;
                } else if (a.season == "Winter") {
                    b.season = 4;
                } else {
                    b.season = a.season;
                }
            }
        }
        return b;
    },
    format: function(a, b) {
        var c = moment(a);
        return c.format(b);
    },
    isTimestamp: function(a) {
        if (PP.Utils.isNumeric(a)) {
            return true;
        }
    },
    hasValue: function(a) {
        if (a === undefined) {
            return false;
        } else {
            if (a.year !== undefined || a.month !== undefined || a.day !== undefined || a.literal !== undefined) {
                return true;
            } else if (this.isTimestamp(a)) {
                return true;
            } else {
                return false;
            }
        }
    },
    extractDate: function(a, b, c) {
        var d = b + "year";
        var e = b + "month";
        var f = b + "day";
        var g = b + "season";
        if (a[d]) {
            a[d] = a[d] + "";
            a[d] = a[d].replace(/^0+/, "");
            a[d] = a[d].replace(/\s/g, "");
            if (!a[d].match(/^\d+$/)) {
                delete a[d];
            }
        }
        var h = this.monthMap();
        if (a[e]) {
            a[e] = a[e] + "";
            a[e] = a[e].replace(/^0+/, "");
            a[e] = a[e].replace(/\s/g, "");
            a[e] = a[e].replace(/\.$/, "");
            if (h[a[e].toUpperCase()]) {
                a[e] = h[a[e].toUpperCase()];
            }
            if (!a[e].match(/^\d+$/)) {
                delete a[e];
            }
        }
        if (a[f]) {
            a[f] = a[f] + "";
            a[f] = a[f].replace(/^0+/, "");
            a[f] = a[f].replace(/\s/g, "");
            if (!a[f].match(/^\d+$/)) {
                delete a[f];
            } else {
                if (a[f] < 1 || a[f] > 31) {
                    delete a[f];
                }
            }
        }
        if (a[g]) {
            a[g] = a[g] + "";
            a[g] = a[g].replace(/^\s+/, "").replace(/\s+$/g, "");
        }
        if (a[d] || a[e] || a[f] || a[g]) {
            if (a[d] && PP.Utils.isString(a[d])) a[d] = a[d];
            if (a[e] && PP.Utils.isString(a[e])) a[e] = a[e];
            if (a[f] && PP.Utils.isString(a[f])) a[f] = a[f];
            a[c] = {
                year: a[d],
                month: a[e],
                day: a[f]
            };
            if (a[g]) {
                a[c].season = a[g];
                delete a[g];
            }
            delete a[d];
            delete a[e];
            delete a[f];
        }
    },
    parseDate: function(a) {
        var b, c, d, e, f, g, h, i;
        var j = this.monthMapAbbr();
        f = [];
        for (g in j) {
            if (!j.hasOwnProperty(g)) continue;
            f.push(g);
        }
        var k = "(" + f.join("|") + ")";
        j = this.monthMap();
        f = [];
        for (g in j) {
            if (!j.hasOwnProperty(g)) continue;
            f.push(g);
        }
        var l = "(" + f.join("|") + ")";
        a = a.replace(/^\s+/, "").replace(/\s+$/, "").replace(/\s+/g, " ");
        g = new RegExp("^\\{(.+)\\}$", "");
        f = a.match(g);
        if (f && f[1]) {
            var m = this.parseLiteral(f[1]);
            if (m.year && PP.Utils.isString(m.year) && m.year.match(/^\d+$/)) {
                m.year = m.year;
            }
            return m;
        }
        i = this.seasonsMap();
        f = [];
        for (g in i) {
            if (!i.hasOwnProperty(g)) continue;
            f.push(g);
        }
        var n = "\\b(" + f.join("|") + ")\\b";
        g = new RegExp("(.*)" + n + "(.*)", "i");
        f = a.match(g);
        if (f && f[0]) {
            f.shift();
            for (g = 0; g < f.length; g++) {
                if (i[f[g].toUpperCase()]) {
                    h = i[f[g].toUpperCase()];
                    f[g] = "";
                }
            }
            a = f.join("");
        }
        a = a.replace(/\d\d:\d\d:\d\d\s+(GMT|EDT|EST|UTC)[^\s]*/, "");
        a = a.replace(/\d\d:\d\d\s+(GMT|EDT|EST|UTC).+/, "");
        a = a.replace(/T?\d\d:\d\d:\d\d.*/, "");
        a = a.replace(/,*\s+(at)?\s*\d\d?:\d\d\s*[ap]m.*/i, "");
        a = a.replace(/^\d?\d:\d\d\s+[AP]M\s+/i, "");
        a = a.replace(/^\s+/, "").replace(/\s+$/, "").replace(/\s+/g, " ");
        a = a.replace(/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday),?\s*/i, "");
        a = a.replace(/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s*/i, "");
        a = a.replace(/(\d+)(th|rd|nd|st)/, "$1");
        a = a.replace(/\/+$/, "");
        g = new RegExp("(.*)" + k + "\\.(.*)", "i");
        a = a.replace(g, "$1$2$3");
        a = a.replace(/Sept\b\.?/i, "Sep");
        a = a.replace(/JAN\b/, "Jan");
        a = a.replace(/FEB\b/, "Feb");
        a = a.replace(/MAR\b/, "Mar");
        a = a.replace(/APR\b/, "Apr");
        a = a.replace(/MAY\b/, "May");
        a = a.replace(/JUN\b/, "Jun");
        a = a.replace(/JUL\b/, "Jul");
        a = a.replace(/AUG\b/, "Aug");
        a = a.replace(/SEP\b/, "Sep");
        a = a.replace(/OCT\b/, "Oct");
        a = a.replace(/NOV\b/, "Nov");
        a = a.replace(/DEC\b/, "Dec");
        var o = [];
        b = [ "MM", "M" ];
        c = [ "DD", "D" ];
        var p = [ "YYYY", "YY" ];
        d = [ "-" ];
        b.forEach(function(a) {
            c.forEach(function(b) {
                p.forEach(function(c) {
                    d.forEach(function(d) {
                        var e = c + d + a + d + b;
                        o.push(e);
                        var f = a + d + b + d + c;
                        o.push(f);
                        var g = b + d + a + d + c;
                        o.push(g);
                    });
                });
            });
        });
        b = [ "MMM", "MMMM" ];
        c = [ "D", "DD" ];
        d = [ ",", "" ];
        c.forEach(function(a) {
            b.forEach(function(b) {
                d.forEach(function(c) {
                    var d = b + " " + a + c + " " + "YYYY";
                    o.push(d);
                    var e = b + c + " YYYY";
                    o.push(e);
                });
            });
        });
        o.push("YYYY");
        o.push("D MMM, YYYY");
        var q;
        for (var r in o) {
            if (o[r]) {
                var s = o[r];
                q = moment(a, s);
                if (q) {
                    var t = q.format(s);
                    t = t.replace(/[^a-z0-9]/gi, "-");
                    var u = a;
                    u = u.replace(/[^a-z0-9]/gi, "-");
                    if (t !== u) {
                        continue;
                    } else {
                        var v = {};
                        if (s.match(/(m|n|f)/i)) {
                            v.month = q.month() + 1;
                            v.month = v.month + "";
                        }
                        if (s.match(/y/i)) {
                            v.year = q.year() + "";
                        }
                        if (s.match(/(d|j)/i)) {
                            v.day = q.date() + "";
                        }
                        if (h) {
                            v.season = h;
                        }
                        return v;
                    }
                }
            }
        }
        e = {
            year: null,
            month: null,
            day: null,
            unparsed: a
        };
        if (h) {
            e.season = h;
        }
        if (a.match(/^(\d{4})[\-\/](\d\d)$/)) {
            if (!e.year && !e.month) {
                e.year = RegExp.$1;
                e.month = RegExp.$2;
            }
        }
        if (a.match(/^(\d{4})[\-\/](\d{1,2})[\-\/](\d{1,2})/)) {
            if (!e.day && !e.month && !e.year) {
                e.day = RegExp.$3;
                e.month = RegExp.$2;
                e.year = RegExp.$1;
            }
        }
        if (a.match(/^(\d{1,2})[\-\/](\d{1,2})[\-\/](\d{4})/)) {
            if (!e.day && !e.month && !e.year) {
                e.day = RegExp.$1;
                e.month = RegExp.$2;
                e.year = RegExp.$3;
            }
        }
        g = new RegExp("^" + l + "\\s+(\\d{4})$", "i");
        if (a.match(g)) {
            if (!e.month && !e.year) {
                e.month = RegExp.$1;
                e.year = RegExp.$2;
            }
        }
        g = new RegExp("^" + l + "$", "i");
        if (a.match(g)) {
            if (!e.month && !e.year) {
                e.month = RegExp.$1;
            }
        }
        g = new RegExp("^(\\d+)\\s+" + l + "\\s+(\\d{4})$", "i");
        if (a.match(g)) {
            if (!e.day && !e.month && !e.year) {
                e.day = RegExp.$1;
                e.month = RegExp.$2;
                e.year = RegExp.$3;
            }
        }
        g = new RegExp("^(\\d\\d?)\\s+" + l + "$", "i");
        if (a.match(g)) {
            if (!e.day && !e.month && !e.year) {
                e.day = RegExp.$1;
                e.month = RegExp.$2;
            }
        }
        g = new RegExp("^(\\d{4})\\s+" + l + "$", "i");
        if (a.match(g)) {
            if (!e.month && !e.year) {
                e.year = RegExp.$1;
                e.month = RegExp.$2;
            }
        }
        g = new RegExp("^(\\d{4})\\s+" + l + "\\s*-\\s*" + l + "$", "i");
        if (a.match(g)) {
            if (!e.month && !e.year) {
                e.year = RegExp.$1;
                e.month = RegExp.$2;
            }
        }
        g = new RegExp("^(\\d{4})\\s+" + l + "\\s+(\\d+)$", "i");
        if (a.match(g)) {
            if (!e.day && !e.month && !e.year) {
                e.year = RegExp.$1;
                e.month = RegExp.$2;
                e.day = RegExp.$3;
            }
        }
        if (a.match(/^\d{4}\s[A-Z].*/)) {
            f = a.split(/\s+/);
            if (!e.year) {
                e.year = f[0];
            }
        }
        if (e.month) {
            var w = this.monthMap();
            var x = e.month.toUpperCase();
            if (w[x]) {
                e.month = w[x];
            }
            if (e.month.match(/^\d+$/)) {
                if (parseInt(e.month) < 1 || parseInt(e.month) > 12) {
                    e.month = null;
                    e.day = null;
                }
            } else {
                e.month = null;
            }
        }
        if (!e.year) {
            var y = false;
            if (a.match(l)) y = true;
            if (a.match(/\b(BC|AD|CENTURY)\b/i)) y = true;
            if (a.match(/^\d\d\d\d/)) y = true;
            if (a.match(/\d\d\d\d$/)) y = true;
            if (y) {
                e = this.parseLiteral(a);
            }
        }
        if (e.month) {
            e.month = e.month.replace(/^0/, "");
            if (PP.Utils.isString(e.month) && e.month.match(/^\d+$/)) {
                e.month = parseInt(e.month) + "";
            }
        }
        if (e.day) {
            e.day = e.day.replace(/^0/, "");
            if (PP.Utils.isString(e.day) && e.day.match(/^\d+$/)) {
                e.day = parseInt(e.day) + "";
            }
        }
        if (e.year) {
            if (PP.Utils.isString(e.year) && e.year.match(/^\d+$/)) {
                e.year = parseInt(e.year) + "";
            }
        }
        return e;
    },
    parseLiteral: function(a) {
        var b = {
            literal: a
        };
        var c = new RegExp("(\\d{4})", "i");
        var d = a.match(c);
        if (d && d[1]) {
            b.year = d[1];
        }
        return b;
    },
    monthMapAbbr: function() {
        return {
            JAN: "1",
            FEB: "2",
            MAR: "3",
            APR: "4",
            MAY: "5",
            JUN: "6",
            JUL: "7",
            AUG: "8",
            SEP: "9",
            OCT: "10",
            NOV: "11",
            DEC: "12"
        };
    },
    monthMapFull: function() {
        return {
            JANUARY: "1",
            JANVIER: "1",
            JANUAR: "1",
            ENERO: "1",
            GENNAIO: "1",
            FEBRUARY: "2",
            "F\xc9VRIER": "2",
            FEBRUAR: "2",
            FEBRERO: "2",
            FEBBRAIO: "2",
            MARCH: "3",
            MARS: "3",
            "M\xc4RZ": "3",
            MARZO: "3",
            APRIL: "4",
            AVRIL: "4",
            ABRIL: "4",
            APRILE: "4",
            MAY: "5",
            MAI: "5",
            MAYO: "5",
            MAGGIO: "5",
            JUNE: "6",
            JUIN: "6",
            JUNI: "6",
            JUNIO: "6",
            GIUGNO: "6",
            JULY: "7",
            JUILLET: "7",
            JULI: "7",
            JULIO: "7",
            LUGLIO: "7",
            AUGUST: "8",
            "AO\xdbT": "8",
            AGOSTO: "8",
            SEPTEMBER: "9",
            SEPTEMBRE: "9",
            SEPTIEMBRE: "9",
            SETTEMBRE: "9",
            OCTOBER: "10",
            OCTOBRE: "10",
            OKTOBER: "10",
            OCTUBRE: "10",
            OTTOBRE: "10",
            NOVEMBER: "11",
            NOVEMBRE: "11",
            NOVIEMBRE: "11",
            DECEMBER: "12",
            DECEMBRE: "12",
            "D\xc9CEMBRE": "12",
            DEZEMBER: "12",
            DICIEMBRE: "12",
            DICEMBRE: "12"
        };
    },
    seasonsMap: function() {
        var a = {
            Spring: [ "Fr\xfchling", "primavera", "udaberria" ],
            Summer: [ "Sommer", "estate", "uda" ],
            Autumn: [ "Herbst", "autunno", "udazkena" ],
            Winter: [ "Winter", "inverno", "negua" ]
        };
        var b = {};
        for (var c in a) {
            if (!a.hasOwnProperty(c)) continue;
            b[c.toUpperCase()] = c;
            a[c].forEach(function(a) {
                b[a.toUpperCase()] = c;
            });
        }
        return b;
    },
    monthMap: function() {
        var a = {}, b;
        var c = this.monthMapAbbr();
        for (b in c) {
            if (!c.hasOwnProperty(b)) continue;
            a[b] = c[b];
        }
        c = this.monthMapFull();
        for (b in c) {
            if (!c.hasOwnProperty(b)) continue;
            a[b] = c[b];
        }
        return a;
    }
});

PP.library.Date = new PP.library._Date();

PP.library._Diff = PP.Class.extend({
    diff: function(a, b, c) {
        a = PP.library.Publication.getPersistentData(a);
        b = PP.library.Publication.getPersistentData(b);
        var d = [];
        var e = b.pubtype;
        var f = PP.library.PublicationFields.getFields();
        var g = this.getExcludedFields();
        var h = PP.Array.mapBoolean(g);
        if (c !== undefined) {
            for (var i = 0; i < c.length; i++) {
                h[c[i]] = false;
            }
        }
        var j = 0;
        var k = 0;
        var l = 0;
        for (var i = 0; i < f.length; i++) {
            var m = f[i].name;
            if (h[m] === true) {
                continue;
            }
            var n = this.getFieldValueString(a, m);
            var o = this.getFieldValueString(b, m);
            if (m === "journal" && n && o) {
                n = n.replace(/\./g, "");
                o = o.replace(/\./g, "");
            }
            if (n === null && o === null) {
                continue;
            } else if (n === null) {
                j++;
                d.push({
                    field: m,
                    type: "add",
                    old: n,
                    new: o
                });
            } else if (o === null) {
                k++;
                d.push({
                    field: m,
                    type: "delete",
                    old: n,
                    new: o
                });
            } else if (n !== o) {
                l++;
                d.push({
                    field: m,
                    type: "mod",
                    old: n,
                    new: o
                });
            } else if (n === o) {} else {
                console.log("Weird diff", m, n, o);
            }
        }
        var p = PP.library.Publication.formatAuthorYear(b);
        var q = {
            pubId: b._id,
            pubLabel: p,
            pubType: e,
            pubDiffs: d,
            nAdded: j,
            nRemoved: k,
            nChanged: l
        };
        return q;
    },
    hasValue: function(a, b) {
        var c = PP.library.PublicationFields.getField(b);
        var d = b.fieldType;
        if (c.dataType === "author") {
            return PP.library.Author.hasValue(a[b]);
        } else if (c.dataType === "date") {
            return PP.library.Date.hasValue(a[b]);
        } else if (c.dataType === "array") {
            return PP.Utils.isArray(a[b]) && a[b].length > 0;
        } else {
            return a[b] !== "" && a[b] !== undefined;
        }
    },
    getFieldValueString: function(a, b) {
        var c = PP.library.PublicationFields.getField(b);
        var d = c.fieldType;
        if (!this.hasValue(a, b)) {
            return null;
        }
        if (c.dataType === "author") {
            return PP.library.Author.toString(a[b], {
                output: "forDiff"
            });
        } else if (c.dataType === "date") {
            return PP.library.Date.toString(a[b]);
        } else if (c.dataType === "array") {
            return a[b].join("\n");
        } else {
            return a[b];
        }
    },
    getExcludedFields: function() {
        var a = [ "autocompleted", "collection_timestamps", "crawl_urls", "dup_sha1", "duplicates", "id_list", "sha1", "source", "subfolders", "journal_checked", "xref" ];
        return a;
    },
    formatDiffHtml: function(a) {
        if (!PP.Utils.isArray(a)) {
            a = [ a ];
        }
        var b = new diff_match_patch();
        var c = [];
        for (var d = 0; d < a.length; d++) {
            var e = [];
            var f = a[d];
            var g = f.pubId;
            var h = f.pubLabel;
            var i = f.pubType;
            var j = PP.library.PublicationFields.getFieldsForPubType(i);
            var k = PP.Array.toMap(j, "name");
            e.push('<div class="pp-pub-diff-item">');
            e.push([ '<div class="pp-pub-diff-header">', h, "</div>" ].join(""));
            var l = f.pubDiffs;
            if (l.length === 0) {
                e.push([ '<div class="pp-pub-diff-nochanges">', "No changes made.", "</div>" ].join(""));
            }
            var m = [];
            var n = [];
            var o = [];
            for (var p = 0; p < l.length; p++) {
                var q = "";
                var r = l[p];
                var s = r.field;
                var t = s;
                if (k[s]) {
                    var u = k[s];
                    t = u.label;
                }
                if (s == "pubtype") {
                    t = "Type of item";
                }
                q += '<div class="pp-pub-diff-field">';
                q += [ '<div class="pp-pub-diff-fieldlabel">', t, "</div>" ].join("");
                if (r.type === "add") {
                    q += [ '<div class="pp-pub-diff-fieldvalue">', PP.Utils.midEllipsis(r["new"], 80), "</div>" ].join("");
                } else if (r.type === "mod") {
                    var v = r["old"] + "";
                    var w = r["new"] + "";
                    if (s == "pubtype") {
                        v = PP.library.PublicationTypes.getPubType(r["old"]).label;
                        w = PP.library.PublicationTypes.getPubType(r["new"]).label;
                    }
                    var x = b.diff_main(v, w);
                    b.diff_cleanupSemantic(x);
                    diffHtml = b.diff_prettyHtml(x);
                    if (s !== "url") {
                        diffHtml = PP.String.truncate(diffHtml, 200);
                    }
                    q += [ '<div class="pp-pub-diff-fieldvalue">', diffHtml, "</div>" ].join("");
                } else if (r.type === "remove") {}
                q += "</div>";
                if (r.type === "add") {
                    m.push(q);
                } else if (r.type === "mod") {
                    n.push(q);
                } else {
                    o.push(q);
                }
            }
            if (m.length > 0) {
                e.push('<div class="pp-pub-diff-type">Fields added</div>');
                e.push(m.join(""));
            }
            if (n.length > 0) {
                e.push('<div class="pp-pub-diff-type">Fields updated</div>');
                e.push(n.join(""));
            }
            if (o.length > 0) {
                e.push('<div class="pp-pub-diff-type">Fields removed</div>');
                e.push(o.join(""));
            }
            e.push("</div>");
            c.push(e.join(""));
        }
        return c.join("\n");
    }
});

PP.library.Diff = new PP.library._Diff();

PP.library._Jurisdictions = PP.Class.extend({
    jurisdictions: {
        us: {
            name: "United States",
            abbr: [ {
                name: "SCOTUS",
                court: "Supreme Court"
            }, {
                name: "U.S.",
                court: "Supreme Court",
                default: true
            } ]
        },
        "us:ak": {
            name: "US|Alaska",
            abbr: [ {
                name: "Alaska",
                court: "Supreme Court"
            }, {
                name: "Alaska Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:al": {
            name: "US|Alabama",
            abbr: [ {
                name: "Ala.",
                court: "Supreme Court"
            }, {
                name: "Ala. Civ. App.",
                court: "Court of Civil Appeals"
            }, {
                name: "Ala. Crim. App.",
                court: "Court of Criminal Appeals"
            }, {
                name: "Ala. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:ar": {
            name: "US|Arkansas",
            abbr: [ {
                name: "Ark.",
                court: "Supreme Court"
            }, {
                name: "Ark. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:as": {
            name: "US|American Samoa",
            abbr: []
        },
        "us:az": {
            name: "US|Arizona",
            abbr: [ {
                name: "Ariz.",
                court: "Supreme Court"
            }, {
                name: "Ariz. Ct. App.",
                court: "Court of Appeals"
            }, {
                name: "Ariz. T.C.",
                court: "Tax Court"
            } ]
        },
        "us:c": {
            name: "US|Federal Circuit",
            abbr: [ {
                name: "Federal Circuit",
                court: "Court of Appeals"
            }, {
                name: "Fed. Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "Vet. App.",
                court: "Court of Appeals for Veterans Claims"
            }, {
                name: "Ct. Cl.",
                court: "Court of Claims"
            }, {
                name: "C.C.P.A.",
                court: "Court of Customs and Patent Appeals"
            }, {
                name: "Ct. Intl. Trade",
                court: "Court of International Trade"
            }, {
                name: "Comm. Ct.",
                court: "Commerce Court"
            }, {
                name: "Cust. Ct.",
                court: "Customs Court"
            }, {
                name: "Emer. Ct. App.",
                court: "Emergency Court of Appeals"
            }, {
                name: "FISA Ct.",
                court: "Foreign Intelligence Surveillance Court"
            }, {
                name: "FISA Ct. Rev.",
                court: "Foreign Intelligence Surveillance Court of Review"
            }, {
                name: "J.P.M.L.",
                court: "Judicial Panel on Multidistrict Litigation"
            }, {
                name: "M.C.",
                court: "Court of Military Commission Review"
            }, {
                name: "Tax Ct.",
                court: "Tax Court"
            }, {
                name: "Temp. Emerg. Ct. App.",
                court: "Temporary Emergency Court of Appeals"
            }, {
                name: "Test.",
                court: "Testing Supreme Court"
            }, {
                name: "Fed. Cl.",
                court: "Court of Federal Claims"
            }, {
                name: "U.S.J.C.",
                court: "Judicial Conference Committee"
            }, {
                name: "C.A.A.F.",
                court: "Court of Appeals for the Armed Forces"
            } ]
        },
        "us:c0": {
            name: "US|D.C. Circuit",
            abbr: [ {
                name: "D.C. Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "Dist. of Columbia Circuit",
                court: "Court of Appeals"
            } ]
        },
        "us:c0:dc.d": {
            name: "US|D.C. Circuit|D. District of Columbia",
            abbr: [ {
                name: "Bankr. D.C.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c1": {
            name: "US|First Circuit",
            abbr: [ {
                name: "1st Circuit",
                court: "Court of Appeals"
            }, {
                name: "1st Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "1st Cir. BAP",
                court: "Bankruptcy Appellate Panel"
            } ]
        },
        "us:c10": {
            name: "US|Tenth Circuit",
            abbr: [ {
                name: "10th Circuit",
                court: "Court of Appeals"
            }, {
                name: "10th Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "10th Cir. BAP",
                court: "Bankruptcy Appellate Panel"
            } ]
        },
        "us:c10:co.d": {
            name: "US|Tenth Circuit|D. Colorado",
            abbr: [ {
                name: "D. Colorado",
                court: "District Court"
            }, {
                name: "D. Colo.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Colo.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c10:ks.d": {
            name: "US|Tenth Circuit|D. Kansas",
            abbr: [ {
                name: "D. Kansas"
            }, {
                name: "Bankr. D. Kan.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c10:nm.d": {
            name: "US|Tenth Circuit|D. New Mexico",
            abbr: [ {
                name: "D. New Mexico",
                court: "District Court"
            }, {
                name: "D.N.M.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.N.M.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c10:ok.ed": {
            name: "US|Tenth Circuit|E.D. Oklahoma",
            abbr: [ {
                name: "E.D. Oklahoma",
                court: "District Court"
            }, {
                name: "E.D. Okla.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Okla.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c10:ok.nd": {
            name: "US|Tenth Circuit|N.D. Oklahoma",
            abbr: [ {
                name: "N.D. Oklahoma",
                court: "District Court"
            }, {
                name: "N.D. Okla.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Okla",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c10:ok.wd": {
            name: "US|Tenth Circuit|W.D. Oklahoma",
            abbr: [ {
                name: "W.D. Oklahoma",
                court: "District Court"
            }, {
                name: "W.D. Okla.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Okla.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c10:ut.d": {
            name: "US|Tenth Circuit|D. Utah",
            abbr: [ {
                name: "D. Utah",
                court: "United States District Court"
            }, {
                name: "Bankr. D. Utah",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c10:wy.d": {
            name: "US|Tenth Circuit|D. Wyoming",
            abbr: [ {
                name: "D. Wyoming",
                court: "District Court"
            }, {
                name: "Bankr. D. Wyo.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11": {
            name: "US|Eleventh Circuit",
            abbr: [ {
                name: "11th Circuit",
                court: "Court of Appeals"
            }, {
                name: "11th Cir.",
                court: "Court of Appeals",
                default: true
            } ]
        },
        "us:c11:al.md": {
            name: "US|Eleventh Circuit|M.D. Alabama",
            abbr: [ {
                name: "MD Alabama",
                court: "District Court"
            }, {
                name: "M.D. Ala.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. M.D. Ala.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11:al.nd": {
            name: "US|Eleventh Circuit|N.D. Alabama",
            abbr: [ {
                name: "N.D. Alabama",
                court: "District Court"
            }, {
                name: "N.D. Ala.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Ala.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11:al.sd": {
            name: "US|Eleventh Circuit|S.D. Alabama",
            abbr: [ {
                name: "S.D. Alabama",
                court: "District Court"
            }, {
                name: "S.D. Ala.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Ala.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11:fl.md": {
            name: "US|Eleventh Circuit|M.D. Florida",
            abbr: [ {
                name: "MD Florida",
                court: "District Court"
            }, {
                name: "M.D. Fla.",
                court: "District Court",
                default: true
            } ]
        },
        "us:c11:fl.nd": {
            name: "US|Eleventh Circuit|N.D. Florida",
            abbr: [ {
                name: "N.D. Florida",
                court: "District Court"
            }, {
                name: "N.D. Fla.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Fla.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11:fl.sd": {
            name: "US|Eleventh Circuit|S.D. Florida",
            abbr: [ {
                name: "S.D. Florida",
                court: "District Court"
            }, {
                name: "S.D. Fla.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Florida",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11:ga.md": {
            name: "US|Eleventh Circuit|M.D. Georgia",
            abbr: [ {
                name: "MD Georgia"
            }, {
                name: "Bankr. M.D. Ga.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11:ga.nd": {
            name: "US|Eleventh Circuit|N.D. Georgia",
            abbr: [ {
                name: "N.D. Georgia",
                court: "District Court"
            }, {
                name: "N.D. Ga.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Ga.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c11:ga.sd": {
            name: "US|Eleventh Circuit|S.D. Georgia",
            abbr: [ {
                name: "S.D. Georgia",
                court: "District Court"
            }, {
                name: "S.D. Ga.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Ga.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c1:ma.d": {
            name: "US|First Circuit|D. Massachusetts",
            abbr: [ {
                name: "D. Massachusetts",
                court: "District Court"
            }, {
                name: "D. Mass.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Mass.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c1:me.d": {
            name: "US|First Circuit|D. Maine",
            abbr: [ {
                name: "D. Maine",
                court: "District Court"
            }, {
                name: "D. Me.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Me.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c1:nh.d": {
            name: "US|First Circuit|D. New Hampshire",
            abbr: [ {
                name: "D. New Hampshire",
                court: "District Court"
            }, {
                name: "D.N.H.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.N.H.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c1:pr.d": {
            name: "US|First Circuit|D. Puerto Rico",
            abbr: [ {
                name: "D. Puerto Rico",
                court: "District Court"
            }, {
                name: "D.P.R.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.P.R.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c1:ri.d": {
            name: "US|First Circuit|D. Rhode Island",
            abbr: [ {
                name: "D. Rhode Island",
                court: "District Court"
            }, {
                name: "D.R.I.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.R.I.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c2": {
            name: "US|Second Circuit",
            abbr: [ {
                name: "2nd Circuit",
                court: "Court of Appeals"
            }, {
                name: "2d Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "2d Cir. BAP",
                court: "Bankruptcy Appellate Panel"
            } ]
        },
        "us:c2:ct.d": {
            name: "US|Second Circuit|D. Connecticut",
            abbr: [ {
                name: "D. Connecticut",
                court: "District Court"
            }, {
                name: "D. Conn.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Conn.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c2:ny.ed": {
            name: "US|Second Circuit|E.D. New York",
            abbr: [ {
                name: "E.D. New York",
                court: "District Court"
            }, {
                name: "E.D.N.Y",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D.N.Y.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c2:ny.nd": {
            name: "US|Second Circuit|N.D. New York",
            abbr: [ {
                name: "N.D. New York",
                court: "District Court"
            }, {
                name: "Bankr. N.D.N.Y.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c2:ny.sd": {
            name: "US|Second Circuit|S.D. New York",
            abbr: [ {
                name: "S.D. New York",
                court: "District Court"
            }, {
                name: "S.D.N.Y.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D.N.Y.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c2:ny.wd": {
            name: "US|Second Circuit|W.D. New York",
            abbr: [ {
                name: "W.D. New York",
                court: "District Court"
            }, {
                name: "W.D.N.Y.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D.N.Y.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c2:vt.d": {
            name: "US|Second Circuit|D. Vermont",
            abbr: [ {
                name: "D. Vermont",
                court: "District Court"
            }, {
                name: "D. Vt.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Vt.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c3": {
            name: "US|Third Circuit",
            abbr: [ {
                name: "3rd Circuit",
                court: "Court of Appeals"
            }, {
                name: "3rd Cir.",
                court: "Court of Appeals",
                default: true
            } ]
        },
        "us:c3:de.d": {
            name: "US|Third Circuit|D. Delaware",
            abbr: [ {
                name: "D. Delaware",
                court: "District Court"
            }, {
                name: "D. Del.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Del.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c3:nj.d": {
            name: "US|Third Circuit|D. New Jersey",
            abbr: [ {
                name: "D. New Jersey",
                court: "District Court"
            }, {
                name: "D.N.J.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.N.J.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c3:pa.d": {
            name: "US|Third Circuit|D. Pennsylvania",
            abbr: [ {
                name: "D. Pa.",
                court: "District Court"
            } ]
        },
        "us:c3:pa.ed": {
            name: "US|Third Circuit|E.D. Pennsylvania",
            abbr: [ {
                name: "E.D. Pennsylvania",
                court: "District Court"
            }, {
                name: "E.D. Pa.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Pa.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c3:pa.md": {
            name: "US|Third Circuit|M.D. Pennsylvania",
            abbr: [ {
                name: "MD Pennsylvania",
                court: "District Court"
            }, {
                name: "M.D. Penn.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. M.D. Penn.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c3:pa.wd": {
            name: "US|Third Circuit|W.D. Pennsylvania",
            abbr: [ {
                name: "W.D. Pennsylvania",
                court: "District Court"
            }, {
                name: "W.D. Pa.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Pa.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c3:vi.d": {
            name: "US|Third Circuit|D. U.S. Virgin Islands",
            abbr: [ {
                name: "D. Virgin Islands",
                court: "District Court"
            }, {
                name: "D.V.I.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.V.I.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4": {
            name: "US|Fourth Circuit",
            abbr: [ {
                name: "4th Circuit",
                court: "Court of Appeals"
            }, {
                name: "4th Cir.",
                court: "Court of Appeals",
                default: true
            } ]
        },
        "us:c4:md.d": {
            name: "US|Fourth Circuit|D. Maryland",
            abbr: [ {
                name: "D. Maryland",
                court: "District Court"
            }, {
                name: "Bankr. D. Md.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:nc.ed": {
            name: "US|Fourth Circuit|E.D. North Carolina",
            abbr: [ {
                name: "E.D. North Carolina",
                court: "District Court"
            }, {
                name: "E.D.N.C.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D.N.C.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:nc.md": {
            name: "US|Fourth Circuit|M.D. North Carolina",
            abbr: [ {
                name: "MD North Carolina",
                court: "District Court"
            }, {
                name: "M.D.N.C.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. M.D.N.C.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:nc.wd": {
            name: "US|Fourth Circuit|W.D. North Carolina",
            abbr: [ {
                name: "W.D. North Carolina",
                court: "District Court"
            }, {
                name: "W.D.N.C.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D.N.C.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:sc.ed": {
            name: "US|Fourth Circuit|E.D. South Carolina",
            abbr: [ {
                name: "E.D. South Carolina",
                court: "District Court"
            }, {
                name: "E.D.S.C.",
                court: "District Court",
                default: true
            } ]
        },
        "us:c4:sc.wd": {
            name: "US|Fourth Circuit|W.D. South Carolina",
            abbr: [ {
                name: "W.D. South Carolina",
                court: "District Court"
            }, {
                name: "W.D.S.C.",
                court: "District Court",
                default: true
            } ]
        },
        "us:c4:sc.d": {
            name: "US|Fourth Circuit|D. South Carolina",
            abbr: [ {
                name: "D. South Carolina",
                court: "District Court"
            }, {
                name: "D.S.C.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.S.C.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:va.ed": {
            name: "US|Fourth Circuit|E.D. Virginia",
            abbr: [ {
                name: "E.D. Virginia",
                court: "District Court"
            }, {
                name: "E.D. Va.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Va.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:va.wd": {
            name: "US|Fourth Circuit|W.D. Virginia",
            abbr: [ {
                name: "W.D. Virginia",
                court: "District Court"
            }, {
                name: "W.D. Va.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Va.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:wv.nd": {
            name: "US|Fourth Circuit|N.D. West Virginia",
            abbr: [ {
                name: "N.D. West Virginia",
                court: "District Court"
            }, {
                name: "N.D.W. Va.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D.W. Va.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c4:wv.sd": {
            name: "US|Fourth Circuit|S.D. West Virginia",
            abbr: [ {
                name: "S.D. West Virginia",
                court: "District Court"
            }, {
                name: "S.D.W. Va",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D.W. Va.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5": {
            name: "US|Fifth Circuit",
            abbr: [ {
                name: "5th Circuit",
                court: "Court of Appeals"
            }, {
                name: "5th Cir.",
                court: "Court of Appeals",
                default: true
            } ]
        },
        "us:c5:la.ed": {
            name: "US|Fifth Circuit|E.D. Louisiana",
            abbr: [ {
                name: "E.D. Louisiana",
                court: "District Court"
            }, {
                name: "E.D. La.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. La.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:la.md": {
            name: "US|Fifth Circuit|M.D. Louisiana",
            abbr: [ {
                name: "MD Louisiana",
                court: "District Court"
            }, {
                name: "M.D. La.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. M.D. La.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:la.wd": {
            name: "US|Fifth Circuit|W.D. Louisiana",
            abbr: [ {
                name: "W.D. Louisiana",
                court: "District Court"
            }, {
                name: "W.D. La.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. La.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:ms.nd": {
            name: "US|Fifth Circuit|N.D. Mississippi",
            abbr: [ {
                name: "N.D. Mississippi",
                court: "District Court"
            }, {
                name: "N.D. Miss.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Miss.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:ms.sd": {
            name: "US|Fifth Circuit|S.D. Mississippi",
            abbr: [ {
                name: "S.D. Mississippi",
                court: "District Court"
            }, {
                name: "S.D. Miss.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Miss.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:pz.d": {
            name: "US|Fifth Circuit|D. Panama Canal Zone",
            abbr: []
        },
        "us:c5:tx.ed": {
            name: "US|Fifth Circuit|E.D. Texas",
            abbr: [ {
                name: "E.D. Texas",
                court: "District Court"
            }, {
                name: "E.D. Tex.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Tex.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:tx.nd": {
            name: "US|Fifth Circuit|N.D. Texas",
            abbr: [ {
                name: "N.D. Texas",
                court: "District Court"
            }, {
                name: "N.D. Tex.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Tex.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:tx.sd": {
            name: "US|Fifth Circuit|S.D. Texas",
            abbr: [ {
                name: "S.D. Texas",
                court: "District Court"
            }, {
                name: "S.D. Tex.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Tex.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c5:tx.wd": {
            name: "US|Fifth Circuit|W.D. Texas",
            abbr: [ {
                name: "W.D. Texas",
                court: "District Court"
            }, {
                name: "W.D. Tex.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Tex.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6": {
            name: "US|Sixth Circuit",
            abbr: [ {
                name: "6th Circuit",
                court: "Court of Appeals"
            }, {
                name: "6th Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "6th Cir. BAP",
                court: "Bankruptcy Appellate Panel"
            } ]
        },
        "us:c6:ky.ed": {
            name: "US|Sixth Circuit|E.D. Kentucky",
            abbr: [ {
                name: "E.D. Kentucky",
                court: "District Court"
            }, {
                name: "E.D. Ky.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Ky.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:ky.wd": {
            name: "US|Sixth Circuit|W.D. Kentucky",
            abbr: [ {
                name: "W.D. Kentucky",
                court: "District Court"
            }, {
                name: "W.D. Ky.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Ky.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:mi.ed": {
            name: "US|Sixth Circuit|E.D. Michigan",
            abbr: [ {
                name: "E.D. Michigan",
                court: "District Court"
            }, {
                name: "E.D. Mich.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Mich.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:mi.wd": {
            name: "US|Sixth Circuit|W.D. Michigan",
            abbr: [ {
                name: "W.D. Michigan"
            }, {
                name: "Bankr. W.D. Mich.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:oh.d": {
            name: "US|Sixth Circuit|D. Ohio",
            abbr: [ {
                name: "D. Ohio",
                court: "District Court"
            } ]
        },
        "us:c6:oh.nd": {
            name: "US|Sixth Circuit|N.D. Ohio",
            abbr: [ {
                name: "N.D. Ohio",
                court: "District Court"
            }, {
                name: "Bankr. N.D. Ohio",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:oh.sd": {
            name: "US|Sixth Circuit|S.D. Ohio",
            abbr: [ {
                name: "S.D. Ohio",
                court: "District Court"
            }, {
                name: "Bankr. S.D. Ohio",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:tn.d": {
            name: "US|Sixth Circuit|D. Tennessee",
            abbr: [ {
                name: "D. Tenn.",
                court: "District Court"
            }, {
                name: "Bankr. D. Tenn.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:tn.ed": {
            name: "US|Sixth Circuit|E.D. Tennessee",
            abbr: [ {
                name: "E.D. Tennessee",
                court: "District Court"
            }, {
                name: "E.D. Tenn.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Tenn.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:tn.md": {
            name: "US|Sixth Circuit|M.D. Tennessee",
            abbr: [ {
                name: "MD Tennessee",
                court: "District Court"
            }, {
                name: "M.D. Tenn.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. M.D. Tenn.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c6:tn.wd": {
            name: "US|Sixth Circuit|W.D. Tennessee",
            abbr: [ {
                name: "W.D. Tennessee",
                court: "District Court"
            }, {
                name: "W.D. Tenn.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Tenn.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c7": {
            name: "US|Seventh Circuit",
            abbr: [ {
                name: "7th Circuit",
                court: "Court of Appeals"
            }, {
                name: "7th Cir.",
                court: "Court of Appeals",
                default: true
            } ]
        },
        "us:c7:il.cd": {
            name: "US|Seventh Circuit|C.D. Illinois",
            abbr: [ {
                name: "CD Illinois",
                court: "District Court"
            }, {
                name: "C.D. Ill.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. C.D. Ill.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c7:il.d": {
            name: "US|Seventh Circuit|D. Illinois",
            abbr: [ {
                name: "D. Ill.",
                court: "District Court"
            } ]
        },
        "us:c7:il.ed": {
            name: "US|Seventh Circuit|E.D. Illinois",
            abbr: [ {
                name: "E.D. Ill.",
                court: "District Court"
            } ]
        },
        "us:c7:il.nd": {
            name: "US|Seventh Circuit|N.D. Illinois",
            abbr: [ {
                name: "N.D. Illinois",
                court: "District Court"
            }, {
                name: "N.D. Ill.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Ill.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c7:il.sd": {
            name: "US|Seventh Circuit|S.D. Illinois",
            abbr: [ {
                name: "S.D. Illinois",
                court: "District Court"
            }, {
                name: "S.D. Ill.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Ill.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c7:in.d": {
            name: "US|Seventh Circuit|D. Indiana",
            abbr: [ {
                name: "D. Ind.",
                court: "District Court"
            } ]
        },
        "us:c7:in.nd": {
            name: "US|Seventh Circuit|N.D. Indiana",
            abbr: [ {
                name: "N.D. Indiana",
                court: "District Court"
            }, {
                name: "N.D. Ind.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Ind.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c7:in.sd": {
            name: "US|Seventh Circuit|S.D. Indiana",
            abbr: [ {
                name: "S.D. Indiana",
                court: "District Court"
            }, {
                name: "S.D. Ind.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Ind.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c7:wi.ed": {
            name: "US|Seventh Circuit|E.D. Wisconsin",
            abbr: [ {
                name: "E.D. Wisconsin",
                court: "District Court"
            }, {
                name: "E.D. Wis.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Wis.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c7:wi.wd": {
            name: "US|Seventh Circuit|W.D. Wisconsin",
            abbr: [ {
                name: "W.D. Wisconsin",
                court: "District Court"
            }, {
                name: "W.D. Wis.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Wis.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8": {
            name: "US|Eighth Circuit",
            abbr: [ {
                name: "8th Circuit",
                court: "Court of Appeals"
            }, {
                name: "8th Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "8th Cir. BAP",
                court: "United States Bankruptcy Appellate Panel"
            } ]
        },
        "us:c8:ar.ed": {
            name: "US|Eighth Circuit|E.D. Arkansas",
            abbr: [ {
                name: "E.D. Arkansas",
                court: "District Court"
            }, {
                name: "E.D. Ark.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Ark.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:ar.wd": {
            name: "US|Eighth Circuit|W.D. Arkansas",
            abbr: [ {
                name: "W.D. Arkansas",
                court: "District Court"
            }, {
                name: "W.D. Ark.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Ark.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:ia.nd": {
            name: "US|Eighth Circuit|N.D. Iowa",
            abbr: [ {
                name: "N.D. Iowa",
                court: "District Court"
            }, {
                name: "Bankr. N.D. Iowa",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:ia.sd": {
            name: "US|Eighth Circuit|S.D. Iowa",
            abbr: [ {
                name: "S.D. Iowa",
                court: "District Court"
            }, {
                name: "Bankr. S.D. Iowa",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:mn.d": {
            name: "US|Eighth Circuit|D. Minnesota",
            abbr: [ {
                name: "Minnesota",
                court: "District Court"
            }, {
                name: "D. Minnesota",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Minn.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:mo.cd": {
            name: "US|Eighth Circuit|C.D. Missouri",
            abbr: [ {
                name: "C.D. Mo.",
                court: "District Court"
            } ]
        },
        "us:c8:mo.ed": {
            name: "US|Eighth Circuit|E.D. Missouri",
            abbr: [ {
                name: "E.D. Missouri",
                court: "District Court"
            }, {
                name: "E.D. Mo.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Mo.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:mo.sd": {
            name: "US|Eighth Circuit|S.D. Missouri",
            abbr: [ {
                name: "Mo. S.D.",
                court: "District Court"
            } ]
        },
        "us:c8:mo.wd": {
            name: "US|Eighth Circuit|W.D. Missouri",
            abbr: [ {
                name: "W.D. Missouri",
                court: "District Court"
            }, {
                name: "W.D. Mo.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Mo.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:nd.d": {
            name: "US|Eighth Circuit|D. North Dakota",
            abbr: [ {
                name: "D. North Dakota",
                court: "District Court"
            }, {
                name: "D.N.D.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.N.D.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:ne.d": {
            name: "US|Eighth Circuit|D. Nebraska",
            abbr: [ {
                name: "D. Nebraska",
                court: "District Court"
            }, {
                name: "D. Neb.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Neb.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c8:sd.d": {
            name: "US|Eighth Circuit|D. South Dakota",
            abbr: [ {
                name: "D. South Dakota",
                court: "District Court"
            }, {
                name: "D.S.D.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D.S.D.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9": {
            name: "US|Ninth Circuit",
            abbr: [ {
                name: "9th Circuit",
                court: "Court of Appeals"
            }, {
                name: "9th Cir.",
                court: "Court of Appeals",
                default: true
            }, {
                name: "9th Cir. BAP",
                court: "United States Bankruptcy Appellate Panel"
            } ]
        },
        "us:c9:ak.d": {
            name: "US|Ninth Circuit|D. Alaska",
            abbr: [ {
                name: "D. Alaska",
                court: "District Court"
            }, {
                name: "Bankr. D. Alaska",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:az.d": {
            name: "US|Ninth Circuit|D. Arizona",
            abbr: [ {
                name: "D. Arizona",
                court: "District Court"
            }, {
                name: "D. Ariz.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Ariz.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:ca.cd": {
            name: "US|Ninth Circuit|C.D. California",
            abbr: [ {
                name: "CD California",
                court: "District Court"
            }, {
                name: "C.D. Cal.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. C.D. Cal.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:ca.d": {
            name: "US|Ninth Circuit|D. California",
            abbr: [ {
                name: "D. Cal.",
                court: "District Court"
            } ]
        },
        "us:c9:ca.ed": {
            name: "US|Ninth Circuit|E.D. California",
            abbr: [ {
                name: "E.D. California",
                court: "District Court"
            }, {
                name: "E.D. Cal.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Cal.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:ca.nd": {
            name: "US|Ninth Circuit|N.D. California",
            abbr: [ {
                name: "N.D. California",
                court: "District Court"
            }, {
                name: "N.D. Cal.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. N.D. Cal.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:ca.sd": {
            name: "US|Ninth Circuit|S.D. California",
            abbr: [ {
                name: "S.D. California",
                court: "District Court"
            }, {
                name: "S.D. Cal.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. S.D. Cal.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:gu.d": {
            name: "US|Ninth Circuit|D. Guam",
            abbr: [ {
                name: "D. Guam",
                court: "District Court"
            }, {
                name: "Bankr. D. Guam",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:hi.d": {
            name: "US|Ninth Circuit|D. Hawaii",
            abbr: [ {
                name: "D. Hawaii",
                court: "District Court"
            }, {
                name: "D. Haw.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Haw.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:id.d": {
            name: "US|Ninth Circuit|D. Idaho",
            abbr: [ {
                name: "D. Idaho",
                court: "District Court"
            }, {
                name: "Bankr. D. Idaho",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:mp.d": {
            name: "US|Ninth Circuit|D. Northern Mariana Islands",
            abbr: [ {
                name: "N. Mar. I.",
                court: "District Court"
            }, {
                name: "Bankr. N. Mar. I.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:mt.d": {
            name: "US|Ninth Circuit|D. Montana",
            abbr: [ {
                name: "D. Montana",
                court: "District Court"
            }, {
                name: "D. Mont.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Mont.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:nv.d": {
            name: "US|Ninth Circuit|D. Nevada",
            abbr: [ {
                name: "D. Nevada",
                court: "District Court"
            }, {
                name: "D. Nev.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Nev.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:or.d": {
            name: "US|Ninth Circuit|D. Oregon",
            abbr: [ {
                name: "D. Oregon",
                court: "District Court"
            }, {
                name: "D. Or.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. D. Or.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:wa.ed": {
            name: "US|Ninth Circuit|E.D. Washington",
            abbr: [ {
                name: "E.D. Washington",
                court: "District Court"
            }, {
                name: "E.D. Wash.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. E.D. Wash.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:c9:wa.wd": {
            name: "US|Ninth Circuit|W.D. Washington",
            abbr: [ {
                name: "W.D. Washington",
                court: "District Court"
            }, {
                name: "W.D. Wash.",
                court: "District Court",
                default: true
            }, {
                name: "Bankr. W.D. Wash.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:ca": {
            name: "US|California",
            abbr: [ {
                name: "Cal.",
                court: "Supreme Court"
            }, {
                name: "Cal. Ct. App.",
                court: "Court of Appeal"
            } ]
        },
        "us:co": {
            name: "US|Colorado",
            abbr: [ {
                name: "Colo.",
                court: "Supreme Court"
            }, {
                name: "Colo. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:ct": {
            name: "US|Connecticut",
            abbr: [ {
                name: "Conn.",
                court: "Supreme Court"
            }, {
                name: "Conn. App. Ct.",
                court: "Appellate Court"
            }, {
                name: "Conn. Super. Ct.",
                court: "Superior Court"
            } ]
        },
        "us:dc": {
            name: "US|District of Columbia",
            abbr: []
        },
        "us:de": {
            name: "US|Delaware",
            abbr: [ {
                name: "Del.",
                court: "Supreme Court"
            }, {
                name: "Del. Ch.",
                court: "Court of Chancery"
            }, {
                name: "Del. Fm. Ct.",
                court: "Family Court"
            }, {
                name: "Ct. Jud. Del.",
                court: "Court on the Judiciary"
            }, {
                name: "Del. Super. Ct.",
                court: "Superior Court"
            } ]
        },
        "us:fl": {
            name: "US|Florida",
            abbr: [ {
                name: "Fla.",
                court: "Supreme Court"
            }, {
                name: "Fla. Dist. Ct. App.",
                court: "District Court of Appeal"
            }, {
                name: "Bankr. M.D. Fla.",
                court: "Bankruptcy Court"
            } ]
        },
        "us:ga": {
            name: "US|Georgia",
            abbr: [ {
                name: "Ga",
                court: "Supreme Court"
            }, {
                name: "Ga. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:gu": {
            name: "US|Guam",
            abbr: []
        },
        "us:hi": {
            name: "US|Hawaii",
            abbr: [ {
                name: "Haw.",
                court: "Supreme Court"
            }, {
                name: "Haw. App.",
                court: "Intermediate Court of Appeals"
            } ]
        },
        "us:ia": {
            name: "US|Iowa",
            abbr: [ {
                name: "Iowa",
                court: "Supreme Court"
            }, {
                name: "Iowa Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:id": {
            name: "US|Idaho",
            abbr: [ {
                name: "Idaho",
                court: "Supreme Court"
            }, {
                name: "Idaho Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:il": {
            name: "US|Illinois",
            abbr: [ {
                name: "Ill.",
                court: "Supreme Court"
            }, {
                name: "Ill. App. Ct.",
                court: "Appellate Court"
            } ]
        },
        "us:in": {
            name: "US|Indiana",
            abbr: [ {
                name: "Ind.",
                court: "Supreme Court"
            }, {
                name: "Ind. Ct. App.",
                court: "Court of Appeals"
            }, {
                name: "Ind. T.C.",
                court: "Tax Court"
            } ]
        },
        "us:ks": {
            name: "US|Kansas",
            abbr: [ {
                name: "Kan.",
                court: "Supreme Court"
            }, {
                name: "Kan. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:ky": {
            name: "US|Kentucky",
            abbr: [ {
                name: "Ky.",
                court: "Supreme Court"
            }, {
                name: "Ky. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:la": {
            name: "US|Louisiana",
            abbr: [ {
                name: "La.",
                court: "Supreme Court"
            }, {
                name: "La. Ct. App.",
                court: "Court of Appeal"
            } ]
        },
        "us:ma": {
            name: "US|Massachusetts",
            abbr: [ {
                name: "Mass.",
                court: "Supreme Judicial Court"
            }, {
                name: "Mass. App. Ct.",
                court: "Appeals Court"
            } ]
        },
        "us:md": {
            name: "US|Maryland",
            abbr: [ {
                name: "Md.",
                court: "Court of Appeals"
            }, {
                name: "Md. Ct. Spec. App.",
                court: "Court of Special Appeals"
            } ]
        },
        "us:me": {
            name: "US|Maine",
            abbr: [ {
                name: "Me.",
                court: "Supreme Judicial Court"
            } ]
        },
        "us:mi": {
            name: "US|Michigan",
            abbr: [ {
                name: "Mich.",
                court: "Supreme Court"
            }, {
                name: "Mich. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:mn": {
            name: "US|Minnesota",
            abbr: [ {
                name: "Minn.",
                court: "Supreme Court"
            }, {
                name: "Minn. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:mo": {
            name: "US|Missouri",
            abbr: [ {
                name: "Mo.",
                court: "Supreme Court"
            }, {
                name: "Mo. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:mp": {
            name: "US|Northern Mariana Islands",
            abbr: []
        },
        "us:ms": {
            name: "US|Mississippi",
            abbr: [ {
                name: "Miss.",
                court: "Supreme Court"
            }, {
                name: "Miss. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:mt": {
            name: "US|Montana",
            abbr: [ {
                name: "Mont.",
                court: "Supreme Court"
            } ]
        },
        "us:navajo": {
            name: "US|Navajo Nation",
            abbr: [ {
                name: "Navajo",
                court: "Supreme Court"
            } ]
        },
        "us:nc": {
            name: "US|North Carolina",
            abbr: [ {
                name: "N.C.",
                court: "Supreme Court"
            }, {
                name: "N.C. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:nd": {
            name: "US|North Dakota",
            abbr: [ {
                name: "N.D.",
                court: "Supreme Court"
            }, {
                name: "N.D. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:ne": {
            name: "US|Nebraska",
            abbr: [ {
                name: "Neb.",
                court: "Supreme Court"
            }, {
                name: "Neb. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:nh": {
            name: "US|New Hampshire",
            abbr: [ {
                name: "N.H.",
                court: "Supreme Court"
            } ]
        },
        "us:nj": {
            name: "US|New Jersey",
            abbr: [ {
                name: "N.J.",
                court: "Supreme Court"
            }, {
                name: "N.J. Super. Ct. App. Div.",
                court: "Superior Court"
            }, {
                name: "N.J. Tax Ct.",
                court: "Tax Court"
            } ]
        },
        "us:nm": {
            name: "US|New Mexico",
            abbr: [ {
                name: "N.M.",
                court: "Supreme Court"
            }, {
                name: "N.M. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:nv": {
            name: "US|Nevada",
            abbr: [ {
                name: "Nev.",
                court: "Supreme Court"
            } ]
        },
        "us:ny": {
            name: "US|New York",
            abbr: [ {
                name: "N.Y.",
                court: "Court of Appeals"
            }, {
                name: "N.Y. App. Div.",
                court: "Appellate Division of the Supreme Court"
            }, {
                name: "N.Y. Fam. Ct.",
                court: "Family Court"
            }, {
                name: "N.Y. Sur. Ct.",
                court: "Surrogate 's Court"
            } ]
        },
        "us:oh": {
            name: "US|Ohio",
            abbr: [ {
                name: "Ohio",
                court: "Supreme Court"
            } ]
        },
        "us:ok": {
            name: "US|Oklahoma",
            abbr: [ {
                name: "Okla.",
                court: "Supreme Court"
            }, {
                name: "Okla. Civ. App.",
                court: "Court of Civil Appeals"
            }, {
                name: "Okla. C.O.J.",
                court: "Court on the Judiciary"
            }, {
                name: "Okla. Crim. App.",
                court: "Court of Criminal Appeals"
            }, {
                name: "Okla. J.E.A.P.",
                court: "Judicial Ethics Advisory Panel"
            } ]
        },
        "us:or": {
            name: "US|Oregon",
            abbr: [ {
                name: "Or.",
                court: "Supreme Court"
            }, {
                name: "Or. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:pa": {
            name: "US|Pennsylvania",
            abbr: [ {
                name: "Pa.",
                court: "Supreme Court"
            }, {
                name: "Pa. Commw. Ct.",
                court: "Commonwealth Court"
            }, {
                name: "Special Tribunal of Pa.",
                court: "Special Tribunal"
            }, {
                name: "Pa. Super. Ct.",
                court: "Superior Court"
            }, {
                name: "Ct. Jud. Disc. Pa",
                court: "Court of Judicial Discipline"
            } ]
        },
        "us:pr": {
            name: "US|Puerto Rico",
            abbr: [ {
                name: "P.R.",
                court: "Supreme Court"
            } ]
        },
        "us:ri": {
            name: "US|Rhode Island",
            abbr: [ {
                name: "R.I.",
                court: "Supreme Court"
            } ]
        },
        "us:sc": {
            name: "US|South Carolina",
            abbr: [ {
                name: "S.C.",
                court: "Supreme Court"
            }, {
                name: "S.C. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:sd": {
            name: "US|South Dakota",
            abbr: [ {
                name: "S.D.",
                court: "Supreme Court"
            } ]
        },
        "us:tn": {
            name: "US|Tennessee",
            abbr: [ {
                name: "Tenn.",
                court: "Supreme Court"
            }, {
                name: "Tenn. Crim. App.",
                court: "Court of Criminal Appeals"
            }, {
                name: "Tenn. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:tx": {
            name: "US|Texas",
            abbr: [ {
                name: "Tex.",
                court: "Supreme Court"
            }, {
                name: "Tex. App.",
                court: "Court of Appeals"
            }, {
                name: "Tex. Crim. App.",
                court: "Court of Criminal Appeals"
            }, {
                name: "Tex. Rev.",
                court: "Special Court of Review"
            } ]
        },
        "us:ut": {
            name: "US|Utah",
            abbr: [ {
                name: "Utah",
                court: "Supreme Court"
            }, {
                name: "Utah Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:va": {
            name: "US|Virginia",
            abbr: [ {
                name: "Va.",
                court: "Supreme Court"
            }, {
                name: "Va. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:vi": {
            name: "US|U.S. Virgin Islands",
            abbr: []
        },
        "us:vt": {
            name: "US|Vermont",
            abbr: [ {
                name: "Vt.",
                court: "Supreme Court of Vermont"
            } ]
        },
        "us:wa": {
            name: "US|Washington",
            abbr: [ {
                name: "Wash.",
                court: "Supreme Court"
            }, {
                name: "Wash. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:wi": {
            name: "US|Wisconsin",
            abbr: [ {
                name: "Wis.",
                court: "Supreme Court"
            }, {
                name: "Wis. Ct. App.",
                court: "Court of Appeals"
            } ]
        },
        "us:wv": {
            name: "US|West Virginia",
            abbr: [ {
                name: "W. Va.",
                court: "Supreme Court"
            } ]
        },
        "us:wy": {
            name: "US|Wyoming",
            abbr: [ {
                name: "Wyo.",
                court: "Supreme Court"
            } ]
        }
    },
    getJurisdiction: function(a) {
        var b = this.jurisdictions;
        var c = 0;
        var d = {
            jurisdiction: undefined,
            court: undefined
        };
        if (a === undefined || a === null) {
            return d;
        }
        a = a.toUpperCase().replace(/[\.\s]/g, "");
        for (var e in b) {
            if (b[e].abbr && PP.Utils.isArray(b[e].abbr)) {
                b[e].abbr.forEach(function(f) {
                    if (f.name) {
                        var g = f.name.toUpperCase().replace(/[\.\s]/g, "");
                        if (g == a) {
                            d.jurisdiction = b[e].name;
                            d.court = f.court;
                            c++;
                        }
                    }
                });
            }
        }
        if (c > 1) {
            d = {
                jurisdiction: undefined,
                court: undefined
            };
        }
        return d;
    },
    getJurisdictionCSL: function(a) {
        var b = this.jurisdictions;
        var c = "";
        a = a.toUpperCase().replace(/[\.\s]/g, "");
        for (var d in b) {
            if (b[d].name) {
                var e = b[d].name.toUpperCase().replace(/[\.\s]/g, "");
                if (e == a) {
                    c = d;
                }
            }
        }
        return c;
    },
    getCourtAbbreviation: function(a, b) {
        var c = a || "";
        if (b) {
            var d = this.jurisdictions[b];
            if (d && d.abbr) {
                a = a.toUpperCase().replace(/\s/g, "");
                if (a == "DIST.COURT") a = "DISTRICTCOURT";
                var e = {};
                d.abbr.forEach(function(a) {
                    if (a["default"]) {
                        if (a.court) {
                            var b = a.court.toUpperCase().replace(/\s/g, "");
                            e[b] = a.name;
                        }
                    }
                });
                d.abbr.forEach(function(a) {
                    if (a.court) {
                        var b = a.court.toUpperCase().replace(/\s/g, "");
                        if (!(b in e)) {
                            e[b] = a.name;
                        }
                    }
                });
                if (a in e) c = e[a];
            }
        }
        return c;
    }
});

PP.library.Jurisdictions = new PP.library._Jurisdictions();

PP.library._LegalAbbreviations = PP.Class.extend({
    abbr: {
        us: {
            classic: {},
            "collection-title": {},
            "container-phrase": {},
            "container-title": {
                "A. 2d": "A.2d",
                "A. 3d": "A.3d",
                "Atlantic Reporter": "A.",
                "Atlantic Reporter 2d": "A.2d",
                "Atlantic Reporter 3d": "A.3d",
                "B. R.": "B.R.",
                BR: "B.R.",
                "Bankruptcy Reporter": "B.R.",
                Black: "Black",
                "Board of Tax Appeals Memorandum Decisions": "B.T.A.M. (P-H)",
                "Court Martial Reports": "C.M.R.",
                "Court of Claims Reports": "Ct. Cl.",
                "Court of Customs Appeals Reports": "Ct. Cust.",
                "Court of Customs and Patent Appeals Reports": "C.C.P.A.",
                "Court of International Trade Reports": "Ct. Int\u2019l Trade",
                Cranch: "Cranch",
                "Ct.Cl.": "Ct. Cl.",
                "Ct.Int'l Trade": "Ct. Int\u2019l Trade",
                "Customs Bulletin and Decisions": "Cust. B. & Dec.",
                "Customs Court Reports": "Cust. Ct.",
                Dallas: "Dall.",
                "Decisions of the United States Court of Military Appeals": "C.M.A.",
                "F. 2d": "F.2d",
                "F. 3d": "F.3d",
                "F. Supp.2d": "F. Supp. 2d",
                "F.2d": "F.2d",
                "F.3d": "F.3d",
                "F.Supp.": "F. Supp.",
                "F.Supp. 2d": "F. Supp. 2d",
                "F.Supp.2d": "F. Supp. 2d",
                "Fed.Cl.": "Fed. Cl.",
                "Federal Appendix": "F. App\u2019x",
                "Federal Cases": "F. Cas.",
                "Federal Claims Reporter": "Fed. Cl.",
                "Federal Reporter": "F.",
                "Federal Reporter 2d": "F.2d",
                "Federal Reporter 3d": "F.3d",
                "Federal Rules Decisions": "F.R.D.",
                "Federal Rules Service": "Fed. R. Serv. (Callaghan)",
                "Federal Rules Service 2d": "Fed. R. Serv. 2d (Callaghan)",
                "Federal Rules Service 3d": "Fed. R. Serv. 3d (West)",
                "Federal Supplement": "F. Supp.",
                "Federal Supplement 2d": "F. Supp. 2d",
                Howard: "How.",
                "International Trade Reporter Decisions": "I.T.R.D. (BNA)",
                "Kan.App.": "Kan. App.",
                "Kansas Court of Appeals Reports": "Kan. App.",
                "L. Ed.2d": "L. Ed. 2d",
                "L.Ed.": "L. Ed.",
                "L.Ed. 2d": "L. Ed. 2d",
                "L.Ed.2d": "L. Ed. 2d",
                "Lawyers' Edition": "L. Ed.",
                "Lawyers' Edition 2d": "L. Ed. 2d",
                "M. J.": "M.J.",
                "N. E.": "N.E.",
                "N. E. 2d": "N.E.2d",
                "N. E.2d": "N.E.2d",
                "N. W.": "N.W.",
                "N. W. 2d": "N.W.2d",
                "N. W.2d": "N.W.2d",
                "N.E. 2d": "N.E.2d",
                "N.W. 2d": "N.W.2d",
                "NE 2d": "N.E.2d",
                "NW 2d": "N.W.2d",
                "North Eastern Reporter": "N.E.",
                "North Eastern Reporter 2d": "N.E.2d",
                "North Western Reporter": "N.W.",
                "North Western Reporter 2d": "N.W.2d",
                "Northwest Reporter Second": "N.W.2d",
                "Ohio St.3d": "Ohio St. 3d",
                "P. 2d": "P.2d",
                "P. 3d": "P.3d",
                "Pacific Reporter": "P.",
                "Pacific Reporter 2d": "P.2d",
                "Pacific Reporter 3d": "P.3d",
                "Pennsylvania Statutes Annotated": "Pa. Stat. Ann.",
                Peters: "Pet.",
                "Reports of the United States Board of Tax Appeals": "B.T.A.",
                "S. E.": "S.E.",
                "S. E. 2d": "S.E.2d",
                "S. E.2d": "S.E.2d",
                "S. W.": "S.W.",
                "S. W. 2d": "S.W.2d",
                "S. W. 3d": "S.W.3d",
                "S. W.2d": "S.W.2d",
                "S. W.3d": "S.W.3d",
                "S.Ct": "S. Ct.",
                "S.E. 2d": "S.E.2d",
                "S.W. 2d": "S.W.2d",
                "S.W. 3d": "S.W.3d",
                "SE 2d": "S.E.2d",
                "SW 3d": "S.W.3d",
                "So.2d": "So. 2d",
                "So.3d": "So. 3d",
                "South Eastern Reporter": "S.E.",
                "South Eastern Reporter 2d": "S.E.2d",
                "South Eastern Reporter.": "S.E.",
                "South Eastern Reporter. 2d": "S.E.2d",
                "South Western": "S.W.",
                "South Western 2d": "S.W.2d",
                "South Western 3d": "S.W.3d",
                "South Western Reporter": "S.W.",
                "South Western Reporter 2d": "S.W.2d",
                "South Western Reporter 3d": "S.W.3d",
                "Southern Reporter": "So.",
                "Southern Reporter 2d": "So. 2d",
                "Southern Reporter 3d": "So. 3d",
                "Statutes at Large": "Stat.",
                "Supreme Court": "Wall.",
                "Supreme Court Reporter": "!authority>>>S. Ct.",
                "T. C.": "T.C.",
                "Tax Court Memorandum Decisions": "T.C.M. (CCH)",
                "U. S.": "!authority>>>U.S.",
                "US Code": "U.S.C.",
                "United States Claims Court Reporter": "Cl. Ct.",
                "United States Claims Reporter": "Ct. Cl.",
                "United States Law Week": "U.S.L.W.",
                "United States Reports": "!authority>>>U.S.",
                "United States Supreme Court Reports": "!authority>>>L. Ed.",
                "United States Supreme Court Reports 2d": "!authority>>>L. Ed. 2d",
                "United States Supreme Court Reports, Lawyer's Edition": "!authority>>>L. Ed.",
                "United States Supreme Court Reports, Lawyer's Edition 2d": "!authority>>>L. Ed. 2d",
                "United States Supreme Court Reports, Lawyers' Edition": "!authority>>>L. Ed.",
                "United States Supreme Court Reports, Lawyers' Edition 2d": "!authority>>>L. Ed. 2d",
                "United States Tax Court Reports": "T.C.",
                "Vet.App.": "Vet. App.",
                Wallace: "Wall.",
                "West's Bankruptcy Reporter": "B.R.",
                "West's Military Justice Reporter": "M.J.",
                "West's Veterans Appeals Reporter": "Vet. App.",
                Wheaton: "Wheat.",
                "Wn. Terr.": "Wash. Terr."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {
                Congress: "Cong.",
                "Court of Appeals for the Eighth Circuit": "8th Cir.",
                "House Committee on the Judiciary": "H. Comm. on the Judiciary",
                "House of Representatives": "H.R.",
                Legislature: "Leg.",
                "Second Circuit Court of Appeals": "2d Cir.",
                "Supreme Court": "Sup. Ct.",
                "U.S. Congress": "Cong."
            },
            nickname: {},
            number: {},
            place: {},
            title: {
                "House of Representatives Joint Resolution": "H.R.J. Res.",
                "Senate Joint Resolution": "S.J. Res.",
                "Special Session": "Spec. Sess."
            },
            "title-phrase": {}
        },
        "us;ak": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Alaska Federal Reports": "Alaska Fed.",
                "Alaska Reports": "Alaska",
                "Federal Cases": "F. Cas."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;al": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Alabama Appellate Courts Reports": "Ala. App.",
                "Alabama Reports": "Ala."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ar": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Arkansas Appellate Reports": "Ark. App.",
                "Arkansas Reports": "Ark."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;az": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Arizona Appeals Reports": "Ariz. App.",
                "Arizona Reports": "Ariz."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ca": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Cal. App.2d": "Cal. App. 2d",
                "Cal. App.3d": "Cal. App. 3d",
                "Cal. App.4th": "Cal. App. 4th",
                "Cal. Rptr.2d": "Cal. Rptr. 2d",
                "Cal. Rptr.3d": "Cal. Rptr. 3d",
                "Cal.2d": "Cal. 2d",
                "Cal.3d": "Cal. 3d",
                "Cal.4th": "Cal. 4th",
                "Cal.App.": "Cal. App.",
                "Cal.App. 2d": "Cal. App. 2d",
                "Cal.App. 2d Supp.": "Cal. App. 2d Supp.",
                "Cal.App. 3d": "Cal. App. 3d",
                "Cal.App. 3d Supp.": "Cal. App. 3d Supp.",
                "Cal.App. 4th": "Cal. App. 4th",
                "Cal.App. Supp. 2d": "Cal. App. 2d Supp.",
                "Cal.App. Supp. 3d": "Cal. App. 3d Supp.",
                "Cal.App. Supp.2d": "Cal. App. 2d Supp.",
                "Cal.App. Supp.3d": "Cal. App. 3d Supp.",
                "Cal.App.2d": "Cal. App. 2d",
                "Cal.App.2d Supp.": "Cal. App. 2d Supp.",
                "Cal.App.3d": "Cal. App. 3d",
                "Cal.App.3d Supp.": "Cal. App. 3d Supp.",
                "Cal.App.4th": "Cal. App. 4th",
                "Cal.App.Supp.": "Cal. App. Supp.",
                "Cal.Rptr.": "Cal. Rptr.",
                "Cal.Rptr. 2d": "Cal. Rptr. 2d",
                "Cal.Rptr. 3d": "Cal. Rptr. 3d",
                "Cal.Rptr.2d": "Cal. Rptr. 2d",
                "Cal.Rptr.3d": "Cal. Rptr. 3d",
                "California Appellate Reports": "Cal. App.",
                "California Appellate Reports 2d": "Cal. App. 2d",
                "California Appellate Reports 3d": "Cal. App. 3d",
                "California Appellate Reports 4th": "Cal. App. 4th",
                "California Appellate Reports Supplement": "Cal. App. Supp.",
                "California Appellate Reports Supplement 2d": "Cal. App. 2d Supp.",
                "California Appellate Reports Supplement 3d": "Cal. App. 3d Supp.",
                "California Appellate Reports Supplement 4th": "Cal. App. 4th Supp.",
                "California Reports": "Cal.",
                "California Reports 2d": "Cal. 2d",
                "California Reports 3d": "Cal. 3d",
                "California Reports 4th": "Cal. 4th",
                "California Unreported Cases": "Cal. Unrep.",
                "West's California Reporter": "Cal. Rptr.",
                "West's California Reporter 2d": "Cal. Rptr. 2d",
                "West's California Reporter 3d": "Cal. Rptr. 3d",
                "West\u2019s California Reporter": "Cal. Rptr.",
                "West\u2019s California Reporter 2d": "Cal. Rptr. 2d",
                "West\u2019s California Reporter 3d": "Cal. Rptr. 3d"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;co": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Brief Times Reporter": "Brief Times Rptr.",
                "Colorado Court of Appeals Reports": "Colo. App.",
                "Colorado Journal": "Colo. J.",
                "Colorado Lawyer": "Colo. Law.",
                "Colorado Reports": "Colo.",
                "Law Week Colorado": "L. Week Colo."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ct": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Connecticut Appellate Reports": "Conn. App.",
                "Connecticut Circuit Court Reports": "Conn. Cir. Ct.",
                "Connecticut Law Reporter": "Conn. L. Rptr.",
                "Connecticut Reports": "Conn.",
                "Connecticut Superior Court Reports": "Conn. Super. Ct.",
                "Connecticut Supplement": "Conn. Supp."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;dc": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Appeal Cases, District of Columbia": "App. D.C.",
                "Federal Reporter 3d": "F.3d",
                "United States Court of Appeals Reports": "U.S. App. D.C."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;de": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Delaware Cases": "Del. Cas.",
                "Delaware Chancery Reports": "Del. Ch.",
                "Delaware Reports": "Del."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;federal": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {
                "Bankruptcy Court": "Bankr.",
                Congress: "Cong.",
                "Court of Appeals for the Eighth Circuit": "8th Cir.",
                "District Court": "!here>>>",
                "Eighth Circuit Court of Appeals": "8th Cir.",
                "Eleventh Circuit Court of Appeals": "11th Cir.",
                "Fifth Circuit Court of Appeals": "5th Cir.",
                "First Circuit Court of Appeals": "1st Cir.",
                "Fourth Circuit Court of Appeals": "4th Cir.",
                "House Committee on the Judiciary": "H. Comm. on the Judiciary",
                "House of Representatives": "H.R.",
                Legislature: "Leg.",
                "Ninth Circuit Court of Appeals": "9th Cir.",
                "Second Circuit Court of Appeals": "2d Cir.",
                "Seventh Circuit Court of Appeals": "7th Cir.",
                "Sixth Circuit Court of Appeals": "6th Cir.",
                "Supreme Court": "Sup. Ct.",
                "Tenth Circuit Court of Appeals": "10th Cir.",
                "Third Circuit Court of Appeals": "3rd Cir.",
                "U.S. Congress": "Cong."
            },
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;federal;dc": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "District of Columbia Reports": "D.C."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;fl": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Florida Law Weekly": "Fla. L. Weekly",
                "Florida Law Weekly Supplement": "Fla. L. Weekly Supp.",
                "Florida Reports": "Fla.",
                "Florida Supplement": "Fla. Supp.",
                "Florida Supplement 2d": "Fla. Supp. 2d"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ga": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Georgia Appeals Reports": "Ga. App.",
                "Georgia Reports": "Ga."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;gu": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Federal Supplement 2d": "F. Supp. 2d",
                "Guam Reports": "Guam"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;hi": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Hawaii Appellate Reports": "Haw. App.",
                "Hawaii Reports(ends with vol. 75)": "Haw.",
                "West's Hawaii Reports": "Haw.",
                "West's Hawaii Reports (begins with vol. 76)": "Haw.",
                "West\u2019s Hawaii Reports": "Haw."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ia": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Iowa Reports": "Iowa",
                "Iowa Reports (Cite to edition published by Clarke for vols. 1-8.)": "Iowa"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;id": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Idaho Reports": "Idaho"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;il": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Ill. App.2d": "Ill. App. 2d",
                "Ill. App.3d": "Ill. App. 3d",
                "Ill.Dec.": "Ill. Dec.",
                "Illinois Court of Claims Reports": "Ill. Ct. Cl.",
                "West's Illinois Decisions": "Ill. Dec.",
                "West\u2019s Illinois Decisions": "Ill. Dec.",
                "lllinois Appellate Court Reports": "Ill. App.",
                "lllinois Appellate Court Reports 2d": "Ill. App. 2d",
                "lllinois Appellate Court Reports 3d": "Ill. App. 3d",
                "lllinois Reports": "Ill."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;in": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Indiana Court of Appeals Reports (prior to 1972, Indiana Appellate Court Reports)": "Ind. App.",
                "Indiana Reports": "Ind."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ks": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Kan. App.2d": "Kan. App. 2d",
                "Kan.App. 2d": "Kan. App. 2d",
                "Kan.App.2d": "Kan. App. 2d",
                "Kansas Court of Appeals Reports": "Kan. App.",
                "Kansas Court of Appeals Reports 2d": "Kan. App. 2d",
                "Kansas Reports": "Kan."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ky": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Kentucky Appellate Reporter": "Ky. App.",
                "Kentucky Attorney's Memo": "Ky. Att\u2019y Memo",
                "Kentucky Law Reporter": "Ky. L. Rptr.",
                "Kentucky Law Summary": "Ky. L. Summ.",
                "Kentucky Opinions": "Ky. Op.",
                "Kentucky Reports": "Ky."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;la": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Gunby's Reports": "Gunby",
                "Louisiana Annual Reports": "La. Ann.",
                "Louisiana Court of Appeals Reports": "La. App.",
                "Louisiana Reports": "La.",
                "Peltier's Decisions, Parish at Orleans": "Pelt.",
                "Teissier, Orleans Court of Appeals": "Teiss."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ma": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Appellate Division Advance Sheets": "Mass. App. Div. Adv. Sh.",
                "Massachusetts Appeals Court Reports": "Mass. App. Ct.",
                "Massachusetts Appellate Decisions": "Mass. App. Dec.",
                "Massachusetts Reports": "Mass.",
                "Massachusetts Reports Supplement": "Mass. Supp. 246",
                "Reports of MassachusettsAppellate Division": "Mass. App. Div."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;md": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Maryland Appellate Reports": "Md. App.",
                "Maryland Reports": "Md."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;me": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Maine Reports": "Me."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;mi": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Michigan Appeals Reports": "Mich. App.",
                "Michigan Court of Claims Reports": "Mich. Ct. CL",
                "Michigan Reports": "Mich."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;mn": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Minnesota Reports": "Minn."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;mo": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Missouri Appeals Reports": "Mo. App.",
                "Missouri Reports": "Mo."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ms": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Mississippi Reports": "Miss."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;mt": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Montana Reports": "Mont.",
                "State Reporter": "State Rptr."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;nc": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "North Carolina Court of Appeals Reports": "N.C. App.",
                "North Carolina Reports": "N.C.",
                "North Carolina Reports (63 N.C. to date)": "N.C."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;nd": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Dakota Reports": "Dakota",
                "North Dakota Reports": "N.D.",
                "Northwestern Reporter 2d": "N.W.2d"
            },
            hereinafter: {},
            "institution-entire": {
                "Court of Appeals": "ND App",
                "Supreme Court": "ND"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ne": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Nebraska Court of Appeals Reports": "Neb. App.",
                "Nebraska Reports": "Neb."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;nh": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "New Hampshire Reports": "N.H."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;nj": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "New Jersey Administrative Reports": "N.J. Admin.",
                "New Jersey Administrative Reports 2d": "N.J. Admin. 2d",
                "New Jersey Equity Reports": "N.J. Eq.",
                "New Jersey Law Reports": "N.J.L.",
                "New Jersey Miscellaneous Reports": "N.J. Misc.",
                "New Jersey Reports": "N.J.",
                "New Jersey Superior Court Reports": "N.J. Super.",
                "New Jersey Tax Court Reports": "N.J. Tax"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;nm": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "New Mexico Reports": "N.M."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;nv": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Nevada Report": "Nev.",
                "Nevada Reports": "Nev."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ny": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "A.D. 2d": "A.D.2d",
                "A.D. 3d": "A.D.3d",
                "AD 2d": "A.D.2d",
                "AD 3d": "A.D.3d",
                "Abbott's New Cases": "Abb. N. Cas.",
                "Abbott's Practice Reports": "Abb. Pr.",
                "Anthon's Nisi Prius Cases": "Ant. N.P. Cas.",
                "Appellate Division Reports": "A.D.",
                "Appellate Division Reports 2d": "A.D.2d",
                "Appellate Division Reports 3d": "A.D.3d",
                "Barbour's Chancery Reports": "Barb. Ch.",
                "Barbour's Supreme Court Reports": "Barb.",
                "Caines' Cases": "Cai. Cas.",
                "Caines' Reports": "Cai.",
                "Clarke's Chancery Reports": "Cl. Ch.",
                "Coleman & Caines' Cases": "Cole. & Cai. Cas.",
                "Coleman's Cases": "Cole. Cas.",
                "Cowen's Reports": "Cow.",
                "Denio's Reports": "Denio",
                "Edmond's Select Cases": "Edm. Sel. Cas.",
                "Edwards' Chancery Reports": "Edw. Ch.",
                "Hill and Denio Supplement (Lalor)": "Hill & Den.",
                "Hill's Reports": "Hill",
                "Hoffman's Chancery Reports": "Hoff. Ch.",
                "Hopkins' Chancery Reports": "Hopk. Ch.",
                "Howard's Practice Reports": "How. Pr.",
                "Johnson's Cases": "Johns. Cas.",
                "Johnson's Chancery Reports": "Johns. Ch.",
                "Johnson's Reports": "Johns.",
                "Lansing's Chancery Reports": "Lans. Ch.",
                "Lansing's Reports": "Lans.",
                "Lockwood's Reversed Cases": "Lock. Rev. Cas.",
                "Misc 2d": "Misc. 2d",
                "Misc 3d": "Misc. 3d",
                "Misc.2d": "Misc. 2d",
                "Misc.3d": "Misc. 3d",
                "N. Y.": "N.Y.",
                "N.Y. 2d": "N.Y.2d",
                "N.Y. 3d": "N.Y.3d",
                "N.Y.S. 2d": "N.Y.S.2d",
                "N.Y.S. 3d": "N.Y.S.3d",
                "NY 2d": "N.Y.2d",
                "NY 3d": "N.Y.3d",
                "NYS 2d": "N.Y.S.2d",
                "NYS 3d": "N.Y.S.3d",
                "New York Chancery Reports Annotated": "N.Y. Ch. Ann.",
                "New York Miscellaneous Reports": "Misc.",
                "New York Miscellaneous Reports 2d": "Misc. 2d",
                "New York Miscellaneous Reports 3d": "Misc. 3d",
                "New York Reports": "N.Y.",
                "New York Reports 2d": "N.Y.2d",
                "New York Reports 3d": "N.Y.3d",
                "Paige's Chancery Reports": "Paige Ch.",
                "Sandford's Chancery Reports": "Sand. Ch.",
                "Saratoga Chancery Sentinel": "Sarat. Ch. Sent.",
                "Supreme Court Reports": "N.Y. Sup. Ct.",
                "Wendell's Reports": "Wend.",
                "West's New York Supplement": "N.Y.S.",
                "West's New York Supplement 2d": "N.Y.S.2d",
                "West's New York Supplement 3d": "N.Y.S.3d",
                "West\u2019s New York Supplement": "N.Y.S.",
                "West\u2019s New York Supplement 2d": "N.Y.S.2d",
                "West\u2019s New York Supplement 3d": "N.Y.S.3d",
                "Yates' Select Cases": "Yates Sel. Cas."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;oh": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Anderson's Unreported Ohio Appellate Cases": "Ohio App. Unrep.",
                "Baldwin's Ohio Monthly Record": "Ohio Monthly Rec.",
                "Ohio Appellate Reports": "Ohio App.",
                "Ohio Appellate Reports 2d": "Ohio App. 2d",
                "Ohio Appellate Reports 3d": "Ohio App. 3d",
                "Ohio Bar Reports": "Ohio B.",
                "Ohio Circuit Court Decisions": "13-23 Ohio C.C. Dec.",
                "Ohio Circuit Court Reports": "Ohio C.C.",
                "Ohio Circuit Court Reports, New Series": "Ohio C.C. (n.s.)",
                "Ohio Circuit Decisions": "Ohio Cir. Dec.",
                "Ohio Courts of Appeals Reports": "Ohio Ct. App.",
                "Ohio Decisions": "Ohio Dec.",
                "Ohio Decisions, Reprint": "Ohio Dec. Reprint",
                "Ohio Department Reports": "Ohio Dep\u2019t",
                "Ohio Government Reports": "Ohio Gov\u2019t",
                "Ohio Law Abstract": "Ohio Law Abs.",
                "Ohio Law Bulletin": "Ohio L. Bull.",
                "Ohio Law Reporter": "Ohio L.R.",
                "Ohio Miscellaneous": "Ohio Misc.",
                "Ohio Miscellaneous 2d": "Ohio Misc. 2d",
                "Ohio Nisi Prius Reports": "Ohio N.P.",
                "Ohio Opinions": "Ohio Op.",
                "Ohio Opinions 2d": "Ohio Op. 2d",
                "Ohio Opinions 3d": "Ohio Op. 3d",
                "Ohio Reports": "Ohio",
                "Ohio St.3d": "Ohio St. 3d",
                "Ohio State Reports": "Ohio St.",
                "Ohio State Reports 2d": "Ohio St. 2d",
                "Ohio State Reports 3d": "Ohio St. 3d",
                "Ohio Unreported Cases": "Ohio Unrep. Cas.",
                "Tappen's Reports": "Tapp. Rep.",
                "Wilcox's Condensed Reports": "Wilc. Cond. Rep."
            },
            hereinafter: {},
            "institution-entire": {
                Ohio: "Ohio"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ok": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Indian Territory Reports": "Indian Terr.",
                "Oklahoma Criminal Reports": "Okla. Crim.",
                "Oklahoma Reports": "Okla."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;or": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Oregon Reports": "Or.",
                "Oregon Reports, Court of Appeals": "Or. App.",
                "Oregon Tax Reports": "Or. Tax"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;pa": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Pa. Commonwealth Ct.": "Pa. Commw.",
                "Pa. Superior Ct.": "Pa. Super.",
                "Pennsylvania Commonwealth Court Reports": "Pa. Commw.",
                "Pennsylvania County Court Reports": "Pa. C.",
                "Pennsylvania District Reports": "Pa. D.",
                "Pennsylvania District and County Reports": "Pa. D. & C",
                "Pennsylvania District and County Reports 2d": "Pa. D. & C.2d",
                "Pennsylvania District and County Reports 3d": "Pa. D. & C.3d",
                "Pennsylvania State Reports": "Pa.",
                "Pennsylvania Superior Court Reports": "Pa. Super."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;pr": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Decisiones de Puerto Rico": "P.R. Dec.",
                "Decisiones del Tribunal de Circuito de Apelaciones de Puerto Rico": "T.C.A.",
                "Official Translations of the Opinions of the Supreme Court of Puerto Rico": "P.R. Offic. Trans.",
                "Puerto Rico": "P.R.",
                "Puerto Rico Reports": "P.R.",
                "Sentencias del Tribunal Supremo de Puerto Rico": "P.R. Sent."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ri": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Rhode Island Reports": "R.I."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;sc": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "South Carolina Reports": "S.C."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;sd": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "South Dakota Reports": "S.D."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;tn": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Tennessee Appeals Reports": "Tenn. App.",
                "Tennessee Criminal Appeals Reports": "Tenn. Crim. App.",
                "Tennessee Reports": "Tenn."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;tx": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Condensed Reports of Decisions in Civil Causes in the Court of Appeals (White & Willson)": "White & W. Willson",
                "Condensed Reports of Decisions in Civil Causes in the Court of Appeals (Willson)": "White & W. Willson",
                "Dallam's Opinions": "Dallam",
                "Digest of the Laws of Texas": "Dallam",
                Robards: "Robards",
                "Synopses of the Decisions of the Supreme Court of Texas Arising from Restraints by Conscript and Other Military Authorities": "Robards",
                "Texas Civil Appeals Reports": "Tex. Civ. App.",
                "Texas Court of Appeals Reports": "Tex. Ct. App.",
                "Texas Criminal Reports": "Tex. Crim.",
                "Texas Reports": "Tex.",
                "Texas Supreme Court Journal": "Tex. Sup. Ct. J.",
                "Texas Unreported Cases (Posey)": "Posey"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;ut": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Utah Reports": "Utah",
                "Utah Reports 2d": "Utah 2d",
                "Vermont Reports": "Vt."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;va": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Virginia Circuit Court Opinions": "Va. Cir.",
                "Virginia Court of Appeals Reports": "Va. App.",
                "Virginia Reports": "Va."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;vi": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Virgin Islands Reports": "V.I."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;vt": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Vermont Reports": "Vt."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;wa": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Washington Appellate Reports": "Wash. App.",
                "Washington Reports": "Wash.",
                "Washington Reports 2d": "Wash. 2d",
                "Washington Territory Reports": "Wash. Terr.",
                Wn: "Wash.",
                "Wn. 2d": "Wash. 2d",
                "Wn. App.": "Wash. App.",
                "Wn. Terr.": "Wash. Terr.",
                "Wn.2d": "Wash. 2d",
                "Wn.App.": "Wash. App."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;wi": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Wis.2d": "Wis. 2d",
                "Wisconsin Reports": "Wis.",
                "Wisconsin Reports 2d": "Wis. 2d"
            },
            hereinafter: {},
            "institution-entire": {
                "Court of Appeals": "WI App",
                "Supreme Court": "WI"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;wv": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "West Virginia Reports": "W. Va."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "us;wy": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Wyoming Reports": "Wyo."
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        au: {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Australian Capital Territory|Supreme Court": "AUTSC",
                "Australian Federal Police Disciplinary Tribunal": "AFPDT",
                "Competition Tribunal": "ACompT",
                "Copyright Tribunal": "ACopyT",
                "Defence Forces Discipline Appeal Tribunal": "ADFDAT",
                "Family Court": "FamCA",
                "Federal Court": "FCA",
                "Federal Court|Full Court": "FCAFC",
                "Federal Magistrate's Court": "FMCA",
                "High Court": "HCA",
                "Industrial Relations Commission": "AIRComm",
                "Industrial Relations Court of Australia": "IRCA",
                "National Native Title Tribunal": "NNTTA",
                "Native Appeal Tribunal": "AATA",
                "Refugee Review Tribunal": "RRTA",
                "Supreme Court": "AUTSC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "au;nsw": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Administrative Law Decisions": "ALD",
                "Commonwealth Law Reports": "CLR",
                "Family Law Reports": "Fam LR",
                "Federal Court Reports": "FC",
                "New South Wales Law Reports": "NSWLR",
                "Northern Territory Law Reports": "NTLR",
                "Northern Territory Reports": "NTR",
                "Queensland Reports": "QR",
                "Queensland State Reports": "St R Qd",
                "South Australia Law Reports": "SALR",
                "South Australia State Reports": "SASR",
                "State Reports New South Wales": "SR (NSW)",
                "State Reports South Australia": "SRSA",
                "State Reports Tasmania": "Tas SR",
                "Tasmanian Law Reports": "TLR",
                "Tasmanian Reports": "Tas R",
                "Victorian Law Reports": "VLR",
                "Victorian Reports": "VR",
                "Western Australia Law Reports": "WALR",
                "Western Australian Reports": "WAR"
            },
            hereinafter: {},
            "institution-entire": {
                "Administrative Decisions Tribunal": "NSWADT",
                "Administrative Decisions Tribunal| Appeal Panel": "NSWADTAP",
                "Community Services Appeals Tribunal": "NSWCSAT",
                "Compensation Court": "NSWCC",
                "Consumer, Trader and Tenancy Tribunal": "NSWCTTT",
                "Court of Appeal": "NSWCA",
                "Court of Criminal Appeal": "NSWCCA",
                "District Court": "NSWDC",
                "Drug Court": "NSWDRGC",
                "Dust Diseases Tribunal": "NSWDDT",
                "Industrial Relations Commission": "NSWIRComm",
                "Land and Environment Court": "NSALEEC",
                "Local Government & Pecuniary Interest & Disciplinary Tribunal": "NSWPIDT",
                "Residential Tenancies Tribunal of NSW": "NSWRTT",
                "Supreme Court": "NSWSC",
                "Transport Appeal Board": "NSWTAB",
                "Workers Compensation Commission": "NSW WCC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "au;nt": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Anti-Discrimination Commission": "NTADDComm",
                "Supreme Court": "NTSC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "au;qld": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Anti-Discrimination Tribunal": "QADT",
                "Building Tribunal": "QBT",
                "Court of Appeal": "QCA",
                "District Court of Queensland": "QDC",
                "Industrial Court": "QIC",
                "Land Appeal Court": "QLAC",
                "Land Court": "QLC",
                "Medical Assessment Tribunal": "QMAT",
                "Planning & Environment Court": "QPEC",
                "Queensland Industrial Relations Commission": "QIRComm",
                "Supreme Court": "QSC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "au;sa": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "District Court": "SADC",
                "Environment Resources and Development Court": "SAERDC",
                "Industrial Relations Commission": "SAIRComm",
                "Industrial Relations Court": "SAIRC",
                "Supreme Court": "SASC",
                "Workers Compensation Appeal Tribunal": "SAWCAT"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "au;tas": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Resource Management and Planning Appeal Tribunal": "TASRMPAT",
                "Supreme Court": "TASSC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "au;vic": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Civil and Administrative Tribunal": "VCAT",
                "County Court": "VCC",
                "Court of Appeal": "VSCA",
                "Supreme Court": "VSC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "au;wa": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Children\u2019s Court": "WACC",
                "District Court": "WADC",
                "Family Court": "FamCWA",
                "State Administrative Tribunal": "WASAT",
                "State Administrative Tribunal|Equal Opportunity Tribunal": "WAEOT",
                "State Administrative Tribunal|Guardianship and Administration Board": "WAGAB",
                "State Administrative Tribunal|Office of the Strata Titles Referee": "WASTR",
                "State Administrative Tribunal|Town Planning Appeal Tribunal": "WATPAT",
                "Supreme Court": "WASC",
                "Supreme Court|Criminal Appeal": "WASCA"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        ca: {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Alberta Law Reports": "Alta LR",
                "Alberta Reports": "AR",
                "British Columbia Reports": "BCR",
                "Canada Law Reports: Supreme Court of Canada": "!authority>>>SCR",
                "Canada Rederal Court Reports": "FC",
                "Canada Supreme Court Reports": "!authority>>>SCR",
                "Exchequer Court of Canada Reports": "Ex CR",
                "Federal Court Reports": "FC",
                "Manitoba Reports": "Man R",
                "New Brunswick Reports": "NBR",
                "New Brunswick Reports (2d)": "NBR (2d)",
                "Newfoundland & Prince Edward Island Reports": "Nfld & PEIR",
                "Northwest Territories Reports": "NZTR",
                "Nova Scotia Reports": "NSR",
                "Nova Scotia Reports (2d)": "NSR (2d)",
                "Ontario Law Reports": "OLR",
                "Ontario Reports (2d)": "OR (2d)",
                "Ontario Reports (3d)": "OR (3d)",
                "Ontario Reports Second": "OR (2d)",
                "Ontario Weekly Notes": "OWN",
                "Rapports judiciaries officiels de Qu\xe9bec: Cour du Banc de la Reine/du Roi": "BR",
                "Rapports judiciaries officiels de Qu\xe9bec: Cour sup\xe9rieure": "CS",
                "Recueils de jurisprudence du Qu\xe9bec: Cour d'appel": "CA",
                "Recueils de jurisprudence du Qu\xe9bec: Cour des Sessions de la paix": "CSP",
                "Recueils de jurisprudence du Qu\xe9bec: Cour du Banc de la Reine/du Roi": "BR",
                "Recueils de jurisprudence du Qu\xe9bec: Cour du bein-\xeatre social": "CBES",
                "Recueils de jurisprudence du Qu\xe9bec: Cour provinciale": "CP",
                "Recueils de jurisprudence du Qu\xe9bec: Tribunal de la jeunesse": "TJ",
                "Recueils du jurisprudence du Qu\xe9bec: Cour sup\xe9rieure": "CS",
                "Supreme Court Reports": "!authority>>>S.C.R.",
                "Territories Law Reports": "Terr LR",
                "Yukon Reports": "YR"
            },
            hereinafter: {},
            "institution-entire": {
                "Federal Court": "!authority,jurisdiction>>>FC",
                "Federal Court of Appeal": "!authority,jurisdiction>>>FCA",
                "Supreme Court": "!authority>>>SCC"
            },
            "institution-part": {
                "Court of Appeal": "CA",
                "District Court": "DC",
                "High Court": "HC",
                "High Court of Justice": "High Ct J",
                "House of Lords": "HL",
                "Privy Council": "PC",
                "Supreme Court": "SC"
            },
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;ab": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>ABCA",
                "Court of Queen's Bench": "!authority,jurisdiction>>>ABQB",
                "Provincial Court": "!authority,jurisdiction>>>ABPC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;bc": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>BCCA",
                "Provincial Court": "!authority,jurisdiction>>>BCPC",
                "Supreme Court": "!authority,jurisdiction>>>BCSC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;mb": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>MBCA",
                "Court of Queen's Bench": "!authority,jurisdiction>>>MBQB",
                "Provincial Court": "!authority,jurisdiction>>>MBPC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;nb": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>NBCA",
                "Court of Queen's Bench": "!authority,jurisdiction>>>NBQC",
                "Provincial Court": "!authority,jurisdiction>>>NBPC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;nl": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Supreme Court|Court of Appeal": "!authority,jurisdiction>>>NFCA",
                "Supreme Court|Trial Division": "!authority,jurisdiction>>>NFSCTD"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;ns": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>NSCA",
                "Provincial Court": "!authority,jurisdiction>>>NSPC",
                "Supreme Court": "!authority,jurisdiction>>>NSSC",
                "Supreme Court|Family Division": "!authority,jurisdiction>>>NSSF"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;nt": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>NWTCA",
                "North West Territories|Territorial Court": "!authority,jurisdiction>>>NWTTC",
                "Supreme Court": "!authority,jurisdiction>>>NWTSC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;nu": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>NUCA",
                "Court of Justice": "!authority,jurisdiction>>>NUCJ"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;on": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Ontario Reports Second": "OR (2d)"
            },
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>ONCA",
                "Court of Justice": "!authority,jurisdiction>>>ONCJ"
            },
            "institution-part": {
                "High Court of Justice": "H Ct J"
            },
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;pe": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Supreme Court|Appeal Division": "!authority,jurisdiction>>>PESCAD",
                "Supreme Court|Trial Division": "!authority,jurisdiction>>>PESCTD"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;qc": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>QCCA",
                "Court of Qu\xe9bec": "!authority,jurisdiction>>>QCCP",
                "Superior Court": "!authority,jurisdiction>>>QCCS"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;sk": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>SKCA",
                "Court of Queen's Bench": "!authority,jurisdiction>>>SKQB",
                "Provincial Court": "!authority,jurisdiction>>>SKPC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "ca;yt": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "!authority,jurisdiction>>>YKCA",
                "Supreme Court": "!authority,jurisdiction>>>YKSC",
                "Territorial Court": "!authority,jurisdiction>>>YKTC"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        default: {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Administrative Law Decisions": "ALD",
                "Alberta Law Reports": "Alta LR",
                "Alberta Reports": "AR",
                "All England Law Reports": "All ER",
                "All England Reports": "All E.R.",
                "Appeal Cases": "AC",
                "British Columbia Reports": "BCR",
                "British Company Law Cases": "BCC",
                "Butterworths Medico-Legal Reports": "B.M.L.R.",
                "Canada Law Reports: Supreme Court of Canada": "!authority>>>SCR",
                "Canada Rederal Court Reports": "FC",
                "Canada Supreme Court Reports": "!authority>>>SCR",
                Chancery: "Ch",
                "Common Market Law Reports": "CMLR",
                "Commonwealth Law Reports": "CLR",
                "Criminal Appeal Reports": "Cr App R",
                "Criminal Appeal Reports (Sentencing)": "Cr App R (S)",
                "Criminal Reports of New Zealand": "CRNZ",
                "Current Law Yearbook": "CLY",
                "District Court Reports": "DCR",
                "Employment Reports of New Zealand": "ERNZ",
                "English Reports": "ER",
                "Environmental Law Reporter": "NZELR",
                "Environmental Law Reports of New Zealand": "ELRNZ",
                "Estates Gazette": "EG",
                "Estates Gazette Law Reports": "EGLR",
                "European Court Reports": "ECR",
                "European Human Rights Reports": "E.H.R.R.",
                "Exchequer Court of Canada Reports": "Ex CR",
                Family: "Fam",
                "Family Law Reports": "Fam LR",
                "Family Reports of New Zealand": "FRNZ",
                "Federal Court Reports": "FC",
                "Financial Times Law Reports": "FTLR",
                "Fleet Street Reports": "FSR",
                "Gazette Law Reports": "GLR",
                "Harvard Law Review": "Harv. L. Rev.",
                "Housing Law Reports": "HLR",
                "Human Rights Reports of New Zealand": "HRNZ",
                "Industrial Cases Reports": "ICR",
                "Industrial Relations Law Reports": "IRLR",
                "Justice of the Peace Reports": "JP",
                "Land Valuation Casebook": "Land Valuation Casebook",
                "Land Valuation Cases": "Land Valuation Cases",
                "Landlord and Tenant Reports": "L & TR",
                "Law Society Gazette": "LS Gaz",
                "Lloyd's Law Reports": "Lloyd's Rep",
                "Local Government Reports": "LGR",
                "Macassey's Reports": "Mac",
                "Magistrates' Court Reports": "MCR",
                "Magistrates' Courts Decisions": "MCD",
                "Manitoba Reports": "Man R",
                "Maori Law Review": "Maori LR",
                "Matrimonial Property Act Cases": "MPC",
                "Morison's Company Law Reports": "MCLR",
                "New Brunswick Reports": "NBR",
                "New Brunswick Reports (2d)": "NBR (2d)",
                "New Property Cases": "NPC",
                "New South Wales Law Reports": "NSWLR",
                "New Zealand Accident Compensation Reports": "NZACR",
                "New Zealand Administrative Reports": "NZAR",
                "New Zealand Arbitation Court Judgments": "ACJ",
                "New Zealand Armed Forces Law Review": "NZAFLR",
                "New Zealand Bill of Rights Reports": "NZBORR",
                "New Zealand Business Law Cases": "NZBLC",
                "New Zealand Business Law Cases Commerce Commission Decisions": "NZBLC (Com)",
                "New Zealand Company Law Cases": "NZCLC",
                "New Zealand Company and Commercial Law Reports": "NZCCLR",
                "New Zealand Conveyancing Cases": "NZ ConvC",
                "New Zealand Conveyancing and Property Reports": "NZCPR",
                "New Zealand Courts Martial Appeal Reports": "NZCMAR",
                "New Zealand Current Taxation": "New Zealand Current Taxation",
                "New Zealand Customs Cases": "NZCC",
                "New Zealand Employment Law Cases": "NZELC",
                "New Zealand Employment Law Reports": "NZELR",
                "New Zealand Environmental Law Reporter": "NZELR",
                "New Zealand Family Law Reports": "NZFLR",
                "New Zealand Industrial Court Judgments": "ICJ",
                "New Zealand Industrial Law Reports": "NZILR",
                "New Zealand Intellectual Property Reports": "NZIPR",
                "New Zealand Jurist Reports (New Series)": "NZ Jur (NS)",
                "New Zealand Law Reports": "NZLR",
                "New Zealand Law Reports Leading Cases": "NZLRLC",
                "New Zealand Parliamentary Debates": "NZPD",
                "New Zealand Privy Council Cases": "NZPCC",
                "New Zealand Procedural Cases": "NZPC",
                "New Zealand Resource Management Appeals": "NZRMA",
                "New Zealand Superannuation cases": "NZSC",
                "New Zealand Tax Cases": "NZTC",
                "New Zealand Taxation Board of Review Decisions": "NZTBR",
                "New Zealand Town Planning Appeals": "NZTPA",
                "New Zealand Town and Country Planning Appeals": "NZTCPA",
                "Newfoundland & Prince Edward Island Reports": "Nfld & PEIR",
                "Northern Territory Law Reports": "NTLR",
                "Northern Territory Reports": "NTR",
                "Northwest Territories Reports": "NZTR",
                "Nova Scotia Reports": "NSR",
                "Nova Scotia Reports (2d)": "NSR (2d)",
                "Ollivier, Bell & Fitzgerald's Reports of Cases": "OB&F",
                "Ontario Law Reports": "OLR",
                "Ontario Reports (2d)": "OR (2d)",
                "Ontario Reports (3d)": "OR (3d)",
                "Ontario Weekly Notes": "OWN",
                "Privy Council": "P",
                "Procedure Reports of New Zealand": "PRNZ",
                "Property and Compensation Reports": "P&CR",
                "Public and Third Sector Law Reports": "PTSLR",
                "Queen's Bench": "QB",
                "Queensland Reports": "QR",
                "Queensland State Reports": "St R Qd",
                "Rapports judiciaries officiels de Qu\xe9bec: Cour du Banc de la Reine/du Roi": "BR",
                "Rapports judiciaries officiels de Qu\xe9bec: Cour sup\xe9rieure": "CS",
                "Rating and Valuation Reporter": "RVR",
                "Recueils de jurisprudence du Qu\xe9bec: Cour d'appel": "CA",
                "Recueils de jurisprudence du Qu\xe9bec: Cour des Sessions de la paix": "CSP",
                "Recueils de jurisprudence du Qu\xe9bec: Cour du Banc de la Reine/du Roi": "BR",
                "Recueils de jurisprudence du Qu\xe9bec: Cour du bein-\xeatre social": "CBES",
                "Recueils de jurisprudence du Qu\xe9bec: Cour provinciale": "CP",
                "Recueils de jurisprudence du Qu\xe9bec: Tribunal de la jeunesse": "TJ",
                "Recueils du jurisprudence du Qu\xe9bec: Cour sup\xe9rieure": "CS",
                "Reports of Patent Cases": "RPC",
                "Road Traffic Reports": "RTR",
                "Scots Law Times": "SLT",
                "Scottish Civil Law Reports": "SCLR",
                "Scottish Criminal Case Reports ": "SCCR",
                "Session Cases": "SC",
                "Simon's Tax Cases": "STC",
                "Simon's Tax Intelligence": "STI",
                "South Australia Law Reports": "SALR",
                "South Australia State Reports": "SASR",
                "State Reports New South Wales": "SR (NSW)",
                "State Reports South Australia": "SRSA",
                "State Reports Tasmania": "Tas SR",
                "Tasmanian Law Reports": "TLR",
                "Tasmanian Reports": "Tas R",
                "Tax Cases": "TC",
                "Tax Reports New Zealand": "Tax Reports New Zealand",
                "Territories Law Reports": "Terr LR",
                "Trade and Competition Law Reports": "TCLR",
                "Victorian Law Reports": "VLR",
                "Victorian Reports": "VR",
                "Weekly Law Reports": "WLR",
                "Western Australia Law Reports": "WALR",
                "Western Australian Reports": "WAR",
                "Wills & Trusts Law Reports": "WTLR",
                "Yukon Reports": "YR"
            },
            hereinafter: {},
            "institution-entire": {},
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        gb: {
            classic: {},
            "collection-title": {
                "Command Papers 1987-present": "Cm"
            },
            "container-title": {
                "All England Law Reports": "All E.R.",
                "All England Reports": "All E.R.",
                "Appeal Cases": "AC",
                "British Company Law Cases": "BCC",
                "Butterworths Medico-Legal Reports": "B.M.L.R.",
                Chancery: "Ch",
                "Common Market Law Reports": "CMLR",
                "Criminal Appeal Reports": "Cr App R",
                "Criminal Appeal Reports (Sentencing)": "Cr App R (S)",
                "Current Law Yearbook": "CLY",
                "English Reports": "ER",
                "Estates Gazette": "EG",
                "Estates Gazette Law Reports": "EGLR",
                "European Court Reports": "ECR",
                "European Human Rights Reports": "EHRR",
                Family: "Fam",
                "Family Law Reports": "FLR",
                "Financial Times Law Reports": "FTLR",
                "Fleet Street Reports": "FSR",
                "Housing Law Reports": "HLR",
                "Industrial Cases Reports": "ICR",
                "Industrial Relations Law Reports": "IRLR",
                "Justice of the Peace Reports": "JP",
                "Landlord and Tenant Reports": "L & TR",
                "Law Society Gazette": "LS Gaz",
                "Lloyd's Law Reports": "Lloyd's Rep",
                "Local Government Reports": "LGR",
                "New Property Cases": "NPC",
                "Property and Compensation Reports": "P&CR",
                "Public and Third Sector Law Reports": "PTSLR",
                "Queen's Bench": "QB",
                "Rating and Valuation Reporter": "RVR",
                "Reports of Patent Cases": "RPC",
                "Road Traffic Reports": "RTR",
                "Scots Law Times": "SLT",
                "Scottish Civil Law Reports": "SCLR",
                "Scottish Criminal Case Reports ": "SCCR",
                "Session Cases": "SC",
                "Simon's Tax Cases": "STC",
                "Simon's Tax Intelligence": "STI",
                "Tax Cases": "TC",
                "The Times": "The Times",
                "Weekly Law Reports": "WLR",
                "Wills & Trusts Law Reports": "WTLR"
            },
            hereinafter: {},
            "institution-entire": {
                "Administrative Appeals Chamber": "AAC",
                "Asylum and Immigration Tribunal": "United Kingdom Asylum and Immigration Tribunal",
                "Competition Appeals Tribunal": "United Kingdom Competition Appeals Tribunal",
                "Employment Appeal Tribunal": "UKEAT",
                "Financial Services and Markets Tribunals": "United Kingdom Financial Services and Markets Tribunals Decisions",
                "First-tier Tribunal": "UKFTT",
                "First-tier Tribunal|General Regulatory Chamber": "First-tier Tribunal (General Regulatory Chamber)",
                "First-tier Tribunal|Tax": "First-tier Tribunal (Tax)",
                "Health Education and Social Care Chamber": "HESC",
                "High Court|Chancery": "UKHC",
                "House of Lords": "UKHL",
                "Information Tribunal and National Security Appeals Panel": "United Kingdom Information Tribunal including the National Security Appeals Panel",
                "Nominet Dispute Resolution Service": "Nominet UK Dispute Resolution Service",
                "Privy Council": "UKPC",
                "Social Security and Child Support Commissioners": "UK Social Security and Child Support Commissioners' Decisions",
                "Special Commissioners of Income Tax": "United Kingdom Special Commissioners of Income Tax Decisions",
                "Special Immigrations Appeals Commission": "UKSIAC",
                "Supreme Court": "UKSC",
                "Upper Tribunal|Administrative Appeals Chamber": "UKUT",
                "Upper Tribunal|Immigration and Asylum Chamber": "Upper Tribunal (Immigration and Asylum Chamber)",
                "Upper Tribunal|Lands Chamber": "Upper Tribunal (Lands Chamber)",
                "Upper Tribunal|Tax and Chancery Chamber": "Upper Tribunal (Tax and Chancery Chamber)",
                "VAT and Duties Tribunals": "United Kingdom VAT & Duties Tribunals Decisions",
                "VAT and Duties Tribunals|Customs": "United Kingdom VAT & Duties Tribunals (Customs) Decisions",
                "VAT and Duties Tribunals|Excise": "United Kingdom VAT & Duties Tribunals (Excise) Decisions",
                "VAT and Duties Tribunals|Insurance Premium Tax": "United Kingdom VAT & Duties Tribunals (Insurance Premium Tax) Decisions",
                "VAT and Duties Tribunals|Landfill Tax": "United Kingdom VAT & Duties Tribunals (Landfill Tax) Decisions"
            },
            "institution-part": {
                Chancery: "Ch",
                "House of Lords": "HL",
                "King's Bench": "KB",
                "Queen's Bench": "QB"
            },
            nickname: {},
            number: {},
            place: {},
            title: {
                "George III": "Geo 3"
            }
        },
        "gb;england.and.wales": {
            classic: {},
            "collection-title": {},
            "container-title": {
                "All England Reports": "All ER"
            },
            hereinafter: {},
            "institution-entire": {
                "Administrative Court": "Admin",
                "Care Standards Tribunal": "England and Wales Care Standards Tribunal Decisions",
                "Chancery Division": "Ch",
                "Commercial Court": "Comm",
                "County Court|Family": "England and Wales County Court (Family)",
                "County Court|Patents": "England and Wales Patents County Court Decisions",
                "Court of Appeal|Civil Division": "EWCA Civ",
                "Court of Appeal|Criminal Division": "EWCA Crim",
                "England and Wales|Admiralty Division": "Admlty",
                "Family Division": "Fam",
                "High Court": "EWHC",
                "High Court|Chancery": "EWHC",
                "Lands Tribunal": "England and Wales Lands Tribunal",
                "Magistrates' Court|Family": "England and Wales Magistrates' Court (Family)",
                "Patents Court": "Pat",
                "Queen's Bench Division": "QB",
                "Technology and Construction Court": "TCC"
            },
            "institution-part": {
                Chancery: "Ch",
                "Court of Appeal": "CA",
                "Queen's Bench": "QB"
            },
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "gb;northern.ireland": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "NICA",
                "Crown Court": "NICC",
                "Fair Employment Tribunal": "Fair Employment Tribunal Northern Ireland Decisions",
                "High Court|Chancery Division": "High Court of Justice in Northern Ireland Chancery Division Decisions",
                "High Court|Family Division": "High Court of Justice in Northern Ireland Family Division Decisions",
                "High Court|Masters": "High Court of Justice in Northern Ireland Master's Decisions",
                "High Court|Queen's Bench Division": "NIQB",
                "Industrial Tribunals": "Industrial Tribunals Northern Ireland Decisions",
                "Social Security and Child Support Commissioners": "Northern Ireland - Social Security and Child Support Commissioners' Decisions"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        "gb;scotland": {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Court of Session|Inner House": "CSIH",
                "Court of Session|Outer House": "CSOH",
                "High Court": "HCJT",
                "Sheriff Court": "Scottish Sheriff Court Decisions"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        ie: {
            classic: {},
            "collection-title": {},
            "container-title": {},
            hereinafter: {},
            "institution-entire": {
                "Competition Authority": "Irish Competition Authority Decisions",
                "Court of Criminal Appeal": "Irish Court of Criminal Appeal",
                "Data Protection Commission": "Irish Data Protection Commission Case Studies",
                "High Court": "High Court of Ireland Decisions",
                "Information Commissioner": "Irish Information Commissioner's Decisions",
                "Supreme Court": "Supreme Court of Ireland Decisions"
            },
            "institution-part": {},
            nickname: {},
            number: {},
            place: {},
            title: {}
        },
        nz: {
            classic: {},
            "collection-title": {},
            "container-title": {
                "Criminal Reports of New Zealand": "CRNZ",
                "District Court Reports": "DCR",
                "Employment Reports of New Zealand": "ERNZ",
                "Environmental Law Reporter": "NZELR",
                "Environmental Law Reports of New Zealand": "ELRNZ",
                "Family Reports of New Zealand": "FRNZ",
                "Gazette Law Reports": "GLR",
                "Human Rights Reports of New Zealand": "HRNZ",
                "Land Valuation Casebook": "Land Valuation Casebook",
                "Land Valuation Cases": "Land Valuation Cases",
                "Macassey's Reports": "Mac",
                "Magistrates' Court Reports": "MCR",
                "Magistrates' Courts Decisions": "MCD",
                "Maori Law Review": "Maori LR",
                "Matrimonial Property Act Cases": "MPC",
                "Morison's Company Law Reports": "MCLR",
                "New Zealand Accident Compensation Reports": "NZACR",
                "New Zealand Administrative Reports": "NZAR",
                "New Zealand Arbitation Court Judgments": "ACJ",
                "New Zealand Armed Forces Law Review": "NZAFLR",
                "New Zealand Bill of Rights Reports": "NZBORR",
                "New Zealand Business Law Cases": "NZBLC",
                "New Zealand Business Law Cases Commerce Commission Decisions": "NZBLC (Com)",
                "New Zealand Company Law Cases": "NZCLC",
                "New Zealand Company and Commercial Law Reports": "NZCCLR",
                "New Zealand Conveyancing Cases": "NZ ConvC",
                "New Zealand Conveyancing and Property Reports": "NZCPR",
                "New Zealand Courts Martial Appeal Reports": "NZCMAR",
                "New Zealand Current Taxation": "New Zealand Current Taxation",
                "New Zealand Customs Cases": "NZCC",
                "New Zealand Employment Law Cases": "NZELC",
                "New Zealand Employment Law Reports": "NZELR",
                "New Zealand Environmental Law Reporter": "NZELR",
                "New Zealand Family Law Reports": "NZFLR",
                "New Zealand Industrial Court Judgments": "ICJ",
                "New Zealand Industrial Law Reports": "NZILR",
                "New Zealand Intellectual Property Reports": "NZIPR",
                "New Zealand Jurist Reports (New Series)": "NZ Jur (NS)",
                "New Zealand Law Reports": "NZLR",
                "New Zealand Law Reports Leading Cases": "NZLRLC",
                "New Zealand Parliamentary Debates": "NZPD",
                "New Zealand Privy Council Cases": "NZPCC",
                "New Zealand Procedural Cases": "NZPC",
                "New Zealand Resource Management Appeals": "NZRMA",
                "New Zealand Superannuation cases": "NZSC",
                "New Zealand Tax Cases": "NZTC",
                "New Zealand Taxation Board of Review Decisions": "NZTBR",
                "New Zealand Town Planning Appeals": "NZTPA",
                "New Zealand Town and Country Planning Appeals": "NZTCPA",
                "Ollivier, Bell & Fitzgerald's Reports of Cases": "OB&F",
                "Procedure Reports of New Zealand": "PRNZ",
                "Tax Reports New Zealand": "Tax Reports New Zealand",
                "Trade and Competition Law Reports": "TCLR"
            },
            hereinafter: {},
            "institution-entire": {
                "Court of Appeal": "NZCA",
                "District Court": "NZDC",
                "High Court": "NZHC",
                "Supreme Court": "NZSC"
            },
            "institution-part": {
                "Court of Appeal": "CA",
                "District Court": "DC",
                "High Court": "HC",
                "House of Lords": "HL",
                "Privy Council": "PC",
                "Supreme Court": "SC"
            },
            nickname: {},
            number: {},
            place: {},
            title: {}
        }
    },
    getAbbreviation: function(a) {
        for (var b in this.abbr) {
            if ("container-title" in this.abbr[b]) {
                var c = this.abbr[b]["container-title"];
                var d = c[a];
                if (d) {
                    d = d.replace(/!authority>>>/, "");
                    return d;
                }
            }
        }
        return "";
    },
    getAbbreviations: function(a) {
        var b = {
            default: {
                classic: {},
                "collection-title": {},
                "container-phrase": {},
                "container-title": {},
                hereinafter: {},
                "institution-entire": {},
                "institution-part": {},
                nickname: {},
                number: {},
                place: {},
                title: {},
                "title-phrase": {}
            }
        };
        b["institution-part"] = this.abbr.ca["institution-part"];
        return b;
    },
    getReporterMap: function(a) {
        var b = {};
        for (var c in this.abbr) {
            if ("container-title" in this.abbr[c]) {
                var d = this.abbr[c]["container-title"];
                for (var e in d) {
                    var f = d[e];
                    if (a) {
                        f = f.toUpperCase().replace(/[\s\.]+/g, "");
                        f = f.replace(/\!authority>>>/i, "");
                    }
                    if (!(f in b)) {
                        b[f] = e;
                    } else {
                        if (e.length > b[f].length) {
                            b[f] = e;
                        }
                    }
                }
            }
        }
        b["US"] = "United States Reports";
        return b;
    }
});

PP.library.LegalAbbreviations = new PP.library._LegalAbbreviations();

PP.library._Merge = PP.Class.extend({
    merge: function(a, b) {
        var c = this;
        a = PP.Utils.clone(a);
        b = PP.Utils.clone(b);
        var d = {};
        d._id = PP.UUID.generate();
        var e = PP.library.PublicationFields.getFields();
        e.forEach(function(e) {
            c.fillInField(d, a, b, e);
        });
        PP.library.Publication.autoClean(d);
        return d;
    },
    fillInField: function(a, b, c, d) {
        var e = d.name;
        var f = {
            _id: true,
            _keywords: true,
            subfolders: true
        };
        if (f[e]) {
            return;
        }
        var g = b[e];
        var h = c[e];
        var i = g === undefined || g === null || g === "";
        var j = h === undefined || h === null || h === "";
        if (i && j) {
            return;
        }
        if (i && !j) {
            a[e] = h;
            return;
        }
        if (j && !i) {
            a[e] = g;
            return;
        }
        if (d.fieldType === "author") {
            if (g && h) {
                if (g.length != h.length) {
                    var k = g.length > h.length ? g : h;
                    a[e] = k;
                    return;
                } else {
                    var l = this.authorCharLength(g);
                    var m = this.authorCharLength(h);
                    var k = l >= m ? g : h;
                    a[e] = k;
                    return;
                }
            }
        } else if (d.fieldType === "date") {
            if (g && h) {
                var n = this.getDateSpecificity(g);
                var o = this.getDateSpecificity(h);
                var k = n >= o ? g : h;
                a[e] = k;
                return;
            }
        } else if (d.dataType === "object") {
            var p = {};
            PP.Utils.merge(p, g);
            PP.Utils.merge(p, h);
            a[e] = p;
        } else if (d.dataType === "array") {
            var q = g.concat(h);
            q = PP.Array.unique(q);
            a[e] = q;
            return;
        } else {
            g = "" + g;
            h = "" + h;
            var l = g.length;
            var m = h.length;
            var k = l >= m ? g : h;
            a[e] = k;
            return;
        }
    },
    getDateSpecificity: function(a) {
        var b = 0;
        var c = [ "year", "month", "day" ];
        c.forEach(function(c) {
            if (a[c]) {
                b++;
            }
        });
        return b;
    },
    authorCharLength: function(a) {
        var b = 0;
        a.forEach(function(a) {
            b += a.last ? a.last.length : 0;
            b += a.first ? a.first.length : 0;
            b += a.collective ? a.collective.length : 0;
        });
        return b;
    },
    runTests: function() {
        var a = {
            pubtype: "PP_ARTICLE",
            author: [ {
                last: "Jordan",
                first: "GE",
                initials: "GE"
            } ],
            published: {
                year: 2007
            },
            title: "Testing testing one two three",
            url: [ "http://www.google.com/" ],
            source: {
                pdf_crawl_status: "complete"
            }
        };
        var b = PP.Utils.clone(a);
        b.author = [ {
            last: "Jordan",
            first: "Gregory Eric",
            initials: "GE"
        } ];
        b.published = {
            year: 2007,
            month: 10,
            day: 12
        };
        b.url = [ "http://www.yahoo.com/" ];
        b.source = {
            webimport_status: "success",
            plugin: "pubmed"
        };
        PP.library.Publication.autoClean(a);
        PP.library.Publication.autoClean(b);
        var c = PP.library.Merge.merge(a, b);
        console.log(PP.pp(c));
    }
});

createSingleton(PP.library, "_Merge", "Merge");

PP.library.Patterns = PP.Class.extend({
    statics: {
        applyPattern: function(a, b) {
            var c = PP.library.Publication.getAuthorType(b);
            var d = b[c];
            if (d === undefined) {
                d = [];
            }
            var e = [];
            for (var f = 0; f < d.length; f++) {
                e.push(PP.library.Author.toString(d[f], {
                    output: "last"
                }));
            }
            if (e.length === 0) {
                e = [ "_noauthor_" ];
            }
            var g = e[0];
            var h = e[e.length - 1];
            if (g === h) {
                h = "";
            }
            var i, j;
            if (b.published && b.published.year) {
                i = b.published.year + "";
                j = i.substring(2, 4);
            } else {
                j = i = "_undated_";
            }
            g = g.replace(/\s+/g, "_");
            h = h.replace(/\s+/g, "_");
            if (e.length > 0) {
                if (g === g.toUpperCase()) {
                    g = g.toLowerCase();
                }
                g = PP.String.upperFirst(g);
                if (h === h.toUpperCase()) {
                    h = h.toLowerCase();
                }
                h = PP.String.upperFirst(h);
            }
            var k = "";
            for (var f = 0; f < 2; f++) {
                k += this.getRandomChar();
            }
            var l = g.substr(0, 1).toUpperCase();
            var m = {
                firstAuthor: g,
                lastAuthor: h,
                initial: l,
                year: i,
                randomChars: k
            };
            a = PP.Utils.template(a, m);
            a = a.replace(/\[/g, "");
            a = a.replace(/\]/g, "");
            if (!PP.Globals.isDocAddOn() && typeof "Unidecode" === "object") {
                a = Unidecode.decode(a);
            }
            a = PP.Utils.replaceDiacritics(a);
            a = a.replace(/[^\w-]/g, "");
            a = a.replace(/_-/g, "-");
            a = a.replace(/_+/g, "_");
            a = a.replace(/^_/g, "");
            a = a.replace(/_$/g, "");
            return a;
        },
        getRandomChar: function() {
            var a = "abcdefghijklmnopqrstuvwxyz";
            var b = Math.floor(Math.random() * a.length);
            var c = a.charAt(b);
            return c;
        }
    }
});

PP.library._PublicationTypes = PP.Class.extend({
    getBibtexMap: function() {
        var a = this.getPubTypes();
        var b = {};
        for (var c = 0; c < a.length; c++) {
            var d = a[c].bibtex_types;
            for (var e = 0; e < d.length; e++) {
                var f = d[e];
                if (!b[f]) {
                    b[f] = [ a[c].id ];
                } else {
                    b[f].push(a[c].id);
                }
            }
        }
        return b;
    },
    getPubTypeMap: function() {
        if (this._map) {
            return this._map;
        }
        var a = this.getPubTypes();
        var b = {};
        for (var c = 0; c < a.length; c++) {
            var d = a[c].id;
            b[d] = a[c];
        }
        this._map = b;
        return b;
    },
    getPubType: function(a) {
        var b = this.getPubTypes();
        for (var c in b) {
            if (b[c]) {
                var d = b[c];
                if (d.id === a) {
                    return d;
                }
            }
        }
        return null;
    },
    getSortOrder: function() {
        var a = [ "PP_ARTICLE", "PP_BOOK", "PP_BOOK_CHAPTER", "PP_CONFERENCE_PAPER", "PP_THESIS", "PP_PREPRINT", "PP_MANUSCRIPT", "PP_WEBSITE", "PP_NEWS_ARTICLE", "PP_PATENT", "PP_PRESENTATION", "PP_COMPUTER_PROGRAM", "PP_MANUAL", "PP_DATASET", "PP_REPORT", "PP_PERSONAL_COMMUNICATION", "PP_UNPUBLISHED", "PP_MISC", "PP_BROADCAST", "PP_AUDIO", "PP_VIDEO", "PP_FIGURE", "PP_ARTWORK", "PP_SCORE", "PP_GRANT", "PP_STANDARD", "PP_MAP", "PP_LETTER", "PP_INTERVIEW", "PP_REVIEW", "PP_ENCYCLOPEDIA_ARTICLE", "PP_CASE", "PP_STATUTE", "PP_BILL", "PP_TREATY", "PP_PERIODICAL" ];
        return a;
    },
    getTitleHelp: function() {
        return "<p>Italics: &lt;i&gt<i>Homo sapiens</i>&lt;/i&gt <br>Superscript: Ca&lt;sup&gt<sup>2+</sup>&lt;/sup&gt <br>Subscript: H&lt;sub&gt<sub>2</sub>&lt;/sub&gt;O</p>";
    },
    getAuthorHelp: function() {
        return ", separated by semicolons <p><i>Last, First Middle</i> <p>e.g. Knuth, Donald E; Moore, Ronald W</p><p><i>Collective names in braces</i><p>e.g. {1000 Genomes Consortium}</p>";
    },
    getDateHelp: function() {
        return "<p>'2002' <i>or</i> 'June 2002' <i>or</i> 'June 24, 2002' <br/> <i>or free-form date in braces<i><br> '{May-June 1876}'</p>";
    },
    getEditWindowPubTypes: function() {
        var a = PP.Utils.clone(this.getPubTypes());
        a = PP.Array.filter(a, function(a) {
            return a.hideFromEditWindow !== true;
        });
        var b = PP.Array.toMap(a, "id");
        var c = [];
        var d = [ "PP_ARTICLE", "PP_BOOK", "PP_BOOK_CHAPTER", "PP_CONFERENCE_PAPER", "PP_THESIS", "PP_NEWS_ARTICLE", "PP_WEBSITE", "PP_MISC" ];
        var e = [ "PP_MANUSCRIPT", "PP_ARTWORK", "PP_AUDIO", "PP_BILL", "PP_REVIEW", "PP_BROADCAST", "PP_CASE", "PP_COMPUTER_PROGRAM", "PP_DATASET", "PP_ENCYCLOPEDIA_ARTICLE", "PP_FIGURE", "PP_GRANT", "PP_INTERVIEW", "PP_LETTER", "PP_MANUAL", "PP_MAP", "PP_SCORE", "PP_PATENT", "PP_PERSONAL_COMMUNICATION", "PP_PREPRINT", "PP_PRESENTATION", "PP_REPORT", "PP_STANDARD", "PP_STATUTE", "PP_TREATY", "PP_VIDEO", "PP_UNPUBLISHED", "PP_PERIODICAL" ];
        c.push({
            isHeader: true,
            name: "Main reference types"
        });
        for (var f = 0; f < d.length; f++) {
            c.push(b[d[f]]);
        }
        c.push({
            isHeader: true,
            name: "More reference types"
        });
        for (var f = 0; f < e.length; f++) {
            c.push(b[e[f]]);
        }
        return c;
    },
    getPubTypes: function() {
        if (this._types) {
            return this._types;
        }
        var a = {
            patent: [ "issuing_authority", "application_number", "class", "international_class", "search_class", "states", "priority_numbers", "patent_number", "assignee", "foreign_patents", "patent_publication_type" ],
            legal: [ "jurisdiction", "history", "section", "legislative_body", "session", "court" ],
            issn: [ "issn", "issn_alt" ],
            isbn: [ "isbn", "isbn_alt" ],
            pubmed: [ "pmc", "pmid" ],
            arxiv: [ "archivePrefix", "arxivid", "primaryClass", "eprint" ],
            misc: [ "running_time", "medium", "scale", "ismn" ],
            conference: [ "conference", "conference_location", "conference_date" ],
            journal: [ "journal", "journalfull", "issue" ],
            book: [ "booktitle", "chapter" ],
            math: [ "mr", "zbl" ],
            pages: [ "pages", "num_pages" ],
            volume: [ "volume", "num_volumes" ],
            publisher: [ "publisher", "address", "original_publisher", "original_address" ],
            series: [ "series", "series_number", "series_editor" ],
            thesis: [ "school", "department" ],
            archive: [ "archive", "archive_location", "archive_place" ]
        };
        var b = [ {
            id: "PP_BOOK",
            name: "Book",
            label: "Book",
            description: "A whole book",
            bibtex_types: [ "BOOK" ],
            zotero_type: "BOOK",
            mendeley_type: "BOOK",
            endnote_type: [ {
                name: "BOOK",
                default: true
            }, {
                name: "CONFERENCE PROCEEDINGS",
                subtype: "Proceedings"
            }, {
                name: "ELECTRONIC BOOK",
                subtype: "Electronic Book"
            }, {
                name: "EDITED BOOK"
            }, {
                name: "ANCIENT TEXT",
                subtype: "Ancient Text"
            }, {
                name: "CLASSICAL WORK",
                subtype: "Classical Work"
            }, {
                name: "DICTIONARY",
                subtype: "Dictionary"
            } ],
            csl_type: "book",
            ris_type: [ {
                name: "BOOK",
                default: true
            }, {
                subtype: "Proceedings",
                name: "CONF"
            }, {
                subtype: "Ancient Text",
                name: "ANCIENT"
            }, {
                subtype: "Dictionary",
                name: "DICT"
            }, {
                name: "EBOOK"
            } ],
            field_labels: {
                pages: "Pages cited"
            },
            field_ris: {
                isbn: "SN",
                series: "T2",
                num_pages: "SP",
                pages: "SE",
                series_editor: "A2",
                editor: "A3",
                original_title: "OP",
                translator: "A4"
            },
            field_ris_additional: {
                ED: "editor"
            },
            field_endnote: {
                series_number: "%N",
                num_pages: "%P",
                pages: "%&"
            },
            field_zotero: {},
            field_help: {
                title: "Title of the book." + this.getTitleHelp(),
                pages: "<p>The range or starting page, e.g. <p>'210-213' or '210'</p>"
            },
            subtypes: [ {
                name: "Monograph"
            }, {
                name: "Textbook"
            }, {
                name: "Booklet"
            }, {
                name: "Proceedings"
            }, {
                name: "Encyclopedia"
            }, {
                name: "Dictionary"
            }, {
                name: "Classical Work"
            }, {
                name: "Ancient Text"
            }, {
                name: "Fiction"
            }, {
                name: "Electronic Book"
            } ],
            mandatory_fields: [ "title", "author", "editor", "published", [ "publisher", "address" ], [ "series", "volume" ] ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.journal, a.thesis, a.arxiv, a.pubmed, [ "booktitle", "howpublished", "institution", "version", "filed", "number" ])
        }, {
            id: "PP_REVIEW",
            name: "Book or Film Review",
            label: "Book or Film Review",
            description: "A published review of a book or film",
            bibtex_types: [ "MISC" ],
            zotero_type: [],
            mendeley_type: [],
            endnote_type: [],
            csl_type: "review-book",
            ris_type: [],
            field_labels: {
                contributor: "Reviewed author",
                booktitle: "Title of the reviewed item"
            },
            field_ris: {
                isbn: "SN",
                series: "T2",
                num_pages: "SP",
                pages: "SE",
                series_editor: "A2",
                editor: "A3",
                original_title: "OP",
                translator: "A4"
            },
            field_ris_additional: {
                ED: "editor"
            },
            field_endnote: {},
            field_zotero: {},
            field_csl: {
                booktitle: "reviewed-title",
                contributor: "reviewed-author"
            },
            field_help: {
                title: "Title of the book" + this.getTitleHelp(),
                booktitle: "The title of the reviewed item" + this.getTitleHelp(),
                contributor: "The author(s) of the reviewed item" + this.getAuthorHelp()
            },
            subtypes: [],
            mandatory_fields: [ "title", "author", "booktitle", "contributor", [ "journal:2", "published" ], [ "volume", "issue", "pages" ], "url" ],
            excluded_fields: PP.Array.merge(a.patent, a.conference, a.misc, a.legal, a.thesis, a.arxiv, a.pubmed, [ "howpublished", "institution", "number", "version", "filed" ])
        }, {
            id: "PP_BOOK_CHAPTER",
            name: "Book Chapter",
            label: "Book Chapter",
            description: "Book chapter, with its own title and authors",
            bibtex_types: [ "INCOLLECTION", "INBOOK" ],
            csl_type: "chapter",
            endnote_type: [ {
                name: "BOOK SECTION"
            }, {
                name: "ELECTRONIC BOOK SECTION"
            } ],
            zotero_type: "BOOKSECTION",
            mendeley_type: "BOOK_SECTION",
            ris_type: [ {
                name: "CHAP",
                default: true
            }, {
                name: "CHAPTER"
            }, {
                name: "ECHAP"
            }, {
                name: "SER"
            }, {
                name: "EDBOOK"
            } ],
            field_labels: {
                editor: "Book editors",
                author: "Chapter authors",
                title: "Chapter title",
                pages: "Chapter pages"
            },
            field_ris: {
                isbn: "SN",
                booktitle: "T2",
                series: "T3",
                pages: "SP",
                series_editor: "A3",
                editor: "A2",
                original_title: "OP",
                num_volumes: "IS",
                translator: "A4"
            },
            field_ris_additional: {
                ED: "editor",
                SE: "series",
                NV: "num_volumes",
                BT: "booktitle"
            },
            field_mendeley: {
                booktitle: "source"
            },
            field_endnote: {
                chapter: "%&",
                journal: null
            },
            field_zotero: {},
            field_help: {
                title: "Title of the chapter." + this.getTitleHelp(),
                booktitle: "Title of the book." + this.getTitleHelp(),
                editor: "The book editor(s)" + this.getAuthorHelp(),
                author: "Te chapter author(s)" + this.getAuthorHelp(),
                pages: "<p>The range or starting page, e.g. <p>'210-213' or '210'</p>"
            },
            mandatory_fields: [ "booktitle", "editor", "title", [ "pages" ], "author", "abstract", "published", [ "publisher", "address" ], [ "series", "volume" ] ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.journal, a.arxiv, a.thesis, [ "howpublished", "institution", "number", "version", "num_pages", "filed" ]),
            subtypes: [ {
                name: "Monograph"
            }, {
                name: "Textbook"
            }, {
                name: "Dictionary"
            }, {
                name: "Classical Work"
            }, {
                name: "Ancient Text"
            }, {
                name: "Fiction"
            }, {
                name: "Electronic Book"
            }, {
                name: "Appendix"
            } ]
        }, {
            id: "PP_ENCYCLOPEDIA_ARTICLE",
            name: "Encyclopedia Article",
            label: "Encyclopedia Article",
            description: "An article in an encyclopedia",
            bibtex_types: [ "INBOOK" ],
            csl_type: "entry-encyclopedia",
            endnote_type: "ENCYCLOPEDIA",
            zotero_type: "ENCYCLOPEDIAARTICLE",
            mendeley_type: "ENCYCLOPEDIA_ARTICLE",
            ris_type: [ {
                name: "ENCYC",
                default: true
            } ],
            field_labels: {
                booktitle: "Encyclopedia title"
            },
            field_ris: {
                isbn: "SN",
                booktitle: "T2",
                pages: "SP",
                editor: "A2",
                original_title: "OP",
                translator: "A4"
            },
            field_ris_additional: {
                ED: "editor",
                NV: "num_volumes",
                BT: "booktitle"
            },
            field_mendeley: {
                booktitle: "source"
            },
            field_endnote: {},
            field_zotero: {
                booktitle: "encyclopediatitle"
            },
            field_help: {
                title: "Title of the article." + this.getTitleHelp(),
                booktitle: "Title of the encyclopedia." + this.getTitleHelp()
            },
            mandatory_fields: [ "title", "booktitle", [ "pages" ], "author", "abstract", "published", [ "publisher", "address" ] ],
            excluded_fields: PP.Array.merge(a.pubmed, a.patent, a.series, a.misc, a.legal, a.journal, a.arxiv, a.thesis, [ "howpublished", "institution", "number", "version", "num_pages", "filed" ]),
            subtypes: []
        }, {
            id: "PP_ARTICLE",
            name: "Journal Article",
            label: "Journal Article",
            description: "Article in a scholarly journal",
            field_help: {
                title: "Title of the article" + this.getTitleHelp(),
                series: "The series the article was published in ('Recent Advances in Medical Genetics')",
                series_number: "Number of the series the article was published in"
            },
            subtypes: [ {
                name: "Research Article"
            }, {
                name: "Review"
            }, {
                name: "Editorial"
            }, {
                name: "Commentary"
            }, {
                name: "Letter to the Editor"
            }, {
                name: "Opinion"
            }, {
                name: "News"
            }, {
                name: "Erratum"
            }, {
                name: "Retracted"
            } ],
            labelFn: function(a) {
                if (!a.kind) {
                    return "Journal Article";
                } else {
                    if (a.kind === "Research Article") {
                        return "Journal Article";
                    } else {
                        return a.kind;
                    }
                }
            },
            bibtex_types: [ "ARTICLE" ],
            mendeley_type: "JOURNAL",
            zotero_type: "JOURNALARTICLE",
            endnote_type: [ {
                name: "JOURNAL ARTICLE"
            }, {
                name: "ELECTRONIC ARTICLE"
            } ],
            csl_type: "article-journal",
            ris_type: [ {
                name: "JOUR",
                default: true
            }, {
                name: "ABST"
            }, {
                name: "EJOUR"
            }, {
                name: "JFULL"
            } ],
            field_ris: {
                issn: "SN",
                pages: "SP",
                pmc: "C2",
                author: "AU",
                journal: "T2",
                original_title: "OP",
                translator: "A4"
            },
            field_ris_additional: {
                JF: "journalfull",
                JO: "journal",
                JA: "journal"
            },
            field_endnote: {
                issn: "%@"
            },
            field_zotero: {},
            mandatory_fields: [ "title", "author", [ "journal:2", "published" ], "abstract", [ "volume", "issue", "pages" ], "url", [ "doi:2", "pmid" ] ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.legal, a.isbn, a.book, a.thesis, [ "edition", "howpublished", "institution", "version", "num_pages", "num_volumes", "filed", "number" ])
        }, {
            id: "PP_NEWS_ARTICLE",
            name: "News Article",
            label: "News Article",
            description: "Article in a newspaper, magazine, or other periodical",
            bibtex_types: [ "ARTICLE" ],
            zotero_type: [ {
                subtype: "Newspaper Article",
                name: "NEWSPAPERARTICLE"
            }, {
                subtype: "Magazine Article",
                name: "MAGAZINEARTICLE"
            } ],
            endnote_type: [ {
                subtype: "Newspaper Article",
                name: "NEWSPAPER ARTICLE"
            }, {
                subtype: "Magazine Article",
                name: "MAGAZINE ARTICLE"
            } ],
            mendeley_type: [ {
                subtype: "Newspaper Article",
                name: "NEWSPAPER_ARTICLE"
            }, {
                subtype: "Magazine Article",
                name: "MAGAZINE_ARTICLE"
            } ],
            csl_type: [ {
                subtype: "Newspaper Article",
                name: "article-newspaper",
                default: true
            }, {
                subtype: "Magazine Article",
                name: "article-magazine"
            } ],
            ris_type: [ {
                subtype: "Newspaper Article",
                name: "NEWS",
                default: true
            }, {
                subtype: "Magazine Article",
                name: "MGZN"
            } ],
            ris: {
                input: {},
                output: {}
            },
            field_ris: {
                pages: "SP",
                issue: "C2",
                issn: "SN"
            },
            field_ris_additional: {
                JF: "journalfull",
                JO: "journal",
                JA: "journal",
                M1: "issue"
            },
            field_endnote: {
                journal: "%B"
            },
            field_zotero: {},
            field_help: {
                title: "Title of the article" + this.getTitleHelp(),
                journal: "Title of the magazine or newspaper in its standardized abbreviation if available",
                journalfull: "Full title of the magazine or newspaper",
                edition: "The edition of the magazine or newspaper<p>'European edition'</p>"
            },
            subtypes: [ {
                name: "Newspaper Article"
            }, {
                name: "Magazine Article"
            } ],
            mandatory_fields: [ "title", "author", "abstract", "journal", "pages", "volume", "issue", "edition", "published" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.legal, a.pubmed, a.arxiv, a.math, a.isbn, a.book, a.series, a.thesis, [ "associated_doi", "howpublished", "institution", "version", "number", "contributor", "filed", "status" ])
        }, {
            id: "PP_CONFERENCE_PAPER",
            name: "Conference Paper",
            label: "Conference Paper",
            description: "Paper published in the proceedings of a conference",
            bibtex_types: [ "INPROCEEDINGS", "CONFERENCE" ],
            csl_type: "paper-conference",
            mendeley_type: "CONFERENCE_PROCEEDINGS",
            endnote_type: "CONFERENCE PAPER",
            zotero_type: "CONFERENCEPAPER",
            ris_type: "CPAPER",
            field_labels: {
                booktitle: "Proceedings title"
            },
            field_ris: {
                booktitle: "T2",
                series: "J2",
                address: "C1",
                pages: "SP",
                editor: "A2"
            },
            field_ris_additional: {},
            field_endnote: {
                conference: "%B",
                conference_location: "%C",
                conference_date: "%8",
                number: "%N"
            },
            field_zotero: {
                booktitle: "proceedingstitle"
            },
            field_mendeley: {
                booktitle: "source"
            },
            field_help: {
                title: "Title of the paper." + this.getTitleHelp(),
                booktitle: "Title of the conference proceedings",
                series: "Conference proceedings series"
            },
            mandatory_fields: [ "title", "booktitle", "author", "editor", "pages", "published", [ "institution", "series" ], [ "publisher", "address" ], "conference", "conference_location", "conference_date" ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.arxiv, a.journal, a.thesis, [ "chapter", "edition", "howpublished", "version", "filed", "num_pages", "num_volumes" ])
        }, {
            id: "PP_THESIS",
            name: "Thesis",
            label: "Thesis",
            description: "Thesis for a Ph.D. or other degree",
            subtypes: [ {
                name: "Ph.D. Thesis",
                default: true
            }, {
                name: "Masters Thesis"
            }, {
                name: "Bachelor's Thesis"
            }, {
                name: "Undergraduate Thesis"
            }, {
                name: "Habilitation"
            } ],
            labelFn: function(a) {
                if (!a.kind) {
                    return "Thesis";
                } else {
                    return a.kind;
                }
            },
            bibtex_types: [ "MASTERSTHESIS", "PHDTHESIS" ],
            csl_type: "thesis",
            endnote_type: "THESIS",
            mendeley_type: "THESIS",
            zotero_type: "THESIS",
            ris_type: [ {
                name: "THES",
                default: true
            }, {
                name: "PHDT",
                subtype: "Ph.D. Thesis",
                output: false
            }, {
                name: "MAST",
                subtype: "Masters Thesis",
                output: false
            } ],
            field_labels: {
                genre: "Degree",
                editor: "Advisor"
            },
            field_ris: {
                editor: "A3",
                kind: "M3",
                school: "PB",
                address: "CY",
                genre: "VL",
                department: "T2"
            },
            field_ris_additional: {},
            field_endnote: {
                department: "%B",
                num_pages: "%P",
                school: "%I",
                genre: "%V",
                editor: "%Y"
            },
            field_mendeley: {
                school: "institution"
            },
            field_zotero: {},
            field_help: {
                editor: "The advisor(s) of the thesis " + this.getAuthorHelp(),
                genre: "Awarded degree (e.g. BSc, MSc, Phd)",
                title: "Title of the thesis." + this.getTitleHelp(),
                num_pages: "The total number of pages of the thesis"
            },
            mandatory_fields: [ "title", "author", "editor", "school", "department", "genre", "published" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.math, a.legal, a.issn, a.pubmed, a.arxiv, a.series, a.journal, a.book, a.volume, [ "associated_doi", "number", "edition", "howpublished", "institution", "version", "filed", "pages" ])
        }, {
            id: "PP_PREPRINT",
            name: "Preprint Manuscript",
            label: "Preprint Manuscript",
            description: "Preprint version of a manuscript or working paper",
            bibtex_types: [ "UNPUBLISHED", "MISC", "ARTICLE" ],
            csl_type: "manuscript",
            mendeley_type: "WORKING_PAPER",
            endnote_type: "UNPUBLISHED WORK",
            ris_type: [ {
                name: "INPR",
                default: true
            } ],
            field_ris: {
                eprint: "SN",
                archivePrefix: "DP",
                translator: "A4"
            },
            field_endnote: {
                institution: [ "%I", "%S" ]
            },
            field_labels: {
                journal: "Source"
            },
            field_help: {
                title: "Title of the manuscript" + this.getTitleHelp(),
                num_pages: "The total number of pages of the manuscript",
                journal: "Database or archive where the preprint manuscript was deposited",
                series: "The series the working paper was published in <br>'Working Paper Series'",
                number: "Number of the working paper"
            },
            mandatory_fields: [ "title", "author", "journal", "institution", "series", "number", "published", "url" ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.book, a.volume, a.publisher, a.thesis, a.pubmed, a.math, a.issn, a.isbn, [ "series_number", "series_editor", "edition", "version", "filed", "originally_published", "lccn", "journalfull" ])
        }, {
            id: "PP_MANUSCRIPT",
            name: "Archival Material",
            label: "Archival Material",
            description: "Documents stored in an archive",
            bibtex_types: [ "MISC" ],
            csl_type: "manuscript",
            endnote_type: "MANUSCRIPT",
            zotero_type: "MANUSCRIPT",
            ris_type: [ {
                name: "MANSCPT",
                default: true
            } ],
            field_labels: {
                series: "Collection",
                series_editor: "Editor of the collection",
                series_number: "Collection number"
            },
            field_ris: {
                eprint: "SN",
                archivePrefix: "DP",
                translator: "A4",
                howpublished: "T2"
            },
            field_mendeley: {
                howpublished: "source"
            },
            field_endnote: {
                series: "%B",
                series_number: "%N",
                original_title: "%(",
                archive: "%I",
                publisher: null
            },
            field_zotero: {
                howpublished: "journalabbreviation"
            },
            field_csl: {
                howpublished: "container-title"
            },
            field_help: {
                title: "Title of the manuscript" + this.getTitleHelp(),
                series: "Name of the collection<p>'William H. Sager China Marines Photograph Collection'</p>",
                series_number: "Number of the collection",
                series_editor: "Collection editor(s)" + this.getAuthorHelp()
            },
            mandatory_fields: [ "title", "author", "series", "archive", "archive_location", "archive_place", "url", "published" ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.book, a.journal, a.thesis, a.issn, a.pubmed, a.arxiv, a.math, a.conference, [ "institution", "number", "edition", "version", "filed" ])
        }, {
            id: "PP_REPORT",
            name: "Report",
            label: "Report",
            description: "Report published by a university or organization",
            bibtex_types: [ "TECHREPORT" ],
            subtypes: [ {
                name: "Technical Report"
            }, {
                name: "Government Report"
            }, {
                name: "White Paper"
            }, {
                name: "Guideline"
            } ],
            csl_type: "report",
            mendeley_type: "REPORT",
            zotero_type: "REPORT",
            endnote_type: [ {
                name: "REPORT"
            }, {
                name: "GOVERNMENT DOCUMENT",
                subtype: "Government Report"
            } ],
            ris_type: [ {
                name: "RPRT",
                default: true
            }, {
                name: "GOVDOC",
                subtype: "Government Report"
            } ],
            field_ris: {
                publisher: "A3",
                issue: "C6",
                kind: "M3",
                institution: "PB",
                number: "SN",
                num_pages: "SP",
                series: "T2",
                series_editor: "A2"
            },
            field_endnote: {
                number: "%@",
                institution: [ "%I", "%1", "%?", "%E" ],
                series_editor: "%E",
                publisher: "%Y",
                series: "%B",
                translator: null,
                editor: null,
                series_editor: null,
                series_volume: "%6"
            },
            field_zotero: {
                number: "reportnumber",
                series: "seriestitle"
            },
            field_mendeley: {
                number: "revision"
            },
            field_ris_additional: {},
            field_help: {
                title: "Title of the report." + this.getTitleHelp(),
                series: "The series the report was published in ('Recent Advances in Medical Genetics')",
                series_number: "Number of the series the report was published in",
                conference: "Event where the report was presented",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event",
                pages: "<p>The range or starting page, e.g. <p>'210-213' or '210'</p>"
            },
            field_labels: {
                pages: "Pages cited",
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event"
            },
            mandatory_fields: [ "title", "author", [ "number", "institution" ], "published", "num_pages" ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.book, a.journal, a.pubmed, a.math, a.arxiv, a.thesis, [ "associated_doi", "howpublished", "version", "num_volumes", "filed" ])
        }, {
            id: "PP_STANDARD",
            name: "Standard",
            label: "Standard",
            description: "A standard issued by ISO, ANSI,\u2026",
            bibtex_types: [ "TECHREPORT" ],
            subtypes: [],
            csl_type: "report",
            ris_type: [ {
                name: "STAND",
                default: true
            } ],
            endnote_type: "STANDARD",
            field_ris: {
                number: "SN",
                num_pages: "SP"
            },
            field_endnote: {
                number: [ "%V", "%S", "%@" ],
                genre: "%B"
            },
            field_zotero: {},
            field_help: {
                title: "Title of the standard." + this.getTitleHelp(),
                author: "The name of the issuing agency in braces <p>'{International Organization for Standardization}'</p>",
                pages: "<p>The range or starting page, e.g. <p>'210-213' or '210'</p>"
            },
            field_labels: {
                pages: "Pages cited",
                author: "Issuing Agency"
            },
            mandatory_fields: [ "title", "author", "number", "published", "num_pages", "publisher", "address" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.legal, a.pubmed, a.arxiv, a.series, a.volume, a.journal, a.book, a.thesis, a.isbn, a.issn, a.math, a.archive, [ "associated_doi", "howpublished", "version", "filed", "affiliation", "institution", "editor", "contributor", "lccn" ])
        }, {
            id: "PP_PATENT",
            name: "Patent",
            label: "Patent",
            description: "Published patent",
            bibtex_types: [ "PATENT" ],
            csl_type: "patent",
            mendeley_type: "PATENT",
            endnote_type: "PATENT",
            zotero_type: "PATENT",
            ris_type: "PAT",
            subtypes: [ {
                name: "Patent Application"
            }, {
                name: "Utility Patent"
            }, {
                name: "Design Patent"
            }, {
                name: "Plant Patent"
            }, {
                name: "Reissue Patent"
            }, {
                name: "Defensive Publication"
            }, {
                name: "Statutory Invention Registration"
            } ],
            field_labels: {
                title: "Patent title",
                author: "Inventors",
                journal: "Type of patent",
                journalfull: "Issuing office full name"
            },
            field_ris: {
                patent_publication_type: "M3",
                assignee: "PB",
                states: "C3",
                class: "NV",
                international_class: "ET",
                issuing_authority: "A2"
            },
            field_endnote: {
                patent_number: "%@",
                assignee: "%I",
                international_class: "%7",
                states: "%3",
                priority_numbers: "%(",
                class: "%6",
                application_number: "%N",
                issuing_authority: "%E",
                filed: "%2",
                genre: "%9"
            },
            field_zotero: {
                published: "issuedate"
            },
            field_mendeley: {
                patent_number: "revision",
                issuing_authority: "publisher"
            },
            field_help: {
                title: "Title of the patent." + this.getTitleHelp(),
                journal: "Type of patent (e.g. US Patent, International Patent)",
                journalfull: "The full name of the authority / office issuing the patent (e.g., 'United States Patent and Trademark Office')",
                author: "The inventor(s)" + this.getAuthorHelp()
            },
            mandatory_fields: [ "title", "author", "assignee", "issuing_authority", "patent_number", "filed", "published", "abstract" ],
            excluded_fields: PP.Array.merge(a.conference, a.misc, a.legal, a.book, a.series, a.volume, a.pages, a.arxiv, a.pubmed, a.math, a.thesis, a.isbn, a.archive, [ "associated_doi", "number", "issue", "edition", "howpublished", "publisher", "original_publisher", "version", "editor", "lccn" ])
        }, {
            id: "PP_UNPUBLISHED",
            name: "Unpublished Item",
            label: "Unpublished",
            description: "Work that has not been formally published",
            bibtex_types: [ "UNPUBLISHED" ],
            csl_type: "article",
            ris_type: "UNPB",
            field_labels: {
                published: "Date",
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event"
            },
            field_ris: {},
            field_ris_additional: {},
            field_endnote: {},
            field_zotero: {},
            field_help: {
                title: "Title of the document." + this.getTitleHelp(),
                conference: "Event where the interview was conducted",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event" + this.getDateHelp(),
                published: "Date when the document was created" + this.getDateHelp()
            },
            mandatory_fields: [ "title", "author", "published" ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.isbn, a.issn, a.pubmed, a.book, a.journal, a.arxiv, a.publisher, a.series, a.volume, a.thesis, a.math, [ "associated_doi", "doi", "edition", "pages", "howpublished", "institution", "version", "num_pages", "editor", "originally_published", "lccn", "filed" ])
        }, {
            id: "PP_LETTER",
            name: "Letter",
            label: "Letter",
            description: "A letter with sender and recipient",
            bibtex_types: [ "MISC" ],
            csl_type: "personal_communication",
            zotero_type: [ {
                name: "LETTER"
            } ],
            subtypes: [],
            field_ris: {
                pages: "SP"
            },
            field_ris_additional: {},
            field_endnote: {},
            field_zotero: {},
            field_labels: {
                author: "Sender",
                published: "Date",
                editor: "Recipient",
                series: "Collection",
                series_number: "Collection number",
                series_editor: "Collection editor"
            },
            field_csl: {
                editor: "recipient"
            },
            field_help: {
                series: "Name of the collection<p>'William H. Sager China Marines Photograph Collection'</p>",
                series_number: "Number of the collection",
                series_editor: "The collection editor(s)" + this.getAuthorHelp(),
                editor: "The recipient(s)" + this.getAuthorHelp(),
                author: "The sender(s)" + this.getAuthorHelp(),
                published: "Date when the letter was written" + this.getDateHelp()
            },
            mandatory_fields: [ "author", "published", "editor", "abstract", "series", "archive", "archive_location", "archive_place", "url" ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.journal, a.pubmed, a.math, a.arxiv, a.thesis, a.issn, a.isbn, a.book, [ "edition", "pages", "howpublished", "institution", "version", "contributor", "status", "filed" ])
        }, {
            id: "PP_INTERVIEW",
            name: "Interview",
            label: "Interview",
            description: "A published or personal interview",
            bibtex_types: [ "MISC" ],
            csl_type: "interview",
            zotero_type: [ {
                name: "INTERVIEW"
            } ],
            ris_type: [ {
                name: "INTV",
                default: true
            } ],
            endnote_type: [ {
                name: "INTERVIEW"
            } ],
            subtypes: [],
            field_ris: {
                pages: "SP",
                editor: "A2"
            },
            field_ris_additional: {},
            field_zotero: {
                editor: "interviewer",
                author: "interviewee"
            },
            field_endnote: {
                journal: "%B",
                original_title: "%("
            },
            field_labels: {
                author: "Interview with",
                published: "Date",
                editor: "Interviewer",
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event",
                journal: "Magazine",
                genre: "Type"
            },
            field_csl: {
                editor: "interviewer"
            },
            field_help: {
                genre: "Type of interview <p>'Personal Interview', Phone Interview', 'Skype Interview'",
                published: "Date when the interview was conducted or published",
                conference: "Event where the interview was conducted",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event" + this.getDateHelp(),
                author: "Name of the person that is interviewed" + this.getAuthorHelp(),
                editor: "The interviewer(s)" + this.getAuthorHelp(),
                journal: "Title of the magazine in its standardized abbreviation if available"
            },
            mandatory_fields: [ "author", "editor", "published", "abstract", "conference", "conference_location", "conference_date", "genre", "url" ],
            excluded_fields: PP.Array.merge(a.series, a.patent, a.misc, a.legal, a.pubmed, a.math, a.arxiv, a.thesis, a.issn, a.isbn, a.book, [ "edition", "howpublished", "institution", "version", "contributor", "status", "filed" ])
        }, {
            id: "PP_PERSONAL_COMMUNICATION",
            name: "Personal Communication",
            label: "Personal Communication",
            description: "Information or data received via personal communication",
            bibtex_types: [ "MISC" ],
            csl_type: "personal_communication",
            endnote_type: "PERSONAL COMMUNICATION",
            zotero_type: [ {
                subtype: "Message",
                name: "INSTANTMESSAGE"
            }, {
                subtype: "E-mail",
                name: "EMAIL"
            } ],
            ris_type: [ {
                name: "PCOMM",
                default: true
            }, {
                name: "ICOMM"
            } ],
            subtypes: [ {
                name: "E-mail"
            }, {
                name: "Letter"
            }, {
                name: "Conversation"
            }, {
                name: "Message"
            } ],
            field_ris: {
                pages: "SP",
                editor: "A2"
            },
            field_ris_additional: {},
            field_endnote: {},
            field_zotero: {},
            field_labels: {
                author: "Author or source",
                published: "Date",
                editor: "Recipient"
            },
            field_csl: {
                editor: "recipient"
            },
            field_help: {
                conference: "Event where the communication took place",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event" + this.getDateHelp(),
                editor: "The recipient(s)" + this.getAuthorHelp(),
                author: "The author(s)" + this.getAuthorHelp(),
                published: "Date when the communication took place" + this.getDateHelp()
            },
            mandatory_fields: [ "author", "published", "editor", "abstract" ],
            excluded_fields: PP.Array.merge(a.series, a.patent, a.misc, a.legal, a.journal, a.pubmed, a.math, a.arxiv, a.thesis, a.issn, a.isbn, a.book, [ "edition", "pages", "howpublished", "institution", "version", "contributor", "status", "genre", "filed", "num_pages", "num_volumes" ])
        }, {
            id: "PP_WEBSITE",
            name: "Website",
            label: "Website",
            description: "Website accessed online",
            bibtex_types: [ "ONLINE", "MISC" ],
            csl_type: "webpage",
            mendeley_type: "WEB_PAGE",
            endnote_type: [ {
                name: "WEB PAGE"
            }, {
                name: "BLOG",
                subtype: "Blog post"
            }, {
                name: "ONLINE DATABASE",
                subtype: "Database"
            }, {
                name: "ELECTRONIC SOURCE"
            } ],
            zotero_type: [ {
                name: "WEBPAGE"
            }, {
                name: "BLOGPOST",
                subtype: "Blog post"
            }, {
                name: "FORUMPOST",
                subtype: "Forum post"
            } ],
            ris_type: [ {
                name: "ELEC",
                default: true
            }, {
                subtype: "Database",
                name: "DBASE"
            }, {
                subtype: "Blog post",
                name: "BLOG"
            }, {
                subtype: "Wikipedia",
                name: "ENCYC"
            }, {
                name: "WEB"
            }, {
                name: "WEBP"
            }, {
                name: "MULTI"
            } ],
            field_labels: {
                booktitle: "Website name"
            },
            subtypes: [ {
                name: "Article"
            }, {
                name: "Database"
            }, {
                name: "Blog post"
            }, {
                name: "Forum post"
            }, {
                name: "Wikipedia"
            }, {
                name: "Tweet"
            } ],
            field_ris: {
                isbn: "SN",
                accessed: "M1"
            },
            field_ris_additional: {},
            field_endnote: {
                accessed: [ "%V", "%N" ],
                affiliation: [ "%1", "%+" ]
            },
            field_mendeley: {
                booktitle: "source"
            },
            field_zotero: {
                booktitle: "websitetitle"
            },
            field_zotero_additional: {
                blogtitle: "booktitle",
                forumtitle: "booktitle"
            },
            field_help: {
                title: "Title of the page." + this.getTitleHelp(),
                booktitle: "Title of the website."
            },
            mandatory_fields: [ "title", "booktitle", "url", "author", "accessed", "published" ],
            excluded_fields: PP.Array.merge(a.archive, a.conference, a.patent, a.misc, a.legal, a.journal, a.pages, a.volume, a.arxiv, a.issn, a.pubmed, a.math, a.thesis, a.series, a.isbn, [ "chapter", "number", "edition", "howpublished", "institution", "version", "editor", "filed", "lccn", "status" ])
        }, {
            id: "PP_COMPUTER_PROGRAM",
            name: "Computer Program",
            label: "Computer Program",
            description: "Software run on a computer",
            subtypes: [ {
                name: "Scientific software"
            }, {
                name: "Statistics software"
            }, {
                name: "Graphics software"
            }, {
                name: "Business software"
            }, {
                name: "System software"
            }, {
                name: "Programming language"
            }, {
                name: "Database"
            }, {
                name: "Script"
            }, {
                name: "Utility"
            }, {
                name: "Video game"
            } ],
            bibtex_types: [ "MISC" ],
            csl_type: "book",
            endnote_type: "COMPUTER PROGRAM",
            mendeley_type: "COMPUTER_PROGRAM",
            zotero_type: "COMPUTERPROGRAM",
            ris_type: [ {
                name: "COMP",
                default: true
            }, {
                subtype: "Database",
                name: "DBASE"
            } ],
            field_ris: {
                version: "ET"
            },
            field_ris_additional: {},
            field_mendeley: {
                version: "revision"
            },
            field_endnote: {
                version: "%V"
            },
            field_zotero: {
                series: "seriestitle"
            },
            field_zotero_additional: {
                versionnumber: "version"
            },
            field_help: {
                title: "Name of the program" + this.getTitleHelp()
            },
            mandatory_fields: [ "title", "version", "author", "published", "url" ],
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.journal, a.book, a.pages, a.volume, a.series, a.thesis, a.arxiv, a.isbn, a.issn, a.pubmed, a.conference, a.math, a.archive, [ "number", "edition", "howpublished", "editor", "filed", "lccn" ])
        }, {
            id: "PP_MANUAL",
            name: "Manual or Documentation",
            label: "Manual or Documentation",
            description: "Instruction manual or other type of documentation",
            bibtex_types: [ "MANUAL" ],
            csl_type: "report",
            ris_type: "MANU",
            field_ris: {
                number: "IS",
                num_pages: "SP"
            },
            field_ris_additional: {},
            field_help: {
                title: "Title of the document" + this.getTitleHelp(),
                version: "Version of the product this manual is about",
                institution: "The organization or institution that publishes the manual"
            },
            mandatory_fields: [ "title", "version", "author", "institution", "published", "url" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.legal, a.issn, a.book, a.journal, a.series, a.thesis, a.volume, a.arxiv, a.pubmed, a.math, a.archive, [ "howpublished", "filed", "lccn" ])
        }, {
            id: "PP_DATASET",
            name: "Dataset",
            label: "Dataset",
            description: "A dataset with its own DOI or webpage",
            bibtex_types: [ "MISC" ],
            csl_type: "dataset",
            ris_type: "DATA",
            endnote_type: [ {
                name: "AGGREGATED DATABASE"
            }, {
                name: "DATASET",
                default: true
            } ],
            mandatory_fields: [ "title", "author", "url", "doi", [ "published", "accessed" ], "booktitle", "associated_doi" ],
            field_help: {
                title: "Title of the dataset" + this.getTitleHelp(),
                booktitle: "The title of the publication associated with this dataset",
                associated_doi: "The DOI of the publication with which this dataset is associated",
                url: "A list of URLs where this item can be accessed online (one per line)",
                author: "The dataset author(s)" + this.getAuthorHelp(),
                doi: "A generic identifier for digital objects. Some datasets have a unique DOI assigned on publication."
            },
            field_labels: {
                title: "Dataset name",
                author: "Dataset author(s)",
                doi: "Dataset DOI",
                url: "Dataset URL",
                booktitle: "Publication title",
                associated_doi: "Publication DOI"
            },
            field_ris: {},
            field_ris_additional: {},
            field_endnote: {
                version: "%7"
            },
            field_zotero: {},
            excluded_fields: PP.Array.merge(a.patent, a.misc, a.legal, a.journal, a.pages, a.conference, a.issn, a.isbn, a.volume, a.thesis, a.series, a.pubmed, a.arxiv, a.math, [ "chapter", "number", "howpublished", "institution", "filed", "lccn" ])
        }, {
            id: "PP_PRESENTATION",
            name: "Presentation",
            label: "Presentation",
            description: "Talk or other presentation",
            bibtex_types: [ "MISC" ],
            csl_type: "speech",
            zotero_type: "PRESENTATION",
            ris_type: [ {
                name: "SLIDE",
                default: true
            } ],
            field_labels: {
                author: "Presenter",
                published: "Date",
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event"
            },
            field_ris: {},
            field_ris_additional: {
                A2: "editor"
            },
            field_endnote: {},
            field_zotero: {},
            field_csl: {
                journal: "event"
            },
            field_help: {
                title: "Title of the presentation" + this.getTitleHelp(),
                journal: "Event where the presentation took place",
                conference: "Event where the presentation took place",
                conference_location: "Location where the event was held",
                conference_date: "Date when the event took place",
                author: "The presenter(s)" + this.getAuthorHelp(),
                published: "Date when the presentation was held" + this.getDateHelp()
            },
            mandatory_fields: [ "title", "conference", "conference_location", "author", "abstract", "published", "url" ],
            excluded_fields: PP.Array.merge(a.archive, a.patent, a.misc, a.legal, a.issn, a.isbn, a.math, a.pubmed, a.arxiv, a.volume, a.book, a.thesis, [ "number", "num_pages", "version", "journalfull", "volume", "issue", "edition", "pages", "institution", "editor", "howpublished", "filed", "series", "series_number", "series_editor" ]),
            subtypes: [ {
                name: "Conference talk"
            }, {
                name: "Seminar"
            }, {
                name: "Lecture"
            }, {
                name: "Reading"
            }, {
                name: "Poster presentation"
            }, {
                name: "Workshop"
            } ]
        }, {
            id: "PP_MISC",
            name: "Miscellaneous",
            label: "Miscellaneous",
            description: "Miscellaneous reference or resource",
            bibtex_types: [ "MISC" ],
            csl_type: "article",
            ris_type: "MISC",
            mandatory_fields: [ "title", "author", "howpublished", "url", "published" ],
            excluded_fields: PP.Array.merge(a.patent, a.legal, [ "filed" ]),
            field_ris: {
                pages: "SP"
            },
            field_ris_additional: {
                JF: "journalfull",
                JO: "journal"
            },
            field_endnote: {},
            field_zotero: {},
            field_help: {
                title: "Title of the item"
            }
        }, {
            id: "PP_BROADCAST",
            name: "Broadcast",
            label: "Broadcast",
            description: "Radio or TV broadcast",
            bibtex_types: [ "MISC" ],
            mendeley_type: [ {
                name: "TELEVISION_BROADCAST",
                subtype: "TV broadcast"
            } ],
            csl_type: "broadcast",
            zotero_type: [ {
                subtype: "TV broadcast",
                name: "TVBROADCAST"
            }, {
                subtype: "Radio broadcast",
                name: "RADIOBROADCAST"
            } ],
            ris_type: [ {
                name: "MPCT",
                import: false,
                default: true
            } ],
            mandatory_fields: [ "title", "booktitle", "author", "publisher", "address", "number", "url", "published", "medium", "running_time" ],
            excluded_fields: PP.Array.merge(a.arxiv, a.pages, a.patent, a.legal, a.journal, a.pubmed, a.math, a.arxivid, a.issn, a.isbn, a.thesis, [ "filed", "institution", , "scale", "howpublished", "version", "ismn", "associated_doi", "chapter", "lccn" ]),
            csl_excluded_fields: [ "editor", "series_editor" ],
            subtypes: [ {
                name: "TV broadcast"
            }, {
                name: "Radio broadcast"
            } ],
            field_labels: {
                booktitle: "Program Title",
                publisher: "Network",
                number: "Episode Number",
                author: "Directors",
                editor: "Cast members",
                series_editor: "Producers",
                published: "Broadcast date",
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event",
                medium: "Format"
            },
            field_ris: {
                editor: "C1",
                series_editor: "A3",
                running_time: "SP",
                medium: "M3",
                booktitle: "T2"
            },
            field_endnote: {},
            field_zotero: {
                booktitle: "programtitle",
                number: "episodenumber",
                publisher: "network",
                medium: "videorecordingformat"
            },
            field_ris_additional: {},
            field_zotero_additional: {
                audiorecordingformat: "medium"
            },
            field_help: {
                title: "Title of the broadcast" + this.getTitleHelp(),
                publisher: "The network's name <p>'BBC' or 'HBO'</p>",
                booktitle: "Title of the program",
                number: "Number of the current episode",
                author: "The director(s)" + this.getAuthorHelp(),
                editor: "The cast member(s) or reporter(s)" + this.getAuthorHelp(),
                series_editor: "The producer(s)" + this.getAuthorHelp(),
                medium: "e.g. 'Radio broadcast' or 'TV broadcast'",
                address: "Address of the network",
                conference: "Event where the broadcast was recorded",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event",
                published: "Date when the broadcast was aired" + this.getDateHelp()
            }
        }, {
            id: "PP_AUDIO",
            name: "Audio",
            label: "Audio",
            description: "Published audio recording",
            bibtex_types: [ "MISC" ],
            csl_type: "song",
            zotero_type: [ {
                subtype: "Podcast",
                name: "PODCAST"
            }, {
                subtype: "Audio recording",
                name: "AUDIORECORDING"
            } ],
            ris_type: [ {
                name: "SOUND",
                default: true
            }, {
                name: "MUSIC"
            } ],
            mandatory_fields: [ "title", "author", "publisher", "url", "published", "medium", "running_time" ],
            excluded_fields: PP.Array.merge(a.pages, a.patent, a.legal, a.journal, a.isbn, a.issn, a.pubmed, a.arxiv, a.math, a.thesis, [ "chapter", "filed", "scale", "institution", "ismn", "howpublished", "associated_doi" ]),
            csl_excluded_fields: [ "series_editor" ],
            subtypes: [ {
                name: "Song"
            }, {
                name: "Concert"
            }, {
                name: "Podcast"
            } ],
            field_labels: {
                publisher: "Label or publisher",
                author: "Performers",
                editor: "Composers",
                series_editor: "Producers",
                number: "Episode Number",
                published: "Date released",
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event",
                booktitle: "Album name"
            },
            field_shortlabels: {
                published: "Released"
            },
            field_ris: {
                editor: "C1",
                series_editor: "A3",
                running_time: "SP",
                medium: "M3"
            },
            field_ris_additional: {
                C5: "medium",
                A2: "author",
                AU: "editor"
            },
            field_endnote: {},
            field_zotero: {
                medium: "audiorecordingformat",
                publisher: "label",
                series: "seriestitle"
            },
            field_csl: {
                editor: "composer"
            },
            field_help: {
                publisher: "The name of the label <p>'Universal Music Group' or 'Warner Music Group'</p>",
                number: "Number of the episode",
                author: "The performer(s), the band, or the podcaster(s)" + this.getAuthorHelp(),
                editor: "The composer(s)" + this.getAuthorHelp(),
                series_editor: "The producer(s)" + this.getAuthorHelp(),
                booktitle: "Name of the album",
                conference: "Event where the item was recorded",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event",
                published: "Date when the item was released" + this.getDateHelp()
            }
        }, {
            id: "PP_VIDEO",
            name: "Video or Film",
            label: "Video or Film",
            description: "Published video recording or film",
            bibtex_types: [ "MISC" ],
            mendeley_type: "FILM",
            endnote_type: [ {
                name: "ONLINE MULTIMEDIA"
            }, {
                name: "AUDIOVISUAL MATERIAL"
            }, {
                name: "FILM OR BROADCAST"
            } ],
            csl_type: "motion_picture",
            zotero_type: [ {
                subtype: "Film",
                name: "FILM"
            }, {
                subtype: "Video",
                name: "VIDEORECORDING"
            } ],
            ris_type: [ {
                name: "VIDEO",
                default: true
            }, {
                name: "ADVS"
            }, {
                name: "MPCT"
            } ],
            mandatory_fields: [ "title", "author", "publisher", "address", "url", "published", "medium", "running_time" ],
            excluded_fields: PP.Array.merge(a.pages, a.patent, a.journal, a.legal, a.math, a.pubmed, a.isbn, a.issn, a.arxiv, a.book, a.thesis, [ "scale", "institution", "ismn", "howpublished", "filed", "associated_doi" ]),
            csl_excluded_fields: [ "editor", "series_editor", "contributor" ],
            subtypes: [ {
                name: "Video"
            }, {
                name: "Online Video"
            }, {
                name: "Film"
            }, {
                name: "TV Series"
            } ],
            field_labels: {
                publisher: "Studio or distributor",
                author: "Directors",
                editor: "Cast members",
                series_editor: "Producers",
                published: "Date released",
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event",
                address: "Country"
            },
            field_shortlabels: {
                published: "Released"
            },
            field_ris: {
                editor: "C1",
                series_editor: "A3",
                running_time: "SP",
                medium: "M3",
                genre: "C4",
                series: "T2"
            },
            field_endnote: {
                number: "%N",
                running_time: [ "%3", "%P" ],
                genre: "%4",
                series: "%B",
                editor: "%?"
            },
            field_zotero: {
                publisher: "studio",
                medium: "videorecordingformat",
                series: "seriestitle"
            },
            field_ris_additional: {
                A2: "editor"
            },
            field_help: {
                title: "Title of film or video",
                publisher: "The name of the studio or distributor<p>'Walt Disney Pictures', '20th Century Fox', 'YouTube'</p>",
                author: "The director(s)" + this.getAuthorHelp(),
                editor: "The cast member(s)" + this.getAuthorHelp(),
                series_editor: "The producer(s)" + this.getAuthorHelp(),
                conference: "Event where the item was recorded",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event",
                published: "Date when the item was released" + this.getDateHelp(),
                address: "Country where the movie or film was produced"
            }
        }, {
            id: "PP_CASE",
            name: "Case",
            label: "Case",
            description: "Legal case",
            bibtex_types: [ "MISC" ],
            csl_type: "legal_case",
            mendeley_type: "CASE",
            endnote_type: "CASE",
            zotero_type: "CASE",
            ris_type: "CASE",
            mandatory_fields: [ "title", "journal", "court", "volume", "pages", "jurisdiction", "url", "published", "number" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.math, a.thesis, a.archive, a.pubmed, a.arxiv, [ "issue", "isbn", "isbn_alt", "issn", "issn_alt", "eprint", "num_pages", "conference", "institution", "chapter", "session", "legislative_body", "status", "series", "num_volumes", "booktitle", "author", "address", "publisher", "original_publisher", "howpublished", "original_address", "originally_published", "version", "editor", "series_editor" ]),
            subtypes: [],
            field_labels: {
                journal: "Reporter",
                journalfull: "Full reporter name",
                title: "Case name",
                volume: "Reporter volume",
                pages: "First page",
                filed: "Filing date",
                series_number: "Year as volume",
                number: "Docket number",
                published: "Date decided"
            },
            field_ris: {
                journal: "T2",
                pages: "SP",
                filed: "SE",
                history: "OP",
                court: "PB"
            },
            field_zotero: {
                title: "casename",
                journal: "reporter",
                volume: "reportervolume",
                court: "court",
                pages: "firstpage",
                number: "docketnumber"
            },
            field_endnote: {
                journal: "%B",
                history: "%(",
                number: "%N",
                court: "%I",
                filed: "%&",
                edition: null,
                kind: null,
                translator: null,
                original_title: null,
                contributor: null
            },
            field_mendeley: {
                journal: "authors"
            },
            field_ris_additional: {},
            field_csl: {},
            field_help: {
                title: "Case name",
                journal: "Abbreviation of the reporter (publication containing the opinions of a particular court or jurisdiction)",
                journalfull: "The reporter fully spelled out",
                volume: "Volume number",
                pages: "First page of the case in the given volume",
                series_number: "The year used as volume number",
                number: "Docket number",
                filed: "Date when the case was filed" + this.getDateHelp(),
                published: "Date of decision" + this.getDateHelp()
            }
        }, {
            id: "PP_STATUTE",
            name: "Statute",
            label: "Statute",
            description: "Statute",
            bibtex_types: [ "MISC" ],
            csl_type: "legislation",
            mendeley_type: "STATUTE",
            endnote_type: "STATUTE",
            zotero_type: "STATUTE",
            ris_type: "STAT",
            mandatory_fields: [ "title", "journal", "volume", "pages", "section", "number", "history", "jurisdiction", "url", "published", "filed" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.math, a.thesis, a.archive, a.pubmed, a.arxiv, [ "issue", "isbn", "isbn_alt", "issn", "issn_alt", "num_pages", "institution", "status", "series", "num_volumes", "booktitle", "edition", "genre", "publisher", "original_publisher", "affiliation", "address", "original_address", "originally_published", "author", "editor", "series_editor", "version", "howpublished", "court" ]),
            subtypes: [],
            field_labels: {
                published: "Date enacted",
                filed: "Date amended",
                title: "Name of act",
                volume: "Code number",
                series_number: "Regnal year",
                journal: "Code",
                journalfull: "Full name of the Code",
                number: "Public Law Number"
            },
            field_ris: {
                number: "M1",
                history: "OP",
                section: "SE",
                pages: "SP",
                journal: "T2",
                session: "ET"
            },
            field_endnote: {
                section: "%&",
                journal: "%B",
                history: "%(",
                number: "%N",
                author: "%?",
                session: "%7",
                original_title: null
            },
            field_ris_additional: {},
            field_csl: {
                filed: "event-date"
            },
            field_zotero: {
                title: "nameofact",
                volume: "codenumber",
                journal: "code",
                number: "publiclawnumber"
            },
            field_mendeley: {
                journal: "code"
            },
            field_help: {
                journal: "The official source for statutes (e.g. U.S.C.)",
                journalfull: "The official source for statutes (e.g. United States Code)",
                published: "Date when the statute was enacted" + this.getDateHelp(),
                filed: "Date when the statute was amended" + this.getDateHelp(),
                title: "Name of act",
                volume: "Code number",
                series_number: "Regnal year",
                number: "Public Law Number"
            }
        }, {
            id: "PP_BILL",
            name: "Bill",
            label: "Bill",
            description: "Bill",
            bibtex_types: [ "MISC" ],
            csl_type: "bill",
            mendeley_type: "BILL",
            endnote_type: "BILL",
            zotero_type: "BILL",
            ris_type: [ {
                name: "BILL",
                default: true
            }, {
                name: "UNBILL"
            } ],
            mandatory_fields: [ "title", "author", "legislative_body", "session", "number", "section", "jurisdiction", "url", "published" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.math, a.thesis, a.archive, a.pubmed, a.arxiv, a.series, [ "issue", "isbn", "isbn_alt", "issn", "issn_alt", "num_pages", "institution", "chapter", "journalfull", "num_volumes", "booktitle", "edition", "genre", "publisher", "original_publisher", "affiliation", "address", "original_address", "howpublished", "originally_published", "editor", "series_editor", "version", "filed", "court" ]),
            subtypes: [],
            field_labels: {
                published: "Date",
                journal: "Code",
                volume: "Code volume",
                pages: "Code pages",
                author: "Sponsor",
                number: "Bill number"
            },
            field_ris: {
                author: "A2",
                number: "M1",
                history: "OP",
                section: "SE",
                pages: "SP",
                journal: "T2",
                legislative_body: "T3",
                session: "ET"
            },
            field_ris_additional: {},
            field_endnote: {
                section: "%&",
                legislative_body: "%S",
                journal: "%B",
                history: "%(",
                number: "%N",
                author: "%?",
                session: "%7",
                original_title: null
            },
            field_zotero: {
                pages: "codepages",
                volume: "codevolume",
                number: "billnumber",
                journal: "code"
            },
            field_help: {
                journal: "The official source for the bill (e.g. the United States Code or U.S.C.)",
                published: "Date" + this.getDateHelp(),
                volume: "Code volume",
                pages: "Code pages",
                author: "Sponsor",
                number: "Bill number"
            }
        }, {
            id: "PP_TREATY",
            name: "Treaty",
            label: "Treaty",
            description: "Treaty (International law)",
            bibtex_types: [ "MISC" ],
            csl_type: "treaty",
            zotero_type: "TREATY",
            mandatory_fields: [ "title", "author", "journal", "volume", "pages", "number", "url", "published" ],
            excluded_fields: PP.Array.merge(a.conference, a.patent, a.misc, a.math, a.thesis, a.archive, a.pubmed, a.arxiv, a.series, [ "issue", "isbn", "isbn_alt", "issn", "issn_alt", "num_pages", "institution", "chapter", "status", "num_volumes", "booktitle", "edition", "genre", "original_publisher", "affiliation", "address", "original_address", "originally_published", "editor", "version", "howpublished", "jurisdiction", "legislative_body", "history", "session", "court" ]),
            subtypes: [],
            field_labels: {
                title: "Title of the agreement",
                author: "Names of the parties",
                published: "Date in force",
                filed: "Date signed",
                journal: "Source",
                journalfull: "Full name source"
            },
            field_ris: {},
            field_ris_additional: {},
            field_zotero: {},
            field_help: {
                title: "Title of the agreement (e.g. Kyoto Protocol to the United Nations Framework Convention on Climate Change)",
                author: "Names of the signing parties " + this.getAuthorHelp(),
                published: "Date in force" + this.getDateHelp(),
                filed: "Date signed" + this.getDateHelp(),
                journal: "Name of the source that published the text of the treaty",
                journalfull: "Full name of the source (e.g. United Nations Treaty Series)"
            }
        }, {
            id: "PP_FIGURE",
            name: "Figure",
            label: "Figure",
            description: "Published graph, chart,\u2026",
            bibtex_types: [ "MISC" ],
            csl_type: "figure",
            endnote_type: [ {
                name: "CHART OR TABLE"
            }, {
                name: "EQUATION"
            }, {
                name: "FIGURE"
            } ],
            ris_type: [ {
                name: "FIGURE",
                default: true
            }, {
                name: "CHART"
            } ],
            mandatory_fields: [ "title", "author", "publisher", "url", "published", "medium", "number" ],
            excluded_fields: PP.Array.merge(a.legal, a.patent, a.pages, a.volume, a.journal, a.book, a.math, a.thesis, a.isbn, a.arxiv, a.pubmed, a.issn, a.series, [ "institution", "howpublished", "status", "editor", "filed", "associated_doi", "running_time", "scale", "ismn" ]),
            subtypes: [ {
                name: "Image"
            }, {
                name: "Graph"
            }, {
                name: "Chart"
            }, {
                name: "Drawing"
            }, {
                name: "Photography"
            } ],
            field_labels: {
                conference: "Event name",
                conference_location: "Event place",
                conference_date: "Date of the event",
                medium: "Format"
            },
            field_ris: {
                version: "ET",
                number: "M1"
            },
            field_ris_additional: {},
            field_endnote: {
                version: "%7",
                abstract: [ "%X", "%P" ],
                archive: "%E",
                archive_location: "%B",
                number: "%N",
                medium: "%V"
            },
            field_help: {
                medium: "e.g. 'Online image'",
                conference: "Event where the item was presented",
                conference_location: "Location where the event was held",
                conference_date: "Date of the event",
                title: "Figure title" + this.getTitleHelp()
            }
        }, {
            id: "PP_ARTWORK",
            name: "Artwork",
            label: "Artwork",
            description: "Painting, drawing, sculpture,\u2026",
            bibtex_types: [ "MISC" ],
            csl_type: "graphic",
            endnote_type: [ {
                name: "ARTWORK"
            } ],
            ris_type: [ {
                name: "ART",
                default: true
            } ],
            zotero_type: [ {
                name: "ARTWORK"
            } ],
            mandatory_fields: [ "title", "author", "url", "institution", "address", "published", "medium" ],
            excluded_fields: PP.Array.merge(a.legal, a.conference, a.patent, a.pubmed, a.math, a.arxiv, a.isbn, a.journal, a.book, a.issn, a.pages, a.volume, a.math, a.thesis, [ "status", "editor", "edition", "filed", "running_time", "publisher", "original_publisher", "howpublished", "series_editor", "ismn", "associated_doi" ]),
            subtypes: [ {
                name: "Painting"
            }, {
                name: "Drawing"
            }, {
                name: "Sculpture"
            }, {
                name: "Calligraphy"
            }, {
                name: "Photography"
            } ],
            field_labels: {
                author: "Artist",
                published: "Date",
                scale: "Size"
            },
            field_ris: {
                genre: "M3"
            },
            field_endnote: {
                scale: "%3"
            },
            field_zotero: {
                medium: "artworkmedium",
                scale: "artworksize"
            },
            field_csl: {
                scale: "dimensions"
            },
            field_ris_additional: {},
            field_help: {
                title: "Title of the artwork",
                institution: "The institution or individual who owns the work",
                address: "The city where the work resides",
                medium: "e.g. 'Oil on canvas'",
                scale: "Size of the artwork",
                author: "The artist(s)" + this.getAuthorHelp(),
                published: "Date the artwork was created" + this.getDateHelp()
            }
        }, {
            id: "PP_MAP",
            name: "Map",
            label: "Map",
            description: "Published map",
            bibtex_types: [ "MISC" ],
            csl_type: "map",
            endnote_type: [],
            ris_type: [ {
                name: "MAP",
                default: true
            } ],
            zotero_type: [ {
                name: "MAP"
            } ],
            mandatory_fields: [ "title", "author", "url", "scale", "publisher", "address", "published" ],
            excluded_fields: PP.Array.merge(a.series, a.legal, a.conference, a.patent, a.thesis, a.pubmed, a.journal, a.book, a.math, a.arxiv, a.pages, a.volume, a.issn, a.isbn, [ "ismn", "running_time", "medium", "institution", "status", "filed", "howpublished", "associated_doi" ]),
            subtypes: [],
            field_labels: {
                author: "Cartographer"
            },
            field_ris: {
                genre: "M3"
            },
            field_ris_additional: {},
            field_endnote: {},
            field_zotero: {
                genre: "maptype",
                series: "seriestitle"
            },
            field_help: {
                author: "The cartographer(s)" + this.getAuthorHelp()
            }
        }, {
            id: "PP_SCORE",
            name: "Musical Score",
            label: "Musical Score",
            description: "Sheet music",
            bibtex_types: [ "MISC" ],
            csl_type: "musical_score",
            ris_type: [ {
                name: "MUSIC",
                default: true
            } ],
            mandatory_fields: [ "title", "author", "number", "publisher", "address", "published", "ismn" ],
            excluded_fields: PP.Array.merge(a.legal, a.conference, a.patent, a.pubmed, a.math, a.book, a.journal, a.issn, a.isbn, a.arxiv, a.thesis, [ "institution", "status", "edition", "running_time", "scale", "medium", "pages", "howpublished", "associated_doi" ]),
            subtypes: [],
            field_labels: {
                author: "Composer",
                filed: "Composition date"
            },
            field_ris: {
                genre: "M3",
                ismn: "SN"
            },
            field_ris_additional: {},
            field_endnote: {},
            field_zotero: {},
            field_help: {
                title: "Title of the composition, e.g. 'Sonate in Es'",
                author: "The composer(s)" + this.getAuthorHelp(),
                filed: "The date of the composition" + this.getDateHelp(),
                number: "Number of composition, e.g. 'KV 216'"
            }
        }, {
            id: "PP_GRANT",
            name: "Grant",
            label: "Grant",
            description: "Grant application",
            bibtex_types: [ "MISC" ],
            subtypes: [],
            csl_type: "report",
            endnote_type: [ {
                name: "GRANT",
                default: true
            } ],
            ris_type: [ {
                name: "GRANT",
                default: true
            } ],
            field_ris: {},
            field_ris_additional: {},
            field_endnote: {
                number: "%N",
                genre: "%9",
                original_title: "%("
            },
            field_zotero: {},
            field_mendeley: {},
            field_help: {
                title: "Title of the grant" + this.getTitleHelp(),
                publisher: "The sponsoring agency the grant was submitted to",
                published: "Date when the grant was approved" + this.getDateHelp(),
                filed: "Date when the grant was submitted" + this.getDateHelp()
            },
            field_labels: {
                publisher: "Sponsoring agency",
                published: "Date granted",
                filed: "Date submitted"
            },
            mandatory_fields: [ "title", "author", "number", "publisher", "published", "num_pages" ],
            excluded_fields: PP.Array.merge(a.series, a.conference, a.patent, a.misc, a.legal, a.pubmed, a.math, a.book, a.journal, a.volume, a.thesis, a.issn, a.isbn, a.archive, a.arxiv, [ "howpublished", "version", "original_publisher", "original_address", "institution", "pages", "originally_published", "lccn", "associated_doi" ])
        }, {
            id: "PP_PERIODICAL",
            name: "Periodical",
            label: "Periodical",
            description: "Journal, Magazine, or Newspaper",
            bibtex_types: [ "MISC" ],
            subtypes: [ {
                name: "Journal"
            }, {
                name: "Magazine"
            }, {
                name: "Newspaper"
            } ],
            csl_type: "book",
            endnote_type: [],
            ris_type: [],
            field_ris: {},
            field_ris_additional: {},
            field_endnote: {},
            field_zotero: {},
            field_mendeley: {},
            field_help: {
                published: "Date or date range the periodical was published " + this.getDateHelp(),
                howpublished: "Frequency (monthly, weekly, daily)"
            },
            field_labels: {
                howpublished: "Frequency",
                genre: "Issue title"
            },
            mandatory_fields: [ "title", "editor", "publisher", [ "volume", "num_volumes" ], "issue", [ "issn", "issn_alt" ], "published" ],
            excluded_fields: PP.Array.merge(a.series, a.conference, a.patent, a.legal, a.pubmed, a.math, a.book, a.thesis, a.archive, a.arxiv, a.misc, [ "journal", "journalfull", "filed", "author", "version", "institution", "pages", "num_pages", "originally_published", "associated_doi" ])
        } ];
        var c = this.getSortOrder();
        b.sort(function(a, b) {
            return c.indexOf(a.id) - c.indexOf(b.id);
        });
        for (var d = 0; d < b.length; d++) {
            b[d].defaultSortOrder = d;
        }
        this._types = b;
        return b;
    },
    getTypeForPub: function(a) {
        var b = a.pubtype;
        var c = this.getPubTypeMap();
        var d = c[a.pubtype];
        return d;
    },
    getDummyPubForPubtype: function(a) {
        var b = {
            pubtype: a
        };
        var c = {
            doi: "10.1000/1",
            pmc: "PMC1234",
            pmid: "1234567",
            issn: "1825-411X",
            issn_alt: "1530-6984",
            isbn: "9780195122213",
            isbn_alt: "9788479195045",
            arxivid: "1211.7025",
            archivePrefix: "arXiv",
            primaryClass: "math.DS",
            pages: "12-22",
            ismn: "979-0-2306-7118-7"
        };
        var d = 2e3;
        PP.library.PublicationFields.getFieldsForPubType(a).forEach(function(e) {
            var f = e.name;
            var g = e.label;
            if (f in c) {
                g = c[f];
            } else {
                if (f == "title") {
                    g += " for " + a;
                } else if (e.dataType == "author") {
                    g = [ {
                        last: g,
                        first: "AR"
                    } ];
                } else if (e.dataType == "date") {
                    d++;
                    g = {
                        year: d,
                        month: 6,
                        day: 30
                    };
                }
            }
            b[f] = g;
        });
        PP.library.Publication.autoClean(b);
        var e = [ "incomplete", "citedByLink", "sha1", "dup_sha1", "id_list", "subfolders", "source_id", "owner_email", "owner_name", "_id", "created", "updated", "autoCleaned", "id_list", "citekey", "xref", "source" ];
        e.forEach(function(a) {
            delete b[a];
        });
        for (var f in b) {
            if (PP.Utils.isArray(b[f])) {
                b[f].forEach(function(a) {
                    if (PP.Utils.isObject(a)) {
                        delete a["_id"];
                        delete a["formatted"];
                    }
                });
            }
        }
        return b;
    },
    getInputTypeForPub: function(a, b) {
        var c = {
            pubtype: "PP_MISC",
            kind: undefined
        };
        if (b === undefined) return c;
        var d = undefined;
        this.getPubTypes().forEach(function(d) {
            var e = undefined;
            if (b == "ris") {
                e = d.ris_type;
            } else if (b == "mendeley") {
                e = d.mendeley_type;
            } else if (b == "zotero") {
                e = d.zotero_type;
            } else if (b == "endnote") {
                e = d.endnote_type;
            } else if (b == "csl") {
                e = d.csl_type;
            }
            if (PP.Utils.isArray(e)) {
                e.forEach(function(b) {
                    if (b.name) {
                        var e = true;
                        if ("import" in b) {
                            e = b["import"];
                        }
                        if (b.name == a && e) {
                            c.pubtype = d.id;
                            c.kind = b.subtype;
                        }
                    }
                });
            } else {
                if (e == a && c.pubtype == "PP_MISC") c.pubtype = d.id;
            }
        });
        return c;
    },
    getOutputTypeForPub: function(a, b) {
        if (b === undefined) {
            return undefinded;
        }
        var c = undefined;
        var d = this.getPubTypeMap();
        var e = d[a.pubtype];
        var f = undefined;
        if (b == "csl") {
            c = e.csl_type;
        } else if (b == "ris") {
            c = e.ris_type;
        }
        if (PP.Utils.isArray(c)) {
            var g;
            c.forEach(function(a) {
                if (a["default"]) {
                    g = a.name;
                }
            });
            if (a.kind) {
                c.forEach(function(b) {
                    var c = true;
                    if ("output" in b) {
                        c = b.output;
                    }
                    if (c) {
                        if (b.subtype == a.kind) {
                            f = b.name;
                        }
                    }
                });
            }
            if (f === undefined) {
                f = g;
            }
        } else {
            f = c;
        }
        return f;
    },
    getLabel: function(a) {
        var b = this.getTypeForPub(a);
        if (!b) {
            return "BAD PUBTYPE: " + a.pubtype;
        } else {
            if (b.labelFn) {
                return b.labelFn.call(null, a);
            } else {
                return b.label;
            }
        }
    },
    getFullLabel: function(a) {
        var b = this.getTypeForPub(a);
        if (!b) {
            return "BAD PUBTYPE: " + a.pubtype;
        } else {
            var c = b.label;
            if (a.kind) {
                c = c + " / " + a.kind;
            }
            return c;
        }
    }
});

PP.library.PublicationTypes = new PP.library._PublicationTypes();

PP.library._PublicationFields = PP.Class.extend({
    decorate: function(a, b) {
        for (var c = 0; c < a.length; c++) {
            if (b) {
                PP.Utils.applyIf(a[c], b);
            }
        }
        return a;
    },
    generalFields: function() {
        return this.decorate([ {
            name: "pubtype",
            label: "Publication Type",
            bibtex_persist: false
        }, {
            name: "title",
            label: "Title",
            csl: "title",
            ris: "TI",
            zotero: "title",
            mendeley: "title",
            endnote: "%T"
        }, {
            name: "original_title",
            label: "Original title",
            help: "Title of the original item, e.g. for translated books",
            csl: "original-title",
            bibtex_support: false,
            endnote: "%O"
        }, {
            name: "titleshort",
            label: "Short title",
            help: "Short version of the title",
            csl: "shortTitle",
            zotero: "shorttitle",
            mendeley: "short_title",
            bibtex_support: false,
            endnote: "%!"
        }, {
            name: "status",
            label: "Status",
            help: "Publication status, such as 'in preparation', 'submitted', 'in revision', 'in press'",
            bibtex_support: true,
            bibtex_name: "note",
            csl: "status"
        }, {
            name: "abstract",
            label: "Abstract",
            csl: "abstract",
            ris: "AB",
            zotero: "abstractnote",
            mendeley: "abstract",
            endnote: "%X"
        }, {
            name: "keywords",
            label: "Keywords",
            ris: "KW",
            help: "Index terms added by the authors",
            mendeley: "keywords",
            csl: "keyword",
            endnote: "%K"
        }, {
            name: "note",
            label: "Notes",
            bibtex_name: "annote",
            csl: "annote",
            hideFromEditWindow: 1,
            ris: "N1",
            endnote: "%Z"
        }, {
            name: "copyright",
            label: "Copyright",
            help: "Copyright statement for the content"
        }, {
            name: "affiliation",
            label: "Affiliation",
            ris: "AD",
            help: "The organization the authors are affilated with, typically a university, research institute or company",
            endnote: "%+"
        }, {
            name: "language",
            defaultWidth: "67%",
            label: "Language",
            help: "Language of the item as two letter ISO-code (e.g., en, de, fr, es, it). To avoid automatic title casing for Non-English citations set this field to another language.",
            csl: "language",
            ris: "LA",
            zotero: "language",
            mendeley: "language",
            endnote: "%G"
        }, {
            name: "kind",
            defaultWidth: "67%",
            label: "Sub-type",
            hideFromEditWindow: 1,
            bibtex_support: false,
            mendeley: "source_type",
            endnote: "%9"
        }, {
            name: "booktitle",
            label: "Book title",
            help: "The title of the book that this item appears in",
            csl: "container-title",
            zotero: "booktitle",
            endnote: "%B"
        }, {
            name: "series",
            label: "Series",
            help: "The series the book was published in <br>'Lecture Notes in Computer Science'",
            csl: "collection-title",
            zotero: "series",
            mendeley: "series",
            endnote: "%S"
        }, {
            name: "series_number",
            defaultWidth: "67%",
            label: "Series number",
            help: "Number of the series the book was published in",
            bibtex_support: false,
            csl: "collection-number",
            zotero: "seriesnumber"
        }, {
            name: "journal",
            label: "Journal",
            defaultWidth: "67%",
            help: "Title of the journal in its standardized abbreviation if available",
            csl: "container-title",
            ris: "T2",
            zotero: "journalabbreviation",
            mendeley: "source",
            endnote: "%J"
        }, {
            name: "journalfull",
            label: "Full journal",
            bibtex_persist: false,
            help: "Full title of the journal",
            zotero: "publicationtitle"
        }, {
            name: "chapter",
            label: "Chapter",
            defaultWidth: "67%",
            help: "The chapter number",
            csl: "chapter-number",
            mendeley: "chapter"
        }, {
            name: "volume",
            label: "Volume",
            defaultWidth: "67%",
            help: "The volume number",
            csl: "volume",
            ris: "VL",
            zotero: "volume",
            mendeley: "volume",
            endnote: "%V"
        }, {
            name: "number",
            defaultWidth: "33%",
            label: "Number",
            csl: "number",
            mendeley: "revision"
        }, {
            name: "issue",
            label: "Issue",
            defaultWidth: "33%",
            help: "The issue number",
            bibtex_name: "number",
            csl: "issue",
            ris: "IS",
            zotero: "issue",
            mendeley: "issue",
            endnote: "%N"
        }, {
            name: "edition",
            label: "Edition",
            help: "The book edition <p>('first' or 'second')</p>",
            csl: "edition",
            ris: "ET",
            zotero: "edition",
            mendeley: "edition",
            endnote: "%7"
        }, {
            name: "pages",
            label: "Pages",
            defaultWidth: "33%",
            help: "<p>The range or starting page, e.g. <p>'210-213' or '210'</p><p>The article number of an electronic article, e.g. e10233</p>",
            csl: "page",
            zotero: "pages",
            mendeley: "pages",
            endnote: "%P"
        }, {
            name: "url",
            label: "URLs",
            defaultValue: [],
            help: "A list of URLs where this item can be accessed online (one per line)",
            bibtex_name: "url",
            dataType: "array",
            csl: "URL",
            ris: "UR",
            zotero: "url",
            mendeley: "websites",
            endnote: "%U"
        }, {
            name: "howpublished",
            label: "How published",
            help: "How it was published, if the publishing method is nonstandard"
        }, {
            name: "publisher",
            label: "Publisher",
            defaultWidth: "67%",
            help: "The publisher's name <p>'MIT Press'</p>",
            csl: "publisher",
            ris: "PB",
            zotero: "publisher",
            mendeley: "publisher",
            endnote: "%I"
        }, {
            name: "original_publisher",
            label: "Original publisher",
            defaultWidth: "67%",
            help: "The original publisher's name, for items that have been republished by a different publisher",
            csl: "original-publisher",
            bibtex_support: false
        }, {
            name: "institution",
            label: "Institution",
            help: "The institution that was involved in the publishing, but not necessarily the publisher",
            csl: "publisher",
            zotero: "institution",
            mendeley: "institution"
        }, {
            name: "school",
            label: "School",
            help: "The degree-awarding institution <p>'University of Cambridge'</p>",
            csl: "publisher",
            zotero: "university"
        }, {
            name: "department",
            label: "Department",
            help: "The department at the university where the degree was awarded <p>'Computer Science'</p>",
            mendeley: "department",
            csl: "department",
            bibtex_support: false
        }, {
            name: "address",
            label: "Address",
            help: "The publisher's address (usually just the city) <p>'Cambridge'</p>",
            csl: "publisher-place",
            ris: "CY",
            zotero: "place",
            mendeley: "city",
            endnote: "%C"
        }, {
            name: "original_address",
            label: "Original address",
            help: "The original publisher's address (usually just the city) <p>'Cambridge'</p>",
            csl: "original-publisher-place",
            bibtex_support: false
        }, {
            name: "version",
            label: "Version",
            help: "The software or device version <p>'2.1.0'</p>",
            bibtex_support: false,
            csl: "version",
            zotero: "version"
        }, {
            name: "scale",
            label: "Scale",
            help: "The scale of a map e.g. 1:50.000",
            bibtex_support: false,
            csl: "scale",
            zotero: "scale",
            ris: "C1"
        }, {
            name: "conference",
            label: "Conference",
            help: "The name of the conference where this work was presented <p>'Biology of Genomes'</p>",
            csl: "event",
            zotero: "conferencename"
        }, {
            name: "conference_location",
            label: "Conference location",
            help: "Location where the conference was held",
            csl: "event-place",
            bibtex_support: false
        }, {
            name: "issuing_authority",
            label: "Issuing authority",
            help: "The patent issuing authority (e.g. US, Japan, Germany, EC)",
            bibtex_support: false,
            csl: "authority",
            zotero: "issuingauthority"
        }, {
            name: "patent_publication_type",
            label: "Patent publication type",
            help: "The type of patent publication (e.g., 'patent' or 'application')",
            bibtex_support: false
        }, {
            name: "application_number",
            label: "Application number",
            help: "The number assigned to the initial patent application (e.g., '09/458811')",
            bibtex_support: false,
            csl: "call-number",
            ris: "M1",
            zotero: "applicationnumber",
            mendeley: "patent_application_number",
            endnote: "%N"
        }, {
            name: "class",
            label: "Class",
            help: "The category / class of the invention (within the issuing authority's classification system)",
            bibtex_support: false
        }, {
            name: "international_class",
            label: "International class",
            help: "The category / class of the invention within the International Patent Classification (IPC) scheme",
            bibtex_support: false
        }, {
            name: "search_class",
            label: "Field of search",
            help: "An extended list of classes covering the invention categories relevant to this patent",
            bibtex_support: false
        }, {
            name: "states",
            label: "Designated states",
            help: "A list of states specified by the inventor when filed with WIPO or EPO",
            bibtex_support: false,
            zotero: "country"
        }, {
            name: "priority_numbers",
            label: "Priority numbers",
            help: "A list of patent application numbers for which priority is claimed",
            csl: "issue",
            zotero: "prioritynumbers",
            bibtex_support: false
        }, {
            name: "patent_number",
            label: "Patent number",
            help: "The patent number without the preceding country / authority code (e.g., '3990438' NOT 'US3990438')",
            bibtex_name: "number",
            csl: "number",
            ris: "SN",
            zotero: "patentnumber"
        }, {
            name: "assignee",
            label: "Assignee",
            help: "The individual or organization to which the patent was assigned",
            bibtex_support: false,
            zotero: "assignee",
            mendeley: "patent_owner"
        }, {
            name: "foreign_patents",
            label: "Foreign references",
            help: "A list of patent numbers for any associated foreign patents",
            bibtex_support: false
        }, {
            name: "call_number",
            label: "Call number",
            help: "Location in the library where the item can be found",
            bibtex_support: false,
            csl: "call-number",
            zotero: "callnumber",
            endnote: "%L"
        }, {
            name: "num_pages",
            label: "Page count",
            help: "The total number of pages in the book",
            bibtex_support: false,
            csl: "number-of-pages",
            zotero: "numpages",
            endnote: "%&"
        }, {
            name: "num_volumes",
            label: "Volume count",
            help: "The total number of volumes in the book series",
            bibtex_support: false,
            csl: "number-of-volumes",
            ris: "NV",
            zotero: "numberofvolumes",
            endnote: "%6"
        }, {
            name: "archivePrefix",
            label: "Archive prefix",
            help: "Name of the preprint archive<p>arXiv, bioRxiv</p>",
            csl: "archive",
            zotero: "archive"
        }, {
            name: "archive",
            label: "Archive",
            help: "Name of the archive where this document can be found<p>American Heritage Center</p>",
            csl: "archive",
            zotero: "archive",
            bibtex_support: false
        }, {
            name: "archive_location",
            label: "Archive location",
            help: "Storage location within an archive (e.g. a box and folder number)",
            csl: "archive_location",
            zotero: "archivelocation",
            bibtex_support: false
        }, {
            name: "archive_place",
            label: "Archive place",
            help: "Geographic location of the archive<p>West Lafayette, Indiana</p>",
            csl: "archive-place",
            bibtex_support: false
        }, {
            name: "eprint",
            label: "Eprint ID",
            help: "Identifier for the e-print article (e.g. 0707.3168)"
        }, {
            name: "primaryClass",
            label: "Primary class",
            help: "Primary arXiv category (e.g. hep-th)"
        }, {
            name: "running_time",
            label: "Running time",
            help: "Running time e.g. 142 min",
            bibtex_support: false,
            csl: "dimensions",
            zotero: "runningtime",
            endnote: "%runningtime"
        }, {
            name: "medium",
            label: "Medium",
            help: "Medium of the media type (e.g. CD, DVD, VHS)",
            bibtex_support: false,
            csl: "medium",
            mendeley: "medium",
            endnote: "%#"
        }, {
            name: "genre",
            label: "Custom sub-type",
            help: "Class, type or genre of the item",
            bibtex_support: false,
            csl: "genre",
            mendeley: "genre"
        }, {
            name: "jurisdiction",
            label: "Jurisdiction",
            help: "Jurisdiction (e.g. United States, United Kingdom)",
            bibtex_support: false,
            csl: "jurisdiction"
        }, {
            name: "court",
            label: "Court",
            help: "Court (e.g. Supreme Court or Court of Appeals)",
            bibtex_support: false,
            csl: "authority",
            zotero: "court"
        }, {
            name: "history",
            label: "History",
            help: "Legal history: this explains what happened to the case on appeal to a higher appellate court",
            bibtex_support: false,
            csl: "references",
            zotero: "history"
        }, {
            name: "section",
            label: "Section",
            help: "Section number of the statute or bill",
            bibtex_support: false,
            csl: "section",
            zotero: "section"
        }, {
            name: "session",
            label: "Session",
            help: "Session of the Congress",
            bibtex_support: false,
            zotero: "session",
            csl: "chapter-number"
        }, {
            name: "legislative_body",
            label: "Legislative Body",
            help: "Legislative body who made, amended or repealed the bill (e.g. Senate)",
            bibtex_support: false,
            zotero: "legislativebody",
            csl: "authority"
        } ], {
            fieldType: "general",
            defaultValue: undefined
        });
    },
    identifierFields: function() {
        return this.decorate([ {
            name: "user_citekey",
            label: "BibTeX key",
            help: "Citation key for use with LaTeX/BibTeX. If not set Paperpile will assign a key automatically. If you set this field make sure it is unique in your library."
        }, {
            name: "issn",
            label: "ISSN",
            defaultWidth: "67%",
            help: "An identifier for periodicals (journals, magazines)",
            csl: "ISSN",
            zotero: "issn",
            mendeley: "identifiers.issn"
        }, {
            name: "issn_alt",
            label: "ISSN (alt.)",
            defaultWidth: "67%",
            help: "A secondary or alternate ISSN (e.g. online version of the journal)",
            bibtex_name: "issn"
        }, {
            name: "isbn",
            label: "ISBN",
            defaultWidth: "67%",
            help: "An international identifier for books",
            csl: "ISBN",
            zotero: "isbn",
            mendeley: "identifiers.isbn",
            endnote: "%@"
        }, {
            name: "isbn_alt",
            label: "ISBN (alt.)",
            defaultWidth: "67%",
            help: "A secondary or alternate ISBN (e.g. electronic or re-issued version)",
            bibtex_name: "isbn"
        }, {
            name: "ismn",
            label: "ISMN",
            defaultWidth: "67%",
            help: "An international identifier for notated music",
            bibtex_support: false
        }, {
            name: "pmid",
            label: "PMID",
            defaultWidth: "67%",
            help: "An identifier for articles in the PubMed database",
            csl: "PMID",
            mendeley: "identifiers.pmid"
        }, {
            name: "lccn",
            label: "LCCN",
            defaultWidth: "67%",
            help: "An identifier for books published in the United States, managed by the Library of Congress"
        }, {
            name: "mr",
            label: "MR Number",
            defaultWidth: "67%",
            help: "An identifier to locate a specific record in the Mathematical Reviews (MR) database",
            bibtex_name: "mrnumber"
        }, {
            name: "zbl",
            label: "Zbl Number",
            defaultWidth: "67%",
            help: "An identifier to locate a specific record in the Zentralblatt MATH database",
            bibtex_name: "zbl"
        }, {
            name: "arxivid",
            label: "Arxiv ID",
            defaultWidth: "67%",
            help: "An identifier for e-print articles published on arXiv.org",
            mendeley: "identifiers.arxiv"
        }, {
            name: "doi",
            label: "DOI",
            defaultWidth: "67%",
            help: "A generic identifier for digital objects. Most journal articles have a unique DOI assigned on publication.",
            csl: "DOI",
            ris: "DO",
            zotero: "doi",
            mendeley: "identifiers.doi",
            endnote: "%R"
        }, {
            name: "associated_doi",
            label: "Associated DOI",
            defaultWidth: "67%",
            help: "One or more DOIs for the item with which this entry is associated."
        }, {
            name: "pmc",
            label: "PMC ID",
            defaultWidth: "67%",
            help: "An identifier for articles deposited in the PubMed Central open access repository",
            csl: "PMCID",
            endnote: "%]"
        } ], {
            fieldType: "identifier",
            defaultValue: undefined
        });
    },
    dateFields: function() {
        return this.decorate([ {
            name: "published",
            label: "Date published",
            shortLabel: "Published",
            help: "Date when the item was published <p>'2002' <i>or</i> 'June 2002' <i>or</i> 'June 24, 2002' <br/> <i>or free-form date in braces<i><br> '{May-June 1876}'</p>",
            csl: "issued",
            ris: "DA",
            zotero: "date",
            endnote: "%8"
        }, {
            name: "accessed",
            label: "Date accessed",
            shortLabel: "Accessed",
            help: "Date when the item was accessed <p>'May 1, 2012'</p>",
            csl: "accessed",
            ris: "Y2",
            zotero: "accessdate",
            endnote: "%["
        }, {
            name: "filed",
            label: "Date filed",
            shortLabel: "Filed",
            help: "Date when the patent was filed",
            csl: "submitted",
            ris: "C2",
            zotero: "filingdate"
        }, {
            name: "originally_published",
            label: "Date of the original publication",
            shortLabel: "Originally published",
            help: "Date when the item was originally published <p>'2002' <br/> 'June 2002' <br/> 'June 24, 2002' <br/> '{May-June 1876}'</p>",
            csl: "original-date",
            bibtex_support: false
        }, {
            name: "conference_date",
            label: "Conference date",
            shortLabel: "Conference date",
            help: "Date when the conference was held",
            csl: "event-date"
        } ], {
            fieldType: "date",
            dataType: "date",
            defaultValue: undefined
        });
    },
    libraryFields: function() {
        return this.decorate([ {
            name: "imported",
            type: "int",
            defaultValue: 0,
            note: "Either 0 (if the pub hasn't been stored in the DB yet) or 1 (if it has been)"
        }, {
            name: "_id",
            label: "GUID",
            note: "Paperpile GUID for this reference.",
            bibtex_name: "pp_guid",
            export_persist: true,
            csl: "id"
        }, {
            name: "original_id",
            label: "Source ID",
            note: "GUID of the original item from which this item was copied.",
            export_persist: true
        }, {
            name: "owner",
            label: "Owner",
            note: "Paperpile user who owns this reference",
            export_persist: true
        }, {
            name: "id_list",
            label: "ID list",
            dataType: "array",
            note: "Internal array of unique IDs (i.e. doi, pmid, patent_number, etc.)"
        }, {
            name: "_keywords",
            label: "Keywords",
            dataType: "array",
            note: "Internal array of keywords for indexing",
            persist: false,
            endnote: "%K"
        }, {
            name: "collection_timestamps",
            label: "Collection Timestamps",
            defaultValue: {},
            note: "A hash of collection IDs and timestamps, tracking when this item was added to each collection.",
            dataType: "object"
        }, {
            name: "sha1",
            label: "Sha1 hash",
            note: "A sha1 hash of the main contents of the reference."
        }, {
            name: "dup_sha1",
            label: "Sha1 hash (Duplicates)",
            note: "A simpler sha1 hash, for detecting duplicate references."
        }, {
            name: "duplicates",
            label: "Duplicates",
            note: "A list of the IDs of any duplicate publications in the library.",
            dataType: "array"
        }, {
            name: "ignore_duplicates",
            label: "Ignored Duplicates",
            note: "A list of publications that have been manually flagged as NOT duplicates of this item.",
            dataType: "array"
        }, {
            name: "created",
            label: "Created",
            note: "A Unix timestamp, storing the date and time that this reference was created in our database",
            dataType: "date",
            showInExpandedView: true
        }, {
            name: "updated",
            label: "Last modified",
            note: "A Unix timestamp, storing the date and time that this reference was last modified",
            dataType: "date",
            showInExpandedView: true
        }, {
            name: "trashed",
            label: "Trashed",
            note: "Either 0 or 1, indicating whether or not the pub is currently trashed"
        }, {
            name: "starred",
            label: "Starred",
            note: "Either 0 or 1, indicating whether or not the pub is currently starred"
        }, {
            name: "labels",
            label: "Labels",
            defaultValue: [],
            note: "An array of collection GUIDs corresponding to the assigned labels",
            dataType: "array"
        }, {
            name: "folders",
            label: "Folders",
            defaultValue: [],
            note: "An array of collection GUIDs corresponding to the assigned folders",
            dataType: "array"
        }, {
            name: "shared_folders",
            label: "Shared Folders",
            defaultValue: [],
            note: "An array of collection GUIDs corresponding to the assigned shared folders",
            dataType: "array"
        }, {
            name: "crawl_urls",
            label: "URLs",
            defaultValue: [],
            help: "An internal array of ALL the URLs that were encountered during crawling.",
            dataType: "array"
        }, {
            name: "webimport_sha1s",
            label: "Webimport sha1s",
            defaultValue: [],
            help: "An internal array of webimport Sha1s (for identifying webimport pubs)",
            dataType: "array"
        }, {
            name: "attachments",
            label: "Attachments",
            defaultValue: [],
            help: "An internal array of file attachment objects.",
            dataType: "array",
            bibtex_name: "file",
            export_persist: true
        }, {
            name: "xref",
            label: "Associated items",
            help: "An internal array of objects containing data about associated items.",
            dataType: "array"
        }, {
            name: "pdf",
            label: "PDF file ID",
            help: "An internal PDF file ID"
        }, {
            name: "source",
            label: "Data source",
            defaultValue: {},
            help: "Information about the source of this article's metadata.",
            dataType: "object"
        }, {
            name: "masid",
            label: "Microsoft Academic Search ID",
            defaultWidth: "67%",
            help: "The ID for this article within Microsoft Academic Search (unstable)"
        }, {
            name: "mendeleyid",
            label: "Mendeley UUID",
            help: "The canonical Mendeley ID for this article"
        }, {
            name: "scopusid",
            label: "Scopus ID",
            help: "The scopus ID for this article"
        }, {
            name: "gs_related_articles",
            label: 'Link to Google Scholar "related articles"'
        }, {
            name: "gs_all_versions",
            label: 'Link to Google Scholar "all versions"'
        }, {
            name: "gs_cluster_id",
            label: 'Google Scholar "cluster" ID'
        }, {
            name: "gs_cited_by_count",
            label: "Google Scholar cited by count"
        }, {
            name: "pubmed_cited_by_count",
            label: "PubMed / PMC cited by count"
        }, {
            name: "gs_cited_by_link",
            label: 'Link to Google Scholar "cited by"'
        }, {
            name: "gs_bibtex",
            label: 'Link to Google Scholar "details" bibtex link'
        }, {
            name: "citedByLink",
            label: '"Cited by" link',
            help: "URL of a page listing articles that cite this article"
        }, {
            name: "referencesLink",
            label: "References link",
            help: "URL of a page where the article's references can be found"
        }, {
            name: "external_pdf_filename",
            label: "External PDF Filename",
            help: "The PDF filename found during RIS import"
        }, {
            name: "subfolders",
            label: "Subfolder",
            defaultValue: [],
            note: "List of subfolders this article should be stored in Google Drive.",
            dataType: "array"
        }, {
            name: "count_index",
            label: "Count Index",
            defaultValue: [],
            note: "List of keywords used for collecting faceted counts.",
            dataType: "array"
        }, {
            name: "citekey",
            label: "Citation key",
            export_persists: true,
            help: "Citation key for use with LaTeX/BibTeX. If you change it, make sure the key remains unique in your library."
        }, {
            name: "autocompleted",
            label: "Autocompleted",
            note: "Whether the article was autocompleted or not"
        }, {
            name: "locked_citation",
            label: "Locked citation",
            note: 'Flags items in the "Citations" database as modified externally so they are not ovewritten by changes in the original from "Library"'
        }, {
            name: "journal_checked",
            label: "Journal checked",
            note: "Whether the article has had its journal checked against our db or not"
        }, {
            name: "force_complete",
            label: "Force Complete",
            note: "Flag to force the data to NOT be considered incomplete."
        }, {
            name: "incomplete",
            label: "Incomplete",
            note: '1 if the article has "incomplete" data, i.e. missing crucial information for the given pubtype. 0 otherwise.'
        }, {
            name: "pdf_restricted",
            label: "PDF restricted",
            note: "1 if the article hit a paywall when downloading an article PDF."
        }, {
            name: "original_citekey",
            label: "Original BibTeX key",
            help: "Original key (if any) loaded via BibTeX import."
        } ], {
            fieldType: "library",
            defaultValue: undefined,
            export_persist: false
        });
    },
    authorFields: function() {
        var a = ", separated by semicolons <p><i>Last, First Middle</i> <p>e.g. Knuth, Donald E; Moore, Ronald W</p><p><i>Collective names in braces</i><p>e.g. {1000 Genomes Consortium}</p>";
        return this.decorate([ {
            name: "author",
            label: "Authors",
            help: "The author(s)" + a,
            csl: "author",
            ris: "AU",
            mendeley: "authors",
            endnote: "%A"
        }, {
            name: "editor",
            label: "Editors",
            help: "The editor(s)" + a,
            csl: "editor",
            mendeley: "editors",
            endnote: "%E"
        }, {
            name: "series_editor",
            label: "Series editors",
            help: "The series editor(s)" + a,
            csl: "collection-editor",
            mendeley: "series_editor",
            bibtex_support: false
        }, {
            name: "contributor",
            label: "Contributors",
            help: "Additional contributor(s)" + a,
            bibtex_support: false,
            endnote: "%Y"
        }, {
            name: "translator",
            label: "Translators",
            help: "The translator(s) " + a,
            csl: "translator",
            mendeley: "translators",
            bibtex_support: false,
            endnote: "%?"
        } ], {
            fieldType: "author",
            dataType: "author",
            defaultValue: undefined
        });
    },
    temporaryFields: function() {
        return this.decorate([ {
            name: "view_expanded",
            type: "int",
            defaultValue: 0
        }, {
            name: "view_state"
        }, {
            name: "editing_note",
            type: "int",
            defaultValue: 0
        }, {
            name: "view_context_open",
            type: "int",
            defaultValue: 0
        }, {
            name: "dup_group",
            type: "int",
            note: "The current duplicate group, if the view is showing duplicate articles",
            defaultValue: 0
        }, {
            name: "dup_group_first",
            type: "int",
            note: "1 if the current article is first in its group, 0 otherwise",
            defaultValue: 0
        }, {
            name: "dup_group_last",
            type: "int",
            note: "1 if the current article is last in its group, 0 otherwise",
            defaultValue: 0
        }, {
            name: "_imported",
            type: "int",
            defaultValue: 0,
            note: "0 or 1, used to indicate whether an equivalent pub exists in the user's personal library when viewing a shared folder."
        }, {
            name: "_imported_id",
            type: "string",
            defaultValue: "",
            note: "the _id of the equivalent item from the user's library."
        }, {
            name: "_owner_google_email",
            type: "string",
            defaultValue: "",
            note: "Email of the user who owns this item"
        }, {
            name: "_owner_google_name",
            type: "string",
            defaultValue: "",
            note: "Full name of the user who owns this item"
        }, {
            name: "pdf_crawl_status"
        } ], {
            fieldType: "temporary",
            defaultValue: undefined,
            persist: false,
            export_persist: false
        });
    },
    citationFields: function() {
        return this.decorate([ {
            name: "cite_alias",
            label: "Cite Alias",
            ris: "LB"
        }, {
            name: "source_id",
            label: "Source ID"
        }, {
            name: "owner_email",
            label: "Owner's email"
        }, {
            name: "owner_name",
            label: "Owner's name"
        } ], {
            fieldType: "citation",
            persist: false,
            export_persist: false
        });
    },
    getField: function(a) {
        var b = this.getFieldsMap();
        if (b[a]) {
            return b[a];
        } else {
            return null;
        }
    },
    getFieldType: function(a) {
        var b = this.getFieldsMap();
        if (b[a]) {
            return b[a].fieldType;
        }
        return null;
    },
    getDataType: function(a) {
        var b = this.getFieldsMap();
        if (b[a]) {
            return b[a].dataType;
        }
        return null;
    },
    isFieldMandatory: function(a, b) {
        var c = PP.library.PublicationTypes.getPubType(b);
        var d = c.mandatory_fields || [];
        d = PP.Array.flatten(d);
        d = PP.Array.unique(d);
        if (PP.Array.contains(d, a)) {
            return true;
        }
        return false;
    },
    getInputMapForPubType: function(a, b) {
        var c = PP.library.PublicationTypes.getPubType(a);
        var d = [ "ris", "zotero", "mendeley", "endnote", "csl" ];
        var e = {};
        if (d.indexOf(b) == -1) {
            return e;
        }
        this.getFieldsForPubType(a).forEach(function(a) {
            if (b in a) {
                if (b == "ris") {
                    e[a.ris] = a.name;
                }
                if (b == "zotero") {
                    e[a.zotero] = a.name;
                }
                if (b == "mendeley") {
                    e[a.mendeley] = a.name;
                }
                if (b == "csl") {
                    e[a.csl] = a.name;
                }
                if (b == "endnote") {
                    if (PP.Utils.isArray(a.endnote)) {
                        a.endnote.forEach(function(b) {
                            e[b] = a.name;
                        });
                    } else {
                        e[a.endnote] = a.name;
                    }
                }
            }
        });
        if (b == "ris") {
            if (c.field_ris_additional) {
                for (var f in c.field_ris_additional) {
                    e[f] = c.field_ris_additional[f];
                }
            }
            e["PY"] = "published";
            e["Y1"] = "published";
            e["DA"] = "published";
            e["PG"] = "pages";
            e["A1"] = "author";
            e["T1"] = "title";
            e["ID"] = "doi";
            e["DOI"] = "doi";
            e["L3"] = "doi";
            e["N2"] = "abstract";
            e["L1"] = "url";
            e["L2"] = "url";
            e["L4"] = "url";
            e["RN"] = "note";
            e["U2"] = "pmid";
            e["IB"] = "isbn";
        } else if (b == "zotero") {
            if (c.field_zotero_additional) {
                for (var f in c.field_zotero_additional) {
                    e[f] = c.field_zotero_additional[f];
                }
            }
            e["creators"] = "creators";
            e["tags"] = "zotero_tags";
        } else if (b == "mendeley") {
            e["id"] = "source.mendeley_id";
            e["day"] = "published.day";
            e["month"] = "published.month";
            e["year"] = "published.year";
        } else if (b == "csl") {
            e["note"] = "annote";
        } else if (b == "endnote") {
            e["%\xc4"] = "url";
            e["%\xcb"] = "journal";
        }
        return e;
    },
    getOutputMapForPubType: function(a, b, c) {
        var d = c || {};
        var e = PP.library.PublicationTypes.getPubType(a);
        var f = [ "csl", "ris" ];
        var g = {};
        if (f.indexOf(b) == -1) {
            return g;
        }
        var h = {};
        if (b == "csl") {
            var i = e.csl_excluded_fields || [];
            i.forEach(function(a) {
                var b = true;
                if ("csl_excluded_fields" in d) {
                    if (d.csl_excluded_fields.indexOf(a) == -1) {
                        b = false;
                    }
                }
                if (b) {
                    h[a] = 1;
                }
            });
            g["_id"] = "id";
        }
        this.getFieldsForPubType(a).forEach(function(a) {
            if (b in a) {
                if (!h[a.name]) {
                    if (b == "csl") {
                        g[a.name] = a.csl;
                    } else if (b == "ris") {
                        g[a.ris] = a.name;
                    }
                }
            }
        });
        return g;
    },
    getFieldsForPubType: function(a, b) {
        var c = b || {};
        if (!("includeAll" in c)) {
            c.includeAll = false;
        }
        var d = PP.library.PublicationTypes.getPubType(a);
        var e = d.excluded_fields || [];
        var f = d.field_labels || {};
        var g = d.field_shortlabels || {};
        var h = d.field_help || {};
        var i = d.field_csl || {};
        var j = d.field_ris || {};
        var k = d.field_zotero || {};
        var l = d.field_mendeley || {};
        var m = d.field_endnote || {};
        var n = d.mandatory_fields || [];
        n = PP.Array.flatten(n);
        n = PP.Array.filter(n, function(a) {
            if (!a) {
                return false;
            } else {
                return true;
            }
        });
        n = PP.Array.map(n, function(a) {
            return a.replace(/:\d/, "");
        });
        var o = PP.Array.map(n, function(a) {
            var b = PP.library.PublicationFields.getField(a);
            b.mandatory = true;
            return b;
        });
        var p = PP.Utils.clone(this.getFields());
        p = PP.Array.filter(p, function(a) {
            if (a.fieldType === "temporary" || a.fieldType === "library" && !a.showInExpandedView || a.name === "pubtype") {
                if (c.includeAll) {
                    return true;
                } else {
                    return false;
                }
            } else if (PP.Array.contains(e, a.name) || PP.Array.contains(n, a.name)) {
                return false;
            } else {
                return true;
            }
        });
        p = PP.Array.map(p, function(a) {
            a.mandatory = false;
            return a;
        });
        p = o.concat(p);
        var q = {};
        for (var r in m) {
            if (PP.Utils.isArray(m[r])) {
                m[r].forEach(function(a) {
                    q["endnote:" + a] = 1;
                });
            } else {
                q["endnote:" + m[r]] = 1;
            }
        }
        for (var r in j) {
            q["ris:" + j[r]] = 1;
        }
        for (var s = 0; s < p.length; s++) {
            var t = PP.Utils.clone(p[s]);
            var u = t.name;
            if (t.endnote) {
                if ("endnote:" + t.endnote in q) delete t.endnote;
            }
            if (t.ris) {
                if ("ris:" + t.ris in q) delete t.ris;
            }
            if (f[u]) {
                t.label = f[u];
            }
            if (g[u]) {
                t.shortLabel = g[u];
            }
            if (h[u]) {
                t.help = h[u];
            }
            if (i[u]) {
                t.csl = i[u];
            }
            if (u in j) {
                if (j[u] === null) {
                    delete t.ris;
                } else {
                    t.ris = j[u];
                }
            }
            if (k[u]) {
                t.zotero = k[u];
            }
            if (l[u]) {
                t.mendeley = l[u];
            }
            if (u in m) {
                if (m[u] === null) {
                    delete t.endnote;
                } else {
                    t.endnote = m[u];
                }
            }
            p[s] = t;
        }
        return p;
    },
    getFieldHelp: function(a, b) {
        var c = PP.library.PublicationTypes.getPubType(b);
        var d = c.field_help || {};
        if (d[a]) {
            return d[a];
        } else {
            var e = this.getFieldsMap();
            var f = e[a];
            if (f) {
                return f.help || "";
            }
        }
        return null;
    },
    getFieldLabel: function(a, b) {
        var c = PP.library.PublicationTypes.getPubType(b);
        var d = c.field_labels || {};
        if (a == "title") {}
        if (d[a]) {
            return d[a];
        } else {
            var e = this.getFieldsMap();
            var f = e[a];
            if (f) {
                return f.label;
            }
        }
        return null;
    },
    getFieldsMap: function() {
        if (this._fieldsMap) {
            return this._fieldsMap;
        }
        var a = this.getFields();
        var b = {};
        a.forEach(function(a) {
            b[a.name] = a;
        });
        this._fieldsMap = b;
        return this._fieldsMap;
    },
    getFields: function() {
        if (this._fields) {
            return this._fields;
        }
        var a = this.generalFields();
        var b = this.authorFields();
        var c = this.dateFields();
        var d = this.identifierFields();
        var e = this.libraryFields();
        var f = this.temporaryFields();
        var g = this.citationFields();
        this._fields = a.concat(b, c, d, e, f, g);
        for (var h = 0; h < this._fields.length; h++) {
            this._fields[h].defaultSortOrder = h;
        }
        return this._fields;
    },
    getDateFieldNames: function() {
        var a = [];
        this.dateFields().forEach(function(b) {
            a.push(b.name);
        });
        return a;
    },
    getAuthorFieldNames: function() {
        var a = [];
        this.authorFields().forEach(function(b) {
            a.push(b.name);
        });
        return a;
    }
});

PP.library.PublicationFields = new PP.library._PublicationFields();

(function() {
    var a = 0;
    var b = "";
    var c = 8;
    function d(a) {
        return s(k(q(a), a.length * c));
    }
    function e(a) {
        return t(k(q(a), a.length * c));
    }
    function f(a) {
        return r(k(q(a), a.length * c));
    }
    function g(a, b) {
        return s(n(a, b));
    }
    function h(a, b) {
        return t(n(a, b));
    }
    function i(a, b) {
        return r(n(a, b));
    }
    function j() {
        return d("abc") === "a9993e364706816aba3e25717850c26c9cd0d89d";
    }
    function k(a, b) {
        a[b >> 5] |= 128 << 24 - b % 32;
        a[(b + 64 >> 9 << 4) + 15] = b;
        var c = new Array(80);
        var d = 1732584193;
        var e = -271733879;
        var f = -1732584194;
        var g = 271733878;
        var h = -1009589776;
        for (var i = 0; i < a.length; i += 16) {
            var j = d;
            var k = e;
            var n = f;
            var q = g;
            var r = h;
            for (var s = 0; s < 80; s++) {
                if (s < 16) {
                    c[s] = a[i + s];
                } else {
                    c[s] = p(c[s - 3] ^ c[s - 8] ^ c[s - 14] ^ c[s - 16], 1);
                }
                var t = o(o(p(d, 5), l(s, e, f, g)), o(o(h, c[s]), m(s)));
                h = g;
                g = f;
                f = p(e, 30);
                e = d;
                d = t;
            }
            d = o(d, j);
            e = o(e, k);
            f = o(f, n);
            g = o(g, q);
            h = o(h, r);
        }
        return new Array(d, e, f, g, h);
    }
    function l(a, b, c, d) {
        if (a < 20) {
            return b & c | ~b & d;
        }
        if (a < 40) {
            return b ^ c ^ d;
        }
        if (a < 60) {
            return b & c | b & d | c & d;
        }
        return b ^ c ^ d;
    }
    function m(a) {
        return a < 20 ? 1518500249 : a < 40 ? 1859775393 : a < 60 ? -1894007588 : -899497514;
    }
    function n(a, b) {
        var d = q(a);
        if (d.length > 16) {
            d = k(d, a.length * c);
        }
        var e = new Array(16), f = new Array(16);
        for (var g = 0; g < 16; g++) {
            e[g] = d[g] ^ 909522486;
            f[g] = d[g] ^ 1549556828;
        }
        var h = k(e.concat(q(b)), 512 + b.length * c);
        return k(f.concat(h), 512 + 160);
    }
    function o(a, b) {
        var c = (a & 65535) + (b & 65535);
        var d = (a >> 16) + (b >> 16) + (c >> 16);
        return d << 16 | c & 65535;
    }
    function p(a, b) {
        return a << b | a >>> 32 - b;
    }
    function q(a) {
        var b = [];
        var d = (1 << c) - 1;
        for (var e = 0; e < a.length * c; e += c) {
            b[e >> 5] |= (a.charCodeAt(e / c) & d) << 32 - c - e % 32;
        }
        return b;
    }
    function r(a) {
        var b = "";
        var d = (1 << c) - 1;
        for (var e = 0; e < a.length * 32; e += c) {
            b += String.fromCharCode(a[e >> 5] >>> 32 - c - e % 32 & d);
        }
        return b;
    }
    function s(b) {
        var c = a ? "0123456789ABCDEF" : "0123456789abcdef";
        var d = "";
        for (var e = 0; e < b.length * 4; e++) {
            d += c.charAt(b[e >> 2] >> (3 - e % 4) * 8 + 4 & 15) + c.charAt(b[e >> 2] >> (3 - e % 4) * 8 & 15);
        }
        return d;
    }
    function t(a) {
        var c = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        var d = "";
        for (var e = 0; e < a.length * 4; e += 3) {
            var f = (a[e >> 2] >> 8 * (3 - e % 4) & 255) << 16 | (a[e + 1 >> 2] >> 8 * (3 - (e + 1) % 4) & 255) << 8 | a[e + 2 >> 2] >> 8 * (3 - (e + 2) % 4) & 255;
            for (var g = 0; g < 4; g++) {
                if (e * 8 + g * 6 > a.length * 32) {
                    d += b;
                } else {
                    d += c.charAt(f >> 6 * (3 - g) & 63);
                }
            }
        }
        return d;
    }
    PP.library.Crypto = {};
    PP.library.Crypto.sha1 = function(a) {
        return d(a);
    };
})();

PP.library._Publication = PP.Class.extend({
    links: function(a) {
        var b = [];
        if (a.doi) {
            b.push(this.getDoiLink(a));
        }
        if (a.url) {
            var c;
            if (PP.Utils.isArray(a.url)) {
                c = a.url;
            } else {
                c = [ a.url ];
            }
            var d = [];
            for (var e = 0; e < c.length; e++) {
                if (c[e] && typeof c[e] === "string") {
                    c[e] = c[e].replace(/\s*$/, "").replace(/^\s*/, "");
                    d.push(c[e]);
                }
            }
            c = d;
            if (!a.doi) {
                PP.Array.each(c, function(a) {
                    if (a.match(/doi\.org/)) {
                        b.push(a);
                    }
                });
            }
            PP.Array.each(c, function(a) {
                if (a.match(/fulltext/i)) {
                    b.push(a);
                }
            });
            PP.Array.each(c, function(a) {
                if (a.match(/full/i)) {
                    b.push(a);
                }
            });
            PP.Array.each(c, function(a) {
                if (!a.match(/pdf/i)) {
                    b.push(a);
                }
            });
            PP.Array.each(c, function(a) {
                b.push(a);
            });
        }
        if (a.pmid) {
            var f = this.getPubMedLink(a).replace(/https/, "http");
            b = PP.Array.filter(b, function(a) {
                if (a == f) {
                    return false;
                }
                return true;
            });
            b.push(this.getPubMedLink(a));
        }
        if (a.pmc) {
            var f = this.getPMCLink(a).replace(/https/, "http");
            b = PP.Array.filter(b, function(a) {
                if (a == f) {
                    return false;
                }
                return true;
            });
            b.push(this.getPMCLink(a));
        }
        if (a.arxivid) {
            b = PP.Array.filter(b, function(a) {
                if (a.match(/arxiv\.org/i)) {
                    return false;
                }
                return true;
            });
            b.push(this.getArxivLink(a));
        }
        if (a.scopusid) {
            b.push(this.getScopusLink(a));
        }
        if (a.zbl) {
            b.push(this.getZBLLink(a));
        }
        if (a.mr) {
            b.push(this.getMRLink(a));
        }
        b = PP.Array.stringUnique(b);
        b = PP.Array.filter(b, function(a) {
            if (a.match(/^\//)) {
                return false;
            }
            if (a.match(/mail-attachment.googleusercontent.com/i)) {
                return false;
            }
            if (!PP.Utils.isUrlLike(a)) {
                return false;
            }
            return true;
        });
        return b;
    },
    getDoiLink: function(a) {
        return "http://dx.doi.org/" + a.doi;
    },
    getPubMedLink: function(a) {
        return "https://www.ncbi.nlm.nih.gov/pubmed/" + a.pmid;
    },
    getPMCLink: function(a) {
        return "https://www.ncbi.nlm.nih.gov/pmc/articles/" + a.pmc;
    },
    getArxivLink: function(a) {
        return "http://arxiv.org/abs/" + a.arxivid;
    },
    getLCCNLink: function(a) {
        return "http://lccn.loc.gov/" + a.lccn;
    },
    getMRLink: function(a) {
        return "http://www.ams.org/mathscinet-getitem?mr=" + a.mr;
    },
    getZBLLink: function(a) {
        return "https://zbmath.org/?q=an:" + a.zbl;
    },
    getScopusLink: function(a) {
        var b = "https://www.reaxys.com/reaxys/secured/fulltext.do?performed=true&citationNumber=" + a.scopusid;
        return b;
    },
    hasPublisherLink: function(a) {
        var b = this.links(a);
        var c = PP.crawling.PdfDriver.getUrlRegexes();
        var d = false;
        PP.Array.each(b, function(a) {
            if (a.match(/doi\.org/i)) {
                d = true;
            }
            for (var b = 0; b < c.length; b++) {
                if (a.match(c[b])) {
                    d = true;
                }
            }
        });
        return d;
    },
    getCitedByCount: function(a) {
        if (a.gs_cited_by_count !== undefined) {
            return a.gs_cited_by_count;
        } else if (a.pubmed_cited_by_count !== undefined) {
            return a.pubmed_cited_by_count;
        } else {
            return null;
        }
    },
    getCitedByLink: function(a) {
        var b = a.doi;
        if (b) {
            var c = "http://dx.doi.org/" + b;
            var d = "http://scholar.google.com";
            var e = "/scholar?hl=en&lr=&num=30&cites=";
            var f = d + e + c;
            return f;
        } else if (a.gs_cluster_id) {
            var d = "http://scholar.google.com";
            var e = "/scholar?hl=en&lr=&num=30&cites=";
            var f = d + e + a.gs_cluster_id;
            return f;
        } else if (a.patent_number) {
            var g = a.patent_number;
            var h = a.issuing_authority;
            g = g.replace(h, "");
            var i = "http://www.freepatentsonline.com/" + g + ".html";
            var d = "http://scholar.google.com";
            var e = "/scholar?cites=";
            var f = d + e + i;
            return f;
        } else {
            return null;
        }
    },
    crawlUrlsContainDoi: function(a) {
        if (!a.crawl_urls) {
            return false;
        }
        var b = false;
        if (a.crawl_urls && PP.Utils.isArray(a.crawl_urls)) {
            a.crawl_urls.forEach(function(a) {
                if (a && a.match(/doi\.org/i)) {
                    b = true;
                }
            });
        }
        return b;
    },
    getSupportedRefDriver: function(a) {
        var b = this.links(a);
        if (a.crawl_urls) {
            b = a.crawl_urls.reverse().concat(b);
        }
        b = PP.Array.stringUnique(b);
        var c, d;
        for (var e = 0; e < b.length; e++) {
            var f = b[e];
            var g = PP.crawling.RefDriver.getSupportingDriver(f);
            if (g) {
                c = g;
                d = f;
                break;
            }
        }
        if (c !== undefined) {
            return {
                driver: c,
                url: d
            };
        } else {
            return undefined;
        }
    },
    addUrl: function(a, b) {
        if (!b) {
            return;
        }
        if (!a.url) {
            a.url = [];
        }
        a.url.push(b);
    },
    addCrawlUrls: function(a, b) {
        if (!b) {
            return;
        }
        if (!a.crawl_urls) {
            a.crawl_urls = [];
        }
        a.crawl_urls = a.crawl_urls.concat(b);
        a.crawl_urls = PP.Array.stringUnique(a.crawl_urls);
    },
    addWebimportSha1: function(a, b) {
        if (!a.webimport_sha1s) {
            a.webimport_sha1s = [];
        }
        a.webimport_sha1s.push(b);
    },
    addXref: function(a, b) {
        if (!a.xref) {
            a.xref = [];
        }
        var c = true;
        a.xref.forEach(function(a) {
            if ("pmid" in b && "pmid" in a) {
                if (b.pmid == a.pmid) c = false;
            }
            if ("doi" in b && "doi" in a) {
                if (b.doi == a.doi) c = false;
            }
        });
        if (c) a.xref.push(b);
    },
    getAttachment: function(a, b) {
        var c = null;
        a.attachments.forEach(function(a) {
            if (a._id === b) {
                c = a;
            }
        });
        return c;
    },
    addAttachment: function(a, b) {
        if (!a.attachments) {
            a.attachments = [];
        }
        PP.library.Attachment.autoClean(a, b);
        a.attachments.push(b);
    },
    removeAttachment: function(a, b) {
        var c;
        a.attachments.forEach(function(a) {
            if (a._id === b) {
                c = a;
            }
        });
        if (c) {
            PP.Array.remove(a.attachments, c);
        }
    },
    getPdfAttachment: function(a) {
        if (!a.attachments) {
            return null;
        }
        var b = null;
        a.attachments.forEach(function(a) {
            if (a.article_pdf === 1) {
                b = a;
            }
        });
        return b;
    },
    getPersistentData: function(a) {
        var b = PP.Utils.clone(a);
        var c = {};
        var d = PP.library.PublicationFields.getFields();
        for (var e = 0; e < d.length; e++) {
            var f = d[e].name;
            if (d[e].persist !== false && b[f] !== undefined) {
                if (PP.Utils.isArray(b[f]) && b[f].length == 0) {
                    continue;
                }
                c[f] = b[f];
            }
        }
        c._id = b._id;
        return c;
    },
    getAllData: function(a) {
        var b = PP.Utils.clone(a);
        var c = {};
        var d = PP.library.PublicationFields.getFields();
        for (var e = 0; e < d.length; e++) {
            var f = d[e].name;
            if (b[f] !== undefined) {
                if (PP.Utils.isArray(b[f]) && b[f].length == 0) {
                    continue;
                }
                c[f] = b[f];
            }
        }
        c._id = b._id;
        return c;
    },
    stripNonBibtexFields: function(a) {
        var b = PP.library.PublicationFields.getFields();
        for (var c = 0; c < b.length; c++) {
            var d = b[c].name;
            if (b[c].persist_bibtex === false && a[d]) {
                delete a[d];
            }
        }
        return a;
    },
    clearEmptyValues: function(a) {
        var b = PP.library.PublicationFields.getFields();
        for (var c = 0; c < b.length; c++) {
            var d = b[c].name;
            var e = b[c].fieldType;
            var f = a[d];
            var g = false;
            if (e === "array" || e === "author") {
                g = f === "" || f === undefined || f === null || PP.Utils.isArray(f) && f.length === 0;
            } else if (e === "date") {
                g = f === "" || f === undefined || f === null || PP.Utils.isArray(f) && f.length === 0;
            } else {
                g = f === "" || f === undefined || f === null;
            }
            if (g) {
                delete a[d];
            }
        }
    },
    autoClean: function(a, b) {
        var c, d, e;
        var f = b || {};
        if (!("updateUrls" in f)) {
            f.updateUrls = true;
        }
        if (a.autoCleaned) {}
        for (c in a) {
            if (a[c] === undefined) {
                delete a[c];
                continue;
            }
            if (a[c] === null) {
                delete a[c];
                continue;
            }
            if (PP.Utils.isString(a[c])) {
                a[c] = PP.Utils.replaceU0308(a[c]);
                a[c] = PP.Utils.replaceControlChars(a[c]);
            }
        }
        this.convertHtmlEntitiesToUnicode(a);
        if (!a._id) {
            a._id = PP.UUID.generate();
        }
        if (!a.owner) {
            if (PP.Session.hasKey("user_id")) {
                a.owner = PP.Session.get("user_id");
            }
            if (!a.owner) {}
        }
        var g = a.pubtype;
        var h = PP.library.PublicationTypes.getPubTypeMap();
        if (!h[g]) {
            console.log("BAD PUBTYPE: " + g);
        }
        for (c in a) {
            if (c.match(/arxiv/i)) {
                var i = a[c];
                i = i.replace(/arxiv:?\s*/i, "");
                delete a[c];
                a.arxivid = i;
            }
        }
        if (!a.journal && a.archivePrefix && a.primaryClass) {
            a.journal = a.archivePrefix + " [" + a.primaryClass + "]";
        }
        if (!a.source) {
            a.source = {};
        }
        if (a.url) {
            if (PP.Utils.isString(a.url) && a.url !== "") {
                a.url = [ a.url ];
            }
            if (PP.Utils.isArray(a.url)) {}
        } else {
            a.url = [];
        }
        var j = PP.Array.mapBoolean(a.url);
        if (a.crawl_urls) {
            var k = false;
            for (var c = 0; c < a.crawl_urls.length; c++) {
                if (j[a.crawl_urls[c]]) {
                    k = true;
                    break;
                }
            }
            if (!k) {
                a.crawl_urls = [];
            }
        }
        var l = this.links(a);
        if (l.length > 0 && !a.doi) {
            for (c = 0; c < l.length; c++) {
                if (l[c].match(/^(http:\/\/)?dx\.doi\.org/)) {
                    a.doi = l[c];
                }
            }
        }
        if (a.doi) {
            a.doi = a.doi.replace(/^info:doi\//i, "");
            a.doi = a.doi.replace(/^doi:\s*/i, "");
            a.doi = a.doi.replace(/^(https?:\/\/)?dx\.doi\.org[^\/]*\//i, "");
            a.doi = a.doi.replace(/^(https?:\/\/)?doi\.org\//i, "");
            a.doi = a.doi.replace(/^(https?:\/\/)?doi\.acm\.org\//i, "");
            a.doi = a.doi.replace(/^(https?:\/\/)?doi\.ieeecomputersociety\.org\//i, "");
            a.doi = a.doi.replace(/^(https?:\/\/)?doi\.org[^\/]*\//i, "");
            a.doi = a.doi.replace(/\?locatt=mode:legacy/i, "");
            try {
                a.doi = decodeURIComponent(a.doi);
            } catch (a) {}
        }
        if (a.associated_doi) {
            var m = {
                type: "article",
                doi: a.associated_doi
            };
            this.addXref(a, m);
        }
        if (a.pmid) {
            a.pmid = a.pmid.replace(/^pmid:?\s*/i, "");
        } else {
            l = this.links(a);
            l.forEach(function(b) {
                if (b.match(/ncbi\.nlm\.nih\.gov\/pubmed\/(\d+)/i)) {
                    a.pmid = RegExp.$1;
                }
            });
        }
        if (!a.pmc) {
            l = this.links(a);
            l.forEach(function(b) {
                if (b.match(/ncbi\.nlm\.nih\.gov\/pmc\/articles\/(PMC\d+)/i)) {
                    a.pmc = RegExp.$1;
                }
            });
        }
        if (a.zbl) {
            a.zbl = a.zbl.replace(/\s*zbl\s*/i, "");
        } else {
            l = this.links(a);
            l.forEach(function(b) {
                if (b.match(/zbmath\.org\/\?q=an:(.+)/i)) {
                    a.zbl = RegExp.$1;
                }
            });
        }
        if (!a.mr) {
            l = this.links(a);
            l.forEach(function(b) {
                if (b.match(/ams\.org\/mathscinet-getitem\?mr=(.+)/i)) {
                    a.mr = RegExp.$1;
                }
            });
        }
        if (f.updateUrls) {
            var n = this.links(a);
            var o = [];
            a.url.forEach(function(a) {
                for (var b = 0; b < n.length; b++) {
                    n[b] = n[b].replace(/\s*$/, "").replace(/^\s*/, "");
                    if (a == n[b]) {
                        o.push(a);
                        n.splice(b, 1);
                    }
                }
            });
            a.url = o.concat(n);
            if (a.url.length === 0) {
                delete a.url;
            }
        }
        var p = this.getCitedByLink(a);
        if (p !== null) {
            a.citedByLink = p;
        }
        if (PP.Features.getPaperReferences()) {
            var q = this.getSupportedRefDriver(a);
            if (q) {
                var r = q.url;
                a.referencesLink = r;
            }
        }
        var s = [ "issn", "isbn", "issn_alt", "isbn_alt" ];
        s.forEach(function(b) {
            var c = a[b];
            if (c) {
                if ((b == "issn" || b == "isbn") && PP.Utils.isArray(c)) {
                    if (c.length > 1) {
                        a[b] = c[0];
                        if (!a[b + "_alt"]) {
                            a[b + "_alt"] = c[1];
                        }
                    } else if (c.length > 0) {
                        a[b] = c[0];
                    } else {
                        delete a[b];
                    }
                }
                if (!PP.Utils.isString(a[b])) {
                    delete a[b];
                    return;
                }
                if (b == "issn" || b == "issn_alt") {
                    a[b] = a[b].replace(/\s/g, "");
                    if (a[b].match(/^(\d{4})(\d{3}[X\d])$/)) {
                        a[b] = RegExp.$1 + "-" + RegExp.$2;
                    }
                }
                if (b == "isbn" || b == "isbn_alt") {
                    a[b] = a[b].toUpperCase();
                    a[b] = a[b].replace(/-/g, "");
                    a[b] = a[b].replace(/\s/g, "");
                    if (!a[b].match(/^[X\d]+$/)) {
                        if (a[b].match(/([X\d]{13})/)) {
                            a[b] = RegExp.$1;
                        } else if (a[b].match(/([X\d]{10})/)) {
                            a[b] = RegExp.$1;
                        } else {
                            delete a[b];
                        }
                    }
                    if (a[b] && a[b].length == 10) {
                        a[b] = PP.Utils.isbn10To13(a[b]);
                    }
                }
            } else {
                delete a[b];
            }
        });
        if (a.startpage && a.endpage) {
            a.pages = a.startpage + "-" + a.endpage;
            delete a.startpage;
            delete a.endpage;
        } else if (a.startpage) {
            a.pages = a.startpage;
            delete a.startpage;
        } else if (a.endpage) {
            a.pages = a.endpage;
            delete a.endpage;
        }
        if (a.pages) {
            a.pages = a.pages.replace(/\s*-\s*/, "-");
            a.pages = a.pages.replace(/^\s*/, "");
            a.pages = a.pages.replace(/\s$/, "");
            a.pages = a.pages.replace(/--/, "-");
            a.pages = a.pages.replace(/^pp?\.?\s*/, "");
            if (a.pages) {
                var t = a.pages.match(/^(\d+)-(\d+)$/);
                if (t) {
                    var u = t[1];
                    var v = t[2];
                    if (u.length > v.length) {
                        v = u.substring(0, u.length - v.length) + v;
                        a.pages = u + "-" + v;
                    }
                }
            }
            if (a.pages.match(/n\/a/gi)) {
                delete a.pages;
            }
        }
        if (a.volume && PP.Utils.isString(a.volume)) {
            if (a.volume.match(/\d/)) {
                a.volume = a.volume.replace(/\s*([Vv]olume|VOLUME|VOL|[Vv]ol|v)\s*\.?\s*/, "");
            }
        }
        if (a.issue && PP.Utils.isString(a.issue)) {
            if (a.issue.match(/\d/)) {
                a.issue = a.issue.replace(/\s*([Ii]ssue|ISSUE|[Nn]umber|NUMBER|NO|[Nn]o)\.?\s*/, "");
            }
        }
        PP.library.Date.extractDate(a, "", "published");
        PP.library.Date.extractDate(a, "acc", "accessed");
        PP.library.Date.extractDate(a, "filed", "filed");
        var w = PP.library.PublicationFields.authorFields();
        for (c = 0; c < w.length; c++) {
            e = w[c].name;
            if (a[e] && PP.Utils.isArray(a[e])) {
                var x = a[e];
                var y = [];
                for (d = 0; d < x.length; d++) {
                    if (PP.Utils.isString(x[d])) {
                        x[d] = PP.library.Author.parseAuthor(x[d]);
                    }
                    PP.library.Author.autoClean(x[d]);
                    if (PP.library.Author.toString(x[d]) !== "") {
                        y.push(x[d]);
                    }
                }
                a[e] = y;
            } else if (a[e] && PP.Utils.isString(a[e])) {
                var x = [];
                var z = a[e];
                var A = z.split(/[,;]/g);
                A.forEach(function(a) {
                    var b = PP.library.Author.parseAuthor(a);
                    if (PP.library.Author.toString(b) !== "") {
                        x.push(b);
                    }
                });
                a[e] = x;
            }
        }
        var B = PP.library.PublicationFields.dateFields();
        for (c = 0; c < B.length; c++) {
            e = B[c].name;
            if (a[e]) {
                a[e] = PP.library.Date.autoClean(a[e]);
            }
        }
        if (a.journalfull && !a.journal) {
            a.journal = a.journalfull;
        }
        if (a.journal) {
            var z = a.journal;
            a.journal = z;
        }
        var C = [ "title", "booktitle", "journal", "abstract", "publisher" ];
        for (var c = 0; c < C.length; c++) {
            var e = C[c];
            var D = {
                replacement: "",
                exclude: []
            };
            if (c <= 1) {
                D.exclude = [ "i", "b", "sup", "sub" ];
            }
            if (a[e] !== undefined) {
                a[e] = this.strip(a[e]);
                a[e] = PP.String.stripHtml(a[e], D);
            }
        }
        if (a.title) {
            a.title = a.title.replace(/\.$/, "");
            a.title = a.title.replace(/\s+/g, " ");
        }
        if (a.booktitle) {
            a.booktitle = a.booktitle.replace(/\s+/g, " ");
        }
        if (a["abstract"]) {
            a["abstract"] = a["abstract"].replace(/\s+/g, " ");
            var E = /(\\){10,}/g;
            if (a["abstract"].match(E)) {
                a["abstract"] = a["abstract"].replace(E, "");
            }
        }
        if (a["pubtype"] === "PP_ARTICLE") {
            if (a.number && !a.issue) {
                a.issue = a.number;
                delete a.number;
            }
        }
        if (a.keywords && PP.Utils.isArray(a.keywords)) {
            a.keywords = a.keywords.join("; ");
        }
        if (a.kind) {
            if (!this.checkKindField(a)) a.kind = "";
        } else {
            var F = PP.library.PublicationTypes.getTypeForPub(a);
            if (F && F.subtypes) {
                a.kind = F.defaultSubtype;
            }
        }
        if (a.pubtype === "PP_PATENT") {
            if (a.patent_number && a.patent_number.match(/^us\s*:?(.+)/i)) {
                a.patent_number = RegExp.$1;
                a.issuing_authority = "USPTO";
                a.journal = "US Patent";
                a.journalfull = "United States Patent and Trademark Office";
            } else if (a.patent_number && a.patent_number.match(/^WO\s*:?(.+)/i)) {
                a.patent_number = RegExp.$1;
                a.issuing_authority = "WIPO";
                a.journal = "World Patent";
                a.journalfull = "World Intellectual Property Organization";
            } else if (a.patent_number && a.patent_number.match(/^EP\s*:?(.+)/i)) {
                a.patent_number = RegExp.$1;
                a.issuing_authority = "EPO";
                a.journal = "European Patent";
                a.journalfull = "European Patent Office";
            }
            if (a.application_number) {
                a.application_number = a.application_number.replace(/,/g, "");
            }
            if (!a.journal) {
                a.journal = "Patent";
            }
        }
        var G = PP.library.Patterns.applyPattern("{initial}", a);
        if (!G.match(/[A-Z]/)) {
            G = "Other";
        }
        var H = [ "All Papers" + "/" + G ];
        if (a.starred) {
            H.push("Starred Papers");
        }
        a.subfolders = H;
        var I = a.attachments || [];
        I.forEach(function(b) {
            PP.library.Attachment.autoClean(a, b);
        });
        var J = this.isIncomplete(a);
        var K = a.force_complete == 1;
        if (J && !K) {
            a.incomplete = 1;
        } else {
            a.incomplete = 0;
        }
        if (!this.isEmptyPub(a)) {
            a.sha1 = this.sha1(a);
            a.dup_sha1 = this.dupSha1(a);
        } else {
            delete a.sha1;
            delete a.dup_sha1;
        }
        var L = PP.library.Patterns.applyPattern("{firstAuthor}{year}-{randomChars}", a);
        if (a.citekey) {
            var M = a.citekey;
            var N = M.replace(/-\S{2,3}$/, "");
            var O;
            if (M.match(/(\S{2,3})$/)) {
                O = RegExp.$1;
            }
            var P = L.replace(/-\S{2,3}$/, "");
            var Q;
            if (L.match(/(\S{2,3})$/)) {
                Q = RegExp.$1;
            }
            if (P !== N) {
                if (O) {
                    a.citekey = P + O;
                } else {
                    a.citekey = L;
                }
            }
        } else {
            a.citekey = L;
        }
        a.id_list = this.collectIdList(a);
        this.clearEmptyValues(a);
        a.autoCleaned = true;
    },
    removeNonPubtypeSpecificFields: function(a) {
        var b = this;
        var c = [];
        var d = [ "general", "date", "identifier", "author" ];
        PP.library.PublicationFields.getFields().forEach(function(a) {
            if (a.fieldType) {
                if (d.indexOf(a.fieldType) > -1) {
                    c.push(a.name);
                }
            }
        });
        if (a && a.pubtype && a.pubtype.match(/^PP_/)) {
            var e = {
                pubtype: 1
            };
            PP.library.PublicationFields.getFieldsForPubType(a.pubtype).forEach(function(a) {
                e[a.name] = 1;
            });
            for (var f in a) {
                if (c.indexOf(f) > -1) {
                    if (!e[f]) {
                        b.setEmpty(a, f);
                    }
                }
            }
        }
    },
    autoCleanLegalDocs: function(a) {
        if (a.journal) {
            var b = PP.library.LegalAbbreviations.getReporterMap(true);
            var c = a.journal.toUpperCase().replace(/[\s\.]+/g, "");
            if (c in b) {
                a.journalfull = b[c];
                a.journal = PP.library.LegalAbbreviations.getAbbreviation(a.journalfull);
            }
        }
    },
    isEmptyPub: function(a) {
        if (!a.title) {
            return true;
        }
        var b = PP.library.Publication.getAuthorType(a);
        var c = a[b];
        if (!c) {
            return true;
        }
        return;
    },
    checkValidityOfISSN: function(a) {
        if (!a) {
            return "";
        }
        var b = a.toUpperCase().replace(/-/g, "");
        b = b.replace(/\s+\(.+/, "");
        b = b.replace(/^\s+/, "");
        if (b.match(/^\d{7}[\dX]$/)) {
            var c = b.split("");
            if (c[7].toUpperCase() == "X") {
                c[7] = 10;
            }
            var d = 0;
            for (var e = 0; e < c.length; e++) {
                d += (8 - e) * parseInt(c[e]);
            }
            if (d % 11 == 0) {
                if (c[7] == 10) {
                    c[7] = "X";
                }
                var f = c.slice(0, 4).join("") + "-" + c.slice(4, 8).join("");
                return f;
            }
        }
        return "";
    },
    getAuthorArray: function(a) {
        var b = PP.library.Publication.getAuthorType(a);
        if (a[b]) {
            return a[b];
        } else {
            return [];
        }
    },
    getIdentifierFieldNames: function() {
        return [ "arxivid", "isbn", "doi", "patent_number", "pmc", "pmid", "zbl", "mr" ];
    },
    hasIdentifier: function(a) {
        var b = this.getIdentifierFieldNames();
        var c = false;
        b.forEach(function(b) {
            if (a[b]) {
                c = true;
            }
        });
        return c;
    },
    collectIdList: function(a) {
        var b = [ "sha1", "dup_sha1" ];
        b = b.concat(this.getIdentifierFieldNames());
        if (a.pubtype != "PP_BOOK") {
            b = PP.Array.remove(b, "isbn");
        }
        var c = [];
        for (var d = 0; d < b.length; d++) {
            var e = b[d];
            if (a[e]) {
                c.push(e + ":" + a[e]);
            }
        }
        var f = this.links(a);
        var g = a.crawl_urls || [];
        var h = [];
        g.forEach(function(a) {
            if (PP.crawling.Proxy.isLoginUrl(a)) {} else if (PP.crawling.Proxy.isProxied(a)) {
                var b = PP.crawling.Proxy.deproxify(a);
                if (b && b.cleanUrl) h.push(b.cleanUrl);
            } else {
                h.push(a);
            }
        });
        f = f.concat(h);
        f = PP.Array.filter(f, function(a) {
            if (a.length > 500) {
                return false;
            }
            if (!PP.Utils.isString(a)) {
                return false;
            }
            if (a.match(/scopus\.com\/scopus\/inward/i)) {
                return false;
            }
            if (!a.match(/\d+/)) {
                return false;
            }
            return true;
        });
        for (var d = 0; d < f.length; d++) {
            c.push("url:" + f[d]);
        }
        var i = a.webimport_sha1s || [];
        for (var d = 0; d < i.length; d++) {
            c.push("webimport_sha1:" + i[d]);
        }
        if (a.original_id) {
            c.push("original_id:" + a.original_id);
        }
        c = PP.Array.stringUnique(c);
        return c;
    },
    dupSha1: function(a) {
        var b = [];
        var c = [ "title", "booktitle", "author" ];
        var d;
        for (var e in c) {
            if (c[e]) {
                d = c[e];
                var f = PP.library.PublicationFields.getFieldType(d);
                var g;
                if (f === "date") {
                    g = PP.library.Date.toString(a[d]);
                } else if (f === "author") {
                    var h = [];
                    if (a[d] && a[d].length >= 2) {
                        h = a[d].slice(0, 2);
                    } else if (a[d] && a[d].length > 0) {
                        h = a[d];
                    }
                    g = PP.library.Author.toString(h, {
                        output: "last",
                        delim: " "
                    });
                } else {
                    g = a[d];
                }
                if (g) {
                    g = g.toLowerCase();
                    g = g.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g, "");
                    g = g.replace(/\s{2,}/g, "");
                    b.push(g);
                }
            }
        }
        var i = b.join(" ");
        var j = PP.library.Crypto.sha1(i);
        return j;
    },
    sha1: function(a) {
        var b = [ "title", "booktitle", "journal", "author", "editor", "publisher", "published" ];
        var c = [];
        var d;
        for (var e in b) {
            if (b[e]) {
                d = b[e];
                var f = PP.library.PublicationFields.getFieldType(d);
                var g;
                if (f === "date") {
                    g = PP.library.Date.toString(a[d]);
                } else if (f === "author") {
                    g = PP.library.Author.toString(a[d]);
                } else {
                    g = a[d];
                }
                if (g) {
                    c.push(g);
                }
            }
        }
        var h = c.join(" ");
        var i = PP.library.Crypto.sha1(h);
        return i;
    },
    strip: function(a) {
        a = a.replace(/^\s*/, "");
        a = a.replace(/\s*$/, "");
        return a;
    },
    setEmpty: function(a, b) {
        var c = PP.library.PublicationFields.getField(b);
        var d = c.dataType;
        if (d === "array" || d === "author") {
            a[b] = [];
        } else if (d === "object" || d === "date") {
            a[b] = {};
        } else {
            a[b] = "";
        }
    },
    getAuthorType: function(a) {
        var b = [ "author", "editor", "series_editor", "contributor", "translator" ];
        var c;
        for (var d = 0; d < b.length; d++) {
            var e = a[b[d]];
            if (e && e.length > 0) {
                c = b[d];
                break;
            }
        }
        return c;
    },
    getAuthorById: function(a, b) {
        var c = PP.library.PublicationFields.getFields();
        for (var d = 0; d < c.length; d++) {
            var e = c[d].name;
            var f = c[d].dataType;
            if (f === "author") {
                var g = a[e];
                if (g && PP.Utils.isArray(g)) {
                    for (var h = 0; h < g.length; h++) {
                        var i = g[h];
                        if (i._id === b) {
                            return i;
                        }
                    }
                }
            }
        }
    },
    getJournalString: function(a) {
        var b = this.getJournalField(a);
        var c = "";
        if (b && a[b]) {
            c = a[b];
        }
        return c;
    },
    getJournalField: function(a) {
        if (a.pubtype == "PP_CONFERENCE_PAPER") {
            return "booktitle";
        } else if (a.pubtype == "PP_BOOK_CHAPTER") {
            return "booktitle";
        } else if (a.pubtype == "PP_WEBSITE") {
            return "booktitle";
        } else {
            return "journal";
        }
    },
    formatAuthors: function(a, b) {
        var c = this.getAuthorType(a);
        if (c) {
            var d = a[c];
            if (d) {
                var e = PP.library.Author.toString(d, b);
                return e;
            } else {
                return "";
            }
        } else {
            return "[No author]";
        }
    },
    formatAuthorYearJournal: function(a, b) {
        if (b === undefined) {
            b = false;
        }
        var c = this.formatAuthorYear(a);
        var d = this.getJournalString(a);
        var e = c;
        if (d) {
            if (!b) {
                d = '<span style="font-style:italic;">' + d + "</span>";
            }
            e += " - " + d;
        }
        return e;
    },
    formatAuthorYear: function(a, b) {
        b = b || {};
        var c = this.getAuthorType(a);
        if (c) {
            var d = this.formatAuthors(a, {
                etAl: true,
                output: "last",
                includeItalics: false
            });
        } else {
            d = a.title || "[untitled item]";
            d = PP.String.interconvertString(d, {
                format: "nomarkup"
            });
        }
        var e = a.published || {};
        var f = PP.library.Date.yearString(e);
        var g = d + " " + f;
        var h = b.maxLength || 40;
        return PP.Utils.ellipsis(g, h, false, "...");
    },
    formatYear: function(a) {
        var b = a.published || {};
        var c = PP.library.Date.yearString(b);
        if (c == "") {
            return "[no date]";
        } else {
            return c;
        }
    },
    formatAuthorYearLink: function(a) {
        var b = this.formatAuthorYear(a);
        var c = this.links(a);
        if (c.length > 0) {
            var d = c[0];
            return b + " " + d;
        } else {
            return b;
        }
    },
    formatYearTitle: function(a) {
        var b = PP.library.Date.yearString(a.published || {});
        var c = a.title || "";
        return b + " &mdash; " + c;
    },
    findAuthorById: function(a, b) {
        var c = PP.library.PublicationFields.authorFields();
        for (var d = 0; d < c.length; d++) {
            var e = c[d].name;
            if (a[e]) {
                var f = a[e];
                for (var g = 0; g < f.length; g++) {
                    var h = f[g];
                    if (h._id === b) {
                        return h;
                    }
                }
            }
        }
        return null;
    },
    toText: function(a) {
        if (PP.Utils.isArray(a)) {
            var b = [];
            for (var c = 0; c < a.length; c++) {
                b.push(PP.library.Publication.toText(a[c]));
            }
            return b.join("\n");
        }
        if (a && a.$className) {
            a = a.serialize();
        }
        var d = "";
        d += a._plugin !== undefined ? "[" + a._plugin + "]" : "";
        d += PP.Utils.ellipsis(a.title || "", 40, true, "...");
        d += " - ";
        d += PP.Utils.ellipsis(PP.library.Publication.formatAuthors(a), 20, null, "...");
        d += " - ";
        d += PP.library.Date.toString(a.published || "");
        d += ", ";
        d += a.journal;
        return d;
    },
    convertHtmlEntitiesToUnicode: function(a) {
        if (!PP.Utils.isObject(a)) return;
        for (var b in a) {
            if (a[b] === undefined) continue;
            if (a[b] === null) continue;
            if (PP.Utils.isString(a[b])) {
                a[b] = PP.Utils.convertHtmlEntitiesToUnicode(a[b]);
            } else if (PP.Utils.isArray(a[b])) {
                for (var c = 0; c < a[b].length; c++) {
                    if (PP.Utils.isObject(a[b][c])) {
                        for (var d in a[b][c]) {
                            if (a[b][c][d] === undefined) continue;
                            if (a[b][c][d] === null) continue;
                            if (PP.Utils.isString(a[b][c][d])) {
                                a[b][c][d] = PP.Utils.convertHtmlEntitiesToUnicode(a[b][c][d]);
                            }
                        }
                    }
                }
            }
        }
    },
    checkKindField: function(a) {
        if (a) {
            if (!("kind" in a)) {
                return true;
            } else if (!("pubtype" in a)) {
                return true;
            } else {
                var b = PP.library.PublicationTypes.getTypeForPub(a);
                var c = [];
                if ("subtypes" in b) {
                    c = b.subtypes;
                }
                if (c.length === 0) {
                    return false;
                } else {
                    var d = false;
                    c.forEach(function(b) {
                        if ("name" in b) {
                            if (b.name === a.kind) {
                                d = true;
                            }
                        }
                    });
                    return d;
                }
            }
        } else {
            return true;
        }
    },
    _collectLink: function(a, b, c) {
        return {
            url: a,
            name: b,
            type: c
        };
    },
    collectLinks: function(a) {
        var b = [];
        var c = this.links(a);
        var d = false;
        var e = "nih.gov/pubmed";
        var f = "arxiv.org";
        var g = "nih.gov/pmc";
        var h = "mendeley.com";
        var i = "citeulike.org";
        var j = "inspirehep.net";
        var k = "evernote";
        var l = "dx.doi.org";
        var m;
        var n;
        for (var o = 0; o < c.length; o++) {
            var p = c[o];
            if (p.match(l)) {
                b.push(this._collectLink(p, "Website", "website"));
                d = true;
            } else if (p.match(e)) {
                n = this._collectLink(p, "PubMed", "db");
                b.push(n);
            } else if (p.match(f)) {
                b.push(this._collectLink(p, "arXiv", "db"));
            } else if (p.match(g)) {
                m = this._collectLink(p, "PMC", "db");
            } else if (p.match(h)) {
                b.push(this._collectLink(p, "Mendeley", "db"));
            } else if (p.match(i)) {
                b.push(this._collectLink(p, "CiteULike", "db"));
            } else if (p.match(j)) {
                b.push(this._collectLink(p, "INSPIRE", "db"));
            } else if (p.match(k)) {
                b.push(this._collectLink(p, "Evernote", "db"));
            }
        }
        if (!n && m) {
            b.push(m);
        }
        if (!d) {
            for (var o = 0; o < c.length; o++) {
                var p = c[o];
                if (p.match(l) || p.match(e) || p.match(f) || p.match(g) || p.match(h) || p.match(i) || p.match(j) || p.match(k)) {} else {
                    b.push(this._collectLink(p, "Website", "website"));
                    break;
                }
            }
        }
        if (a.source.pdf_web_url) {
            var q = "PDF";
            if (PP.Utils.isPdfRestricted(a.source.pdf_crawl_status)) {
                q = "PDF";
            }
            b.push(this._collectLink(a.source.pdf_web_url, q, "pdf"));
        }
        if (a.citedByLink) {
            b.push(this._collectLink(a.citedByLink, "Cited By", "citedby"));
        }
        if (PP.Features.getPaperReferences()) {
            if (a.referencesLink) {
                b.push(this._collectLink(a.referencesLink, "References", "refs"));
            }
        }
        if (a.patent_number) {
            var r = a.patent_number;
            var s = a.issuing_authority;
            r = r.replace(s, "");
            if (s === "US") {
                var t = a.patent_number;
                t = t.replace(/\s\S+$/, "");
                var u = "http://www.google.com/patents/" + t;
                b.push(this._collectLink(u, "Google Patents", "website"));
            }
        }
        if (a.xref) {
            var v = {};
            for (var o = 0; o < a.xref.length; o++) {
                var w = a.xref[o];
                if (!(w.doi || w.pmid || w.url)) {
                    console.error("Xref without a good ID", w);
                    continue;
                }
                var q = "";
                var x = true;
                if (w.type === "article") {
                    q = "Associated Paper";
                } else if (w.type.toLowerCase() === "commentin") {
                    q = "Commentary";
                    x = false;
                } else if (w.type.toLowerCase() === "erratumin") {
                    q = "Erratum";
                } else if (w.type.toLowerCase() === "commenton") {
                    q = "Associated Paper";
                    x = false;
                } else if (w.type.toLowerCase() === "cites") {
                    continue;
                } else if (w.type.toLowerCase() === "data") {
                    q = "Associated Data";
                } else {
                    continue;
                }
                if (v[q]) {
                    v[q].push(w);
                } else {
                    v[q] = [ w ];
                }
                var y = this.links(w);
                if (y.length > 0) {
                    var p = y[0];
                    if (x) {
                        b.push(this._collectLink(p, q, "xref"));
                    }
                } else {
                    console.error("No link for xref", w);
                }
            }
            var z = v["Commentary"];
            if (z) {
                var A = PP.Array.pluck(z, "pmid");
                A = PP.Array.map(A, function(a) {
                    return a + "[PMID]";
                });
                var B = A.join(" OR ");
                var C = "https://www.ncbi.nlm.nih.gov/pubmed?term=" + B;
                var q = "Commentary";
                if (z.length > 1) {
                    q += " (" + z.length + ")";
                }
                b.push(this._collectLink(C, q, "xref"));
            }
            var D = v["Associated Paper"];
            if (D) {
                D = PP.Array.filter(D, function(a) {
                    return a.pmid != undefined;
                });
                if (D.length > 0) {
                    var A = PP.Array.pluck(D, "pmid");
                    A = PP.Array.map(A, function(a) {
                        return a + "[PMID]";
                    });
                    var B = A.join(" OR ");
                    var C = "https://www.ncbi.nlm.nih.gov/pubmed?term=" + B;
                    var q = "Associated Paper";
                    if (D.length > 1) {
                        q += " (" + D.length + ")";
                    }
                    b.push(this._collectLink(C, q, "xref"));
                }
            }
        }
        var E = false;
        var F = false;
        b = PP.Array.filter(b, function(a) {
            if (a.name == "Website" && E) {
                return false;
            } else if (a.name == "PubMed" && F) {
                return false;
            } else if (a.name == "Website") {
                E = true;
            } else if (a.name == "PubMed") {
                F = true;
            }
            return true;
        });
        b.sort(function(a, b) {
            var c = {
                website: 0,
                db: 1,
                citedby: 2,
                refs: 3,
                pdf: 4,
                xref: 5
            };
            var d = c[a.type];
            var e = c[b.type];
            return d > e;
        });
        return b;
    },
    hasAnyUsefulMetadata: function(a) {
        var b = PP.library.Publication.getAuthorType(a);
        var c = false;
        var d = a.published || {};
        var e = PP.library.Date.yearString(d);
        var f = a.title;
        var g = a[b];
        var h = a.journal;
        return f || g || h || e;
    },
    isIncomplete: function(a) {
        var b = PP.library.Publication.getAuthorType(a);
        var c = false;
        var d = a.published || {};
        var e = PP.library.Date.yearString(d);
        var f = a.title;
        var g = a[b];
        var h = a.editor;
        var i = a.journal;
        var j = a.court;
        var k = a.kind;
        var l = a.legislative_body;
        if (a.pubtype === "PP_ARTICLE") {
            if (!f || !g || !i || !e) {
                c = true;
            }
            if (k) {
                if (k == "Editorial") {
                    c = false;
                    if (!f || !i || !e) c = true;
                }
            }
        } else if (a.pubtype === "PP_WEBSITE") {
            if (!f) {
                c = true;
            }
        } else if (a.pubtype === "PP_CASE") {
            if (!f || !i || !j) {
                c = true;
            }
        } else if (a.pubtype === "PP_PERIODICAL") {
            if (!f) {
                c = true;
            }
        } else if (a.pubtype === "PP_STATUTE" || a.pubtype === "PP_TREATY") {
            if (!f || !i) {
                c = true;
            }
        } else if (a.pubtype === "PP_BILL") {
            if (!f || !l) {
                c = true;
            }
        } else if (a.pubtype === "PP_LETTER" || a.pubtype === "PP_INTERVIEW" || a.pubtype === "PP_PERSONAL_COMMUNICATION") {
            if (!g || !h) {
                c = true;
            }
        } else {
            if (!f || !g) {
                c = true;
            }
        }
        return c;
    },
    extractDoi: function(a) {
        if (a.match(/(10\.\d\d\d\d\S+)/)) {
            return this.cleanDoi(RegExp.$1);
        } else {
            return null;
        }
    },
    cleanDoi: function(a) {
        a = a.replace(/\/$/, "");
        return a;
    },
    getMissingFields: function(a) {
        var b = a.pubtype;
        var c = [];
        if (b === "PP_ARTICLE") {
            c = [ "title", "author", "journal", "year" ];
        } else {
            c = [ "title", "author" ];
        }
        var d = [];
        c.forEach(function(b) {
            if (b === "author") {
                var c = PP.library.Publication.getAuthorType(a);
                if (!a[c]) {
                    d.push(b);
                }
            } else if (b === "year") {
                var e = a.published || {};
                var f = PP.library.Date.yearString(e);
                if (!f) {
                    d.push("published");
                }
            } else {
                if (!a[b]) {
                    d.push(b);
                }
            }
        });
        return d;
    },
    isAutocompleted: function(a) {
        return a.autocompleted === 1;
    },
    hasWebsiteLink: function(a) {
        var b = this.collectLinks(a);
        var c = this.getWebsiteLink(a);
        if (c) {
            return true;
        } else {
            return false;
        }
    },
    getWebsiteLink: function(a) {
        var b = this.collectLinks(a);
        var c;
        b.forEach(function(a) {
            if (a.name === "Website" && !c) {
                c = a;
            }
        });
        return c;
    },
    getBibTeXkey: function(a) {
        var b = a.citekey;
        if (a.user_citekey) {
            b = a.user_citekey;
        }
        if (b === undefined) {
            b = "dummy_key";
        }
        return b;
    },
    getEndNoteCitation: function(a) {
        var b = this.getAuthorType(a);
        if (b) {
            var c = this.formatAuthors(a, {
                etAl: false,
                output: "last",
                includeItalics: false
            });
        } else {
            c = a.title || "[untitled item]";
            c = PP.String.interconvertString(c, {
                format: "nomarkup"
            });
        }
        c = c.split(",")[0];
        var d = a.published || {};
        var e = PP.library.Date.yearString(d);
        var f = c + ", " + e + ", " + a.cite_alias;
        return f;
    },
    hasPdf: function(a) {
        var b = this.getPdfAttachment(a);
        if (b) {
            return true;
        }
    },
    applyIdentifiersToNewPub: function(a, b) {
        if (a._id) {
            b._id = a._id;
        }
        if (a.citekey) {
            b.citekey = a.citekey;
        }
        if (a.gs_cluster_id) {
            b.gs_cluster_id = a.gs_cluster_id;
        }
        if (a.crawl_urls) {
            PP.library.Publication.addCrawlUrls(b, a.crawl_urls);
        }
        if (a.url) {
            for (var c = 0; c < a.url.length; c++) {
                this.addUrl(b, a.url[c]);
            }
        }
        if (a.source) {
            PP.Utils.merge(b.source, a.source);
            if (a.source.pdf_web_url) {
                this.addCrawlUrls(b, [ a.source.pdf_web_url ]);
                this.addUrl(b, a.source.pdf_web_url);
            }
        }
        if (a.starred !== undefined) {
            b.starred = a.starred;
        }
        if (a.attachments) {
            b.attachments = PP.Utils.clone(a.attachments);
        }
        this.autoClean(b);
    },
    applyTitleToNewPub: function(a, b) {
        var c = [ "title", "booktitle" ];
        c.forEach(function(c) {
            var d = a[c] || "";
            var e = b[c] || "";
            if (d && d != e) {
                var f = PP.String.interconvertString(d, {
                    format: "nomarkup"
                });
                var g = PP.String.interconvertString(e, {
                    format: "nomarkup"
                });
                if (f == g) {
                    if (c in b) {
                        b[c] = a[c];
                    }
                }
            }
        });
    },
    applyKeywordsToNewPub: function(a, b) {
        if (a.keywords) {
            var c = "";
            if (b.keywords) {
                var d = {};
                a.keywords.split(/[;,]/).forEach(function(a) {
                    a = a.replace(/^[\t\n\s]+/g, "");
                    a = a.replace(/[\t\n\s]+$/g, "");
                    d[a.toUpperCase()] = a;
                });
                var e = [];
                b.keywords.split(/[;,]/).forEach(function(a) {
                    a = a.replace(/^[\t\n\s]+/g, "");
                    a = a.replace(/[\t\n\s]+$/g, "");
                    if (!d[a.toUpperCase()]) {
                        d[a.toUpperCase()] = a;
                        e.push(a);
                    }
                });
                if (e.length > 0) {
                    c = "; " + e.join("; ");
                }
            }
            b.keywords = a.keywords + c;
        }
    },
    applyAllOtherAttributesToNewPub: function(a, b) {
        if (a && b) {
            if (a.pubtype == b.pubtype) {
                PP.library.PublicationFields.getFieldsForPubType(a.pubtype).forEach(function(c) {
                    if (c.fieldType == "general" || c.fieldType == "author") {
                        if (c.name in a && !(c.name in b)) {
                            if (a[c.name]) {
                                b[c.name] = PP.Utils.clone(a[c.name]);
                            }
                        }
                    }
                });
            }
        }
    },
    getXML: function() {
        var a = this;
        var b = '<?xml version="1.0" encoding="UTF-8"?>\n';
        b += "<pubtypes>\n";
        PP.library.PublicationTypes.getPubTypes().forEach(function(c) {
            b += "  <pubtype " + a.formatXMLattr({
                id: c.id,
                label: c.label,
                description: c.description
            }) + ">\n";
            b += "    <subtypes>\n";
            if (c.subtypes) {
                c.subtypes.forEach(function(a) {
                    b += '      <subtype name="' + PP.Utils.escapeXML(a.name) + '" />\n';
                });
            }
            b += "    </subtypes>\n";
            b += "    <fields>\n";
            PP.library.PublicationFields.getFieldsForPubType(c.id, {
                includeAll: true
            }).forEach(function(c) {
                b += "    <field " + a.formatXMLattr({
                    name: c.name,
                    label: c.label || "",
                    help: c.help || "",
                    type: c.fieldType,
                    mandatory: c.mandatory
                }) + "/>\n";
            });
            b += "    </fields>\n";
            b += "  </pubtype>\n";
        });
        b += "</pubtypes>\n";
        return b;
    },
    formatXMLattr: function(a) {
        var b = [];
        for (var c in a) {
            b.push(c + '="' + PP.Utils.escapeXML(a[c]) + '"');
        }
        return b.join(" ");
    }
});

PP.library.Publication = new PP.library._Publication();

PP.library._Render = PP.Class.extend({
    renderPub: function(a, b) {
        var c = {
            renderType: "autocomplete",
            searchTerms: ""
        };
        b = PP.Utils.apply(c, b);
        var d = b.renderType;
        if (d === "autocomplete") {
            return this.renderAutocomplete(a, b);
        } else if (d === "citation-grid-view") {
            return this.renderCitationGridView(a, b);
        } else if (d === "citation-details") {
            return this.renderCitationDetails(a, b);
        } else if (d === "pubview-error") {
            return this.renderPubViewError(a, b);
        } else if (d === "addon") {
            return this.renderAddon(a, b);
        } else if (d === "pubmed") {
            return this.renderPubMed(a, b);
        } else if (d === "word") {
            return this.renderWord(a, b);
        } else if (d === "bibguru") {
            return this.renderBibguru(a, b);
        } else {
            return this.renderAuthorYearJournal(a, b);
        }
    },
    renderAutocomplete: function(a, b) {
        var c = [ '<div class="pp-paper-panel-item pp-cite-autocomplete">', '  <div class="pp-paper-panel-title">', this.formatTitle(a, b), "  </div>", '  <div class="pp-paper-panel-authors">', this.formatAuthors(a, b), "  </div>", '  <div class="pp-paper-panel-reference">', this.formatReferenceLine(a, b), "  </div>", this.formatSnippets(a, b), "</div>" ].join("");
        return c;
    },
    renderAddon: function(a, b) {
        var c = [ '<div class="pp-paper-panel-item pp-cite-autocomplete">', '  <div class="pp-paper-panel-title">', this.formatTitle(a, b), "  </div>", '  <div class="pp-paper-panel-authors">', this.formatAuthors(a, b), "  </div>", '  <div class="pp-paper-panel-reference">', this.formatReferenceLine(a, b), this.getAddonEditLink(a, b), "  </div>", this.formatSnippets(a, b), '<div class="pp-search-item-button"></div><div class="dot-spinner"><div class="bounce1"></div><div class="bounce2"></div> <div class="bounce3"></div></div>', "</div>" ].join("");
        return c;
    },
    renderWord: function(a, b) {
        var c = [ '<div class="pp-title">', this.formatTitle(a, b), "  </div>", '  <div class="pp-authors">', this.formatAuthors(a, b), "  </div>", '  <div class="pp-reference">', this.formatReferenceLine(a, b), "  </div>", this.formatSnippets(a, b) ].join("");
        return c;
    },
    renderBibguru: function(a, b) {
        var c = [ '<div class="pp-title">', this.formatTitle(a, b), "  </div>", '  <div class="pp-authors">', this.formatAuthors(a, b), "  </div>", '  <div class="pp-reference">', this.formatReferenceLine(a, b), "  </div>", this.formatSnippets(a, b) ].join("");
        return c;
    },
    renderPubMed: function(a, b) {
        var c = a.titleDisplay || a.title || "Untitled Item";
        c = PP.String.interconvertString(c, {
            format: "html"
        });
        var d = "";
        if (a.abstractDisplay) {
            d = '<div class="pp-pubview-abstract">' + a.abstractDisplay + "</div>";
        }
        var e = [ '<div class="pp-paper-panel-item pp-cite-autocomplete">', '  <div class="pp-paper-panel-title">', '<div class="pp-grid-title"><span class="pp-grid-titletext">' + c + "</span></div>", "  </div>", '  <div class="pp-paper-panel-authors">', this.formatAuthors(a, b), "  </div>", '  <div class="pp-paper-panel-reference">', this.formatReferenceLine(a, b), "  </div>", d, "</div>" ].join("");
        return e;
    },
    renderCitationGridView: function(a, b) {
        var c = [ '<div class="' + this.getClasses(a, b) + '">', '  <div class="pp-grid-cursorblock"></div>', '  <div class="pp-grid-content pp-grid-collapsed">', "    <div>", this.formatTitle(a, b), '        <div class="pp-grid-authors">', this.formatAuthors(a, b), "        </div>", '        <div class="pp-grid-reference">', this.formatReferenceLine(a, b), "        </div>", '        <div class="pp-paper-panel-library-info">', this.getOwnerMessage(a, b), this.getEditLink(a, b), this.getLinkToPaperpile(a, b), "      </div>", "    </div>", "  </div>", "</div>" ].join("");
        return c;
    },
    renderCitationDetails: function(a, b) {
        var c = [ '<div class="pp-paper-panel-item">', '  <div class="pp-paper-panel-title">', this.formatTitle(a, b), "  </div>", '  <div class="pp-paper-panel-authors">', this.formatAuthors(a, b), "  </div>", '  <div class="pp-paper-panel-reference">', this.formatReferenceLine(a, b), "  </div>", '  <div class="pp-paper-panel-library-info">', this.getOwnerMessage(a, b), this.getCiteDetailsLinkToPaperpile(a, b), "  </div>", "</div>" ].join("");
        return c;
    },
    renderPubViewError: function(a, b) {
        var c = "";
        if (a) {
            c = [ '<div class="pp-pubview-pub">', '  <div class="pp-paper-panel-item">', '    <div class="pp-paper-panel-title">', this.formatTitle(a, b), "    </div>", '    <div class="pp-paper-panel-authors">', this.formatAuthors(a, b), "    </div>", '    <div class="pp-paper-panel-reference">', this.formatReferenceLine(a, b), "    </div>", "  </div>", this.formatPubViewAbstract(a, b), "</div>" ].join("");
        }
        var d = false;
        if (a && PP.Session.get("user_id")) {
            if (a.owner == PP.Session.get("user_id")) {
                d = true;
            }
        }
        var e = "try again";
        var f = PP.Globals.url("/troubleshooting#opening-attachments");
        var g = 'visit <a class="pp-link" href="' + f + '" target="_blank">Troubleshooting</a> for help.';
        var h = 'contact <a class="pp-link" fn="contactSupport">Paperpile support</a>';
        var i = "contact the item's owner";
        var j;
        if (d === true && b.isExtensionAvailable === true) {
            j = "Please " + e + ", " + h + " or " + g;
        } else if (d) {
            j = "Please " + e + " or " + g;
        } else {
            j = "Please " + e + ", " + i + " or " + g;
        }
        var k = [ '<div class="pp-pubview-error">', "  <p>" + b.errorMessage + "</p>", "  <p>" + j + "</p>", "</div>", c ].join("");
        return k;
    },
    renderAuthorYearJournal: function(a, b) {
        var c = PP.library.Publication.formatAuthorYear(a);
        var d = a.journal;
        var e = [ c, d ].join(", ");
        return e;
    },
    getClasses: function(a, b) {
        var c = [ "pp-grid-item" ];
        if (a.view_context_open === 1) {
            c.push("pp-grid-context-open");
        }
        if (a.view_pdf_context_open === 1) {
            c.push("pp-grid-pdf-context-open");
        }
        if (a.view_state.open_panel || a.view_state.search_open_panel) {
            c.push("pp-grid-panel-open");
            if (a.view_state.open_panel) {
                c.push("pp-grid-panel-open-" + a.view_state.open_panel);
            }
            if (a.view_state.search_open_panel) {
                c.push("pp-grid-panel-open-" + a.view_state.search_open_panel);
            }
        }
        if (PP.library.Publication.isIncomplete(a)) {
            c.push("pp-grid-incomplete");
        }
        if (b.extraClasses) {
            c = c.concat(b.extraClasses);
        }
        return c.join(" ");
    },
    formatAddToCitationSection: function(a, b) {
        var c = "pp-paper-panel-add";
        var d = "ADD_TO_CITATION";
        if (a.addedToCitation) {
            c = "pp-paper-panel-add pp-paper-panel-added";
        } else if (a.addingToCitation) {
            c = "pp-paper-panel-add pp-paper-panel-adding";
        }
        return [ '  <div class="' + c + '" ', d ? 'action="' + d + '"' : "", "></div>" ].join("");
    },
    getOwnerMessage: function(a, b) {
        var c = PP.Session.get("user_id");
        var d = a.owner;
        var e = a.owner_email;
        var f = a.owner_name;
        var g = "";
        if (c === d) {
            g = "Added by you";
        } else {
            if (f) {
                g = "Added by " + f;
            } else if (e) {
                if (e === "anonymous@example.com") {
                    g = "Added by an anonymous collaborator";
                } else {
                    g = "Added by " + e;
                }
            } else {
                g = "Added by another user";
            }
        }
        var h = "";
        var i = a.created;
        if (i) {
            var j = new Date(i * 1e3);
            var k = moment(j);
            h = "Added " + k.fromNow();
        }
        return [ '<div class="pp-cite-details-user" ppTip="' + h + '">', g, "</div>" ].join("");
    },
    getTweetStyleTime: function(a, b) {
        var b = b || new Date(), a = moment(a).valueOf(), b = moment(b).valueOf(), c = Math.round(Math.abs(b - a) / 60 / 1e3), d = Math.round(Math.abs(b - a) / 1e3);
        var e = Math.round(Math.abs(b - a) / 60 / 1e3 / 60);
        var f = Math.round(Math.abs(b - a) / 60 / 1e3 / 60 / 24);
        if (c < 2) {
            return d < 60 ? d + "s" : "1m";
        } else if (c < 60) {
            return c + "m";
        } else if (c < 1440) {
            return Math.round(c / 60) + "h";
        } else if (e < 48) {
            return Math.round(e) + "h";
        } else if (f < 7) {
            return Math.round(f) + "d";
        } else {
            var g = new Date().getYear() == new Date(a).getYear();
            return moment(a).format(g ? "D MMM" : "D MMM YY");
        }
    },
    getEditLink: function(a, b) {
        return [ '<div class="pp-action-container">', '<span class="pp-link pp-action" action="EDIT">Edit</span>', " / ", '<span class="pp-link pp-action" action="CITEVIEW_DELETE">Delete</span>', "</div>" ].join("");
    },
    getCiteDetailsLinkToPaperpile: function(a, b) {
        var c = PP.Session.get("user_id");
        var d = a.owner;
        var e = c && c === d;
        if (e) {
            return [ '<div class="pp-cite-details-linkout">', '<a class="pp-link" ', 'cite_alias="' + a.cite_alias + '" source_id="' + a.source_id + '" ', 'action="OPEN_CITATION_IN_PAPERPILE"', ">Open in Paperpile</a>", "</div>" ].join("");
        } else {
            var f = PP.write.CitationStore.documentSettings;
            if (f) {
                var g = PP.Globals.getUrlBase();
                var h = g + "/c/" + f.doc_alias + "/" + a.cite_alias;
                return [ '<div class="pp-cite-details-linkout">', '<a target="_blank" class="pp-link" href="' + h + '">View / edit reference</a>', "</div>" ].join("");
            } else {
                return "";
            }
        }
    },
    getAddonEditLink: function(a, b) {
        var c = PP.Session.get("user_id");
        var d = a.owner;
        var e = c && c === d;
        var f;
        if (a && a.source) {
            f = a.source.quick_result_plugin;
        }
        if (f && !(a._searchSource === "local")) {
            return '<div class="pp-webresult-byline"><span class="pp-paper-panel-source">From ' + f + ' </span> <div class="pp-details-link-container"><span class="pp-details-link" forid="' + a._id + '" id="info-panel-toggle-' + a._id + '" >&hellip;</span></div></div>';
        } else {
            return '<div class="pp-details-link-container"><span class="pp-details-link" forid="' + a._id + '" id="info-panel-toggle-' + a._id + '" >&hellip;</span></div>';
        }
    },
    getLinkToPaperpile: function(a, b) {
        var c = PP.Session.get("user_id");
        var d = PP.Globals.isChrome();
        var e = true;
        var f;
        var g;
        if (a.source) {
            f = a.source.quick_result_status;
            g = a.source._existing_pub_data != undefined;
        }
        var h = a.owner;
        var i = c && c === h;
        var j, k, l, m;
        if (!c || !d) {
            e = false;
            j = "pp-ready";
            k = "SHOW_MARKETING_DIALOG";
            l = "Add to My Library";
            m = "Get Paperpile to add papers<br/>to your personal web library";
        } else if (i) {
            j = "pp-exists";
            k = "OPEN_CITATION_IN_PAPERPILE";
            l = "Open in Paperpile";
            m = "You cited this paper.<br/>Click to open in Paperpile";
        } else if (g) {
            j = "pp-exists";
            k = "OPEN_CITATION_IN_PAPERPILE";
            l = "Open in Paperpile";
            m = "You have this paper in your library.<br/>Click to open in Paperpile";
        } else if (c && c !== h) {
            var n = a.source.quick_result_status;
            if (n && n.match(/ready/i)) {
                j = "pp-ready";
                k = "ADD_CITATION_TO_PAPERPILE";
                l = "Add to Library";
                m = "Click to copy this paper to your library";
            } else if (n && n.match(/working/i)) {
                j = "pp-working";
                k = "";
                l = "Adding...";
                m = "";
            } else if (n && n.match(/error/i)) {
                j = "pp-error";
                k = "REPORT_CITATION_ADD_ERROR";
                l = "Error";
                m = "Something went wrong &mdash; click to report this error.";
            } else if (n && n.match(/success/i)) {
                j = "pp-success";
                k = "OPEN_CITATION_IN_PAPERPILE";
                l = "Added to Library";
                m = "Added successfully.<br/>Click to open in Paperpile";
            }
        }
        if (!e) {
            return "";
        }
        var o = 'ppTip="' + m + '"';
        return [ '<div class="pp-citations-container ' + j + '" style="display:inline-block">', '  <div class="pp-citations-button ' + j + '" ' + o + ' action="' + k + '">', l, "  </div>", "</div>" ].join("");
    },
    selectionTickOnly: function(a) {
        return [ '<div class="pp-grid-grabstar-wrap">', this.selectionTickRegion(a), "</div>" ].join("");
    },
    grabRegion: function(a) {
        return '<div class="pp-grid-grab"><span class="icon" ppTip="Drag to add a folder or label"></span></div>';
    },
    starRegion: function(a) {
        if (a.starred) {
            return '<span class="pp-grid-star pp-star-filled pp-grid-button" action="TOGGLE_STAR"><span class="icon"></span></span>';
        } else {
            return '<span class="pp-grid-star pp-grid-button" action="TOGGLE_STAR"><span class="icon"></span></span>';
        }
    },
    selectionTickRegion: function(a) {
        return '<div class="pp-grid-selection-tick pp-grid-button" action="TOGGLE_SELECTION"><span class="icon"></span></div>';
    },
    searchIconRegion: function(a) {
        if (a.view_state.search_open_panel === "snippets") {
            return [ '<div class="pp-grid-snippet">', "</div>" ].join("");
        }
    },
    formatSnippets: function(a, b) {
        PP.library.Snippets.createSnippets(a, b);
        var c = [];
        var d = "";
        if (a.snippets) {
            a.snippets.forEach(function(a) {
                var b = '<span class="pp-snippet-type">' + a.type + "</span>";
                var d = '<div class="raster-u-22-24 pp-snippet-text">' + b + a.text + "</div>";
                c.push([ '<div class="pp-snippet raster">', '<div class="raster-u-1-24"></div>', d, "</div>" ].join(""));
            });
            d = c.join("");
            return [ '<div class="pp-grid-snippet-container">', d, "</div>" ].join("");
        } else {
            return "";
        }
    },
    formatTitle: function(a, b) {
        var c = a.title || "Untitled Item";
        if (c == "Untitled Item") {
            var d;
            if (a.pubtype == "PP_LETTER" || a.pubtype == "PP_PERSONAL_COMMUNICATION") {
                if ("editor" in a && a.editor.length) d = a.editor[0];
            } else if (a.pubtype == "PP_INTERVIEW") {
                if ("author" in a && a.author.length) d = a.author[0];
            }
            if (d) {
                var e;
                if (d.first && d.last) {
                    e = d.first + " " + d.last;
                } else if (d.initials && d.last) {
                    e = d.initials + " " + d.last;
                } else if (d.collective) {
                    e = d.collective;
                } else if (d.last) {
                    e = d.last;
                }
                if (e) {
                    if (a.pubtype == "PP_LETTER") c = "Letter to ";
                    if (a.pubtype == "PP_PERSONAL_COMMUNICATION") c = "Personal communication with ";
                    if (a.pubtype == "PP_INTERVIEW") c = "Interview with ";
                    c += e;
                }
            }
        }
        c = PP.String.interconvertString(c, {
            format: "html"
        });
        c = this.highlight(c, b);
        var f = "";
        var g = "";
        if (b.includeActions) {
            if (a["abstract"]) {
                f = "pp-grid-clickable-title";
                var h = a.view_state || {};
                var i = h.open_panel;
                if (i === "abstract") {
                    g = 'onlyonclick="true" action="GRID_CLOSE_ABSTRACT"';
                } else {
                    g = 'onlyonclick="true" action="GRID_OPEN_ABSTRACT"';
                }
            }
        }
        var j = a.title ? "" : "pp-grid-no-title";
        if (a.pubtype == "PP_LETTER" || a.pubtype == "PP_PERSONAL_COMMUNICATION" || a.pubtype == "PP_INTERVIEW") {
            if (c != "Untitled Item") j = "";
        }
        return [ '<div class="pp-grid-title ' + j + '">', "<span " + g + ' class="pp-grid-titletext ' + f + '">' + c + "</span>", "</div>" ].join("").replace(/\s+/g, " ").replace(/\s+"/g, '"');
    },
    formatAuthors: function(a, b) {
        var c = 80;
        var d = {
            prefix: '<span class="pp-author">',
            suffix: "</span>",
            delim: ", ",
            output: "display",
            othersString: "&hellip;"
        };
        var e = {
            prefix: "",
            suffix: "",
            delim: ", ",
            output: "display",
            othersString: "..."
        };
        var f = parseInt(c / 6) + 1;
        var g = {
            author: [],
            editor: [],
            contributor: [],
            series_editor: [],
            translator: []
        };
        for (var h in g) {
            if (a[h]) {
                g[h] = a[h].slice(0, f > a[h].length ? a[h].length : f);
            }
        }
        var i = PP.library.Publication.formatAuthors(g, d);
        var j;
        var k = PP.library.Publication.getAuthorType(g);
        if (k) {
            var l = a[k];
            var m = [];
            for (var n = 0; n < l.length; n++) {
                var o = l[n];
                if (o.collective === "et al.") {
                    m.push(o);
                } else if (PP.library.Author.toString(o) === "") {
                    continue;
                } else {
                    m.push(o);
                }
            }
            l = m;
            j = PP.library.Author.toString(l, e);
            var p = l.length;
            var q = l.length;
            var r = 0;
            while (j.length > c) {
                q--;
                var s = l.slice(0, q);
                var t = l.slice(q, l.length);
                r = t.length;
                j = [ PP.library.Author.toString(s, e), r > 0 ? " et al." : "" ].join("");
                i = [ PP.library.Author.toString(s, d), r > 0 ? " <i>et al.</i>" : "" ].join("");
            }
        }
        if (i === "[No author]") {
            return "";
        }
        b.allowShortStrings = true;
        return this.highlight(i, b);
    },
    formatReferenceLine: function(a, b) {
        var c;
        if (a && a.source) {
            c = a.source.quick_result_plugin;
        }
        var d = "";
        if (c && b && !a.cite_alias && b.renderType !== "citation-grid-view" && b.renderType !== "addon" && !(a._searchSource == "local")) {
            d = [ '<span class="pp-paper-panel-source">', " from " + c, "</span>" ].join("");
        }
        var e = false;
        var f = this.formatJournal(a, b);
        if (!f && a.publisher) {
            f = a.publisher;
        } else if (!f) {
            if (a.pubtype === "PP_BOOK") {
                f = "No publisher";
                e = true;
            } else if (a.pubtype === "PP_WEBSITE") {
                if (a.url && a.url.length > 0) {
                    f = a.url[0].replace(/([\.\/_])/g, "$1<wbr>");
                }
            } else if (a.pubtype === "PP_LETTER" || a.pubtype === "PP_MAP" || a.pubtype === "PP_STANDARD" || a.pubtype === "PP_FIGURE" || a.pubtype == "PP_PRESENTATION" || a.pubtype == "PP_COMPUTER_PROGRAM" || a.pubtype == "PP_MANUAL" || a.pubtype == "PP_PERSONAL_COMMUNICATION" || a.pubtype == "PP_UNPUBLISHED" || a.pubtype == "PP_MISC") {
                f = "";
            } else if (a.pubtype == "PP_BILL") {
                f = a.legislative_body ? a.legislative_body : "";
            } else {
                f = "No journal";
                e = true;
            }
        }
        var g = e ? " pp-paper-panel-empty" : "";
        var h = this.surroundIf('<span class="pp-paper-panel-journal' + g + '">', f, "</span>");
        var i = this.surroundIf('<span class="pp-paper-panel-year' + g + '">', this.formatYear(a, b), "</span>");
        var j = this.surroundIf('<span class="pp-paper-panel-citedby">', this.formatCitedBy(a, b), "</span>");
        var k = [ h, i ];
        k = k.filter(function(a) {
            return a != "";
        });
        var l = k.join(", ");
        var m = [ d, j ];
        m = m.filter(function(a) {
            return a != "";
        });
        var n = m.join('<span class="pp-paper-panel-sep">|</span>');
        return [ l, n ].join(" ").replace(/\s+$/, "").replace(/\s+/g, " ");
    },
    formatEditLink: function(a, b) {
        if (a.cite_alias) {
            return a.cite_alias;
        } else {
            return "";
        }
    },
    formatPubViewAbstract: function(a, b) {
        if (a["abstract"]) {
            return [ '<div class="pp-pubview-abstract">', a["abstract"], "</div>" ].join("");
        } else {
            return "";
        }
    },
    surroundIf: function(a, b, c) {
        if (!b) {
            return "";
        } else {
            return a + b + c;
        }
    },
    formatCitedBy: function(a, b) {
        var c = "";
        if (a.gs_cited_by_count !== undefined) {
            return "cited by " + a.gs_cited_by_count;
        } else if (a.pubmed_cited_by_count !== undefined) {
            return "cited by " + a.pubmed_cited_by_count;
        } else {
            return "";
        }
    },
    formatYear: function(a, b) {
        var c = a.published || {};
        var d = PP.library.Date.yearString(c);
        d = this.highlight(d, b);
        return d;
    },
    formatJournal: function(a, b) {
        var c = "";
        if (a.pubtype == "PP_CONFERENCE_PAPER" || a.pubtype == "PP_WEBSITE") {
            c = a.booktitle;
        } else if (a.pubtype == "PP_BOOK_CHAPTER") {
            c = PP.String.interconvertString(a.booktitle, {
                format: "html"
            });
        } else if (a.pubtype == "PP_THESIS") {
            c = a.school;
        } else if (a.pubtype == "PP_MANUSCRIPT") {
            c = a.series;
        } else if (a.pubtype == "PP_ARTWORK" || a.pubtype == "PP_REPORT") {
            c = a.institution;
        } else if (a.pubtype == "PP_LETTER" || a.pubtype === "PP_MAP" || a.pubtype === "PP_STANDARD" || a.pubtype === "PP_FIGURE" || a.pubtype == "PP_PRESENTATION" || a.pubtype == "PP_COMPUTER_PROGRAM" || a.pubtype == "PP_MANUAL" || a.pubtype == "PP_PERSONAL_COMMUNICATION" || a.pubtype == "PP_UNPUBLISHED" || a.pubtype == "PP_MISC") {
            c = "";
        } else {
            c = a.journal;
        }
        c = this.highlight(c, b);
        return c;
    },
    highlight: function(a, b) {
        if (!a || a == "") {
            return a;
        }
        if (!b.searchTerms) {
            return a;
        }
        b = b || {};
        var c = b.searchTerms;
        var d = [];
        if (c) {
            d = c.split(/\s+/);
        }
        d = PP.Array.filter(d, function(a) {
            if (b.allowShortStrings !== true && a.length <= 2) {
                return false;
            } else if (a !== "") {
                return true;
            }
        });
        for (var e = 0; e < d.length; e++) {
            d[e] = PP.Utils.removeQuotationMarksAndPunctation(d[e]);
        }
        d = PP.Array.unique(d.sort(function(a, b) {
            return b.length - a.length;
        }));
        var f, g;
        for (var e = 0; e < d.length; e++) {
            g = d[e].replace(/[-[\]{}()*+?.,\\^$|#]/g, "\\$&");
            if (g.length <= 2) {
                f = new RegExp("(<\\/?\\w+(\\s+\\w+(\\s*=\\s*(\"[^\"]*\"|'[^']*'|\\S+))?)*>)" + "|\\b(" + g + ")\\b", "ig");
            } else {
                f = new RegExp("(<\\/?\\w+(\\s+\\w+(\\s*=\\s*(\"[^\"]*\"|'[^']*'|\\S+))?)*>)" + "|(" + g + ")", "ig");
            }
            a = this.replaceOutsideTags(a, f);
        }
        return a;
    },
    replaceOutsideTags: function(a, b) {
        a = a.replace(b, function(a, b, c, d, e, f) {
            if (b) {
                return b;
            } else {
                f = f.replace(/<\//g, "");
                return '<span class="pp-grid-highlight">' + f + "</span>";
            }
        });
        return a;
    }
});

PP.library.Render = new PP.library._Render();

PP.library._Serialization = PP.Class.extend({
    serialize: function(a, b) {
        var c = PP.library.PublicationFields.getFields();
        var d = {};
        for (var e = 0; e < c.length; e++) {
            var f = c[e];
            var g = c[e].name;
            var h = PP.library.PublicationFields.getFieldType(g);
            var i = PP.library.PublicationFields.getDataType(g);
            if (f.export_persist === false) {
                continue;
            }
            if (h === "author") {
                var j = a[g];
                if (j && j.length > 0) {
                    d[g] = PP.library.Author.toString(j, {
                        delim: "; ",
                        output: "serialize"
                    });
                    a[g + "_origString"] = d[g];
                }
            } else if (h === "date") {
                var k = a[g];
                if (k) {
                    d[g] = PP.library.Date.toString(k, b);
                    a[g + "_origString"] = d[g];
                }
            } else if (i === "array") {
                var l = a[g];
                if (l && PP.Utils.isArray(l) && l.length > 0) {
                    d[g] = l.join("\n");
                    a[g + "_origString"] = d[g];
                }
            } else {
                if (a[g] !== undefined) {
                    d[g] = a[g] + "";
                }
            }
        }
        for (var m in d) {
            if (!PP.Utils.isString(d[m])) {
                throw new Error("Key " + m + " in serialized pub is not a string!");
            }
        }
        return PP.Utils.clone(d);
    },
    unserializeField: function(a, b) {
        var c = PP.library.PublicationFields.getFieldsMap();
        var d = c[a];
        if (!d) {
            console.log("Field not found", a);
            return b;
        }
        parseOptions = {
            delimiter: ";",
            familyNameFirst: false
        };
        var e = d.fieldType;
        var f = d.dataType;
        if (f === "array" && b === "") {
            return undefined;
        }
        if (e === "author") {
            var g = PP.library.Author.parseAuthorList(b, parseOptions);
            return g;
        } else if (e === "date") {
            var g = PP.library.Date.parseDate(b);
            return g;
        } else if (f === "array") {
            var h = b;
            var i = h.split(/\n/g);
            return i;
        } else {
            return b;
        }
    },
    unserialize: function(a, b) {
        a = PP.Utils.clone(a);
        var c = {};
        if (b === undefined) {
            b = {
                delimiter: ";",
                familyNameFirst: false
            };
        }
        var d = PP.library.PublicationFields.getFields();
        for (var e = 0; e < d.length; e++) {
            var f = d[e].name;
            var g = d[e].fieldType;
            var h = d[e].dataType;
            if (a[f] !== undefined) {
                if (h === "array" && a[f] === "") {
                    c[f] = undefined;
                    continue;
                }
                if (g === "author") {
                    var i = PP.library.Author.parseAuthorList(a[f], b);
                    c[f] = i;
                } else if (g === "date") {
                    var i = PP.library.Date.parseDate(a[f]);
                    c[f] = i;
                } else if (h === "array") {
                    var j = a[f];
                    var k = j.split(/\n/g);
                    c[f] = k;
                } else {
                    c[f] = a[f];
                }
            }
        }
        return c;
    }
});

PP.library.Serialization = new PP.library._Serialization();

PP.library._Snippets = PP.Class.extend({
    createSnippets: function(a, b) {
        var c = b.searchTerms || "";
        var d = c.split(/\s+/);
        d = PP.Array.filter(d, function(a) {
            if (a !== "") {
                return true;
            }
        });
        if (d.length > 0) {
            var e = [];
            d.forEach(function(a) {
                a = PP.Utils.escapeRegex(a);
                e.push(new RegExp(a, "ig"));
            });
            var f = true;
            var g = {
                delim: ",",
                output: "display"
            };
            var h = PP.library.Publication.formatAuthors(a, g);
            for (var i = 0; i < e.length; i++) {
                var j = e[i];
                if (j.test(a["title"]) || j.test(a["journal"]) || j.test(h)) {
                    continue;
                } else {
                    f = false;
                    break;
                }
            }
            if (f === false) {
                var k = [];
                if (a["abstract"]) {
                    var l = a["abstract"];
                    l = l.replace(/(<([^>]+)>)/g, "&nbsp;");
                    l = l.replace(/&nbsp;/g, " ");
                    var m = this.getSnippet(e, l, b);
                    if (m) {
                        m.type = "Abstract";
                        k.push(m);
                    }
                }
                if (a["note"]) {
                    var l = a["note"];
                    l = l.replace(/(<([^>]+)>)/g, "&nbsp;");
                    l = l.replace(/&nbsp;/g, " ");
                    var m = this.getSnippet(e, l, b);
                    if (m) {
                        m.type = "Notes";
                        k.push(m);
                    }
                }
                if (k.length > 0) {
                    a.snippets = k;
                    if (a.view_state) {
                        a.view_state.search_open_panel = "snippets";
                    }
                }
            } else {
                if (a.view_state) {
                    delete a.view_state.search_open_panel;
                }
            }
        } else {
            if (a.view_state) {
                delete a.view_state.search_open_panel;
            }
        }
    },
    getSnippet: function(a, b, c) {
        var d = [];
        for (var e = 0; e < a.length; e++) {
            var f = a[e];
            var g = [];
            var h;
            while ((h = f.exec(b)) !== null) {
                var i = h.index;
                var j = h[0].length;
                var k = {};
                k[h[0]] = 1;
                var l = {
                    left: i,
                    right: i + j,
                    tokens: k
                };
                d.push(l);
            }
        }
        var m = 30;
        this.mergeMatches(d, m);
        d.sort(function(a, b) {
            var c = Object.keys(a.tokens).length;
            var d = Object.keys(b.tokens).length;
            return d - c;
        });
        var n = [];
        var o = {};
        var p = {};
        for (var e = 0; e < d.length; e++) {
            var q = d[e];
            var r = false;
            var s = Object.keys(q.tokens);
            for (var t = 0; t < s.length; t++) {
                if (!o[s[t]]) {
                    r = true;
                    break;
                }
            }
            if (r) {
                n.push(this.getTextRange(q, b));
                PP.Utils.apply(o, q.tokens);
                p[e] = 1;
            }
        }
        var u = 350;
        for (var e = 0; e < d.length; e++) {
            var q = d[e];
            if (p[e]) {
                continue;
            }
            var v = this.getTextRange(q, b);
            var w = v[1] - v[0];
            if (this.getCombinedLength(n) + w >= u) {
                break;
            } else {
                n.push(v);
            }
        }
        n.sort(function(a, b) {
            return a[0] - b[0];
        });
        this.mergeRanges(n);
        var x = [];
        n.forEach(function(a) {
            var d = b.substring(a[0], a[1]);
            d = PP.library.Render.highlight(d, c);
            x.push(d);
        });
        var y = '<span class="pp-snippet-ellipsis">&hellip;</span>';
        var z = y + " " + x.join(" " + y + " ") + "" + y;
        if (x.length > 0) {
            return {
                text: z
            };
        } else {
            return null;
        }
    },
    getCombinedLength: function(a) {
        var b = 0;
        a.forEach(function(a) {
            b += a[1] - a[0];
        });
        return b;
    },
    getTextRange: function(a, b) {
        var c = 15;
        var d = 2;
        var e, f;
        e = Math.max(0, a.left - 500);
        f = a.left;
        var g = b.substring(e, f);
        var h = g.split("").reverse().join("");
        var i = this.expandOnPunctuation(h, 5, 15);
        var j = a.left - i;
        e = a.right;
        f = Math.min(b.length, a.right + 500);
        var k = b.substr(e, f);
        var l = this.expandOnPunctuation(k, 5, 15);
        var m = a.right + l;
        return [ j, m ];
    },
    expandOnPunctuation: function(a, b, c) {
        var d = a.split(/[\.,;!\?]/);
        var e = 0;
        var f = 0;
        for (var g = 0; g < d.length; g++) {
            var h = d[g];
            var i = h.split(/\s+/);
            var j = e + i.length;
            for (var k = 0; k < i.length; k++) {
                if (e > b && j > c) {
                    return f - 1;
                } else if (e > c) {
                    return f - 1;
                }
                e++;
                f += i[k].length + 1;
            }
        }
        return f;
    },
    mergeRanges: function(a) {
        for (var b = 0; b < a.length; b++) {
            for (var c = b + 1; c < a.length; c++) {
                var d = a[b];
                var e = a[c];
                var f = false;
                if (this.rangesOverlap(d, e)) {
                    f = true;
                }
                if (f) {
                    a.splice(b, 1);
                    a.splice(c - 1, 1);
                    var g = [];
                    g[0] = Math.min(d[0], e[0]);
                    g[1] = Math.max(d[1], e[1]);
                    a.push(g);
                    this.mergeRanges(a);
                    return;
                }
            }
        }
    },
    rangesOverlap: function(a, b) {
        var c = 0;
        var d = a[0] - c;
        var e = a[1] + c;
        var f = b[0] - c;
        var g = b[1] + c;
        if (d > f && d < g) {
            return true;
        } else if (f > d && f < e) {
            return true;
        } else {
            return false;
        }
    },
    mergeMatches: function(a, b) {
        var c = a.length;
        for (var d = 0; d < a.length; d++) {
            for (var e = d + 1; e < a.length; e++) {
                var f = a[d];
                var g = a[e];
                var h = false;
                if (this.matchesOverlap(f, g, b)) {
                    h = true;
                }
                if (h) {
                    a.splice(d, 1);
                    a.splice(e - 1, 1);
                    var i = {};
                    PP.Utils.apply(i, f.tokens);
                    PP.Utils.apply(i, g.tokens);
                    a.push({
                        left: Math.min(f.left, g.left),
                        right: Math.max(f.right, g.right),
                        tokens: i
                    });
                    this.mergeMatches(a, b);
                    return;
                }
            }
        }
    },
    matchesOverlap: function(a, b, c) {
        var d = a.left - c;
        var e = a.right + c;
        var f = b.left - c;
        var g = b.right + c;
        if (d > f && d < g) {
            return true;
        } else if (f > d && f < e) {
            return true;
        } else {
            return false;
        }
    }
});

PP.library.Snippets = new PP.library._Snippets();

(function(a) {
    "use strict";
    var b = "matchesSelector";
    if ("webkitMatchesSelector" in Element.prototype) b = "webkitMatchesSelector"; else if ("mozMatchesSelector" in Element.prototype) b = "mozMatchesSelector";
    var c = a.MutationObserver || a.WebKitMutationObserver || a.MozMutationObserver;
    if (typeof c != "function") {
        return;
    }
    var d = "__mutation_summary_node_map_id__";
    var e = 1;
    function f(a) {
        if (!a[d]) {
            a[d] = e++;
            return true;
        }
        return false;
    }
    function g() {
        this.map_ = {};
    }
    g.prototype = {
        set: function(a, b) {
            f(a);
            this.map_[a[d]] = {
                k: a,
                v: b
            };
        },
        get: function(a) {
            if (f(a)) return;
            var b = this.map_[a[d]];
            if (b) return b.v;
        },
        has: function(a) {
            return !f(a) && a[d] in this.map_;
        },
        delete: function(a) {
            if (f(a)) return;
            delete this.map_[a[d]];
        },
        keys: function() {
            var a = [];
            for (var b in this.map_) {
                a.push(this.map_[b].k);
            }
            return a;
        }
    };
    function h(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b);
    }
    var i = 0;
    var j = 1;
    var k = 2;
    var l = 3;
    var m = 4;
    var n = 5;
    function o(a) {
        return a == j || a == l;
    }
    var p = Array.prototype.forEach.call.bind(Array.prototype.forEach);
    function q(a, b, c) {
        this.rootNode = a;
        this.elementFilter = b;
        this.calcReordered = c;
    }
    q.prototype = {
        getChange: function(a) {
            var b = this.changeMap.get(a);
            if (!b) {
                b = {
                    target: a
                };
                this.changeMap.set(a, b);
            }
            if (a.nodeType == Node.ELEMENT_NODE) b.matchCaseInsensitive = a instanceof HTMLElement && a.ownerDocument instanceof HTMLDocument;
            return b;
        },
        getParentChange: function(a) {
            var b = this.getChange(a);
            if (!b.childList) {
                b.childList = true;
                b.oldParentNode = null;
            }
            return b;
        },
        handleChildList: function(a) {
            this.childListChanges = true;
            p(a.removedNodes, function(b) {
                var c = this.getParentChange(b);
                if (c.added || c.oldParentNode) c.added = false; else c.oldParentNode = a.target;
            }, this);
            p(a.addedNodes, function(a) {
                var b = this.getParentChange(a);
                b.added = true;
            }, this);
        },
        handleAttributes: function(a) {
            this.attributesChanges = true;
            var b = this.getChange(a.target);
            if (!b.attributes) {
                b.attributes = true;
                b.attributeOldValues = {};
            }
            var c = b.attributeOldValues;
            if (!h(c, a.attributeName)) {
                c[a.attributeName] = a.oldValue;
            }
        },
        handleCharacterData: function(a) {
            this.characterDataChanges = true;
            var b = this.getChange(a.target);
            if (b.characterData) return;
            b.characterData = true;
            b.characterDataOldValue = a.oldValue;
        },
        processMutations: function(a) {
            this.mutations = a;
            this.changeMap = new g();
            this.mutations.forEach(function(a) {
                switch (a.type) {
                  case "childList":
                    this.handleChildList(a);
                    break;

                  case "attributes":
                    this.handleAttributes(a);
                    break;

                  case "characterData":
                    this.handleCharacterData(a);
                    break;
                }
            }, this);
            var b = this.entered = [];
            var c = this.exited = [];
            var d = this.stayedIn = new g();
            if (!this.childListChanges && !this.attributesChanges) return;
            var e = this.matchabilityChange.bind(this);
            var f = this.reachabilityChange.bind(this);
            var h = this.wasReordered.bind(this);
            var o = new g();
            var p = this;
            function q(a, g) {
                if (o.has(a)) return;
                o.set(a, true);
                var r = p.changeMap.get(a);
                var s = g;
                if (r && r.childList || s == undefined) s = f(a);
                if (s == i) return;
                e(a);
                if (s == j) {
                    b.push(a);
                } else if (s == l) {
                    c.push(a);
                } else if (s == k) {
                    var t = k;
                    if (r && r.childList) {
                        if (r.oldParentNode !== a.parentNode) {
                            t = m;
                        } else if (p.calcReordered && h(a)) {
                            t = n;
                        }
                    }
                    d.set(a, t);
                }
                if (s == k) return;
                for (var u = a.firstChild; u; u = u.nextSibling) {
                    q(u, s);
                }
            }
            this.changeMap.keys().forEach(function(a) {
                q(a);
            });
        },
        getChanged: function(a) {
            var b = this.matchabilityChange.bind(this);
            this.entered.forEach(function(c) {
                var d = b(c);
                if (d == j || d == k) a.added.push(c);
            });
            this.stayedIn.keys().forEach(function(c) {
                var d = b(c);
                if (d == j) {
                    a.added.push(c);
                } else if (d == l) {
                    a.removed.push(c);
                } else if (d == k && (a.reparented || a.reordered)) {
                    var e = this.stayedIn.get(c);
                    if (a.reparented && e == m) a.reparented.push(c); else if (a.reordered && e == n) a.reordered.push(c);
                }
            }, this);
            this.exited.forEach(function(c) {
                var d = b(c);
                if (d == l || d == k) a.removed.push(c);
            });
        },
        getOldParentNode: function(a) {
            var b = this.changeMap.get(a);
            if (b && b.childList) return b.oldParentNode ? b.oldParentNode : null;
            var c = this.reachabilityChange(a);
            if (c == i || c == j) throw Error("getOldParentNode requested on invalid node.");
            return a.parentNode;
        },
        getOldPreviousSibling: function(a) {
            var b = this.childlistChanges.get(a.parentNode);
            if (!b || !this.wasReordered(a)) throw Error("getOldPreviousSibling requested on invalid node.");
            return b.oldPreviousSibling.get(a);
        },
        getOldAttribute: function(a, b) {
            var c = this.changeMap.get(a);
            if (!c || !c.attributes) throw Error("getOldAttribute requested on invalid node.");
            if (c.matchCaseInsensitive) b = b.toLowerCase();
            if (!h(c.attributeOldValues, b)) throw Error("getOldAttribute requested for unchanged attribute name.");
            return c.attributeOldValues[b];
        },
        getAttributesChanged: function(a) {
            if (!this.attributesChanges) return {};
            var b;
            var c;
            if (a) {
                b = {};
                c = {};
                a.forEach(function(a) {
                    b[a] = true;
                    var d = a.toLowerCase();
                    if (a != d) {
                        c[d] = a;
                    }
                });
            }
            var d = {};
            var e = this.changeMap.keys();
            for (var f = 0; f < e.length; f++) {
                var g = e[f];
                var h = this.changeMap.get(g);
                if (!h.attributes) continue;
                if (k != this.reachabilityChange(g) || k != this.matchabilityChange(g)) continue;
                var i = g;
                var j = h.attributeOldValues;
                Object.keys(j).forEach(function(a) {
                    var e = a;
                    if (h.matchCaseInsensitive && c && c[a]) e = c[a];
                    if (b && !b[e]) return;
                    if (i.getAttribute(a) == j[a]) return;
                    if (!d[e]) d[e] = [];
                    d[e].push(i);
                });
            }
            return d;
        },
        getOldCharacterData: function(a) {
            var b = this.changeMap.get(a);
            if (!b || !b.characterData) throw Error("getOldCharacterData requested on invalid node.");
            return b.characterDataOldValue;
        },
        getCharacterDataChanged: function() {
            if (!this.characterDataChanges) return [];
            var a = this.changeMap.keys();
            var b = [];
            for (var c = 0; c < a.length; c++) {
                var d = a[c];
                if (k != this.reachabilityChange(d) || k != this.matchabilityChange(d)) continue;
                var e = this.changeMap.get(d);
                if (!e.characterData || d.textContent == e.characterDataOldValue) continue;
                b.push(d);
            }
            return b;
        },
        reachabilityChange: function(a) {
            this.reachableCache = this.reachableCache || new g();
            this.wasReachableCache = this.wasReachableCache || new g();
            var b = this.rootNode;
            var c = this.changeMap;
            var d = this.reachableCache;
            var e = this.wasReachableCache;
            function f(a) {
                var b = c.get(a);
                if (b && b.childList) {
                    if (b.oldParentNode) return b.oldParentNode;
                    if (b.added) return null;
                }
                return a.parentNode;
            }
            function h(a) {
                if (a === b) return true;
                if (!a) return false;
                var c = d.get(a);
                if (c === undefined) {
                    c = h(a.parentNode);
                    d.set(a, c);
                }
                return c;
            }
            function m(a) {
                if (a === b) return true;
                if (!a) return false;
                var c = e.get(a);
                if (c === undefined) {
                    c = m(f(a));
                    e.set(a, c);
                }
                return c;
            }
            if (h(a)) return m(a) ? k : j; else return m(a) ? l : i;
        },
        checkWasMatching: function(a, b, c) {
            var d = this.changeMap.get(a);
            if (!d || !d.attributeOldValues) return c;
            var e = b.tagName;
            if (d.matchCaseInsensitive && e != "*" && h(b, "caseInsensitiveTagName")) {
                e = b.caseInsensitiveTagName;
            }
            if (e != "*" && e != a.tagName) return false;
            var f = d.attributeOldValues;
            var g = b.qualifiers.some(function(a) {
                if (a.class) return h(f, "class"); else if (a.id) return h(f, "id"); else {
                    return d.matchCaseInsensitive && h(a, "caseInsensitiveAttrName") ? h(f, a.caseInsensitiveAttrName) : h(f, a.attrName);
                }
            });
            if (!g) return c;
            for (var i = 0; i < b.qualifiers.length; i++) {
                var j = b.qualifiers[i];
                var k;
                if (j.class) k = "class"; else if (j.id) k = "id"; else {
                    if (d.matchCaseInsensitive && h(j, "caseInsensitiveAttrName")) {
                        k = j.caseInsensitiveAttrName;
                    } else {
                        k = j.attrName;
                    }
                }
                var l = j.class ? true : j.contains;
                var m = h(f, k) ? f[k] : a.getAttribute(k);
                if (m == null) return false;
                if (j.hasOwnProperty("attrValue")) {
                    if (!l && j.attrValue !== m) return false;
                    var n = m.split(" ").some(function(a) {
                        return a == j.attrValue;
                    });
                    if (!n) return false;
                }
            }
            return true;
        },
        matchabilityChange: function(a) {
            if (this.filterCharacterData) {
                switch (a.nodeType) {
                  case Node.COMMENT_NODE:
                  case Node.TEXT_NODE:
                    return k;

                  default:
                    return i;
                }
            }
            if (!this.elementFilter) return k;
            if (a.nodeType !== Node.ELEMENT_NODE) return i;
            var c = a;
            function d(a) {
                if (!this.matchCache) this.matchCache = {};
                if (!this.matchCache[a.selectorString]) this.matchCache[a.selectorString] = new g();
                var d = this.matchCache[a.selectorString];
                var e = d.get(c);
                if (e !== undefined) return e;
                var f = c[b](a.selectorString);
                var h = this.checkWasMatching(c, a, f);
                if (f) e = h ? k : j; else e = h ? l : i;
                d.set(c, e);
                return e;
            }
            var e = this.elementFilter.map(d, this);
            var f = i;
            var h = 0;
            while (f != k && h < e.length) {
                switch (e[h]) {
                  case k:
                    f = k;
                    break;

                  case j:
                    if (f == l) f = k; else f = j;
                    break;

                  case l:
                    if (f == j) f = k; else f = l;
                    break;
                }
                h++;
            }
            return f;
        },
        processChildlistChanges: function() {
            if (this.childlistChanges) return;
            var a = this.childlistChanges = new g();
            function b(b) {
                var c = a.get(b);
                if (!c) {
                    c = {
                        added: new g(),
                        removed: new g(),
                        maybeMoved: new g(),
                        oldPrevious: new g()
                    };
                    a.set(b, c);
                }
                return c;
            }
            var c = this.reachabilityChange.bind(this);
            this.mutations.forEach(function(a) {
                if (a.type != "childList") return;
                if (c(a.target) != k) return;
                var d = b(a.target);
                var e = a.previousSibling;
                function f(a, b) {
                    if (!a || d.oldPrevious.has(a) || d.added.has(a) || d.maybeMoved.has(a)) return;
                    if (b && (d.added.has(b) || d.maybeMoved.has(b))) return;
                    d.oldPrevious.set(a, b);
                }
                p(a.removedNodes, function(a) {
                    f(a, e);
                    if (d.added.has(a)) {
                        d.added.delete(a);
                    } else {
                        d.removed.set(a, true);
                        d.maybeMoved.delete(a, true);
                    }
                    e = a;
                });
                f(a.nextSibling, e);
                p(a.addedNodes, function(a) {
                    if (d.removed.has(a)) {
                        d.removed.delete(a);
                        d.maybeMoved.set(a, true);
                    } else {
                        d.added.set(a, true);
                    }
                });
            });
        },
        wasReordered: function(a) {
            if (!this.childListChanges) return false;
            this.processChildlistChanges();
            var b = this.childlistChanges.get(a.parentNode);
            if (b.moved) return b.moved.get(a);
            var c = b.moved = new g();
            var d = new g();
            function e(a) {
                while (a = a.previousSibling) {
                    if (d.has(a)) return false;
                }
                return true;
            }
            function f(a) {
                if (!a) return false;
                if (!b.maybeMoved.has(a)) return false;
                var f = c.get(a);
                if (f !== undefined) return f;
                if (d.has(a)) {
                    f = e(a);
                } else {
                    d.set(a, true);
                    f = k(a) !== i(a);
                }
                if (d.has(a)) {
                    d.delete(a);
                    c.set(a, f);
                } else {
                    f = c.get(a);
                }
                return f;
            }
            var h = b.oldPreviousSibling = new g();
            function i(a) {
                var c = h.get(a);
                if (c !== undefined) return c;
                c = b.oldPrevious.get(a);
                while (c && (b.removed.has(c) || f(c))) {
                    c = i(c);
                }
                if (c === undefined) c = a.previousSibling;
                h.set(a, c);
                return c;
            }
            var j = new g();
            function k(a) {
                if (j.has(a)) return j.get(a);
                var c = a.previousSibling;
                while (c && (b.added.has(c) || f(c))) c = c.previousSibling;
                j.set(a, c);
                return c;
            }
            b.maybeMoved.keys().forEach(f);
            return b.moved.get(a);
        }
    };
    var r = /[a-zA-Z_]+/;
    var s = /[a-zA-Z0-9_\-]+/;
    function t(a) {
        var b = [];
        var c;
        var d;
        function e() {
            if (c) {
                if (d) {
                    c.qualifiers.push(d);
                    d = undefined;
                }
                b.push(c);
            }
            c = {
                qualifiers: []
            };
        }
        function f() {
            if (d) c.qualifiers.push(d);
            d = {};
        }
        var g = /\s/;
        var h;
        var i = "Invalid or unsupported selector syntax.";
        var j = 1;
        var k = 2;
        var l = 3;
        var m = 4;
        var n = 5;
        var o = 6;
        var p = 7;
        var q = 8;
        var t = 9;
        var u = 10;
        var v = 11;
        var w = 12;
        var x = 13;
        var y = 14;
        var z = j;
        var A = 0;
        while (A < a.length) {
            var B = a[A++];
            switch (z) {
              case j:
                if (B.match(r)) {
                    e();
                    c.tagName = B;
                    z = k;
                    break;
                }
                if (B == "*") {
                    e();
                    c.tagName = "*";
                    z = l;
                    break;
                }
                if (B == ".") {
                    e();
                    f();
                    c.tagName = "*";
                    d.class = true;
                    z = m;
                    break;
                }
                if (B == "#") {
                    e();
                    f();
                    c.tagName = "*";
                    d.id = true;
                    z = m;
                    break;
                }
                if (B == "[") {
                    e();
                    f();
                    c.tagName = "*";
                    d.attrName = "";
                    z = o;
                    break;
                }
                if (B.match(g)) break;
                throw Error(i);

              case k:
                if (B.match(s)) {
                    c.tagName += B;
                    break;
                }
                if (B == ".") {
                    f();
                    d.class = true;
                    z = m;
                    break;
                }
                if (B == "#") {
                    f();
                    d.id = true;
                    z = m;
                    break;
                }
                if (B == "[") {
                    f();
                    d.attrName = "";
                    z = o;
                    break;
                }
                if (B.match(g)) {
                    z = y;
                    break;
                }
                if (B == ",") {
                    z = j;
                    break;
                }
                throw Error(i);

              case l:
                if (B == ".") {
                    f();
                    d.class = true;
                    z = m;
                    break;
                }
                if (B == "#") {
                    f();
                    d.id = true;
                    z = m;
                    break;
                }
                if (B == "[") {
                    f();
                    d.attrName = "";
                    z = o;
                    break;
                }
                if (B.match(g)) {
                    z = y;
                    break;
                }
                if (B == ",") {
                    z = j;
                    break;
                }
                throw Error(i);

              case m:
                if (B.match(r)) {
                    d.attrValue = B;
                    z = n;
                    break;
                }
                throw Error(i);

              case n:
                if (B.match(s)) {
                    d.attrValue += B;
                    break;
                }
                if (B == ".") {
                    f();
                    d.class = true;
                    z = m;
                    break;
                }
                if (B == "#") {
                    f();
                    d.id = true;
                    z = m;
                    break;
                }
                if (B == "[") {
                    f();
                    z = o;
                    break;
                }
                if (B.match(g)) {
                    z = y;
                    break;
                }
                if (B == ",") {
                    z = j;
                    break;
                }
                throw Error(i);

              case o:
                if (B.match(r)) {
                    d.attrName = B;
                    z = p;
                    break;
                }
                if (B.match(g)) break;
                throw Error(i);

              case p:
                if (B.match(s)) {
                    d.attrName += B;
                    break;
                }
                if (B.match(g)) {
                    z = q;
                    break;
                }
                if (B == "~") {
                    d.contains = true;
                    z = t;
                    break;
                }
                if (B == "=") {
                    d.attrValue = "";
                    z = v;
                    break;
                }
                if (B == "]") {
                    z = l;
                    break;
                }
                throw Error(i);

              case q:
                if (B == "~") {
                    d.contains = true;
                    z = t;
                    break;
                }
                if (B == "=") {
                    d.attrValue = "";
                    z = v;
                    break;
                }
                if (B == "]") {
                    z = l;
                    break;
                }
                if (B.match(g)) break;
                throw Error(i);

              case t:
                if (B == "=") {
                    d.attrValue = "";
                    z = v;
                    break;
                }
                throw Error(i);

              case u:
                if (B == "]") {
                    z = l;
                    break;
                }
                if (B.match(g)) break;
                throw Error(i);

              case v:
                if (B.match(g)) break;
                if (B == '"' || B == "'") {
                    h = B;
                    z = x;
                    break;
                }
                d.attrValue += B;
                z = w;
                break;

              case w:
                if (B.match(g)) {
                    z = u;
                    break;
                }
                if (B == "]") {
                    z = l;
                    break;
                }
                if (B == "'" || B == '"') throw Error(i);
                d.attrValue += B;
                break;

              case x:
                if (B == h) {
                    z = u;
                    break;
                }
                d.attrValue += B;
                break;

              case y:
                if (B.match(g)) break;
                if (B == ",") {
                    z = j;
                    break;
                }
                throw Error(i);
            }
        }
        switch (z) {
          case j:
          case k:
          case l:
          case n:
          case y:
            e();
            break;

          default:
            throw Error(i);
        }
        if (!b.length) throw Error(i);
        function C(a) {
            return '"' + a.replace(/"/, '\\"') + '"';
        }
        b.forEach(function(a) {
            var b = a.tagName.toUpperCase();
            if (a.tagName != b) a.caseInsensitiveTagName = b;
            var c = a.tagName;
            a.qualifiers.forEach(function(a) {
                if (a.class) c += "." + a.attrValue; else if (a.id) c += "#" + a.attrValue; else {
                    var b = a.attrName.toLowerCase();
                    if (a.attrName != b) a.caseInsensitiveAttrName = b;
                    if (a.contains) c += "[" + a.attrName + "~=" + C(a.attrValue) + "]"; else {
                        c += "[" + a.attrName;
                        if (a.hasOwnProperty("attrValue")) c += "=" + C(a.attrValue);
                        c += "]";
                    }
                }
            });
            a.selectorString = c;
        });
        return b;
    }
    var u = /^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;
    function v(a) {
        if (typeof a != "string") throw Error("Invalid request opion. attribute must be a non-zero length string.");
        a = a.trim();
        if (!a) throw Error("Invalid request opion. attribute must be a non-zero length string.");
        if (!a.match(u)) throw Error("Invalid request option. invalid attribute name: " + a);
        return a;
    }
    function w(a) {
        if (!a.trim().length) throw Error("Invalid request option: elementAttributes must contain at least one attribute.");
        var b = {};
        var c = {};
        var d = a.split(/\s+/);
        for (var e = 0; e < d.length; e++) {
            var f = d[e];
            if (!f) continue;
            var f = v(f);
            if (b.hasOwnProperty(f.toLowerCase())) throw Error("Invalid request option: observing multiple case varitations of the same attribute is not supported.");
            c[f] = true;
            b[f.toLowerCase()] = true;
        }
        return Object.keys(c);
    }
    function x(a) {
        var b = {
            callback: true,
            queries: true,
            rootNode: true,
            observeOwnChanges: true
        };
        var c = {};
        for (var d in a) {
            if (!(d in b)) throw Error("Invalid option: " + d);
        }
        if (typeof a.callback !== "function") throw Error("Invalid options: callback is required and must be a function");
        c.callback = a.callback;
        c.rootNode = a.rootNode || document;
        c.observeOwnChanges = a.observeOwnChanges;
        if (!a.queries || !a.queries.length) throw Error("Invalid options: queries must contain at least one query request object.");
        c.queries = [];
        for (var e = 0; e < a.queries.length; e++) {
            var f = a.queries[e];
            if (f.all) {
                if (Object.keys(f).length > 1) throw Error("Invalid request option. all has no options.");
                c.queries.push({
                    all: true
                });
                continue;
            }
            if (f.hasOwnProperty("attribute")) {
                var g = {
                    attribute: v(f.attribute)
                };
                g.elementFilter = t("*[" + g.attribute + "]");
                if (Object.keys(f).length > 1) throw Error("Invalid request option. attribute has no options.");
                c.queries.push(g);
                continue;
            }
            if (f.hasOwnProperty("element")) {
                var h = Object.keys(f).length;
                var g = {
                    element: f.element,
                    elementFilter: t(f.element)
                };
                if (f.hasOwnProperty("elementAttributes")) {
                    g.elementAttributes = w(f.elementAttributes);
                    h--;
                }
                if (h > 1) throw Error("Invalid request option. element only allows elementAttributes option.");
                c.queries.push(g);
                continue;
            }
            if (f.characterData) {
                if (Object.keys(f).length > 1) throw Error("Invalid request option. characterData has no options.");
                c.queries.push({
                    characterData: true
                });
                continue;
            }
            throw Error("Invalid request option. Unknown query request.");
        }
        return c;
    }
    function y(a) {
        var b = {};
        a.forEach(function(a) {
            a.qualifiers.forEach(function(a) {
                if (a.class) b["class"] = true; else if (a.id) b["id"] = true; else b[a.attrName] = true;
            });
        });
        return Object.keys(b);
    }
    function z(a) {
        var b = {
            childList: true,
            subtree: true
        };
        var c;
        function d(a) {
            if (b.attributes && !c) return;
            b.attributes = true;
            b.attributeOldValue = true;
            if (!a) {
                c = undefined;
                return;
            }
            c = c || {};
            a.forEach(function(a) {
                c[a] = true;
                c[a.toLowerCase()] = true;
            });
        }
        a.forEach(function(a) {
            if (a.characterData) {
                b.characterData = true;
                b.characterDataOldValue = true;
                return;
            }
            if (a.all) {
                d();
                b.characterData = true;
                b.characterDataOldValue = true;
                return;
            }
            if (a.attribute) {
                d([ a.attribute.trim() ]);
                return;
            }
            if (a.elementFilter && a.elementFilter.some(function(a) {
                return a.className;
            })) d([ "class" ]);
            var c = y(a.elementFilter).concat(a.elementAttributes || []);
            if (c.length) d(c);
        });
        if (c) b.attributeFilter = Object.keys(c);
        return b;
    }
    function A(a, b, c) {
        a.elementFilter = c.elementFilter;
        a.filterCharacterData = c.characterData;
        var d = {
            target: b,
            type: "summary",
            added: [],
            removed: []
        };
        d.getOldParentNode = a.getOldParentNode.bind(a);
        if (c.all || c.element) d.reparented = [];
        if (c.all) d.reordered = [];
        a.getChanged(d);
        if (c.all || c.attribute || c.elementAttributes) {
            var e = c.attribute ? [ c.attribute ] : c.elementAttributes;
            var f = a.getAttributesChanged(e);
            if (c.attribute) {
                d.valueChanged = [];
                if (f[c.attribute]) d.valueChanged = f[c.attribute];
                d.getOldAttribute = function(b) {
                    return a.getOldAttribute(b, c.attribute);
                };
            } else {
                d.attributeChanged = f;
                if (c.elementAttributes) {
                    c.elementAttributes.forEach(function(a) {
                        if (!d.attributeChanged.hasOwnProperty(a)) d.attributeChanged[a] = [];
                    });
                }
                d.getOldAttribute = a.getOldAttribute.bind(a);
            }
        }
        if (c.all || c.characterData) {
            var g = a.getCharacterDataChanged();
            d.getOldCharacterData = a.getOldCharacterData.bind(a);
            if (c.characterData) d.valueChanged = g; else d.characterDataChanged = g;
        }
        if (d.reordered) d.getOldPreviousSibling = a.getOldPreviousSibling.bind(a);
        return d;
    }
    function B(a) {
        var b = false;
        var d = x(a);
        var e = z(d.queries);
        var f = d.rootNode;
        var g = d.callback;
        var h = Array.prototype.concat.apply([], d.queries.map(function(a) {
            return a.elementFilter ? a.elementFilter : [];
        }));
        if (!h.length) h = undefined;
        var i = d.queries.some(function(a) {
            return a.all;
        });
        var j = [];
        if (B.createQueryValidator) {
            j = d.queries.map(function(a) {
                return B.createQueryValidator(f, a);
            });
        }
        function k() {
            j.forEach(function(a) {
                if (a) a.recordPreviousState();
            });
        }
        function l(a) {
            j.forEach(function(b, c) {
                if (b) b.validate(a[c]);
            });
        }
        function m(a) {
            if (!a || !a.length) return [];
            var b = new q(f, h, i);
            b.processMutations(a);
            return d.queries.map(function(a) {
                return A(b, f, a);
            });
        }
        function n(a) {
            return a.some(function(a) {
                var b = [ "added", "removed", "reordered", "reparented", "valueChanged", "characterDataChanged" ];
                if (b.some(function(b) {
                    return a[b] && a[b].length;
                })) return true;
                if (a.attributeChanged) {
                    var c = Object.keys(a.attributeChanged).some(function(b) {
                        return a.attributeChanged[b].length;
                    });
                    if (c) return true;
                }
                return false;
            });
        }
        var o = new c(function(a) {
            if (!d.observeOwnChanges) o.disconnect();
            var c = m(a);
            l(c);
            if (d.observeOwnChanges) k();
            if (n(c)) g(c);
            if (!d.observeOwnChanges && b) {
                k();
                o.observe(f, e);
            }
        });
        this.reconnect = function() {
            if (b) throw Error("Already connected");
            o.observe(f, e);
            b = true;
            k();
        };
        this.disconnect = function() {
            if (!b) throw Error("Not connected");
            var a;
            if (typeof o.takeRecords == "function") a = o.takeRecords(); else console.log("Warning: MutationObserver.takeRecords not implemented. Current changes cannot be reported.");
            o.disconnect();
            b = false;
            var c = m(a);
            if (n(c)) return c;
        };
        this.reconnect();
    }
    a.MutationSummary = B;
    a.MutationSummary.NodeMap = g;
    a.MutationSummary.parseElementFilter = t;
})(this);

PP.backend._Logs = PP.Class.extend({
    debug: false,
    suppressLogsInDevMode: false,
    flushDelay: 5e3,
    cache: null,
    isOffline: false,
    disabled: false,
    initialize: function() {
        var a = this;
        this.googleEventCount = 0;
        if (window) {
            window.addEventListener("offline", function(b) {
                a.isOffline = true;
            });
            window.addEventListener("online", function(b) {
                a.isOffline = false;
                PP.Utils.defer(function() {
                    a.flushCache();
                }, 10 * 1e3);
            });
        } else {
            this.disabled = true;
        }
    },
    disableAllLogging: function() {
        this.disabled = true;
    },
    sendToWebApp: function(a) {
        if (!this.webappCache) {
            this.webappCache = [];
        }
        this.webappCache.push(a);
        window.clearTimeout(this.webappTimeout);
        this.webappTimeout = window.setTimeout(PP.Utils.bind(this.flushToWebApp, this), 1e3);
    },
    flushToWebApp: function() {
        var a = this.webappCache;
        this.webappCache = [];
        PP.Msg.sendMessage({
            fn: "logToGoogleAnalytics",
            args: [ {
                logs: a
            } ]
        });
    },
    googleAnalytics: function(a) {
        if (PP.Globals.isBackgroundPage()) {
            this.sendToWebApp(a);
            return;
        }
        if (!window.ga) {
            return;
        }
        if (this.googleEventCount > 500 && !this.loggedGoogleQuota) {
            this.loggedGoogleQuota = true;
            PP.log({
                type: "error",
                subtype: "Google Analytics quota exceeded",
                msg: "Exceeded the per-session analytics quota of 500 hits"
            });
        }
        if (a.timingOnly) {
            this.logTiming(a);
            return;
        }
        var b = {};
        b.eventCategory = a.type;
        b.eventAction = a.subtype;
        if (a.msg) {
            b.eventLabel = a.msg;
        }
        if (a.duration) {
            b.eventValue = Math.floor(a.duration);
        }
        if (a.eventValue) {
            b.eventValue = Math.floor(a.eventValue);
        }
        ga("send", "event", b);
        this.googleEventCount++;
    },
    mixpanel: function(a) {
        if (!window.mixpanel) return;
        var b;
        if (a.mp) {
            b = a.mp;
        } else {
            return;
        }
        properties = a.mpProperties || {};
        properties.site = PP.backend.Settings.getSetting("site") || "NA";
        properties.email = PP.backend.Settings.getSetting("google_email") || "NA";
        var c = mixpanel.track(b, properties);
    },
    logTiming: function(a) {
        if (!window.ga) return;
        var b = {};
        b.timingCategory = a.type;
        b.timingVar = a.subtype;
        b.timingLabel = a.msg;
        b.timingValue = a.duration;
        ga("send", "timing", b);
        this.googleEventCount++;
    },
    preprocess: function(a) {
        if (!this.userAgentInfo) {
            if (window && window.UAParser) {
                var b = new UAParser();
                this.userAgentInfo = b.getResult();
                if (this.userAgentInfo) {
                    delete this.userAgentInfo.engine;
                    delete this.userAgentInfo.device;
                    this.userAgentInfo.webappVersion = window.PP_WEBAPP_VERSION;
                    this.userAgentInfo.extensionVersion = window.PP_EXTENSION_VERSION;
                }
            }
        }
        if (!a.userAgent) {
            a.userAgent = {};
        }
        if (this.userAgentInfo) {
            PP.Utils.merge(a.userAgent, this.userAgentInfo);
        }
        var c = PP.Session.get("user_id");
        var d = PP.Session.get("google_email");
        var e = PP.Session.get("google_name");
        if (c) a.userAgent.user_id = c;
        if (d) a.userAgent.google_email = d;
        if (e) a.userAgent.google_name = e;
        if (a.pub && !a.authorYearIncluded) {
            var f = PP.library.Publication.formatAuthorYearLink(a.pub);
            if (!a.msg) {
                a.msg = f;
            } else {
                a.msg = a.msg + " (" + f + ")";
            }
            a.authorYearIncluded = true;
            a.pub = this.getBasicLogInfo(a.pub);
        }
        if (a.collection) {
            var e = a.collection.cName;
            var g = a.collection.collectionType;
            a.msg = (a.msg || "") + " (" + g + ' "' + e + '")';
        }
        if (a.anonymous) {
            PP.Utils.merge(a.userAgent, {
                browser: {
                    version: "[anonymous]"
                },
                google_email: "[anonymous]",
                user_id: "[anonymous]",
                user_ip: "[anonymous]",
                google_name: "[anonymous]"
            });
        }
        a.user_timestamp = Date.now() / 1e3;
        return a;
    },
    log: function(a) {
        if (this.disabled === true) {
            return;
        }
        if (!a.userAgent) {
            a.userAgent = {};
            a.userAgent.windowId = window.PP_WINDOW_ID;
        }
        if (PP.Globals.isTestEnvironment()) {
            return;
        }
        if (PP.Globals.isContentScript() || PP.Globals.isDocsPlugin() || PP.Globals.isPopupView() || PP.Globals.isUploadIframe() || PP.Globals.isAttachmentContentScript() || PP.Globals.isPdfIframe()) {
            this.logToBackgroundPage(a);
            return;
        }
        if (PP.Globals.hasNoUserInfo()) {
            console.log("NO user info -- NOT logging!");
            return;
        }
        this.googleAnalytics(a);
        this.mixpanel(a);
        if (!a.type) {
            return;
        }
        if (PP.Globals.isDev() && this.suppressLogsInDevMode) {
            return;
        }
        if (PP.Globals.isBackgroundPage()) {
            if (!PP.bg.LoginState.loggedIn) {
                console.log("%c Not logged in -- skipping Logging!", e1());
                return;
            }
        }
        this.c.log(">>>>  logging ", a.type, PP.Utils.keySummary(a));
        a = this.preprocess(a);
        if (a.type == "exception") {
            console.log("Paperpile Exception (" + a.subtype + "): " + a.msg);
        } else if (a.type == "error") {
            console.log("Paperpile Error (" + a.subtype + "): " + a.msg);
        }
        if (this.cache === null) {
            this.cache = [];
            this.flushTimeout = window.setTimeout(PP.Utils.bind(this.flushCache, this), this.flushDelay);
        } else {
            window.clearTimeout(this.flushTimeout);
            this.flushTimeout = window.setTimeout(PP.Utils.bind(this.flushCache, this), this.flushDelay);
        }
        this.cache.push(PP.Utils.clone(a));
    },
    getBasicLogInfo: function(a) {
        var b = {};
        var c = [ "_id", "arxivid", "autocompleted", "crawl_urls", "doi", "incomplete", "journal", "kind", "owner", "pmc", "pmid", "pubtype", "source.match_plugin", "source.match_strategy", "source.pdf_crawl_error", "source.pdf_crawl_status", "source.pdf_web_url", "source.plugin", "source.type", "source.webimport_plugin", "subfolders", "title", "url" ];
        c.forEach(function(c) {
            var d = PP.Utils.getPath(a, c);
            if (d) {
                PP.Utils.setPath(b, c, d);
            }
        });
        if (a.author) {
            var d = PP.library.Author.toString(a.author);
            b.authorList = d;
        }
        return b;
    },
    logToBackgroundPage: function(a) {
        a = this.preprocess(a);
        PP.Msg.sendMessage({
            fn: "sendLogs",
            args: [ {
                logs: [ a ]
            } ]
        });
    },
    flushToBackgroundPage: function() {
        var a = this.cache;
        if (a && a.length > 0) {
            PP.Msg.sendMessage({
                fn: "sendLogs",
                args: [ {
                    logs: a
                } ]
            });
            this.cache = [];
        }
    },
    flushCache: function() {
        var a = this;
        var b = this.cache;
        if (this.isOffline) {
            console.log("Offline, not attempting to flush cache");
            return;
        }
        if (!b || b.length === 0) {
            return;
        }
        var c = {};
        var d = [];
        for (var e = 0; e < b.length; e++) {
            var f = b[e];
            var g = f.type + f.subtype + f.msg;
            if (c[g]) {
                c[g]++;
            } else {
                c[g] = 1;
                d.push(f);
            }
        }
        for (var e = 0; e < d.length; e++) {
            var f = d[e];
            var h = c[f.type + f.subtype + f.msg];
            if (h && h > 1) {
                f.msg += " (" + h + " times)";
            }
        }
        this.cache = null;
        d.forEach(function(a) {
            delete a.authorYearIncluded;
        });
        var i = {
            action: "insert",
            mcollection: "Logs",
            data: d
        };
        var j = {
            query: PP.Utils.encode(i)
        };
        PP.Ajax.request({
            url: PP.Globals.url("/ajax/crud/query"),
            params: j,
            method: "POST",
            noErrorStatusPanel: true,
            callback: function(b, c, e) {
                if (c !== "success") {
                    a.c.error("  Error flushing log objects to the server", c);
                } else {
                    a.c.log("  flushed " + d.length + " log objects to the server");
                }
            }
        });
    }
});

PP.backend.Logs = new PP.backend._Logs();

PP.log = function(a) {
    PP.backend.Logs.log(a);
};

PP.cs.ImportWidget = PP.Class.extend({
    pub: null,
    plugin: null,
    pubId: null,
    tabId: null,
    el: null,
    status: "",
    pdfStatus: "",
    align: "left",
    debug: false,
    initializeTimestamp: undefined,
    initialize: function(a) {
        var b = this;
        PP.Utils.apply(this, a);
        this.pubId = this.pub._id;
        this.initializeTimestamp = new Date().getTime();
        var c = this.pub;
        PP.backend.Publications.registerPubForUpdates(c);
        PP.backend.Publications.on("pubupdate", this.onUpdate, this);
        this.el = $("<div/>", {
            class: "pp-webimport-container" + " " + this.getExtraClasses()
        }).css({
            position: "relative"
        });
        this.el.tipsy({
            title: "importWidgetTip",
            delegate: ".pp-webimport-buttonpiece",
            cancelEvent: false,
            fade: false,
            gravity: $.fn.tipsy.autoNS,
            html: true
        });
        this.button = $("<div/>", {
            id: "webimport-" + c._id,
            class: "pp-webimport-button pp-webimport-buttonpiece"
        }).css({
            display: "inline-block",
            position: "absolute",
            top: 0,
            left: 0,
            "z-index": 99
        });
        this.button.appendTo(this.el);
        this.pdf = $("<div/>", {
            id: "webimport-pdf-" + c._id,
            class: "pp-webimport-pdf pp-webimport-buttonpiece"
        }).css({
            display: "inline-block",
            position: "absolute",
            top: 1,
            left: 0
        });
        this.pdf.appendTo(this.el);
        this.text = $("<span>Paperpile</span>");
        this.text.appendTo(this.button);
        if (this.plugin) {
            this.plugin.positionWidget(c, this, this.el);
        } else {
            this.el.css({
                display: "block",
                position: "relative"
            });
        }
        this.button.on("click", PP.Utils.bind(this.onClick, this));
        this.pdf.on("click", PP.Utils.bind(this.onPdfClick, this));
        this.setStatus("ready");
        this.setPdfStatus("ready");
        PP.Msg.on("message", this.onMessage, this);
        this.updateStatus();
    },
    getExtraClasses: function() {
        return "";
    },
    destroy: function() {
        this.button.off("mouseover");
        this.button.off("mouseout");
        this.button.off("hover");
        this.button.off("click");
        this.pdf.off("click");
        PP.Msg.un("message", this.onMessage, this);
        PP.backend.Publications.un("pubupdate", this.onUpdate, this);
        PP.backend.Publications.unregisterPubFromUpdates(this.pub);
        this.pdf.remove();
        this.button.remove();
        this.el.remove();
    },
    setPub: function(a) {
        var b = this.pub;
        PP.backend.Publications.unregisterPubFromUpdates(b);
        PP.backend.Publications.registerPubForUpdates(a);
        this.pub = a;
        this.updateStatus();
    },
    onUpdate: function(a) {
        var b = a.pubId;
        if (b === this.pubId) {
            this.updateStatus();
        }
    },
    onMessage: function(a) {},
    forceUpdateStatus: function() {
        this.updateStatus(true);
    },
    updateStatus: function(a) {
        var b = this;
        var c = this.pub;
        if (PP.cs.App && PP.cs.App.isLoggedOut) {
            this.setStatus("loggedout", true);
            return;
        }
        if (a === undefined) {
            a = false;
        }
        if (c.source.webimport_status === "success") {}
        if (c.source.webimport_status === "exists") {
            this.setStatus("exists", a);
        } else {
            if (c.source.webimport_status) {
                if (!b.isSliding) {
                    this.setStatus(c.source.webimport_status, a);
                } else {}
            }
            if (c.source.pdf_crawl_status) {
                if (!b.isSliding) {
                    this.setPdfStatus(c.source.pdf_crawl_status, a);
                } else {
                    PP.Utils.defer(function() {
                        if (!b.isSliding) {
                            b.setPdfStatus(c.source.pdf_crawl_status, a);
                        }
                    }, 500);
                }
            }
        }
        this.realign();
    },
    onPdfClick: function(a) {
        var b = this.getPub();
        switch (this.pdfStatus) {
          case "success":
          case "exists":
            PP.Msg.sendMessage({
                fn: "viewPubPdf",
                args: [ {
                    pub: b
                } ],
                tabId: this.tabId
            });
            break;
        }
        a.stopPropagation();
    },
    onClick: function(a) {
        a.stopPropagation();
        var b = this.getPub();
        switch (this.status) {
          case "loggedout":
            PP.Msg.sendMessage({
                fn: "requestPopupLogin"
            });
            break;

          case "ready":
            if (this.clickedReadyOnce) {
                break;
            }
            this.clickedReadyOnce = true;
            PP.Msg.sendMessage({
                fn: "importWebImportPub",
                args: [ b ],
                tabId: this.tabId
            });
            this.el.tipsy.showDelegate(this.button[0]);
            break;

          case "error":
            PP.Msg.sendMessage({
                fn: "logWebImportError",
                args: [ b ],
                tabId: this.tabId
            });
            this.el.tipsy.showDelegate(this.button[0]);
            break;

          case "timeout":
            PP.Msg.sendMessage({
                fn: "resetAndImportWebImportPub",
                args: [ b ],
                tabId: this.tabId
            });
            this.el.tipsy.showDelegate(this.button[0]);
            break;

          case "working":
            break;

          case "success":
            var c = [ b._id ];
            var d = this.getAuthorYear();
            PP.Msg.sendMessage({
                fn: "triggerViewPubs",
                args: [ {
                    ids: c,
                    label: d,
                    showAbstract: true
                } ]
            });
            break;

          case "exists":
            var c = [ b._id ];
            var d = this.getAuthorYear();
            PP.Msg.sendMessage({
                fn: "triggerViewPubs",
                args: [ {
                    ids: c,
                    label: d,
                    showAbstract: true
                } ]
            });
            break;
        }
    },
    shouldSlidePdf: function(a, b) {
        if (this.status === "exists") {
            return false;
        }
        if (a === "ready" && b === "success") {
            return true;
        } else if (a == "" && b === "success") {
            return true;
        } else {
            return false;
        }
    },
    slidePdf: function() {
        var a = this;
        if (a.isSliding) {
            return;
        }
        a.isSliding = true;
        var b = $(a.button).position().left;
        var c = $(a.button).outerWidth();
        a.pdfToBack();
        a.pdf.css({
            left: b + c - 20
        });
        a.pdf.show();
        a.realign();
        b = $(a.button).position().left;
        c = $(a.button).outerWidth();
        var d = c / 7;
        a.pdf.animate({
            left: b + c + d
        }, {
            duration: 250,
            easing: "swing",
            queue: false,
            complete: function() {
                a.pdfToFront();
                b = $(a.button).position().left;
                c = $(a.button).outerWidth();
                a.pdf.animate({
                    left: b + c - 5
                }, {
                    duration: 200,
                    easing: "swing",
                    queue: false,
                    complete: function() {
                        a.isSliding = false;
                        a.realign();
                    }
                });
            }
        });
    },
    pdfToBack: function() {
        var a = this.button.css("z-index");
        this.pdf.css({
            "z-index": a - 1
        });
    },
    pdfToFront: function() {
        var a = this.button.css("z-index");
        this.pdf.css({
            "z-index": a + 1
        });
    },
    showPdf: function() {
        if (!this.isSliding) {
            this.pdfToFront();
        }
        var a = [ "pp-ready", "pp-working", "pp-success", "pp-error" ];
        this.pdf.toggleClass(a.join(" "), false);
        this.pdf.toggleClass("pp-" + this.pdfStatus, true);
        var b = $(this.button[0]).position().left;
        var c = $(this.button[0]).outerWidth();
        if (!this.isSliding) {
            this.pdf.css({
                left: b + c - 5
            });
            this.pdf.show();
        }
    },
    isPdfVisible: function() {
        return this.pdf.is(":visible");
    },
    handlePdfStatusJump: function() {
        var a = new Date().getTime();
        if (a - this.initializeTimestamp < 100) {
            var b = this;
            PP.Utils.defer(function() {
                b.showPdf();
            }, 100);
            this.showPdf();
            return true;
        } else {
            return false;
        }
    },
    setPdfStatus: function(a, b) {
        var c = this.getPub();
        var d = PP.library.Publication.getPdfAttachment(c);
        if (d) {
            a = "success";
            if (a === "ready") {
                this.pdf.hide();
            }
        }
        if (b === undefined) {
            b = false;
        }
        if (a === "" || a === undefined) {
            a = "ready";
        }
        if (a === this.pdfStatus && a !== "downloading" && a !== "working" && a !== "saving" && b !== true) {
            return;
        }
        this.c.log("  PDF status to ", a);
        var e = this.pdfStatus;
        this.pdfStatus = a;
        var f = [ "pp-ready", "pp-working", "pp-downloading", "pp-saving", "pp-success", "pp-restricted", "pp-error", "pp-exists" ];
        this.pdf.toggleClass(f.join(" "), false);
        var g = a.match(/(proxyrestricted|loginrequired)/i) ? "restricted" : a;
        this.pdf.toggleClass("pp-" + g, true);
        switch (a) {
          case "ready":
            this.pdf.hide();
            break;

          case "working":
            var h = this.pub.source.pdf_crawl_current_url;
            var i = PP.Utils.getDomainSuffix(h);
            if (PP.crawling.Proxy.isLoginUrl(h)) {
                i = "Connecting to proxy";
            }
            if (e === "ready") {
                var j = this.handlePdfStatusJump();
                if (!j) {
                    this.slidePdf();
                }
            }
            this.setPdfTooltip("Searching for PDF...<br/>" + i);
            break;

          case "downloading":
            if (e === "ready") {
                this.handlePdfStatusJump();
                this.showPdf();
            }
            var k = "Downloading PDF";
            var l = this.pub.source.pdf_download_percent;
            if (l !== undefined) {
                l = l * 100;
                l = Math.round(l);
                k = "Downloading PDF (" + l + "%)";
            }
            this.setPdfTooltip(k);
            break;

          case "saving":
            var k = "Saving file";
            this.setPdfTooltip(k);
            break;

          case "success":
            PP.Utils.defer(function() {
                this.showPdf();
                this.setPdfTooltip("Click to open PDF");
            }, 1, this);
            break;

          case "exists":
            this.showPdf();
            this.setPdfTooltip("Click to open PDF");
            break;

          case "restricted":
            var m = this.pub.source.pdf_crawl_error;
            this.setPdfTooltip("Access to this PDF is restricted.");
            break;

          case "proxyrestricted":
            var m = this.pub.source.pdf_crawl_error;
            this.setPdfTooltip("Access is restricted and you are not logged in to your proxy.");
            break;

          case "loginrequired":
            var m = this.pub.source.pdf_crawl_error;
            this.setPdfTooltip("Access to this PDF requires login with a free account on the publisher's site.");
            break;

          case "error":
            var m = this.pub.source.pdf_crawl_error;
            this.setPdfTooltip("Error finding PDF.");
            break;
        }
    },
    setStatus: function(a, b) {
        if (a === undefined) {
            throw new Error("Undefined import status!");
        }
        this.c.log("Set status", a);
        if (a === "working" || a == "parsing_pdf") {
            b = true;
        }
        if (a === this.status && !b) {
            return;
        }
        var c = [ "ready", "parsing_pdf", "working", "success", "exists" ];
        var d = c.indexOf(this.status);
        var e = c.indexOf(a);
        var f = false;
        if (a == "error" || a == "reporting" || a == "reported" || a == "timeout" || a == "loggedout") {
            f = true;
        }
        if (!f && d > e) {
            console.log("Not following order, returning!", this.status, a);
            return;
        }
        this.status = a;
        this.c.log("  status to ", a);
        var g = [ "pp-ready", "pp-working", "pp-success", "pp-error", "pp-reporting", "pp-reported", "pp-timeout", "pp-exists", "pp-loggedout" ];
        this.button.toggleClass(g.join(" "), false);
        this.button.toggleClass("pp-" + a, true);
        this.el.toggleClass(g.join(" "), false);
        this.el.toggleClass("pp-" + a, true);
        switch (a) {
          case "loggedout":
            this.setText("Sign in");
            this.setTooltip("You are signed out of Paperpile.<br/>Click to sign in.");
            break;

          case "ready":
            this.setText("Paperpile");
            this.setTooltip("Add to Paperpile");
            break;

          case "parsing_pdf":
            this.setText("Analyzing...");
            this.setTooltip("Analyzing PDF...");
            break;

          case "working":
            this.setText("Importing...");
            var h = this.pub.source.webimport_current_url;
            var i = PP.Utils.getDomainSuffix(h);
            if (this.getPub().autocompleted) {
                this.setTooltip("Importing to Paperpile...<br/>" + i);
            } else {
                this.setTooltip("Searching for metadata...<br/>" + i);
            }
            break;

          case "importing":
            break;

          case "success":
            this.setText("Paperpile");
            var j = this.getAuthorYear();
            this.setTooltip(j + "<br/>successfully added.<br/>Click to view in Paperpile.");
            break;

          case "timeout":
            this.setText("Retry");
            var k = this.pub.source.webimport_error;
            this.setTooltip("Journal website is unresponsive.<br/>Click to retry.");
            break;

          case "error":
            this.setText("Report");
            var k = this.pub.source.webimport_error;
            this.setTooltip("Failed to find metadata.<br/>Click to report this error.");
            break;

          case "reporting":
            this.setText("Reporting...");
            this.setTooltip("Reporting error to Paperpile...");
            break;

          case "reported":
            this.setText("Reported");
            this.setTooltip("Thank you.<br/>This error has been reported.");
            break;

          case "exists":
            this.setText("Paperpile {ay}");
            var j = this.getAuthorYear();
            this.setTooltip(j + "<br/>Click to view in Paperpile.");
            var l = this.pub.source._existing_pub_data;
            if (l && PP.library.Publication.hasPdf(l)) {
                this.setPdfStatus("exists");
            }
            break;
        }
    },
    getPub: function() {
        var a = this.pub;
        if (this.status === "exists") {
            a = this.pub.source._existing_pub_data;
        }
        return a;
    },
    getAuthorYear: function() {
        var a = PP.library.Publication.formatAuthorYear(this.getPub(), {
            maxLength: 25
        });
        return a;
    },
    showAuthorYear: function() {
        this._showAuthorYear = true;
        this.refreshText();
    },
    refreshText: function() {
        this.setText(this._txt);
    },
    setText: function(a) {
        if (a === null || a === undefined) {
            a = "";
        }
        a = a.replace("...", "&hellip;");
        this._txt = a;
        var b = {
            ay: ""
        };
        if (this._showAuthorYear) {
            var c = this.getAuthorYear();
            b.ay = c;
        }
        a = PP.Utils.template(a, b);
        a = PP.Utils.ellipsis(a, 40, true, "...");
        this.text.html(a);
        if (this.pdfStatus === "success") {
            this.showPdf();
        }
        this.realign();
    },
    realign: function() {
        var a = this;
        var b = a.el.outerWidth();
        var c = a.button.outerWidth();
        var d = 0;
        if (this.isPdfVisible() || this.pdfStatus === "success" || this.pdfStatus === "exists") {
            d = a.pdf.outerWidth();
        }
        if (this.align === "center") {
            var e = b - (c + d - 5);
            if (e > 0) {
                buttonLeft = e / 2;
                a.button.css({
                    left: buttonLeft
                });
                if (this.isPdfVisible() && !this.isSliding) {
                    a.pdf.css({
                        left: buttonLeft + c - 5
                    });
                }
            }
        } else if (this.align === "right") {
            a.button.css({
                left: "",
                right: Math.max(0, d - 5)
            });
            if (this.isPdfVisible() && !this.isSliding) {
                a.pdf.css({
                    left: "",
                    right: 0
                });
            }
        } else if (this.alignment === "left") {}
    },
    setTooltip: function(a) {
        this._tooltip(this.button, a);
    },
    setPdfTooltip: function(a) {
        this._tooltip(this.pdf, a);
    },
    _tooltip: function(a, b) {
        var c = this;
        a.attr("importWidgetTip", b);
        var d = this.el.tipsy;
        var e = d.isShown || d.hoverState === "in";
        if (e && d.delegatedEl && d.delegatedEl.id === a[0].id) {
            PP.Utils.defer(function() {
                c.el.tipsy.showDelegate(a[0]);
            }, 50);
        }
    },
    hide: function() {
        this.button.hide();
    },
    show: function() {
        this.button.show();
    }
});

PP.cs.MutationWatcher = PP.Class.extend({
    includes: [ PP.Events ],
    rootNode: null,
    watch: function(a) {
        if (!PP.Utils.isArray(a)) {
            a = [ a ];
        }
        var b = [];
        a.forEach(function(a) {
            if (PP.Utils.isString(a)) {
                b.push({
                    element: a
                });
            } else {
                b.push(a);
            }
        });
        var c = {
            callback: PP.Utils.bind(this.onChange, this),
            queries: b
        };
        if (this.rootNode) {
            c.rootNode = this.rootNode;
        }
        var d = new MutationSummary(c);
        this.observer = d;
    },
    stopWatching: function() {
        if (this.observer) {
            this.observer.disconnect();
            delete this.observer;
        }
    },
    onChange: function(a) {
        for (var b = 0; b < a.length; b++) {
            var c = a[b];
            var d = c.added || [];
            var e = c.removed || [];
            var f = c.attributeChanged;
            var g = c.characterDataChanged || [];
            var h = false;
            if (d.length || e.length || g.length || f && Object.keys(f).length) {
                this.fire("anychange", {
                    selectorIndex: b
                });
            }
            d.forEach(function(a) {
                this.fire("added", {
                    element: a,
                    selectorIndex: b
                });
            }, this);
            e.forEach(function(a) {
                this.fire("removed", {
                    element: a,
                    selectorIndex: b
                });
            }, this);
            if (f) {
                for (var i in f) {
                    var j = f[i];
                    j.forEach(function(a) {
                        this.fire("modified", {
                            element: a,
                            selectorIndex: b,
                            attribute: i
                        });
                    }, this);
                }
            }
        }
    },
    destroy: function() {
        this.stopWatching();
    }
});

PP.pop.PaperpileButton = PP.Class.extend({
    includes: [ PP.Events ],
    el: null,
    debug: false,
    type: "injected",
    initialize: function(a) {
        PP.Utils.apply(this, a);
        var b = [];
        if (this.type === "popup") {
            b.push("pp-big");
        } else if (this.type === "attach") {
            b.push("pp-big");
            b.push("pp-attach");
        }
        this.el = $("<div/>", {
            class: "pp-webimport-container" + " " + b.join(" ")
        }).css({
            position: "relative"
        });
        this.button = $("<div/>", {
            class: "pp-webimport-button pp-webimport-buttonpiece pp-ready"
        }).css({
            display: "inline-block",
            position: "relative",
            top: 0,
            left: 0,
            "z-index": 99
        });
        this.button.appendTo(this.el);
        if (this.text) {
            this.text = $("<span>" + this.text + "</span>");
        } else {
            this.text = $("<span>Paperpile</span>");
        }
        this.text.appendTo(this.button);
        this.button.on("click", PP.Utils.bind(this.onClick, this));
        this.el.tipsy({
            delegate: ".pp-webimport-buttonpiece",
            fade: false,
            gravity: $.fn.tipsy.autoNS,
            title: "importWidgetTip",
            html: true
        });
        if (this.tooltip) {
            this.setTooltip(this.tooltip);
        } else {
            this.setTooltip("");
        }
    },
    hide: function() {
        this.el.hide();
    },
    show: function() {
        this.el.show();
    },
    destroy: function() {
        this.el.off("click");
        this.el.remove();
    },
    onClick: function(a) {
        a.stopPropagation();
        this.fire("click");
    },
    setText: function(a) {
        this.text.text(a);
    },
    setTooltip: function(a) {
        this._tooltip(this.button, a);
    },
    _tooltip: function(a, b) {
        a.attr("importWidgetTip", b);
        var c = this.el.tipsy;
        var d = c.isShown || c.hoverState === "in";
        if (d && c.delegatedEl && c.delegatedEl.id === a[0].id) {
            this.el.tipsy.showDelegate(a[0]);
        }
    }
});

PP.attach.PaperpileStatusBar = PP.Class.extend({
    includes: [ PP.Events ],
    el: null,
    contentEl: null,
    debug: true,
    text: null,
    closable: true,
    initialize: function(a) {
        PP.Utils.apply(this, a);
        this.el = $("<div/>", {
            class: "pp-status-panel-wrap pp-clear"
        });
        this.contentEl = $("<div/>", {
            class: "pp-status-panel"
        });
        this.contentEl.appendTo(this.el);
        this.logoEl = $("<div/>", {
            class: "pp-status-logo"
        });
        this.logoEl.appendTo(this.contentEl);
        this.textEl = $("<div/>", {
            class: "pp-status-text"
        });
        this.textEl.appendTo(this.contentEl);
        if (this.text) {
            this.setText(this.text);
        }
        this.closeEl = $('<div class="pp-status-dropdown-close"></div>');
        this.closeEl.appendTo(this.contentEl);
        this.setClosable(this.closable);
        this.closeEl.on("click", PP.Utils.bind(this.onCloseClick, this));
        var b = this;
        PP.Utils.defer(function() {
            b.reposition();
        }, 20);
    },
    reposition: function() {
        this.el.position({
            my: "bottom",
            at: "top",
            of: window,
            collision: "none"
        });
        this.el.animate({
            top: 0,
            left: 0
        }, 500, function() {});
    },
    onCloseClick: function() {
        this.el.hide();
    },
    setText: function(a) {
        this.text = a;
        this.textEl.html(a);
    },
    setClosable: function(a) {
        if (a) {
            this.closeEl.css("display", "inline-block");
        } else {
            this.closeEl.css("display", "none");
        }
    }
});

window.PP_WINDOW_ID = "attach";

var app = {
    handleRemovedElement: function(a) {
        var b = this;
        var c = $(a).find(".pp-webimport-container");
        var d = [];
        for (var e = 0; e < b.buttons.length; e++) {
            var f = b.buttons[e];
            if (f.el === c) {
                d.push(f);
            }
        }
        d.forEach(function(a) {
            PP.Array.remove(b.buttons, a);
        });
    },
    handlePdfResult: function(a) {
        var b = this;
        var c = $(a).find("a");
        var d;
        for (var e = 0; e < c.length; e++) {
            d = $(c[e]).attr("href");
            if (d && d.match("http")) {
                break;
            }
        }
        var f = new PP.pop.PaperpileButton({
            text: "Select PDF",
            url: d,
            el: a
        });
        f.el.addClass("pp-big");
        f.el.addClass("pp-search-attach");
        var g = PP.attach.App.pub;
        if (g) {
            var h = PP.library.Publication.formatAuthorYear(g);
            h = PP.Utils.ellipsis(h, 40, false, "...");
            f.setTooltip("Attach this PDF to<br/>" + h);
        }
        f.on("click", function(a) {
            b.onAttachClick(a);
        });
        $(f.el).css({
            position: "absolute",
            opacity: .2,
            left: -100,
            top: 22
        });
        $(a).css({
            position: "relative"
        });
        $(a).append(f.el);
        $(f.el).hover(function() {
            $(f.el).css({
                opacity: 1
            });
        }, function() {
            $(f.el).css({
                opacity: .2
            });
        });
        b.buttons.push(f);
    },
    onAttachClick: function(a) {
        var b = a.target;
        var c = b.url;
        var d = this.type;
        var e = "";
        if (d == "pdf") {
            e = "PDF from Google";
        } else if (d == "suppl") {
            e = "Supplementary file from publisher";
        } else if (d == "articlepdf") {
            e = "Article PDF from publisher";
        }
        PP.log({
            type: "event",
            subtype: "Attempt to attach " + e,
            msg: "User clicked to download and attach the file."
        });
        var f = PP.attach.App.pub;
        PP.Msg.sendMessage({
            fn: "attachFileToPub",
            args: [ {
                url: c,
                attachType: d,
                typeStr: e,
                closeTab: true,
                pubId: f._id
            } ]
        });
    },
    getItemSelectors: function() {
        return [ "span" ];
    },
    addEl: function(a, b) {
        if (!b) {
            return;
        }
        if ($(b).hasClass("pp-webimport-item")) {
            return;
        }
        $(b).addClass("pp-webimport-item");
        a.push(b);
    },
    createView: function() {
        var a = this;
        var b = this.type;
        a.buttons = [];
        if (b === "pdf") {
            var c = [];
            var d = 1;
            var e = $('li.g a[href*=".pdf"]');
            for (var f = 0; f < e.length; f++) {
                var g = e[f];
                var h = $(g).attr("href");
                var i = $(g).text();
                if (h.match(/(q=cache|q=related|q=share)/i) || i.match(/cached/i)) {
                    continue;
                }
                this.addEl(c, $(g).parents("div")[0]);
            }
            var j = $("span:contains('[PDF]')");
            for (var f = 0; f < j.length; f++) {
                var k = j[f];
                this.addEl(c, $(k).parent()[0]);
            }
            var l = $("cite:contains('pdf')");
            for (var f = 0; f < l.length; f++) {
                var m = l[f];
                var n = $(m).text();
                this.addEl(c, $(m).parents()[3]);
            }
            c.forEach(function(b) {
                a.handlePdfResult(b);
            });
            var o = new PP.cs.MutationWatcher();
            o.watch(this.getItemSelectors());
            o.on("added", PP.Utils.bind(function(b) {
                var c = b.element;
                if ($(c).text() === "[PDF]") {
                    a.handlePdfResult($(c).parent()[0]);
                }
            }, this));
            o.on("removed", PP.Utils.bind(function(b) {
                a.handleRemovedElement(b.element);
            }, this));
            var p = "";
            var q = this.pub;
            if (q) {
                var r = PP.library.Publication.formatAuthorYear(q);
                r = PP.Utils.ellipsis(r, 40, false, "...");
                p = [ "Searching for PDF", '<span class="pp-smaller">Click one of the <b>Select PDF</b> buttons to attach to ', '"' + r + '"', "</span>" ].join("");
            }
            this.status = new PP.attach.PaperpileStatusBar({
                text: p,
                closable: true
            });
            $("body").append(this.status.el);
            this.status.reposition();
        } else if (b === "suppl") {
            var s = [ "h1:contains('Supplementary information')" ];
            var t = [];
            s.forEach(function(a) {
                var b = $(a);
                if (b.length) {
                    t.push(b[0]);
                }
            });
            if (t.length) {
                PP.Utils.defer(function() {
                    $("body").animate({
                        scrollTop: $(t[0]).offset().top
                    }, 800);
                }, 50);
            }
            var p = "";
            var q = this.pub;
            if (q) {
                var r = PP.library.Publication.formatAuthorYear(q);
                r = PP.Utils.ellipsis(r, 40, false, "...");
                p = [ "Browse for supplementary files: ", '<span class="pp-smaller">Right-click on a link and choose <b>Paperpile -> Attach File to "', r, '"', "</b> to download to your library", "</span>" ].join("");
            }
            this.status = new PP.attach.PaperpileStatusBar({
                text: p,
                closable: true
            });
            $("body").append(this.status.el);
            this.status.reposition();
        } else if (b === "articlepdf") {
            var p = "";
            var q = this.pub;
            if (q) {
                var r = PP.library.Publication.formatAuthorYear(q);
                r = PP.Utils.ellipsis(r, 40, false, "...");
                p = [ "Browse journal website for PDF: ", '<span class="pp-smaller">Right-click on the PDF link and choose <b>Paperpile -> Attach File to "', r, '"', "</b> to download to your library", "</span>" ].join("");
            }
            this.status = new PP.attach.PaperpileStatusBar({
                text: p,
                closable: true
            });
            $("body").append(this.status.el);
            this.status.reposition();
        }
    },
    pub: null,
    type: null
};

PP.attach.App = app;

window.attachApp = app;

PP.Msg.listen();

PP.Msg.connectPort("background--" + window.location.href + "--" + PP.Msg.guid, true, "bg");

PP.Msg.handleAppFunctionMessages(app);

function init() {
    PP.Msg.on("message", function(a) {
        var b = a.msg;
        if (b.attachTabType) {
            console.log("Got attach tab type!");
            PP.attach.App.type = b.attachTabType;
            PP.attach.App.pub = b.pub;
            PP.attach.App.createView();
            PP.Msg.sendMessage({
                fn: "setWebAttachPub",
                args: [ {
                    pub: b.pub
                } ]
            });
        }
    });
}

if (/loaded|complete|interactive/.test(document.readyState)) {
    init();
} else {
    document.addEventListener("DOMContentLoaded", init);
}