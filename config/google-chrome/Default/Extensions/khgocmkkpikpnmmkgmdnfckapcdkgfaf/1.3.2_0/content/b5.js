const auto=null!==getURLParameter(location.search,"auto"),messages={"auto-sign-in-to-b5":handleAutoSignInToB5,"initialize-device":handleDeviceInit,lock:()=>{}};chrome.runtime.onMessage.addListener((e,n,t)=>e.name in messages&&(e.name,messages[e.name](e,t),!0));function isTrusted1PasswordDomain(){let e=window.location.hostname;if(!e)return!1;e=e.toLowerCase();const n=["1password.com","1password.eu","1password.ca","b5dev.com","b5test.com","b5staging.com","b5local.com"];for(let t of n)if(e===t||e.endsWith("."+t))return!0;return!1}function handleAutoSignInToB5(e){isTrusted1PasswordDomain()?document.dispatchEvent(new CustomEvent("B5InitializeSession",{detail:e.data})):console.warn("Was asked to initialize a session for an untrusted page:",window.location)}function handleDeviceInit(e){isTrusted1PasswordDomain()?document.dispatchEvent(new CustomEvent("B5InitializeDevice",{detail:e.data.device})):window.location}function closeNotification(e){const n=document.querySelector(`iframe[src="${e}"]`);n&&document.body.removeChild(n)}function showNotification(e){createNotification("b5x-notification",e)}function createNotification(e,n){let t=document.createElement("iframe");return t.id=e,n&&(t.src=n),document.body.appendChild(t),document.body.addEventListener("click",e=>{}),t}const spoofablePageEvents={B5WebReady:handleUntrustedB5Ready,B5SignInSucceeded:handleUntrustedB5SignInSucceeded};function handleUntrustedB5Ready(e){if(!isTrusted1PasswordDomain())return void console.warn("Received B5Ready event from an untrusted page:",window.location);let n=e.detail;n.capabilities.DeviceInit&&chrome.runtime.sendMessage({name:"b5Ready",data:{deviceInit:n.capabilities.DeviceInit,sessionInit:n.capabilities.SessionInit}})}function handleUntrustedB5SignInSucceeded(e){if(!isTrusted1PasswordDomain())return void console.warn("Received b5 signin event from an untrusted page:",window.location);let n=e.detail;n.signinAddress=window.location.origin;const t={name:"sign-in-succeeded",data:{details:n}};chrome.runtime.sendMessage(t),chrome.runtime.onMessage.addListener(e=>{"show-add-account-prompt"===e.name&&showNotification(e.data),"close-add-account-prompt"===e.name&&closeNotification(e.data)})}for(let e in spoofablePageEvents)document.addEventListener(e,spoofablePageEvents[e]);document.dispatchEvent(new CustomEvent("B5OPXReady",{bubbles:!1,cancelable:!1,detail:{capabilities:{CustomAutosave:!0,SessionInit:1,DeviceInit:1}}}));function getURLParameter(e,n){let t=e.match("[?&]"+n+"=([^&]+)");return t?t[1]:null}