webpackJsonp([4],{197:function(e,t,n){"use strict";function o(e){S=e;var t=E.default.htmlToElement(window.localHtml(P),!0);v=window.localHtml(V),_=window.localHtml(W),A.isXSmall()?$("#main-menu-drawer").find("#note-list-pos").replaceWith(t):S.$el.append(t),x=$("#note-list-col"),console.assert(x.length),r(),ue("Standard","Root",[])}function r(){function e(){var e=[];w.find(".note-item[left-checked]").each(function(t,n){var o=S.findLocalArticle(n.dataset.name);e.push(o)});var t=[],n=0;e.forEach(function(e){if("Folder"===e.type){var o=S.getAllArticlesInFolder(e.artName,!0,!1);n+=o.filter(function(e){return"Note"===e.type}).length,t=t.concat(o)}t.push(e),e._bDirectTrash=!0}),G=t;var o,r=e.filter(function(e){return"Note"===e.type}).length,i=e.filter(function(e){return"Folder"===e.type}).length;o=r&&!i?localString("delete_note_confirm",r):i&&!r?localString("delete_note_confirm_note_only",i,n):localString("delete_note_confirm_note_inside",r,i,n),$("#note-list-del-popover .msg").html(o),$("#note-list-del-popover").showModal()}function t(e,t){var n=$(e).hasClass(".note-item")?e:$(e).closest(".note-item")[0];if(!$(n).hasAttr("disabled")){var o=S.findLocalArticle(n.dataset.name);if("Standard"===t)if("All"===n.dataset.type)I.emit("All");else if("Note"===o.type){if(o===ar.curArticle)return void S.switchMainScreen("HomeMain");if(ar.bRecording)return void S.setInfoBarInfo(localString("sel_cancaled_by_recording"));ar.sinkInTimeSync(ar.curArticle),S.selectArticle(o).then(function(){L.default.updateKeywords(J)})}else I.emit(o.artName);else"Trash"===t||("All"===n.dataset.type?I.emit("All"):"Move"===t&&"Folder"===o.type&&I.emit(o.artName))}}function n(e,t){var n,o,r=S.findLocalArticle(e);return"All"===e?n="Root":"Trash"===e?(n="Root",o="Standard"):n=r.parentName?S.findLocalArticle(r.parentName).artName:null,o||(o="Trash"===t&&"Trash"!==n?"Standard":t),{folderName:n,mode:o}}function o(e){var t=$("#note-menu")[0].dataset.noteName,n=S.findLocalArticle(t);p(t);if("duplicate"===e){var o;o=S.getArtTitleShowName(n)+"("+localString("dupl_postfix")+")";for(var r=1;y.findWhere(ar.lsArticles,{artTitle:o,type:"Note",bTrash:!1});)o=S.getArtTitleShowName(n)+"("+localString("dupl_postfix")+" "+r+")",r++;var i=ar.tmpDir+"/~duplicated.micnote";E.default.showFullscreenWaiting(!0),N.resolve().then(function(){var e=S.getArtNum("Note");if(!S.checkNoteNum(e+1,!1))throw"out-of-note-num"}).then(function(){return D.b(n,i)}).then(function(){return D.d(i,n.parentName,o)}).then(function(e){return s(e.artName),S.selectArticle(e)}).finally(function(){E.default.showFullscreenWaiting(!1)}).catch(function(e){"out-of-note-num"!=e&&(E.default.toastShowLongCenter(localString("dupl_note_failed",E.default.getShowError(e)),"error"),log.fail(e))})}else"del"===e&&ee.emit([n])}function r(e){var t=$("#note-trash-menu")[0].dataset.noteName,n=S.findLocalArticle(t);p(t);if("restore"===e){var o=S.restoreTrashedArticle(n,!0);S.saveArticleList(),o?E.default.toastShowShortCenter(localString("trash_restore_success",S.getArtTitleShowName(n),S.getArtTitleShowName(o))):E.default.toastShowShortCenter(localString("common_failed"))}else if("del"==e){var r=S.getAllArticlesInFolder(n.artName,!0,!1,!0);r.push(n),y.reduce(r,function(e,t){return e.then(function(){return S.trashDeleteArticle(t)})},N())}}if(x.on("click",".list-standard-mode .action-edit",function(e){z.emit("Edit"),ar.settings.tips.bCreateFolder||oe.take(1).onValue(()=>{S.showPopoverTips($(".action-new-folder",x),{popPos:"bottom"},localString("note_list_tip_create_folder")),ar.settings.tips.bCreateFolder=!0,S.saveSettings()}),$("#input-search-note").attr("disabled","disabled")}),x.on("click",".list-edit-mode .action-done",function(e){z.emit("Standard"),$("#input-search-note").removeAttr("disabled")}),x.on("click",".list-edit-mode .action-del",function(t){e()}),x.on("click",".list-edit-mode .action-move",function(e){var t=[];w.find(".note-item[left-checked]").each(function(e,n){var o=S.findLocalArticle(n.dataset.name);t.push(o)}),U=t,z.emit("Move"),ar.settings.tips.bPasteFile||oe.take(1).onValue(()=>{S.showPopoverTips("#note-list-footer",{popPos:"top",width:"200px"},localString("paste_target_folder")),ar.settings.tips.bPasteFile=!0,S.saveSettings()})}),Kefir.combine([x.asStream("click","#note-list-footer .action-paste")],[j]).onValue(([e,t])=>{U.forEach(function(e){e.parentName=t,e.folderCommit=F.genCommitHash(),ne.emit(e)}),S.saveArticleList(),$("#note-list-footer .action-cancel").click();var n=w.find(".note-item"),o=U.map(function(e){return e.artName});n.each(function(e,t){-1!==o.indexOf(t.dataset.name)&&$(t).addAttr("active").attr("aria-selected","true")}),U=null}),x.on("click","#note-list-footer .action-cancel",function(e){z.emit("Edit")}),$("#sort-by").on("click",function(e){$("#sort-menu paper-item").toggleAttr("active",!1).attr("aria-checked","false"),$("#sort-menu paper-item[data-value="+q+"]").addAttr("active").attr("aria-checked","true")}),Kefir.combine([Kefir.fromJQEvents($("#sort-menu"),"click","paper-item")],[B,j]).onValue(([e,t,n])=>{q=e.currentTarget.dataset.value,ar.settings.sortType=q,S.saveSettings(),a(t,n)}),Kefir.combine([Kefir.fromEvents($("#input-search-note"),"focus")],[j]).onValue(([e,t])=>{e.currentTarget.value||(X=t)}),Kefir.combine([Kefir.fromEvents($("#input-search-note"),"input")],[B]).onValue(([e,t])=>{var n=L.default.parseKeywords(e.currentTarget.value);n.length?(a(t,"All",n),J=n):(a(t,X),J=null),L.default.updateKeywords(J)}),x.on("note-item-check-changed","#note-list-bar .note-item",function(e){var t=$("#note-list-bar .note-item[left-checked]").length;$(".list-edit-mode .action-del").toggleAttr("disabled",!t),$(".list-edit-mode .action-move").toggleAttr("disabled",!t)}),x.asStream("click","#note-list-header .action-new-folder").onValue(e=>{var t=O,n=S.newFolder({parentName:t,title:localString("new_folder_def_title")}),o=p(n.artName);s(n.artName),o[0].async(function(){this.nameAction()})}),x.on("note-item-change-name-finished","#note-list-bar .note-item.tb-editable",function(e){var t=e.target,n=S.findLocalArticle(t.dataset.name),o=e.originalEvent.detail;S.setArtTitle(n,o)}),Kefir.combine([x.asStream("note-item-body-action","#note-list-bar note-list-item-fixed")],[B]).onValue(([e,n])=>{var o=w.find(".note-item");Q=o.index(e.target),t(e.target,n)}),x.on("note-item-enter-folder","#note-list-bar note-list-item-editable",function(e){var t=this,n=S.findLocalArticle(t.dataset.name);I.emit(n.artName)}),x.on("keydown","#note-list-bar",function(e){if(38===e.keyCode||40===e.keyCode){var t=w.find(".note-item");t.length&&t[Q=38===e.keyCode?(Q+t.length-1)%t.length:(Q+1)%t.length].focus(),e.preventDefault()}else 27===e.keyCode&&w.focus()}),Kefir.combine([x.asStream("click","#note-list-header .action-back")],[B,j]).onValue(([e,t,o])=>{let{folderName:r,mode:i}=n(o,t);g(r,i)}),T("MobileApp")||T("FakeMobile")){let e=E.default.createTapHoldExplosionStream(x[0],{rippleColor:"#90A4AE",selector:"#note-list-header .action-new-note"}),t=e.filter(e=>!e),n=e.filter(e=>e);t.filter(()=>!(ar.settings.bVisitedHotPad&&!S.isRunTimeTipFinish("bFastStartRecording"))||(S.checkRunTimeTipWithPic("bFastStartRecording",localString("tip_fast_start_recording"),"./img/holdNewNoteButton.jpg",localString("tip_tap_and_hold")),!1)).onValue(()=>{h().then(()=>Y.emit())}),n.onValue(e=>{h({title:new E.default.DateFmt("%y-%m-%d_%H-%M-%S").format(new Date)}).then(()=>Z.emit())})}else{let e=x.asStream("click","#note-list-header .action-new-note");e.filter(e=>!e.shiftKey).onValue(e=>{ar.settings.bVisitedHotPad&&!S.isRunTimeTipFinish("bFastStartRecordingDesktop")?S.checkRunTimeTipWithPic("bFastStartRecordingDesktop",localString("tip_fast_start_recording_desktop"),"./img/holdNewNoteButton.jpg",localString("tip_shift_and_click")):h()});let t=e.filter(e=>e.shiftKey).flatMap(e=>{E.default.playClickExplosion(e.currentTarget,{explosionColor:"#90A4AE"});let t=new E.default.DateFmt("%y-%m-%d_%H-%M-%S").format(new Date);return Kefir.fromPromise(h({title:t}))});re.plug(t)}$("#note-list-del-popover .action-ok").on("click",function(e){te.emit(G)}),Kefir.combine([x.asStream("note-item-menu-action","#note-list-bar .note-item")],[j]).onValue(([e,t])=>{var n=$(e.target)[0].dataset.name,o=S.findLocalArticle(n);if(i(t)){var r=E.default.htmlToElement(_);r.dataset.noteName=n,r.togglerElem=_$("note-list-bar .note-item[data-name='"+n+"']"),E.default.insertModal(r),r.toggle()}else(r=E.default.htmlToElement(v)).dataset.noteName=n,null===o.noteCommit&&null===o.noteSyncCommit&&$(r).find("[data-name=duplicate]").addAttr("disabled"),r.togglerElem=_$("#note-list-bar .note-item[data-name='"+n+"']"),E.default.insertModal(r),r.toggle();$(e.currentTarget).find(".right-panel").attr("aria-expanded",!0)}),A.vars.$appBody.on("iron-overlay-closed","#note-menu, #note-trash-menu",function(e){p($(this)[0].dataset.noteName).find(".right-panel").attr("aria-expanded",!1)}),A.vars.$appBody.on("click","#note-menu paper-button",function(e){var t=$(this).parents("#note-menu"),n=this.dataset.name;t.hideModal(function(){o(n)})}),A.vars.$appBody.on("click","#note-trash-menu paper-button",function(e){var t=$(this).parents("#note-trash-menu"),n=this.dataset.name;t.hideModal(function(){r(n)})}),x.on("click",".list-trash-mode .action-empty",function(e){E.default.messageBoxPromise("",localString("trash_empty_msg"),{btnOk:!0,btnCancel:!0,okTitle:localString("trash_empty")}).then(function(e){if("Ok"===e)return E.default.showFullscreenWaiting(!0),S.emptyTrash().then(function(){E.default.toastShowShortCenter(localString("common_success"))}).finally(function(){E.default.showFullscreenWaiting(!1)})})}),Kefir.combine([Kefir.merge([S.syncer.artFolderChanged,ne])],[B,j]).onValue(([e,t,n])=>{a(t,n)}),Kefir.combine([Kefir.fromEvents(M.a,"UI_onArtListChanged")],[B,j]).onValue(([e,t,n])=>{a(t,n)}),M.a.addListener("onRecordStarted",function(){x.find(".action-new-note").toggleAttr("disabled",!0)}),M.a.addListener("onRecordStopped",function(){x.find(".action-new-note").toggleAttr("disabled",!1)}),M.a.addListener("onFetchingNoteProgress",function(e){var t=e.artName,n=p(t);if(n.length)if("start"===e.type)n[0].setFetching(!0);else if("end"===e.type){n[0].setFetching(!1);S.findLocalArticle(t);n[0].unfetched=!1}else"failed"===e.type?n[0].setFetching(!1):n[0].setProgress(e.loaded,e.total)}),M.a.addListener("onNoteCached",function(e){console.assert(!S.isNoteOnCloudOnly(e));var t=p(e.artName);t.length&&(t[0].unfetched=!1)}),A.isXSmall()&&x.on("click",".list-standard-mode .action-menu",function(){f()}),Kefir.combine([ar.artTrashedStream],[ar.curArtProp]).map(([e,t])=>{var n,o=w.find(k.sprintf(".note-item[data-name=%s]",e.artName));if(!A.isXSmall()&&t===e){if(o.length){for(n=o.last()[0].nextSibling;n&&"Folder"===n.dataset.type;)n=n.nextSilbing;n||(n=w.find(k.sprintf(".note-item[data-type='Note']:not([data-name='%s'])",e.artName))[0])}else n=w.find(".note-item[data-type='Note']")[0];n||(n=null)}return n?n.dataset.name:null}).debounce(100).onValue(e=>{if(e){var t=S.findLocalArticle(e);S.selectArticle(t)}else S.selectArticle(null)}),Kefir.combine([Kefir.merge([ar.artDeletedStream,ar.artTrashedStream])],[B,I]).onValue(([e,t,n])=>{S.findLocalArticle(n);e.artName===n?I.emit("Root"):a(t,n,J)}),Kefir.combine([ar.artRestoredStream],[B,I]).onValue(([e,t,n])=>{a(t,n,J)}),Kefir.combine([ar.newArtStream],[B,I]).onValue(([e,t,n])=>{a(t,n,J)}),ar.curArtStream.onValue(e=>{w.find(".note-item").removeAttr("active").attr("aria-selected","false");var t;if(e){var n=w.find(".note-item[data-name="+e.artName+"]");n.length&&(t=n[0],$(t).addAttr("active").attr("aria-selected","true"))}}),Kefir.combine([z,I]).debounce(100).onValue(([e,t])=>{console.assert(ar.rootArticle),se(e),a(e,t),de(e),oe.emit()});let l=Kefir.merge([ar.artTitleChanged,ar.artDateChanged]);if(Kefir.combine([l],[B,j]).flatMap(([e,t,n])=>e.parentName===n||"All"===n?Kefir.constant([e,t,n]):Kefir.never()).onValue(([e,t,n])=>{w.find(".note-item[data-name="+e.artName+"]").length&&(a(t,n,J),e!=ar.curArticle&&s(e.artName))}),(T("AndroidApp")||T("FakeMobile"))&&Kefir.combine([ar.backButtonOnNoteList],[j]).onValue(([e,t])=>{var n=_$("#main-menu-drawer");n&&"drawer"===n.selected?f(!1):"Root"!==t?$("#note-list-header .action-back").click():K.handleExitByBackBtn()}),j.onValue(e=>{O="All"===e||"Trash"===e?"Root":e}),T("ChromeApp")&&!T("FakeMobile")){x.asStream("dragstart","#note-list-bar .note-item").onValue(e=>{e.originalEvent.dataTransfer.setData("note-name",e.currentTarget.dataset.name)}),x.asStream("dragover","#note-list-bar .note-item[data-type=Folder]").onValue(e=>{e.preventDefault()}),Kefir.combine([x.asStream("dragover","#note-list-header .action-back")],[j]).onValue(([e,t])=>{t!==e.originalEvent.dataTransfer.getData("note-name")&&"All"!==t&&"Trash"!==t&&null==e.currentTarget.getAttribute("disabled")&&e.preventDefault()});let e=Kefir.combine([x.asStream("drop","#note-list-header .action-back")],[B,j]).map(([e,t,o])=>{let{folderName:r}=n(o,t);return[e,r]});Kefir.merge([x.asStream("drop","#note-list-bar .note-item[data-type=Folder]").map(e=>[e,e.currentTarget.dataset.name]),e]).onValue(([e,t])=>{e.preventDefault();let n=e.originalEvent.dataTransfer.getData("note-name"),o=S.findLocalArticle(n);o&&(o.parentName=t,o.folderCommit=F.genCommitHash(),S.saveArticleList(),ne.emit(o))})}if(!A.isXSmall()){x.css("width",ar.settings.noteListWidth);let e=$("#note-list-dragging-bar").asStream("mousedown").flatMap(e=>{let t=ar.settings.noteListWidth,n=Kefir.fromEvents(document,"mousemove").takeWhile(e=>1===e.which).takeUntilBy(Kefir.fromEvents(document,"mouseup")).flatMap(n=>{let o=n.pageX-e.pageX,r=t+o;return r=Math.max(200,r),(r=Math.min(600,r))!==ar.settings.noteListWidth?Kefir.constant(r):Kefir.never()});return Kefir.concat([Kefir.later(0,{name:"start"}),n.map(e=>({name:"resizing",width:e})),Kefir.later(0,{name:"end"})])});e.onValue(e=>{if("resizing"===e.name)x.css("width",e.width),ar.settings.noteListWidth=e.width,S.saveSettings();else if("start"===e.name){var t=$("<div/>").html("<div id='resizing-backdrop' class='resize-col'></div>").children()[0];A.vars.$appBody.append(t)}else"end"===e.name&&$("#resizing-backdrop").remove()}),ie.plug(e.filter(R.propEq("name","resizing")).map(R.prop("width")))}}function i(e){console.assert(e);return"All"!==e&&("Trash"===e||S.findLocalArticle(e).bTrash)}function a(e,t,n){console.assert(t),Q=-1;var o=i(t);l(e,t,null!=n,R.compose(ae(n),le(o),ce(t))(ar.lsArticles))}function l(e,t,n,o){ue(e,t,o);var r;n?(r=localString("search_result"),$("#note-list-header .action-back").attr("disabled","")):"All"===t?(r=localString("all_notes"),$("#note-list-header .action-back").removeAttr("disabled")):"Trash"===t?(r=localString("trash_folder_name"),$("#note-list-header .action-back").removeAttr("disabled")):"Root"!=t?(r=S.findLocalArticle(t).artTitle,$("#note-list-header .action-back").removeAttr("disabled")):(r=localString("common_app_name"),$("#note-list-header .action-back").attr("disabled","")),$("#folder-name").text(r),n?$("#note-list-header .action-new-note").toggleAttr("disabled",!0):($("#note-list-header .action-new-folder").toggleAttr("disabled","All"===t||"Trash"===t),$("#note-list-header .action-new-note").toggleAttr("disabled","All"===t||"Trash"===t),$("#note-list-footer .action-paste").toggleAttr("disabled","All"===t||"Trash"===t),"Edit"===e&&($(".list-edit-mode .action-del").toggleAttr("disabled",!0),$(".list-edit-mode .action-move").toggleAttr("disabled",!0))),$("#note-list-footer .action-edit").toggleAttr("disabled",n),"Trash"===e&&c(),ar.settings.lastFolderName!==t&&(ar.settings.lastFolderName=t,S.saveSettings())}function c(){var e=w.find(".note-item").length;$(".list-trash-mode .action-empty").toggleAttr("disabled",0===e)}function s(e){console.assert("static"!==w.css("position"));var t=p(e),n=t.position().top,o=t[0].offsetTop,r=w.height(),i=t.outerHeight(),a=(w.find(".note-item").length,w.find(".tip-item"));a.length&&a.height();var l;if(n+i>r?l=r-i:n<0&&(l=0),void 0!==l){var c=o-l;w.scrollTop(c)}}function d(e){Kefir.combine([Kefir.later(0,e)],[B]).onValue(([e,t])=>{a(t,e.parentName),y.delay(function(){s(e.artName)})})}function u(e,t){if(e&&"All"!==e.type){if(t&&"All"!==t.type){if(e.type!==t.type)return"Note"===e.type?1:-1;if("Name"===q){var n=S.getArtTitleShowName(e).toLowerCase(),o=S.getArtTitleShowName(t).toLowerCase();return n>o?1:n<o?-1:t.mDate.getTime()-e.mDate.getTime()}return"ModifiedDate"===q?t.mDate.getTime()-e.mDate.getTime():t.cDate.getTime()-e.cDate.getTime()}return 1}return-1}function p(e){return w.find(k.sprintf(".note-item[data-name='%s']",e))}function m(){return x}function f(e){console.assert(A.isXSmall()),void 0===e?_$("#main-menu-drawer").togglePanel():e?_$("#main-menu-drawer").openDrawer():_$("#main-menu-drawer").closeDrawer()}function h(e){var t=y.defaults(e||{},{title:""});if(ar.bRecording)return S.setInfoBarInfo("Recording, operation was canceled..."),N.reject();var n=Object.create(H.a);return n.create(),S.doNewNote({bCheckNoteNum:!0,parentName:O,title:t.title,ldoc:n}).then(function(e){return s(e.artName),S.selectArticle(e)},function(e){throw"out-of-note-num"!=e&&log.fail(e),e})}function g(e,t){console.assert(t),"Trash"===e?(console.assert("Trash"===t),z.emit("Trash"),I.emit("Trash")):(z.emit(t),I.emit(e))}function b(){return O}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return o}),n.d(t,"updateListForStream",function(){return a}),n.d(t,"getJQElement",function(){return m}),n.d(t,"toggleMainMenu",function(){return f}),n.d(t,"makeNoteVisible",function(){return d}),n.d(t,"cmdNewNote",function(){return h}),n.d(t,"enterFolder",function(){return g}),n.d(t,"editModeByNewNote",function(){return Y}),n.d(t,"editModeByTapHoldNewNote",function(){return Z}),n.d(t,"fastRecordingDesktop",function(){return re}),n.d(t,"delNoteStream",function(){return ee}),n.d(t,"delSeledArticlesStream",function(){return te}),n.d(t,"getCurFolderNameForNewArt",function(){return b}),n.d(t,"widthResized",function(){return ie});var v,_,S,x,w,y=n(19),k=(n.n(y),n(23)),N=(n.n(k),n(20)),A=(n.n(N),n(8)),T=n(6),M=(n.n(T),n(92)),E=n(22),F=n(21),D=(n.n(F),n(100)),C=(n(91),n(7)),K=(n.n(C),n(134)),L=n(104),H=n(101),P=n(198),V=(n.n(P),n(199)),W=(n.n(V),n(200));n.n(W);let z=new Kefir.Bus,B=z.toProperty(()=>"Standard"),O="Root",I=new Kefir.Bus,j=I.toProperty(()=>"Root");var G,U,X,J,Q,q=ar.settings.sortType||"Name";let Y=new Kefir.Bus,Z=new Kefir.Bus,ee=new Kefir.Bus,te=new Kefir.Bus,ne=new Kefir.Bus,oe=new Kefir.Bus,re=Kefir.pool(),ie=Kefir.pool();var ae=function(e){return e?R.filter(function(t){for(var n=S.getArtTitleShowName(t).toLowerCase(),o=t.ldoc?E.default.stripHtmlTags(t.ldoc.getTextHtmlContent()).toLowerCase():"",r=0;r<e.length;r++)if(-1===n.indexOf(e[r])&&-1===o.indexOf(e[r]))return!1;return!0}):R.identity()},le=function(e){return R.filter(t=>t.bTrash==e)},ce=function(e){return"All"===e||"Trash"===e?R.identity():R.filter(t=>t.parentName===e)},se=(e=>{function t(e){return s("div#note-list-header.app-nav.layout.horizontal.center-justified",{style:"order:0;"},[s("label#folder-name",[]),s("paper-icon-button.action-back",{icon:"bs:circle-arrow-left",title:"Back to parent folder",tabindex:"1"},[]),c("Standard"===e,"paper-icon-button.action-new-note.list-standard-mode",{icon:"bs:file",title:r("note_list_new_note_tip")+r("hk_new_note")},[]),c("Edit"===e,"paper-icon-button.action-new-folder.list-edit-mode",{icon:"moon:folder",title:r("note_list_new_folder_tip")},[])])}let n,o,{lt:r,lh:i,attrV:a,attrB:l,hIf:c,h:s,diff:d,patch:u,create:p}=E.default.vDomUtils;return e=>{if(n){var r=t(e),i=d(n,r);o=u(o,i),n=r}else n=t(e),o=p(n),$("#note-list-header-pos").replaceWith(o)}})(),de=(()=>{function e(e){return"Standard"===e?t():"Edit"===e?n():"Move"===e?o():"Trash"===e?r():void 0}function t(){return p("div.list-standard-mode",{style:{width:"100%"}},[p("div.layout.horizontal.center.justified",[p("paper-icon-button.action-edit",{icon:"bs:edit",title:"Enter note list edit mode"},[]),u(A.isXSmall(),"div.text-center",[p("paper-icon-button#sync",{icon:"bs:refresh",title:"Sync"},[]),p("paper-icon-button#show-slient-error",{icon:"report-problem",title:l("slient_error_title"),style:{color:"darkred",display:"none"}},[])]),u(A.isXSmall(),"x-icon-button.action-menu",{icon:"bs:align-justify",title:"Main Menu",style:{"max-height":"50px"},attributes:{"aria-haspopup":"true"}},[])])])}function n(){return p("div.list-edit-mode",{style:{width:"100%"}},[p("div.layout.horizontal.center.justified",[p("paper-button.action-done.text-primary",{attributes:{title:"Finish note list edit mode"}},[l("note_list_done")]),p("paper-button.action-move",{attributes:{title:"Move selected items to other folder",disabled:""}},[l("note_list_move")]),p("paper-button.action-del",{attributes:{title:"Delete selected items",disabled:"","aria-haspopup":"true"}},[l("note_list_delete")])])])}function o(){return p("div.list-move-mode",{style:{width:"100%"}},[p("div.layout.horizontal.center.justified",[p("paper-button.action-paste.text-primary",{title:"Paste items into current folder"},[l("note_list_paste")]),p("paper-button.action-cancel",{title:"Cancel"},[l("note_list_cancel")])])])}function r(){return p("div.list-trash-mode",{style:{width:"100%"}},[p("div.layout.horizontal.center.justified",[p("paper-button.action-empty.text-primary",{title:l("trash_empty_tip")},[l("trash_empty")])])])}let i,a,{lt:l,lh:c,attrV:s,attrB:d,hIf:u,h:p,diff:m,patch:f,create:h}=E.default.vDomUtils;return t=>{if(i){var n=e(t),o=m(i,n);a=f(a,o),i=n}else i=e(t),a=h(i),$("#note-list-footer").append(a)}})(),ue=(()=>{function e(e,t,i){let a=m("div#note-list-bar.flex",{style:{position:"relative",order:2,role:"listbox",tabindex:"0"},attributes:{"aria-label":l("aria_note_list_bar")}},[]);if("Root"===t&&a.children.push(r(e)),i.forEach(function(n){let r=o(n,e,t);r&&a.children.push(r)}),"All"!==t&&"Trash"!==t){let t=n(e);a.children.push(t)}return a}function t(e){A.isXSmall()&&(e.propperties||(e.propperties={}),e.propperties.noink="")}function n(e){var t;return t="Standard"===e?localString("note_list_tip_item_note"):"Edit"===e?localString("note_list_tip_item_folder"):"",m("div.tip-item",{attributes:{style:"height: 60px; padding: 15px 10px;text-align:center;color:rgb(161, 161, 161);text-shadow: 0px 1px 0px rgba(255,255,255,.5)","aria-hidden":!0},role:"presentation",innerHTML:t,key:"tip-item"})}function o(e,n,o){if(console.assert(void 0!==o),"All"===o){if(e.bTrash||"Note"!==e.type)return!1}else if("Trash"==o){if(!e.bTrash)return}else if(o!=e.parentName)return!1;let r;if("Note"===e.type){a=i=S.getArtTitleShowName(e),t(r=m("Edit"===n?"note-list-item-editable.note-item":"note-list-item-fixed.note-item",{showName:i,realName:e.artTitle,dataset:{name:e.artName,type:"Note"},title:a,ariaSelected:"true",ariaNoteMenu:localString("aria_note_menu"),ariaRename:localString("aria_rename"),unfetched:S.isNoteOnCloudOnly(e),bTrash:e.bTrash,noteType:"Note",key:e.artName,attributes:{}}))}else{console.assert("Folder"===e.type);var i=S.getArtTitleShowName(e),a=i;t(r=m("Edit"===n?"note-list-item-editable.note-item":"note-list-item-fixed.note-item",{showName:i,realName:e.artTitle,dataset:{name:e.artName,type:"Folder"},title:a,ariaRename:localString("aria_rename"),bTrash:e.bTrash,noteType:"Folder",key:e.artName,attributes:{}}))}{let t="CreatedDate"===q?localString("aria_created_date"):localString("aria_modified_date"),n="CreatedDate"===q?E.default.makeShortDateStr(e.cDate):E.default.makeShortDateStr(e.mDate),o=S.getArtTitleShowName(e);"Note"===e.type?(r.properties.attributes["aria-label"]=o+","+t+":"+n+","+localString("aria_note"),r.properties.date=n):"Folder"===e.type&&(r.properties.attributes["aria-label"]=o+","+t+":"+n+","+localString("aria_folder"),r.properties.date=n)}"Edit"===n&&(r.properties.className+=" tb-editable"),"Standard"===n&&"Trash"!==o&&"All"!==o&&(r.properties.draggable=!0);return r.properties.noink=!0,"Move"===n?("Note"===e.type&&(r.properties.attributes.disabled=""),-1!==U.indexOf(e)&&(r.properties.attributes.disabled="",r.properties.attributes.active="",r.properties.attributes["aria-selected"]=!0)):"Standard"===n&&ar.curArticle===e&&(r.properties.attributes.active="",r.properties.attributes["aria-selected"]=!0),r}function r(e){let n=m("note-list-item-fixed.note-item",{showName:localString("all_notes"),realName:localString("all_notes"),attributes:{"aria-label":localString("all_notes")+","+localString("aria_folder"),disabled:d("Move"===e)},dataset:{name:"All",type:"All"},title:localString("all_notes"),date:E.default.makeShortDateStr(new Date),noteType:"All"});return t(n),n}let i,a,{lt:l,lh:c,attrV:s,attrB:d,hIf:p,h:m,diff:f,patch:h,create:g}=E.default.vDomUtils;return(t,n,o)=>{let r=R.sort(u,o);if(i){var l=e(t,n,r),c=f(i,l);a=h(a,c),i=l}else i=e(t,n,r),a=g(i),x.find("#note-list-bar-pos").replaceWith(a);w=$(a)}})()},198:function(e,t){e.exports='<div id="note-list-col">\n  <div class="layout vertical layout-start" style="height:100%">\n    <div id="search-bar" class="layout horizontal center" style="order:1">\n      <x-dropdown-button>\n        <x-icon-button id="sort-by" slot="x-dropdown-trigger" icon="bs:align-justify" class="" title="Change list order" aria-haspopup="true" tabindex="0">\n        </x-icon-button>\n        <paper-listbox id="sort-menu" class="dropdown" role="radiogroup">\n          <div class="x-dropdown-header">{=note_list_sort_by=}</div>\n          <paper-item class="action-by-name active" data-value="Name" role="radio">\n            {=note_list_sort_name=}\n          </paper-item>\n          <paper-item class="action-by-modified-date" data-value="ModifiedDate" role="radio">\n            {=note_list_sort_mdate=}\n          </paper-item>\n          <paper-item class="action-by-created-date"  data-value="CreatedDate" role="radio">\n            {=note_list_sort_cdate=}\n          </paper-item>\n        </paper-listbox>\n      </x-dropdown-button>\n      <input id="input-search-note" style="font-size:16px" type="search" placeholder="{=search_in_all_notes=}" title="{=search_in_all_notes=}" class="flex" >\n      </input>\n      <iron-icon icon="bs:search" style="color:gray; margin-left: 4px" role="presentation"></iron-icon>\n    </div>\n    \x3c!-- <div id="node-list-search" >       --\x3e\n    \x3c!-- </div>     --\x3e\n    <div id="note-list-bar-pos"></div>\n    <div class="x-shadow" elevation="{=rt_mobile_shadow_z=}" style="margin-bottom:2px">\n      <div id="note-list-header-pos"></div>\n    </div>\n    <div id="note-list-footer" class="app-nav layout vertical center-justified" style="order:3;">\n    </div>\n    <div id="sync-info-bar" class="xsmall-only alert alert-warning" style="display:none;position:absolute; bottom:50px;left:0px;width:100%;margin:0;height:52px;z-index:2">\n      \x3c!-- <button type="button" class="close" style="font-size: 40px;top: -13px;position: relative;"> --\x3e\n      \x3c!--   <span aria-hidden="true">&times;</span> --\x3e\n      \x3c!--   <span class="sr-only">Close</span> --\x3e\n      \x3c!-- </button> --\x3e\n      <span></span>\n    </div>\n  </div>\n  <div id="note-list-dragging-bar" style="width:4px;position:absolute;top:0;bottom:0;right:0;cursor:col-resize;">\n  </div>\n</div>\n'},199:function(e,t){e.exports='<x-popover id="note-menu" pop-pos="bottom" auto-remove {=rt_xs_backdrop=} aria-label="{=aria_esc_to_close=}">\n  <div class="layout horizontal center">\n    <paper-button data-name="duplicate" >\n      <iron-icon icon="moon:copy" class="std-icon-size" role="presentation"></iron-icon>\n      <div>{=note_list_dupl=}</div>\n    </paper-button>\n    <paper-button data-name="del" class="text-danger" >\n      <iron-icon icon="bs:trash" class="std-icon-size" role="presentation"></iron-icon>\n      <div>{=common_delete=}</div>\n    </paper-button>\n  </div>\n</x-popover>\n'},200:function(e,t){e.exports='<x-popover id="note-trash-menu" pop-pos="bottom" auto-remove {=rt_xs_backdrop=} aria-label="{=aria_esc_to_close=}">\n  <div class="layout horizontal center">\n    <paper-button data-name="restore" >\n      <iron-icon icon="restore" class="std-icon-size" role="presentation"></iron-icon>\n      <div>{=trash_restore=}</div>\n    </paper-button>\n    <paper-button data-name="del" >\n      <iron-icon icon="bs:remove" class="std-icon-size" role="presentation"></iron-icon>\n      <div>{=common_delete=}</div>\n    </paper-button>\n  </div>\n</x-popover>\n'},201:function(e,t,n){"use strict";function o(e){(d=e).createPrintableHtml=i,s=window.localHtml(w)}function r(e){if("Disk"===e){t=S.create(d);S.showExportNoteWnd(t)}else if("GDrive"===e){t=x.a(d,_.gdrive);x.b(t)}else if("Dropbox"===e){var t=x.a(d,_.dropboxStd);x.b(t)}else y.error("Unsupported source:",e)}function i(e,t,o,r){var i,a;return m.resolve().then(function(){let t=r;var n=d.editorUtil.genEditorHtml(d,e.ldoc,d.getNoteDir(e),t,"small",700,!0);if(o){var i=document.createElement("div");return i.innerHTML=n,d.editorUtil.embedImages($(i)).then(function(){return i.innerHTML})}return n}).then(function(e){var t=m.defer();return n.e(5).then(function(o){i=n(204),a=n(205),t.resolve(e)}.bind(null,n)).catch(n.oe),t.promise}).then(function(n){var o=m.defer();return $.when($.get("css/editor.css")).done(function(l){let c=localHtml(a);c=localHtml(c,{rt_title:d.getArtTitleShowName(e),rt_content:n,rt_footnote:ar.commits.accountType===ar.AT_Pro?"":localString("exported_note_footnote")});var s=document.createElement("div");s.innerHTML=c,r||($(s).find("#abm-list-col").remove(),$(s).find(".line-editor").css("padding-left","4px")),function(){c=s.innerHTML;var n;n=t?c:localHtml(i,{rt_editor_css:l,rt_title:d.getArtTitleShowName(e),rt_body:c}),o.resolve(n)}()}),o.promise})}function a(e,t,o,r){var i,a;let l="Full"===t;return m.resolve().then(function(){if("Full"===t||"NoteOnly"===t){let t=l;return d.editorUtil.genEditorHtml(d,e.ldoc,d.getNoteDir(e),t,"middle",700,!1,o)}return""}).then(function(e){var t=m.defer();return n.e(6).then(function(){var o=[n(206),n(207)];(function(n,o){i=n,a=o,t.resolve(e)}).apply(null,o)}).catch(n.oe),t.promise}).then(function(t){var n=m.defer();return $.when($.get("css/editor.css")).done(function(o){let c=localHtml(a);c=localHtml(c,{rt_title:d.getArtTitleShowName(e),rt_update_date:g.default.makeShortDateStr(new Date),rt_content:t,rt_app_link:v.shareLinkAppLink,rt_app_link_name:localString("exported_note_footnote"),rt_font_size_name:"middle"});var s=document.createElement("div");s.innerHTML=c,l||($(s).find("#abm-list-col").remove(),$(s).find(".line-editor").css("padding-left","4px")),r||$(s).find("#wave-view").remove(),c=s.innerHTML,c=localHtml(c,{rt_audio_src:r});let u=localHtml(i,{rt_editor_css:o,rt_title:d.getArtTitleShowName(e),rt_body:c});n.resolve(u)}),n.promise})}function l(e){var t=s;t=window.localHtml(t,{rt_header:e.header||localString("export_menu_def_header")});var n=g.default.htmlToElement(t,!0);$("#export-to-menu").remove(),g.default.insertModal(n),n.togglerElem=$(e.toggler)[0],n.open();var o,r=m.defer(),i=$(n);return i.on("iron-activate",function(e){var t=e.originalEvent.detail.item;o=t.dataset.value,e.preventDefault(),i.hideModal()}),i.on("iron-overlay-closed",function(){o?r.resolve(o):r.reject()}),r.promise}function c(e){l({toggler:e}).then(function(e){r(e)})}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return o}),n.d(t,"cmdExportNote",function(){return c}),n.d(t,"createShareLinkHtml",function(){return a});var s,d,u=n(19),p=(n.n(u),n(23)),m=(n.n(p),n(20)),f=(n.n(m),n(8)),h=n(6),g=(n.n(h),n(22)),b=n(21),v=(n.n(b),n(91),n(7)),_=(n.n(v),n(92),n(93),n(94)),S=n(105),x=n(202),w=(n(97),n(203)),y=(n.n(w),log.reg("share"));console.assert(!f.isXSmall()||$("#xs-note-menu paper-item").length),$("#xs-note-menu").on("iron-activate",function(e){var t=e.originalEvent.detail.item;t.classList.contains("export-note-source")&&(u.delay(function(){r(t.dataset.value)},100),e.preventDefault())})},202:function(e,t,n){"use strict";function o(e,t){$("#modal-export-note").remove();var n=window.localHtml(b),o=$(u.default.htmlToElement(n,!0));o.find(".text-title").text(localString("export_cloud_title",t.showName)),o.find(".action-open-gdrive").text(localString("export_cloud_open_web",t.showName)),u.default.clearCloudElements(o,t.source);var r={$el:o,home:e,cp:t,$panelMain:$(".panel-gdrive",o),$panelExp:$(".panel-export",o),xSlider:$("x-slider",o)[0]};return i(r),r}function r(e){e.exportSettings=l.defaults(ar.settings.exports[e.cp.source]||{},{bMicnote:!0,bRecording:!1,bPdf:!1,bGDoc:!1,bHtml:!1,exportFolderPath:"/",folderId:"root",bWithAbm:!0}),ar.settings.exports[e.cp.source]=e.exportSettings,e.home.$el.append(e.$el),$(".check-micnote",e.$panelMain).checked(e.exportSettings.bMicnote),$(".check-recording",e.$panelMain).checked(e.exportSettings.bRecording),$(".check-pdf",e.$panelMain).checked(e.exportSettings.bPdf),$(".check-gdoc",e.$panelMain).checked(e.exportSettings.bGDoc),$(".check-html",e.$panelMain).checked(e.exportSettings.bHtml),$(".check-with-abm",e.$panelMain).checked(e.exportSettings.bWithAbm),$(".text-folder",e.$panelMain).text(e.exportSettings.exportFolderPath).get(0).title=e.exportSettings.exportFolderPath,a(e),e.$el[0].toggle()}function i(e){function t(){function t(t){$(".progress-bar",e.$panelExp)[0].value=0,$(".text-prog",e.$panelExp).html("&nbsp;")}function o(t,n){if(n){var o=t/n;$(".progress-bar",e.$panelExp)[0].value=100*o;r=c.sprintf("%.2fM / %.2fM",t/1024/1024,n/1024/1024);$(".text-prog",e.$panelExp).text(r)}else{var r=c.sprintf("%.2fM / *",t/1024/1024);$(".text-prog",e.$panelExp).text(r),$(".progress-bar",e.$panelExp)[0].indeterminate=!0}}function i(t){"progress"===t.name?o(t.loaded,t.total):"cancel-handler"===t.name&&(e.cancelHandler=t.handler)}var a=ar.curArticle,l=e.exportSettings.folderId,d=s.resolve();if(e.exportSettings.bMicnote){var m=r.getArtTitleShowName(a)+".micnote";d=d.then(function(){if(e.bCanceled)throw"cancel";return _.info(v,"start export micnote: ",a.artTitle),n("Exporting <strong>"+m+"</strong>..."),t(),h.c(e.cp,r,a,null,l,i)})}if(e.exportSettings.bRecording){var f=p.getExtension(a.audioName).toLowerCase(),g=r.getArtTitleShowName(a)+"."+f;d=d.then(function(){if(e.bCanceled)throw"cancel";return _.log(v,"start export rec: ",a.artTitle),n("Exporting <strong>"+g+"</strong>..."),t(),h.e(e.cp,r,a,null,l,i)})}if(e.exportSettings.bPdf&&(d=d.then(function(){if(e.bCanceled)throw"cancel";return _.log(v,"start export pdf: ",a.artTitle),n("Converting to PDF..."),t(),h.d(e.cp,r,a,null,l,i,function(e){n(e)},e.exportSettings.bWithAbm)})),e.exportSettings.bGDoc&&(d=d.then(function(){if(e.bCanceled)throw"cancel";return _.log(v,"start export gdoc: ",a.artTitle),n("Converting to Google Doc..."),t(),h.a(e.cp,r,a,null,l,i,function(e){n(e)},e.exportSettings.bWithAbm)})),e.exportSettings.bHtml){var b=r.getArtTitleShowName(a)+".html";d=d.then(function(){if(e.bCanceled)throw"cancel";return _.log(v,"start export html: ",a.artTitle),n("Exporting  <strong>"+b+"</strong>..."),t(),h.b(e.cp,r,a,null,l,i,e.exportSettings.bWithAbm)})}d.then(function(){n(localString("gdrive_exported_succeed")),$(".progress",e.$panelExp).hide(),$(".action-open-gdrive",e.$panelExp).show(),$(".action-close",e.$panelExp).removeAttr("disabled"),$(".action-cancel-exp",e.$panelExp).hide()},function(e){"cancel"===e||e&&"cancel"===e.appName?log.log("canceled"):(_.fail(v,e),n(localString("gdrive_exported_failed",u.default.getShowError(e))))})}function n(t){$(".text-status",e.$panelExp).html(t),r.setStableInfo("ExportCloud",t)}var o=e.$el,r=e.home,i=e.$panelMain;$(".action-close",o).on("click",function(){r.saveSettings(),o.hideModal()}),$(".panel-gdrive .action-sel-folder",o).on("click",function(){var t=f.b(e.cp,e.xSlider,e.$panelMain,r,{bSelectFolder:!0,bFolderOnly:!0,bMultiSel:!1,bCancelable:!0});f.c(t,function(t,n){if("Ok"===t){var o=n[0];e.exportSettings.exportFolderPath=o.path,e.exportSettings.folderId=o.fid,"root"===o.fid&&(e.exportSettings.exportFolderPath="/"),$(".text-folder",i).text(e.exportSettings.exportFolderPath).get(0).title=e.exportSettings.exportFolderPath}})}),$(".action-export",i).on("click",function(){e.exportSettings.bMicnote=$(".check-micnote",o).checked(),e.exportSettings.bRecording=$(".check-recording",o).checked(),"GDrive"===e.cp.source&&(e.exportSettings.bPdf=$(".check-pdf",o).checked(),e.exportSettings.bGDoc=$(".check-gdoc",o).checked()),e.exportSettings.bHtml=$(".check-html",o).checked(),e.exportSettings.bWithAbm=$(".check-with-abm",o).checked(),e.xSlider.slide("main","export",!0,function(){t()})}),$(".action-cancel-exp",e.$panelExp).on("click",function(){e.bCanceled=!0,e.cancelHandler&&(e.cancelHandler(),e.cancelHandler=null),o.hideModal(),u.default.toastShowShortCenter(localString("operation_canceled"))}),$(".action-open-gdrive",e.$panelExp).on("click",function(){var t=e.exportSettings.folderId;u.default.viewCloudFolderOnWeb(e.cp.source,t)}),$("paper-checkbox",i).on("change",function(){a(e)})}function a(e){e.exportSettings.bMicnote=$(".check-micnote",e.$el).checked(),e.exportSettings.bRecording=$(".check-recording",e.$el).checked(),"GDrive"===e.cp.source&&(e.exportSettings.bPdf=$(".check-pdf",e.$el).checked(),e.exportSettings.bGDoc=$(".check-gdoc",e.$el).checked()),e.exportSettings.bHtml=$(".check-html",e.$el).checked(),$(".action-export",e.$panelMain).toggleAttr("disabled",!(e.exportSettings.bMicnote||e.exportSettings.bRecording||e.exportSettings.bPdf||e.exportSettings.bGDoc||e.exportSettings.bHtml))}n.d(t,"a",function(){return o}),n.d(t,"b",function(){return r});var l=n(19),c=(n.n(l),n(23)),s=(n.n(c),n(20)),d=(n.n(s),n(6)),u=(n.n(d),n(22)),p=n(21),m=(n.n(p),n(91),n(7)),f=(n.n(m),n(92),n(93),n(96)),h=n(125),g=n(126),b=(n.n(g),window.localHtml(g)),v="[manualExportNote]",_=log.reg("manualExportNote")},203:function(e,t){e.exports='\x3c!-- export-to-menu --\x3e\n<x-popover id="export-to-menu" auto-remove {=rt_mobile_backdrop=} >\n  <h3 slot="heading" heading>{=rt_header=}</h3>\n  <paper-listbox attr-for-selected="data-value" >\n    <paper-item data-value="Disk" class="" >\n      <iron-icon icon="bs:hdd"></iron-icon>\n      {=menu_import_local_disk=}\n    </paper-item>\n    <paper-item data-value="GDrive" >\n      <iron-icon icon="moon:gdrive"></iron-icon>\n      {=google_drive=}\n    </paper-item>\n    <paper-item data-value="Dropbox" >\n      <iron-icon icon="moon:dropbox"></iron-icon>\n      {=dropbox=}\n    </paper-item>\n  </paper-listbox>\n</x-popover>\n'},208:function(e,t,n){"use strict";function o(e){u=e,r()}function r(){}function i(e){g.default.showFullscreenWaiting(!0);var t=[],n=f.resolve();return p.each(e,function(e){var o=e.blob,r=(e.title,ar.userDir+"~unzipping.zip");n=n.then(function(){return f.ninvoke(ar.fileSystem,"saveFile",r,o,o.type)}).then(function(){var e=u.getCurFolderName();return x.d(r,e)}).then(function(e){e.version>u.PROP_VERSION?g.default.toastShowLongCenter(localString("open_micnote_too_new",u.getArtTitleShowName(e)),"error"):(log.info("imported article successfully: ",e.artTitle),g.default.toastShowShortCenter(localString("import_mn_succeed",e.artTitle)),t.push(e))})}),n.then(function(){g.default.showFullscreenWaiting(!1),t.length&&u.selectArticle(t[0])}).catch(function(e){g.default.showFullscreenWaiting(!1),g.default.messageBox(localString("common_error"),localString("import_mn_failed",g.default.getShowError(e))),log.fail(e)}),n}function a(e){var t=window.localHtml(N);t=window.localHtml(t,{rt_header:e.header||localString("import_menu_def_header")});var n=g.default.htmlToElement(t,!0);$("#import_from_menu").remove(),g.default.insertModal(n),n.togglerElem=$(e.toggler)[0],n.open();var o,r=f.defer(),i=$(n);return i.on("iron-activate",function(e){var t=e.originalEvent.detail.item;o=t.dataset.value,e.preventDefault(),i.hideModal()}),i.on("iron-overlay-closed",function(){o?r.resolve(o):r.reject()}),r.promise}function l(e){a({toggler:e}).then(function(e){c(Polymer.Settings.useShadow?e:e)})}function c(e){function t(e,t){if("CancelNetwork"===e)g.default.toastShowShortCenter(localString("operation_canceled"));else if("Ok"!==e)return;i(t)}if("Disk"===e)Object(A.filePicker)({fileType:"Micnote",bMultiSel:!0},t);else if("Link"===e){var n=w.a(u);w.b(n,"*.micnote",{footnote:localString("import_mn_link_accept_types")},t)}else if("GDrive"===e){var o={bSelectFolder:!1,icon:"moon:mn-doc",fileNameFilter:"*.micnote",bMultiSel:!0,actionName:localString("import_gdrive_import"),gdrive_bSharedWithMe:!0,bCancelable:!0},r=k.a(y.gdrive,u,o);k.d(r,t)}else if("Dropbox"===e){var o={bSelectFolder:!1,icon:"moon:mn-doc",fileNameFilter:"*.micnote",bMultiSel:!0,actionName:localString("import_gdrive_import"),bCancelable:!0},r=k.a(y.dropboxStd,u,o);k.d(r,t)}else console.error("Un-supported source: ",e)}function s(e){a({toggler:e}).then(function(e){if("Disk"===e)Object(A.filePicker)({fileType:"Audio",bMultiSel:!1},t);else if("Link"===e){var n=w.a(u);w.b(n,"*.*",{footnote:localString("import_rec_link_footnote")},t)}else if("GDrive"===e){var o={bSelectFolder:!1,icon:"bs:music",mimeTypeFilter:/^audio\//,bMultiSel:!1,actionName:localString("import_gdrive_import"),gdrive_bSharedWithMe:!0,bCancelable:!0},r=k.a(y.gdrive,u,o);k.d(r,t)}else if("Dropbox"===e){var o={bSelectFolder:!1,icon:"bs:music",mimeTypeFilter:/^audio\//,bMultiSel:!1,actionName:localString("import_gdrive_import"),bCancelable:!0},r=k.a(y.dropboxStd,u,o);k.d(r,t)}else console.error("Un-supported source: ",e)});var t=R.curry(function(e,t,n){"Ok"===t&&f.resolve().then(()=>{if(e.audioCommit!==v.a.NEW_AUDIO_COMMIT){var t=u.makeTimeShowStr(e.audioTime);return g.default.messageBoxPromise(localString("common_warning"),localString("import_rec_overwrite_warning",t),{okTitle:localString("import_rec_replace"),btnCancel:!0}).then(e=>{if("Ok"!==e)throw"no-overwrite"})}}).then(R.partial(d,e,n[0])).then(()=>{!e.artTitle&&n[0].title&&u.setArtTitle(e,b.removeExtension(n[0].title))}).done()})(ar.curArticle)}function d(e,t){var n=t.blob,o=t.title;if(n.size>31457280)return g.default.messageBoxPromise(localString("common_error"),localPrintf("import_rec_too_big",n.size/1024/1024,30720/1204)).then(()=>{throw"too-big"});g.default.showFullscreenWaiting(!0);var r=f.resolve(),i=o?"audio."+b.getExtension(o):"audio.mp3";i=i.toLowerCase();var a=u.getAudioPath(e),l=u.getAudioPath(e,i);return r=r.then(function(){return f.ninvoke(ar.fileSystem,"saveFile",l,n,n.type).then(function(){return i!==e.audioName?f.ninvoke(ar.fileSystem,"removeFile",a):void 0}).then(function(){return e.audioName=i,e.audioFormat=v.a.AUDIO_FMT_UNKNOWN,e.audioSize=n.size,e.audioCommit=b.genCommitHash(),e.noteCommit=b.genCommitHash(),u.saveArticle(e),f.nfcall(u.loadAudio,e)}).then(function(){S.a.onAudioChanged(),g.default.showFullscreenWaiting(!1),g.default.toastShowLongCenter(localString("common_success")),u.checkRunTimeTip("bImportRec",localString("import_rec_tip"))},function(e){g.default.showFullscreenWaiting(!1),g.default.toastShowLongCenter(localString("common_failed_with_reason",g.default.getShowError(e)),"error")})})}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return o}),n.d(t,"importMicnotes",function(){return i}),n.d(t,"cmdImportNotes",function(){return l}),n.d(t,"cmdImportNotesFrom",function(){return c}),n.d(t,"cmdImportRec",function(){return s});var u,p=n(19),m=(n.n(p),n(23)),f=(n.n(m),n(20)),h=(n.n(f),n(6)),g=(n.n(h),n(22)),b=n(21),v=(n.n(b),n(91)),_=n(7),S=(n.n(_),n(92)),x=(n(93),n(100)),w=n(111),y=n(94),k=n(96),N=n(209),A=(n.n(N),n(24))},209:function(e,t){e.exports='\x3c!-- import-from-menu --\x3e\n<x-popover id="import-from-menu" auto-remove {=rt_mobile_backdrop=} >\n  <h3 slot="heading" heading>{=rt_header=}</h3>\n  <paper-listbox attr-for-selected="data-value">\n    <paper-item data-value="Disk" class="mobile-hide" >\n      <iron-icon icon="bs:hdd"></iron-icon>\n      {=menu_import_local_disk=}\n    </paper-item>\n    <paper-item data-value="Link"  >\n      <iron-icon icon="bs:link"></iron-icon>\n      {=menu_import_link=}\n    </paper-item>\n    <paper-item data-value="GDrive" >\n      <iron-icon icon="moon:gdrive"></iron-icon>\n      {=google_drive=}\n    </paper-item>\n    <paper-item data-value="Dropbox" >\n      <iron-icon icon="moon:dropbox"></iron-icon>\n      {=dropbox=}\n    </paper-item>\n  </paper-listbox>\n</x-popover>\n'}});
//# sourceMappingURL=4.bundle.js.map