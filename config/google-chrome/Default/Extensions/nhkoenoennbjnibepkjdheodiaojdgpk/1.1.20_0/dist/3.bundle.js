webpackJsonp([3,7],Array(83).concat([function(e,t,n){e.exports=n(0)(59)},,,,,,,,,,function(e,t,n){"use strict";function i(e,t){return N(A.ajax({url:I.default.makeApiUrl("/api/node-gg-token"),type:"POST",xhrFields:{withCredentials:!0},dataType:"json",data:{type:"refresh",ncode:t}})).then(e=>e.token)}function o(e,t,n){var o=W[e];o.token=n;let r=Object.create(H);r.create({token:n,refreshHandler:R.partial(i,e,t),onNewToken:e=>{o.token=e}}),o.auth=r}function r(e){return W[e].auth}function a(e){return"string"==typeof e?JSON.parse(e):e}function l(e){return!!(e&&void 0!==e.code&&e.code>=500&&e.code<600)}function s(e){var t;if(e)if(console.error(e),e instanceof Error&&e.stack&&console.error(e.stack),"string"==typeof e)t=new Error(e);else if(e instanceof Error&&e.appName)t=e;else{var n=e.code,i="Google error ("+(e.code?e.code+": ":"")+e.message+").";401===e.code||403===e.code||"token_refresh_required"==e.code?(T.each(W,function(e){e.setRefreshFlag()}),i=e.message?e.message:localString("google_author_error")):e.code<=0&&(j=!1,T.each(W,function(e){e.setRefreshFlag()}),i=0!==e.code||navigator.onLine?"Network error ("+e.code+": "+(e.message||"")+").":window.localString("network_not_availiable")),(t=new Error(i)).code=n}else t=new Error(localString("common_unknown_error"));throw t}function c(e){var t={},n=!0;this.setRefreshFlag=function(){n=!0},this.isAuthorized=function(e){return!1===n&&T.has(t,e)},this.add=function(e){t[e]=!0,n=!1},this.getListWithNew=function(e){var n=T.keys(t);return T.has(t,e)||n.push(e),n};var i=I.default.appSettings[e+".userId"];this.setUserId=function(t){i=t,I.default.appSettings[e+".userId"]=i,I.default.saveAppSettings()},this.getUserId=function(){return i}}function d(){return N.Promise(function(e,t){B?e():A.ajax({url:"https://apis.google.com/js/js/client.js",type:"HEAD"}).done(function(){j=!0,e()}).fail(function(e){var n={code:e.status,message:e.statusText};t(n)})})}function u(e,t){var n=[e],i=T.chain(G).pick(n).values().flatten().union().value(),o={client_id:L.GOOGLE_NODE_CLIETN_ID,redirect_uri:I.default.makeApiUrl("/node-gg-oauth2callback"),response_type:"code",scope:i.join("+"),include_granted_scopes:"true",access_type:"offline",approval_prompt:"force"};t&&(o.login_hint=t);var r=A.param(o);let a="https://accounts.google.com/o/oauth2/auth?"+(r=r.replace(/%2B/g,"+")),l=I.default.makeApiUrl("/api/node-gg-auth");return D.a(a,l)}function p(e){return Object(F.c)().then(()=>(log.log("get token"),N(A.ajax({url:I.default.makeApiUrl("/api/node-gg-token"),type:"POST",xhrFields:{withCredentials:!0},dataType:"json",data:{type:"access",ncode:e}})).then(e=>e.token,e=>{throw"no-token"===I.default.xhrSafeResponseText(e)?"need-redir":I.default.xhrSafeErrorString(e)})))}function m(e,t,n){return N.resolve().then(()=>(log.log("check token"),r(e).request({url:"https://www.googleapis.com/oauth2/v1/tokeninfo",type:"GET",dataType:"json",qs:{access_token:t},bDontSetTokenInHeader:!0}).catch(e=>{throw"no-token"===I.default.xhrSafeResponseText(e)?"need-redir":I.default.xhrSafeErrorString(e)}))).then(e=>{let t=e.scope.split(" "),i=[n],o=T.chain(G).pick(i).values().flatten().union().value(),r=t.indexOf("https://www.googleapis.com/auth/userinfo.profile");if(-1!==r&&(t[r]="profile"),-1!==(r=t.indexOf("https://www.googleapis.com/auth/userinfo.email"))&&(t[r]="email"),T.intersection(t,o).length===o.length)return e.user_id;throw"need-redir"})}function f(e,t,n){return p(t).then(i=>(o(e,t,i),m(e,i,n).then(o=>(W[e].add(n),{token:i,ncode:t,userId:o}))))}function h(e,t,n){return N.resolve().then(()=>{let n=I.default.appSettings[t+".gg.nc"];if(n)return f(t,n,e);throw"need-redir"}).catch(i=>{if("need-redir"===i){if(n){let n=I.default.appSettings[t+".gg.uid"];return u(e,n).then(n=>f(t,n,e))}var o=new Error(localString("google_author_error"));throw o.appName="need-redir",o}throw i}).then(({token:e,ncode:n,userId:i})=>{let o=I.default.appSettings[t+".gg.uid"],r=I.default.appSettings[t+".gg.nc"];if(o&&o!==i){O.warn("cancel for signing in with different google user",o,i);var a=new Error(localString("google_account_diff_error"));throw a.appName="account-different",a}o===i&&r===n||(I.default.appSettings[t+".gg.nc"]=n,I.default.appSettings[t+".gg.uid"]=i,I.default.saveAppSettings())})}function g(e,t,n){function i(t){A.ajax({url:"https://www.googleapis.com/oauth2/v1/tokeninfo",data:{access_token:t},timeout:$.a.AJAX_TIMEOUT,type:"GET"}).done(function(i){if(r.getUserId()&&r.getUserId()!=i.user_id)if(r.setUserId(null),n)chrome.identity.removeCachedAuthToken({token:t},function(){o(!1)});else{O.error(M,"getTokenInfo failed");var l=new Error(localString("google_author_error"));l.appName="need-redir",a.reject(l)}else r.setUserId(i.user_id),r.add(e),r.token=t,a.resolve()}).fail(function(e){if(O.error(e.responseText),400===e.status)r.setUserId(null),chrome.identity.removeCachedAuthToken({token:t},function(){if(n)o(!1);else{var e=new Error(localString("google_author_error"));e.appName="need-redir",a.reject(e)}});else{var i={code:e.status,message:e.statusText};a.reject(i)}})}function o(r){console.assert(n||r);var l=[e],s=T.chain(G).pick(l).values().flatten().union().value(),c={interactive:!r,scopes:s};if(P("AndroidApp")||P("iOSApp")){var d=I.default.appSettings[t+".mobileEmail"];d&&(c.accountHint=d)}chrome.identity.getAuthToken(c,function(e){if(P("AndroidApp")||P("iOSApp")){var l=arguments[1];I.default.appSettings[t+".mobileEmail"]=l,I.default.saveAppSettings()}if(e)i(e);else if(!0===r&&n)o(!1);else{O.error(M,"getAuthToken with interative failed, lastError:",chrome.runtime.lastError);let e;e="ChromeOS"===I.default.getOSName()?localString("google_getauthtoken_error_chromebook",chrome.runtime.lastError):P("MobileApp")?localString("google_getauthtoken_error_normal",chrome.runtime.lastError):localString("google_getauthtoken_error_chrome",chrome.runtime.lastError);var s=new Error(e);r&&!n&&(s.appName="need-redir"),a.reject(s)}})}var r=W[t];r||(r=new c(t),W[t]=r);var a=N.defer();return r.token&&r.isAuthorized(e)?a.resolve():P("Node")?h(e,t,n).then(a.resolve,a.reject):o(!0),a.promise}function v(e,t){W[e];t()}function b(e,t){function n(){e().then(function(e){i.resolve(e)},function(e){l(e)&&++o<U?(O.warn("retry num:",o),n()):i.reject(e)},i.notify)}var i=N.defer(),o=0;return n(),i.promise}function y(e,t,n){var i,o,r,l=P("MobileApp")&&n.targetUrl,s=N.defer(),c=N.resolve();return c=c.then(function(){var i=N.defer(),l=W[t],s="https://www.googleapis.com/drive/v2/files/"+e,c=new XMLHttpRequest;return c.open("GET",s),c.setRequestHeader("Authorization","Bearer "+l.token),c.responseType="json",c.onload=function(){if(200===c.status){var e=a(c.response);r=e.etag,n.format&&n.format!==e.mimeType?e.exportLinks[n.format]?(o=e.exportLinks[n.format],i.resolve()):i.reject("Can't convert format to "+n.format):(e.downloadUrl||log.error("convert gdoc to gdoc?"),o=e.downloadUrl,i.resolve())}else i.reject({code:c.status,message:c.statusText})},c.onerror=function(){i.reject({code:c.status,message:c.statusText})},c.send(),i.promise}),(c=c.then(function(){var r=N.defer(),c=W[t];if(l){var d=new window.FileTransfer,u={Authorization:"Bearer "+c.token};d.onprogress=function(e){s.notify({name:"progress",loaded:e.loaded,total:e.total})},d.download(o,n.targetUrl,function(e){r.resolve()},function(e){console.log("download error source "+e.source),console.log("download error target "+e.target),console.log("upload error code"+e.code),r.reject({code:e.code,message:"unknown"})},!0,{headers:u})}else{var p=new XMLHttpRequest;p.open("GET",o),p.setRequestHeader("Authorization","Bearer "+c.token),p.responseType=n.responseType||"blob",p.onload=function(){if(200===p.status){var e;e="json"===n.responseType?a(p.response):p.response,i=e,r.resolve()}else r.reject({code:p.status,message:p.statusText})},p.onerror=function(){r.reject({code:p.status,message:p.statusText})},p.onprogress=function(e){s.notify({name:"progress",loaded:e.loaded,total:e.total})},p.send(),s.notify({name:"cancel-handler",handler:function(t){O.warn("download canceled:",e),p.abort();var n=new Error(localString("common_cancel"));n.appName=t||"cancel",s.reject(n)}})}return r.promise})).then(function(){return n.bWithETag?{content:i,etag:r}:i}).then(s.resolve.bind(s),s.reject.bind(s)),s.promise}function w(e){var t={};return t.code=e.status,e.response&&e.response.error&&e.response.error.message?t.message="Google error: "+e.response.error.message:t.message=e.statusText,t}function _(e,t,n,i){console.assert(e);var o=N.defer(),r=W[t],l="https://www.googleapis.com/drive/v2/files/"+e;n&&(l+="?fields="+n);var s=new XMLHttpRequest;return s.open("GET",l),s.setRequestHeader("Authorization","Bearer "+r.token),s.responseType="json",s.onload=function(){200===s.status?a(s.response).explicitlyTrashed?(O.log("file in trash:",s.response.title,s.response.id),o.reject({code:404,message:"file not found"})):o.resolve(a(s.response)):o.reject(w(s))},s.onerror=function(){o.reject({code:s.status,message:s.statusText})},s.send(),i&&i.push(s),o.promise}function x(e,t,n,i){var o=A.isArray(e)?e:[e],r=N.resolve(),a=[];return(r=r.then(function(){function e(){if(l<o.length)_(o[l++],t,n,i).then(function(t){a.push(t),e()},r.reject);else if(a.length===o.length){r.resolve()}}for(var r=N.defer(),l=0,s=0;s<4;s++)e();return r.promise})).then(function(){return A.isArray(e)?a:a[0]})}function S(e,t,n){var i=N.defer(),o=N.resolve(),r=[],l=[];return(o=o.then(function(){function i(e){var t=e,n=new XMLHttpRequest;n.open("GET",t),n.setRequestHeader("Authorization","Bearer "+c.token),n.responseType="json",n.onload=function(){if(200===n.status){var e=N.resolve(),t=a(n.response);t.items.forEach(function(e){r.push(e.id)}),e.then(function(){t.nextLink?i(t.nextLink):s.resolve()}).catch(function(e){s.reject(e)})}else s.reject({code:n.status,message:n.statusText})},n.onerror=function(){s.reject({code:n.status,message:n.statusText})},n.send(),l.push(n)}var o,s=N.defer(),c=W[t];return o=e?"https://www.googleapis.com/drive/v2/files/"+e+"/children":"https://www.googleapis.com/drive/v2/files",n&&(o+="?"+A.param({q:n})),i(o),s.promise})).then(function(){i.resolve(r)},function(e){i.reject(e)}),T.delay(function(){i.notify({name:"cancel-handler",handler:function(t){O.warn("listChildren canceled, folderId:",e),T.each(l,function(e){e.abort()});var n=new Error(localString("common_cancel"));n.appName=t||"cancel",i.reject(n)}})}),i.promise}function k(e,t,n,i,o,r,l,s,c,d){function u(){var e=W[c],t=N.defer(),n=new XMLHttpRequest;n.open("PUT",f,!0),n.setRequestHeader("Authorization","Bearer "+e.token),n.setRequestHeader("Content-Range","bytes */"+h),n.addEventListener("load",function(e,i){if(200===n.status){var o=n.getResponseHeader("Range");w=parseInt(o.split("-")[1]),t.resolve(p())}else t.reject({code:n.status,message:n.statusText})}),n.addEventListener("error",function(e){t.reject({code:n.status,message:n.statusText})}),n.send()}function p(){var e=W[c],t=N.defer(),n=new XMLHttpRequest;n.open("PUT",f,!0),n.setRequestHeader("Authorization","Bearer "+e.token),n.setRequestHeader("Content-Range",C.sprintf("bytes %d-%d/%d",w+1,h-1,h)),n.addEventListener("load",function(e,i){200===n.status?(m=JSON.parse(n.responseText),t.resolve()):503===n.status?t.resolve(u()):t.reject({code:n.status,message:n.statusText})}),n.addEventListener("error",function(e){t.reject({code:n.status,message:n.statusText})});var o;return o="string"==typeof i?i.slice(w+1):new Uint8Array(i,w+1),n.send(o),t.promise}var m,f,h,g=N.defer(),b=P("MobileApp")&&d.fileUrl;b?(console.assert(!i),h=d.byteLength):"string"==typeof i?h=void 0:(console.assert(void 0!==i.byteLength),h=i.byteLength);var y=N.resolve();(y=(y=(y=y.then(function(){var i=N.defer(),a=(W[c],{title:n,mimeType:o=o||"application/octet-stream"});t&&(a.parents=[{kind:"drive#fileLink",id:t}]),l&&(a.createdDate=l),s&&(a.modifiedDate=s,a.modifiedByMeDate=s),d.properties&&(a.properties=[],T.each(d.properties,(e,t)=>{a.properties.push({key:t,value:e,visibility:"PRIVATE"})}));var u="https://www.googleapis.com/upload/drive/v2/files",p="POST";e&&(u+="/"+e,p="PUT"),u+="?uploadType=resumable",d.bConvertToGDoc&&(u+="&convert=true");var m=JSON.stringify(a);return v(c,function(){var t=W[c],n=new XMLHttpRequest;n.open(p,u,!0),n.setRequestHeader("Authorization","Bearer "+t.token),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("X-Upload-Content-Type",o),void 0!==h&&n.setRequestHeader("X-Upload-Content-Length",h),r&&n.setRequestHeader("If-Match",r),n.addEventListener("load",function(t,o){if(200===n.status)f=n.getResponseHeader("Location"),i.resolve();else{var r=n.statusText;void 0!==e&&412===n.status&&(r="ETag check failed!|ETagChanged"),i.reject(r)}}),n.addEventListener("error",function(e){i.reject(n.statusText)}),n.send(m)}),i.promise})).then(function(){var e=W[c],t=N.defer();if(b){var l=function(e){200===e.responseCode?(m=JSON.parse(e.response),t.resolve()):t.reject({code:e.responseCode,message:"unknown"})},s=function(e){t.reject({code:e.code,message:"unnknown"})},p=d.fileUrl,h=new window.FileUploadOptions;h.fileKey="file",h.fileName=p.substr(p.lastIndexOf("/")+1),h.mimeType=o,h.httpMethod="PUT",h.trustAllHosts=!0;var v={Authorization:"Bearer "+e.token,"Content-Type":o};h.headers=v;var y=new window.FileTransfer;y.onprogress=function(e){let t={name:"progress",loaded:e.loaded,total:e.total};g.notify(t),d.notify(t)},y.upload(p,f,l,s,h)}else{var w=new XMLHttpRequest;w.open("PUT",f,!0),w.setRequestHeader("Authorization","Bearer "+e.token),w.setRequestHeader("Content-Type",o),w.responseType="json",w.onload=function(e,n){200===w.status?(m=a(w.response),t.resolve()):503===w.status?t.resolve(u()):r&&412===w.status?t.reject("ETag check failed!|ETagChanged"):t.reject({code:w.status,message:w.statusText})},w.onerror=function(e){t.reject({code:w.status,message:w.statusText})},w.upload.onprogress=function(e){let t={name:"progress",loaded:e.loaded,total:e.total};g.notify(t),d.notify(t)};var _;"string"==typeof i?(w.setRequestHeader("Content-Encoding","base64"),_=I.default.encodeBase64(i)):_=new Uint8Array(i),w.send(_);let l={name:"cancel-handler",handler:function(e){O.warn("upload canceled:",n),w.abort();var t=new Error(localString("common_cancel"));t.appName=e||"cancel",g.reject(t)}};g.notify(l),d.notify(l)}return t.promise})).then(function(){var t=N.defer();W[c];return e&&m.explicitlyTrashed?v(c,function(){var n=W[c],i="https://www.googleapis.com/drive/v2/files/"+e+"/untrash",o=new XMLHttpRequest;o.open("POST",i,!0),o.setRequestHeader("Authorization","Bearer "+n.token),o.onload=function(e){200===o.status?t.resolve():t.reject({code:o.status,message:o.statusText})},o.onerror=function(e){t.reject({code:o.status,message:o.statusText})},o.send()}):t.resolve(),t.promise})).then(function(){g.resolve(m)},function(e){g.reject(e)});var w;return g.promise}Object.defineProperty(t,"__esModule",{value:!0});var T=n(19),C=(n.n(T),n(23)),A=(n.n(C),n(9)),$=(n.n(A),n(91)),L=n(7),I=(n.n(L),n(22)),E=n(21),N=(n.n(E),n(103),n(92),n(20)),P=(n.n(N),n(6)),F=(n.n(P),n(24),n(95)),D=n(106),M="[googleHelper]",O=log.reg("googleHelper"),U=3,B=!1,H={create:function(e){this.token=e.token,this.refreshHandler=e.refreshHandler,this.onNewToken=e.onNewToken},request:function(e){function t(d){let u=N.defer(),p=new XMLHttpRequest;var m=i;l&&("object"==typeof l&&l.access_token&&(l.access_token=c.token),m+="?"+("string"==typeof l?l:A.param(l))),p.open(n,m,!0),T.each(o,(e,t)=>{p.setRequestHeader(t,e)}),s||p.setRequestHeader("Authorization","Bearer "+c.token),r&&(p.responseType=r),p.onload=(()=>{let n=p.status,i=p.response&&p.response.error;e._bTestExpire&&!d&&(n=400,i="invalid_token"),200===n?u.resolve(p.response):d?u.reject(p):400===n&&"invalid_token"===i?(O.log("refresh token"),c.refreshHandler().then(e=>{c.token=e,c.onNewToken&&c.onNewToken(e),t(!0).then(u.resolve,u.reject)},e=>{u.reject(e)})):u.reject(p)}),p.onerror=(()=>{u.reject(p)});var f=JSON.stringify(a);return p.send(f),u.promise}let n=e.type,i=e.url,o=e.headers||{},r=e.dataType,a=e.data,l=e.qs,s=e.bDontSetTokenInHeader,c=this;return t(!1)}},j=!1,W={},V={},G={profile:["profile","email"],gdrive:["profile","https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.appdata"],gmail:["profile","email","https://www.googleapis.com/auth/gmail.compose"],groupAdmin:["https://www.googleapis.com/auth/admin.directory.group","https://www.googleapis.com/auth/admin.directory.user"]};V.getUserProfile=function(e){O.log(M,"getUserProfile, accountId:",e);var t,n=N.defer(),i=N.resolve();return(i=i.then(function(){var n=N.defer(),i=W[e],o=new XMLHttpRequest;return o.open("GET","https://www.googleapis.com/plus/v1/people/me",!0),o.setRequestHeader("Authorization","Bearer "+i.token),o.responseType="json",o.onload=function(){200===o.status?(t=a(o.response),n.resolve()):n.reject({code:o.status,message:o.statusText})},o.onerror=function(){n.reject({code:o.status,message:o.statusText})},o.send(),n.promise})).then(function(){n.resolve(t)},n.reject.bind(n)),n.promise},V.download=function(e,t,n){return O.log(M,"download, fileId: "+e),n||(n={}),b(function(){return y(e,t,n)}).catch(s)},V.downloadMeta=function(e,t,n){O.log(M,"download meta, fileId: "+(A.isArray(e)?"num "+e.length:e));var i=[],o=N.defer();return b(function(){return x(e,t,n,i)}).catch(s).then(o.resolve,o.reject),T.delay(function(){o.notify({name:"cancel-handler",handler:function(e){O.warn("cancel downloadMeda, xhr num:",i.length),T.each(i,function(e){e.abort()});var t=new Error(localString("common_cancel"));t.appName=e||"cancel",o.reject(t)}})}),o.promise},V.listFiles=function(e,t){return S(null,e,t).catch(s)},V.listChildren=function(e,t,n){return S(e,t,n).catch(s)},V.upload=function(e,t,n,i,o,r,a,l,c,d=null){O.log(M,"upload, title: "+n);let u=T.defaults(d||{},{notify:null});return u.notify||(u.notify=function(){}),console.assert(!u.bConvertToGDoc||!e),b(function(){return k(e,t,n,i,o,r,a,l,c,u)}).catch(s)},V.createDir=function(e,t,n){O.log("createDir:",t);var i,o=N.defer(),r=N.resolve();return(r=r.then(function(){var o=N.defer(),r="-------314159265358979323846",l="\r\n--"+r+"\r\n",s="\r\n--"+r+"--",c={title:t,mimeType:"application/vnd.google-apps.folder"};n&&(c.parents=[{kind:"drive#fileLink",id:n}]);var d=[l,"Content-Type: application/json\r\n\r\n",JSON.stringify(c),s].join("");return v(e,function(){var t=W[e],n=new XMLHttpRequest;n.open("POST","https://www.googleapis.com/upload/drive/v2/files",!0),n.setRequestHeader("Authorization","Bearer "+t.token),n.setRequestHeader("Content-Type",'multipart/mixed; boundary="'+r+'"'),n.responseType="json",n.addEventListener("load",function(e,t){200===n.status?(i=a(n.response).id,o.resolve()):o.reject({code:n.status,message:n.statusText})}),n.addEventListener("error",function(e){o.reject({code:n.status,message:n.statusText})}),n.send(d)}),o.promise})).then(function(){o.resolve(i)},function(e){o.reject(e)}),o.promise.catch(s)},V.moveFile=function(e,t,n,i){O.log(M,"moveFile, title:",i),console.assert(t);var o,r=N.resolve();return(r=r.then(function(){var r=N.defer();return v(e,function(){var l="https://www.googleapis.com/drive/v2/files/"+t,s={};i&&(s.title=i),s.parents=[{kind:"drive#fileLink",id:n}];var c=JSON.stringify(s),d=W[e],u=new XMLHttpRequest;u.open("POST",l,!0),u.setRequestHeader("Authorization","Bearer "+d.token),u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("X-HTTP-Method-Override","PATCH"),u.responseType="json",u.onload=function(e,t){if(200===u.status)o=a(u.response),r.resolve();else{var n;n={code:u.status,message:u.statusText},r.reject(n)}},u.onerror=function(e){r.reject({code:u.status,message:u.statusText})},u.send(c)}),r.promise})).then(function(){return o}).catch(s)},V.trashFile=function(e,t){var n=N.resolve();return(n=n.then(function(){var n=N.defer(),i={Authorization:"Bearer "+W[e].token},o="https://www.googleapis.com/drive/v2/files/"+t+"/trash";return A.ajax({type:"POST",url:o,headers:i}).done(function(e){n.resolve()}).fail(function(e){404===e.status?(O.warn(M,"deleted file was not found, skip. fileId: "+t),n.resolve()):n.reject({code:e.status,message:e.statusText})}),n.promise})).catch(s)},V.deleteFile=function(e,t){var n=N.resolve();return(n=n.then(function(){var n=N.defer(),i={Authorization:"Bearer "+W[e].token},o="https://www.googleapis.com/drive/v2/files/"+t;return A.ajax({type:"DELETE",url:o,headers:i}).done(function(e){n.resolve()}).fail(function(e){404===e.status?(O.warn(M,"deleted file was not found, skip. fileId: "+t),n.resolve()):n.reject({code:e.status,message:e.statusText})}),n.promise})).catch(s)},V.copyFile=function(e,t,n,i,o){O.log(M,"copyFile: fid:",t," to:",n);var r=o||{},a=N.resolve();return(a=a.then(function(){var o=N.defer(),a={Authorization:"Bearer "+W[e].token},l="https://www.googleapis.com/drive/v2/files/"+t+"/copy",s={};r.gdriveConvert&&(s.convert=!0);var c=A.param(s);c&&(l+="?"+c);var d={title:n};return i&&(d.parents=[{kind:"drive#fileLink",id:i}]),A.ajax({type:"POST",url:l,headers:a,processData:!1,contentType:"application/json",data:JSON.stringify(d)}).done(function(e){o.resolve(e)}).fail(function(e){o.reject({code:e.status,message:e.statusText})}),o.promise})).catch(s)},V.sendGmail=function(e,t){O.log(M,"sendGmail, draft:",t.bDraft||"0");var n=t.attach,i=t.msg,o=N.defer(),r=N.resolve();return(r=r.then(function(){var r,a,l,s,c=N.defer(),d=W[e],u=(d.token,{}),p=["To: "+t.to,"Subject: "+I.default.base64ForMailHeader(t.subject||"")].join("\n"),m="-------314159265358979323846",f="--"+m,h="--"+m+"--";n&&("string"==typeof n.data?(l=n.data,s="quoted-printable"):(l=I.default.arrayBufferToBase64(n.data),s="base64")),r=t.bDraft?"https://www.googleapis.com/upload/gmail/v1/users/me/drafts":"https://www.googleapis.com/upload/gmail/v1/users/me/messages/send",u.uploadType="multipart",a=n?["MIME-Version: 1.0",p,'Content-Type: multipart/mixed; boundary="'+m+'"',"",f,'Content-Type: text/html; charset="UTF-8"',"",i,"",f,"Content-Type: "+n.type+';name="'+n.name+'"',"Content-Transfer-Encoding: "+s,'Content-Disposition: attachment; filename="'+n.name+'"',"",l,"",h].join("\n"):["MIME-Version: 1.0",p,'Content-Type: multipart/mixed; boundary="'+m+'"',"",f,'Content-Type: text/html; charset="UTF-8"',"",i,"",h].join("\n");var g=A.param(u);g&&(r+="?"+g);var v=new XMLHttpRequest;return v.open("POST",r,!0),v.setRequestHeader("Authorization","Bearer "+d.token),v.setRequestHeader("Content-Type","message/rfc822"),v.responseType="json",v.onload=function(){200===v.status?(console.debug(v.response),c.resolve({msgId:t.bDraft?v.response.message.id:v.response.id})):(O.error(v.response),c.reject({code:v.status,message:v.statusText}))},v.onerror=function(){c.reject({code:v.status,message:v.statusText})},v.onprogress=function(e){o.notify({name:"progress",loaded:e.loaded,total:e.total})},v.send(a),T.delay(function(){o.notify({name:"cancel-handler",handler:function(e){O.warn("sending email canceled:"),v.abort();var t=new Error(localString("common_cancel"));t.appName=e||"cancel",c.reject(t)}})}),c.promise})).catch(s).then(o.resolve,o.reject),o.promise},V.share=function(e,t,n){O.log(M,"share, fileId:",e);var i=N.resolve();return(i=i.then(function(){var n,i=N.defer(),o=W[t];n=C.sprintf("https://www.googleapis.com/drive/v2/files/%s/permissions",e);var r=A.param({});r&&(n+="?"+r);var a=JSON.stringify({role:"reader",type:"anyone",id:"anyoneWithLink",withLink:!0}),l=new XMLHttpRequest;return l.open("POST",n,!0),l.setRequestHeader("Authorization","Bearer "+o.token),l.setRequestHeader("Content-Type","application/json"),l.responseType="json",l.onload=function(){200===l.status?i.resolve({link:C.sprintf("https://drive.google.com/file/d/%s/view?usp=sharing",e)}):(O.error(l.response),i.reject({code:l.status,message:l.statusText}))},l.onerror=function(){i.reject({code:l.status,message:l.statusText})},l.send(a),i.promise})).catch(s)},V.gmailGetUserProfile=function(e){O.log(M,"gmailGetUserProfile, accountId:",e);var t=N.resolve();return(t=t.then(function(){return V.getUserProfile(e)}).then(function(e){return e})).catch(s)},V.authenticate=function(e,t){O.log(M,"authenticate");let n=N.defer();return N.resolve().then(function(){T.delay(()=>{n.notify({name:"cancel-handler",handler:function(e){O.warn("authenticate canceled:");var t=new Error(localString("common_cancel"));t.appName=e||"cancel",n.reject(t)}})})}).then(d).then(g.bind(window,"gdrive",e,t)).catch(s).then(n.resolve,n.reject,n.notify),n.promise},V.authenticateEx=function(e,t,n){O.log(M,"authenticateEx",t);let i=N.defer();return N.resolve().then(function(){T.delay(()=>{i.notify({name:"cancel-handler",handler:function(e){O.warn("authenticate canceled:");var t=new Error(localString("common_cancel"));t.appName=e||"cancel",i.reject(t)}})})}).then(d).then(g.bind(window,t,e,n)).catch(s).then(i.resolve,i.reject,i.notify),i.promise},V.shortUrl=function(e){let t="https://www.googleapis.com/urlshortener/v1/url";t+="?"+A.param({key:"AIzaSyATYjAyIYVJYfTps3VL5qidcEn_cl3PujU"});let n={longUrl:e},i=N.defer();var o=new XMLHttpRequest;o.open("POST",t,!0),o.responseType="json",o.setRequestHeader("Content-Type","application/json"),o.onload=function(){if(200===o.status){let e=a(o.response);i.resolve(e.id)}else i.reject({code:o.status,message:o.statusText})},o.onerror=function(){i.reject({code:o.status,message:o.statusText})};let r=JSON.stringify(n);return o.send(r),i.promise},window.delayedFunction=void 0,window.runDelayedFunction=function(){void 0!==window.delayedFunction&&window.delayedFunction()},P("MobileApp")&&(window.dbgRevokeGoogleAuthToken=function(){var e=W["google.gdrive0"];chrome.identity.revokeAuthToken({token:e.token},function(){O.debug(M,"Revvoke succeed")})}),t.default=V},function(e,t,n){"use strict";function i(){return"My Mic Notes"}function o(e){var t={title:e.title,mDate:new Date(e.modifiedDate),cDate:new Date(e.createdDate),size:e.fileSize||0,id:e.id,mimeType:e.mimeType,parentId:e.parents&&e.parents.length>0?e.parents[0].id:null,md5:e.md5Checksum,properties:{}};return console.assert(t.cDate&&t.mDate),"application/vnd.google-apps.folder"===e.mimeType?t.type="Folder":t.type="File",e.properties&&m.each(e.properties,function(e){t.properties[e.key]=e.value}),t}function r(e){return e?T.syncRoot+"/"+e:T.syncRoot}function a(e,t,n){var i="Folder"===t?"folder":b.getExtension(n);return i?e+"."+i:e}function l(e,t){return{id:a(e,t.type,t.title),title:t.title,type:t.type,mDate:new Date(t.mDate),cDate:new Date(t.cDate),size:t.size,mimeType:t.mimeType,parentId:t.parentId,md5:t.md5}}function s(e){let t=e[".tag"];console.assert("file"==t||"folder"==t);let n,i,o=e.name,r="file"==t?"File":"Folder";n=i="File"==r?new Date(e.server_modified):new Date;let a=b.getExtension(e.name),l=v.default.guessMimeTypeByExtension(a),s=b.removeFileName(e.path_lower);return{title:o,type:r,mDate:i,cDate:n,size:e.size,id:e.path_lower,mimeType:l,parentId:s,md5:e.contentHash}}function c(e,t){function n(t){return _.a.createDir(e,t).catch(function(e){if(403!==e.code)throw e})}return _.a.stat(e,t).catch(function(e){if(404===e.code){t=b.removeFirstSplash(t);var i=(t=b.removeLastSplash(t)).split("/"),o="",r=h.resolve();return m.each(i,function(e){o+="/"+e,r=r.then(n.bind(window,o))}),r}throw e})}function d(e){return{title:e.artTitle,type:"Folder"===e.type?"Folder":"File",mDate:e.mDate,cDate:e.cDate,size:e.audioSize,id:e.artName,mimeType:e.type,parentId:e.parentName}}function u(e){return"GDrive"===e?k:"DropboxStd"===e?C:"DropboxSync"===e?T:"LocalNoteProvider"===e?A:null}function p(e){return"GDrive"===e?k:"Dropbox"===e?C:"LocalNoteProvider"===e?A:null}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"gdrive",function(){return k}),n.d(t,"dropboxStd",function(){return C}),n.d(t,"dropboxSync",function(){return T}),n.d(t,"localNoteProvider",function(){return A}),n.d(t,"getProvider",function(){return u}),n.d(t,"getStdProvider",function(){return p}),n.d(t,"getDefSyncFolderName",function(){return i}),n.d(t,"util",function(){return L});var m=n(19),f=(n.n(m),n(23)),h=(n.n(f),n(20)),g=(n.n(h),n(6)),v=(n.n(g),n(22)),b=n(21),y=(n.n(b),n(91),n(7)),w=(n.n(y),n(92),n(93)),_=n(153),x="[cloudProviders]",S=log.reg("cloudProvider"),k={name:"GDrive",source:"GDrive",showName:"Google Drive"};k.setSyncRoot=function(e){k.syncRoot=e},k.clearCachedAuthToken=function(e){return h.resolve()},k.listChildren=function(e,t,n){n||(n={});var i="trashed=false";if(n.bFolderOnly&&(i+=" and mimeType = 'application/vnd.google-apps.folder'"),n.title){let e=n.title.replace(/\'/g,"\\'");i+=" and title = '"+e+"'"}var r=h.resolve();return r="SharedWithMe"===e?r.then(function(){return i+=" and sharedWithMe=true",w.default.listFiles(t,i)}):r.then(function(){return w.default.listChildren(e,t,i)}),r=r.then(function(e){return w.default.downloadMeta(e,t,"title,modifiedDate,createdDate,fileSize,id,mimeType,parents,md5Checksum,properties").then(function(t){$.isArray(e)||(t=[t]);var n=[];return m.each(t,function(e){var t=o(e);n.push(t)}),n})})},k.upload=function(e,t,n,i,r,a,l,s,c,d){return w.default.upload(e,t,n,i,r,a,l,s,c,d).then(function(e){return o(e)},function(e){throw 404===e.code?e.message="File not found on Google Drive|FileNotFound":a&&412===e.code&&(e.message="ETag checked failed!|ETagChanged"),e})},k.download=function(e,t,n){return w.default.download(e,t,n).catch(function(e){throw 404===e.code&&(e.message="File not found on Google Drive|FileNotFound"),e})},k.moveFile=function(e,t,n,i){return w.default.moveFile(e,t,n,i).then(function(e){return o(e)},function(e){throw 404===e.code&&(e.message="File not found on Google Drive|FileNotFound"),e})},k.copyFile=function(e,t,n,i,r){return w.default.copyFile(e,t,n,i,r).then(function(e){return o(e)},function(e){throw 404===e.code&&(e.message="File not found on Google Drive|FileNotFound"),e})},k.createDir=function(e,t,n){return w.default.createDir(e,t,n)},k.downloadMeta=function(e,t,n,i){return w.default.downloadMeta(e,t,n).then(function(e){return o(e)},function(e){throw 404===e.code&&(e.message="File not found on Google Drive|FileNotFound"),e})},k.getSyncRootFileId=function(e){if("appdata"===k.syncRoot)return w.default.downloadMeta(k.syncRoot,e).then(function(e){return e.id}).catch(function(e){throw 404===e.code&&(e.message="File not found on Google Drive|FileNotFound"),e});if(k.syncRoot)return h(k.syncRoot);return k.listChildren("root",e,{title:"My Mic Notes",bFolderOnly:!0}).then(function(t){return 1===t.length?(S.log("found default sync folder: ","My Mic Notes"),t[0].id):t.length>1?(S.log("found mutiply default sync folder, use the first one: ","My Mic Notes"),t[0].id):(S.log("default sync folder not found, create one: ","My Mic Notes"),w.default.createDir(e,"My Mic Notes","root").then(function(e){return e}))})},k.deleteFile=function(e,t){return"appdata"!==ar.settings.syncFolderId?w.default.trashFile(e,t).catch(function(e){throw 404===e.code&&(e.message="File not found on Google Drive|FileNotFound"),e}):w.default.deleteFile(e,t).catch(function(e){throw 404===e.code&&(e.message="File not found on Google Drive|FileNotFound"),e})},k.share=function(e,t,n){return w.default.share(e,t,n)},k.authenticate=function(e,t){return w.default.authenticate(e,t)},k.authenticateEx=function(e,t,n){return console.assert("Storage"===t),w.default.authenticateEx(e,"gdrive",n)},k.readyHostFolder=function(e,t){return k.share(e,t,{}).then(()=>({folderId:e,hostFolderLink:"https://googledrive.com/host/"+e}))},k.readyHostFile=function(e,t,n){return h.resolve({fileId:e,title:t,hostLink:t,link:"https://googledrive.com/host/"+e})},k.getHostLink=function(e,t){return console.assert("index.html"===t.title),console.assert(e.hostFolderLink),e.hostFolderLink};var T={name:"DropboxSync",source:"Dropbox",showName:"Dropbox"};T.setSyncRoot=function(e){let t="My Mic Notes".toLowerCase();T.syncRoot=e?b.removeLastSplash(e):"/"+t},T.clearCachedAuthToken=function(e){return _.a.clearCachedAuthToken(e)},T.listChildren=function(e,t,n){if(n||(n={}),n.bSyncSpecial){console.assert(n.title),"root"!==e&&e||(e="");var i=n.title,o=r(i);return _.a.stat(t,o).then(function(e){var t=s(e);return t.id=i,[t]},function(e){if(404===e.code)return[];throw e})}var a=r("");return _.a.listChildren(a,t).then(function(i){var o=i,a=[];m.each(o,function(e){"prop"==b.getExtension(e.name)&&a.push(e.name)});var s=h.resolve(),c=[];return m.each(a,function(i){var o=r("")+"/"+i;s=s.then(_.a.download.bind(window,o,t)).then(function(t){return v.default.blobToText(t.fileBlob).then(t=>{var o=JSON.parse(t);if(m.defaults(o,{version:0}),0==o.version&&(o.parentId=o.parentId.toLowerCase()),o.parentId==e&&(!n.bFolderOnly||"Folder"===!o.type)){var r=l(b.removeExtension(i),o);c.push(r)}})})}),s.then(function(){return c})})},T.upload=function(e,t,n,i,o,c,d,u,p,f){if(t&&"root"!==t||(t=""),f||(f={}),f.bSyncSpecial){var h=e||n,g=r(h);return _.a.upload(g,i,o,c,d,u,p,f).then(function(e){if(c&&e.name!==b.getFileName(g))return S.log(x,"Dropbox file conflict since etag checked filed: ",g),_.a.deleteFile(p,e.path_lower).then(function(){throw{code:400,message:"Dropbox file conflict. "+e.path_lower+"|ETagChanged"}});m.defaults(e,{".tag":"file"});var t=s(e);return t.id=h,t})}var v;e?v=b.removeExtension(e):e=a(v=b.genHash(16),"File",n);g=r(e);return _.a.upload(g,i,o,c,d,u,p,f).then(function(e){var i={version:1,title:n,type:"File",mDate:u,cDate:d,size:e.size,mimeType:e.mimeType,parentId:t,md5:v+"_"+e.versionTag},o=JSON.stringify(i),a=r(v+".prop");return _.a.upload(a,o,"application/json",null,null,null,p).then(function(t){return c&&e.name!==b.getFileName(g)?(S.log(x,"Dropbox file conflict since etag checked filed: ",g),_.a.deleteFile(p,e.path_lower).then(function(){throw{code:400,message:"Dropbox file conflict. "+e.path_lower+"|ETagChanged"}})):l(v,i)})})},T.download=function(e,t,n){n||(n={});var i={};n.responseType&&"blob"!==n.responseType?"arraybuffer"===n.responseType?i.arraybuffer=!0:"json"===n.responseType||console.assert(!1):i.blob=!0,n.targetUrl&&(i.targetUrl=n.targetUrl);var o;return o=r(e),_.a.download(o,t,i).then(function(e){return"json"===n.responseType?v.default.blobToText(e.fileBlob).then(t=>({content:JSON.parse(t),st:e})):{content:e.fileBlob,st:e}}).then(e=>n.bWithETag?{content:e.content,etag:e.st.rev}:e.content,function(e){throw 404===e.code&&(e.message="download: file/folder not found|FileNotFound"),e})},T.moveFile=function(e,t,n,i){var o=r(b.removeExtension(t)+".prop");return _.a.download(o,e,{}).then(function(e){return v.default.blobToText(e.fileBlob)}).then(t=>{var r=JSON.parse(t);r.parentId=n,i&&(r.title=i);var a=JSON.stringify(r);return _.a.upload(o,a,"application/json",null,null,null,e).then(function(e){})},function(e){if(404!==e.code)throw e;S.error(x,"moveFile: file/folder not found, ignore.")})},T.createDir=function(e,t,n){var i=b.genHash(16),o=r(i)+".prop",l={title:t,type:"Folder",mDate:new Date,cDate:new Date,size:0,mimeType:"application/mn_folder",parentId:n},s=JSON.stringify(l);return _.a.upload(o,s,"application/json",null,null,null,e).then(function(e){return a(i,"Folder",t)})},T.downloadMeta=function(e,t,n,i){if(i)return C.downloadMeta(e,t,n);var o=$.isArray(e);o||(e=[e]);var a=[],s=h.resolve();return m.each(e,function(e){s=s.then(function(){var n=b.removeExtension(e),i=r(n)+".prop";return _.a.download(i,t,{}).then(function(e){return v.default.blobToText(e.fileBlob)}).then(e=>{var t=JSON.parse(e),i=l(n,t);a.push(i)},function(e){throw 404===e.code&&(e.message="downloadMeta: file/folder not found|FileNotFound"),e})})}),s.then(function(){return o?a:a[0]})},T.deleteFile=function(e,t){var n=r(b.removeExtension(t)+".prop");return _.a.deleteFile(e,n).catch(function(e){if(404!==e.code)throw e;S.error(x,"deleteFile: file not found, ignore.",n)}).then(function(){if("folder"!==b.getExtension(t)){var n=r(t);return _.a.deleteFile(e,n).catch(function(e){if(404!==e.code)throw e;S.error(x,"deleteFile: file not found, ignore.",n)})}})},T.getSyncRootFileId=function(e){return console.assert(T.syncRoot),_.a.stat(e,T.syncRoot).then(function(e){return e.path_lower},function(t){if(404===t.code)return _.a.createDir(e,T.syncRoot).then(function(e){return e.path_lower});throw t})},T.authenticate=function(e,t){return _.a.authenticate(e,t)},T.authenticateEx=function(e,t,n){return console.assert("Storage"===t),_.a.authenticate(e,n)};var C={name:"DropboxStd",source:"Dropbox",showName:"Dropbox"};C.listChildren=function(e,t,n){if(n||(n={}),"root"!==e&&e||(e=""),n.title){var i=b.removeLastSplash(e)+"/"+n.title;return _.a.stat(t,i).then(function(e){return[s(e)]},function(e){if(404===e.code)return[];throw e})}return _.a.listChildren(e,t).then(function(e){var t=[],i=e;return m.each(i,function(e){let i=e[".tag"];if(!(n.bFolderOnly&&"folder"!=i||"file"!=i&&"folder"!=i)){var o=s(e);t.push(o)}}),t})},C.upload=function(e,t,n,i,o,r,a,l,d,u){u||(u={}),t&&"root"!==t||(t="");var p;return p=e||b.removeLastSplash(t)+"/"+n,p=b.removeFirstSplash(p),c(d,t).then(function(){return e||(u.bNoOverwrite=!0),_.a.upload(p,i,o,r,a,l,d,u).then(function(e){if(r&&e.name!==b.getFileName(p))return S.log(x,"Dropbox file conflict since etag checked filed: ",p),_.a.deleteFile(d,e.path_lower).then(function(){throw{code:400,message:"Dropbox file conflict. "+e.path_lower+"|ETagChanged"}});var t=s(e);return p!=b.removeFirstSplash(t.id)&&S.warn("upload: found file name conflict, renamed to :",t.id),t})})},C.download=function(e,t,n){n||(n={});var i={};return n.responseType&&"blob"!==n.responseType?"arraybuffer"===n.responseType?i.arraybuffer=!0:"json"===n.responseType?i.json=!0:console.assert(!1):i.blob=!0,n.targetUrl&&(i.targetUrl=n.targetUrl),_.a.download(e,t,i).then(function(e){return"json"===n.responseType?v.default.blobToText(e.fileBlob).then(t=>({cont:t,meta:e})):{cont:e.fileBlob,meta:e}}).then(e=>{let t;return"json"===n.responseType&&(t=JSON.parse(e.cont)),n.bWithETag?{content:e.cont,etag:e.meta.rev}:e.cont},function(e){throw 404===e.code&&(e.message="download: file/folder not found|FileNotFound"),e})},C.moveFile=function(e,t,n,i){n||(n="/"),i||(i=b.getFileName(t));var o=t,r=b.removeLastSplash(n)+"/"+i;return c(e,b.removeFileName(o)).then(function(){return c(e,b.removeFileName(r))}).then(function(){function t(e,n,i,o){return _.a.moveFile(e,n,i).then(function(e){return e.path_lower},function(r){if(404===r.code)return S.error(x,"moveFile: file/folder not found, ignore."),i;if(403===r.code){if(o)throw r;var a=b.genHash(16),l=b.getExtension(i);return i=b.removeExtension(i)+"_#"+a+"#."+l,t(e,n,i,!0)}throw r})}return t(e,o,r,!1)})},C.createDir=function(e,t,n){n&&"root"!==n||(n="");var i=b.removeLastSplash(n)+"/"+t;return c(e,n).then(function(){return _.a.createDir(e,i).then(function(e){return e.path_lower},function(e){if(403===e.code)return S.error(x,"createDir: folder already exist, ignore."),i;throw e})})},C.downloadMeta=function(e,t,n){var i=$.isArray(e);i||(e=[e]);var o=[],r=h.resolve();return m.each(e,function(e){r=r.then(function(){return _.a.stat(t,e).then(function(e){o.push(s(e))})})}),r.then(function(){return i?o:o[0]})},C.deleteFile=function(e,t){return _.a.deleteFile(e,t).catch(function(e){if(404!==e.code)throw e;S.error(x,"deleteFile: file not found, ignore.",t)})},C.share=function(e,t,n){return _.a.share(e,t,n)},C.authenticate=function(e,t){return _.a.authenticate(e,t)},C.authenticateEx=function(e,t,n){return console.assert("Storage"===t),_.a.authenticate(e,n)},C.readyHostFolder=function(e,t){return h.resolve({folderId:e})},C.readyHostFile=function(e,t,n){return C.share(e,n,{}).then(n=>({fileId:e,title:t,hostLink:n.link,link:n.link}))},C.getHostLink=function(e,t){return console.assert(t.hostLink),t.hostLink};var A={name:"LocalNoteProvider",source:"LocalNoteProvider",showName:"LocalNoteProvider"};A.listChildren=function(e,t,n){n||(n={});var i,o="root"!==e&&e?e:"Root";i=ar.lsArticles.filter(function(e){return!(e.bTrash||e.parentName!==o||n.bFolderOnly&&"Folder"!==e.type)});var r=[];return m.each(i,function(e){var t=d(e);r.push(t)}),h.resolve(r)},A.authenticate=function(e,t){return h.resolve()};var L={};L.uploadTryOverwrite=function(e,t,n,i,o,r,a,l,s,c){return e.listChildren(t,s,{title:n}).then(function(d){var u;return u=d.length>0?d[0].id:null,e.upload(u,t,n,i,o,r,a,l,s,c)})}},function(e,t,n){"use strict";function i(e){$("#loading-state").text(e)}function o(){T.info("checkVersion");var e=w.defer();return u().then(function(t){window._versionPassToken=t.versionPassToken,t.newVersion&&(window._serverNewVersion=t.newVersion),e.resolve()}).catch(function(t){var n;n="version-too-low"==t?"version-too-low":"version-error"==t?localString("av_ver_error",k.CLIENT_VERSION):localString("common_net_err_retry_later"),e.reject(n)}),e.promise}function r(){function e(){c().then(function(){_.default.getLoginData("loginToken");var e=_.default.getLoginData("loginUserId"),t=_.default.getLoginData("loginEmail"),n=_.default.getLoginData("loginSignInType"),i=_.default.getLoginData("loginSignInUserId"),o=_.default.getLoginData("loginSignInUserEmail"),r=_.default.getLoginData("loginSignInShowName");_.default.onLoginSuccess(e,t,n,i,o,r)}).catch(function(e){let t=_.default.getShowError(e);$("#loading-state").text(t),_.default.messageBox(localString("common_error"),t,{btnOk:!1})})}T.info("flowLoginStart");var t=_.default.getLoginData("loginToken"),n=_.default.getLoginData("loginUserId"),i=_.default.getLoginData("loginEmail"),o=_.default.getLoginData("loginSignInType"),r=_.default.getLoginData("loginSignInUserId"),a=_.default.getLoginData("loginSignInUserEmail"),l=_.default.getLoginData("loginSignInShowName"),s=_.default.getAppSettings();if(s.bSwitchNewAccount&&(window._bFirstRun=!0,delete s.bSwitchNewAccount,_.default.saveAppSettings()),t&&n)T.info("offline login success"),_.default.onLoginSuccess(n,i,o,r,a,l);else{window._bFirstRun=!0;S("ChromeApp")?m().then(function(){_.default.getLoginData("loginToken");var e=_.default.getLoginData("loginUserId"),t=_.default.getLoginData("loginEmail"),n=_.default.getLoginData("loginSignInType"),i=_.default.getLoginData("loginSignInUserId"),o=_.default.getLoginData("loginSignInUserEmail"),r=_.default.getLoginData("loginSignInShowName");_.default.onLoginSuccess(e,t,n,i,o,r)},function(){e()}):e()}}function a(){return window.arOnlineLoginSuccess?w.resolve():(I=!0,o().then(function(){var e=w.defer(),t=_.default.getAppSettings();return S("ChromeApp")&&!t.loginSignInUserEmail?(T.debug("patch for sign in email"),chrome.identity.getProfileUserInfo(function(n){T.debug("found user profile:",n),C&&(n.id=""),A&&(n.email=""),n.email&&(n.email=n.email.toLowerCase()),n.email||n.id?$.ajax({url:_.default.makeApiUrl("/api/patch-social"),type:"POST",xhrFields:{withCredentials:!0},data:{uid:t.loginUserId,signInType:"Google",signInUserEmail:n.email,signInUserId:n.id}}).done(function(e){t.loginSignInType="Google",n.email&&(t.loginSignInUserEmail=n.email),n.id&&(t.loginSignInUserId=n.id),_.default.saveAppSettings()}).error(function(e){T.error("patch-social failed:",e.responseText)}).always(function(){e.resolve()}):(T.error("no email found, patch failed"),e.resolve())})):e.resolve(),e.promise}).then(function(){var e=_.default.getLoginData("loginToken"),t=_.default.getLoginData("loginUserId");_.default.getLoginData("loginEmail");return d(t,e)}).then(function(){T.info("online login succeed"),window.arOnlineLoginSuccess=!0,I=!1,L.emit("success")},e=>{throw I=!1,L.emit("failed"),e}))}function l(){T.info("getGoogleUserProfile");var e=w.defer();return n.e(7).then(function(){var t=[n(93)];(function(t){t.authenticateEx("google.gdrive0","profile",!0).then(function(){return t.getUserProfile("google.gdrive0")}).then(function(t){var n={signInType:"Google",signInUserId:t.id,signInUserEmail:t.emails&&t.emails.length&&t.emails[0].value,signInShowName:t.displayName};n.signInUserEmail&&(n.signInUserEmail=n.signInUserEmail.toLowerCase()),e.resolve(n)},function(t){let n;n="cancel"===t||t&&"cancel"===t.message?"cancel":S("ChromeApp")?localString("get_google_profile_failed_chrome"):localString("get_google_profile_failed_normal"),e.reject(n)})}).apply(null,t)}).catch(n.oe),e.promise}function s(){var e=w.defer();return $.ajax({url:_.default.makeApiUrl("/api/new-unreg"),type:"POST",xhrFields:{withCredentials:!0},data:{lang:k.lang,market:k.market,versionPassToken:window._versionPassToken,appName:k.appName,version:k.CLIENT_VERSION},success:function(t){var n=_.default.getAppSettings();n.loginUserId=t.uid,n.loginAccountType=t.accountType,n.loginFreePlan=t.freePlan,n.loginProPlan=t.proPlan,n.loginTrialEndDate=new Date(t.trialEndDate),n.loginToken=t.loginToken,n.unregLoginUserId=t.uid,n.unregLoginAccountType=t.accountType,n.unregLoginFreePlan=t.freePlan,n.unregLoginProPlan=t.proPlan,n.unregLoginTrialEndDate=new Date(t.trialEndDate),n.unregLoginToken=t.loginToken,_.default.saveAppSettings(),T.log("a default account created."),e.resolve({uid:t.uid,token:t.loginToken})},error:function(t){T.log(t.responseText+" :: "+t.statusText),e.reject()}}),e.promise}function c(){T.info("flowCreateUnregAccount");var e=w.defer();return i(localString("creating_account")),o().then(function(){return s()}).then(function(t){d(t.uid,t.token).then(function(){e.resolve()},function(t){e.reject(t)})}).catch(function(){e.reject(localString("av_unreg_create_failed"))}),e.promise}function d(e,t){T.info("doOnlineLogin");var n=w.defer(),i={};return i.loginUserId=e,i.loginToken=t,i.lang=k.lang,i.version=k.CLIENT_VERSION,i.bUseCookies=!1,i.versionPassToken=window._versionPassToken,$.ajax({url:_.default.makeApiUrl("/api/auto-login"),type:"POST",xhrFields:{withCredentials:!0},data:i,dataType:"json",success:function(e){var t=e.trialEndDate?new Date(e.trialEndDate):new Date,i=_.default.getAppSettings();if(i.loginAccountType=e.accountType,i.loginFreePlan=e.freePlan,i.loginProPlan=e.proPlan,i.loginTrialEndDate=t,i.loginEmail=e.email,i.loginSignInType=e.signInType,i.loginSignInUserId=e.signInUserId,i.loginSignInUserEmail=e.signInUserEmail,i.loginSignInShowName=e.signInShowName,window.ar_bottomMsgType=e.bottomMsgType,window.ar_bottomMsgBody=e.bottomMsgBody,window.ar_bottomMsgArg=e.bottomMsgArg,e.forceSettings)try{i.forceSettings=JSON.parse(e.forceSettings),_.default.unsafeConvertBoolString(i.forceSettings)}catch(e){i.forceSettings={}}else i.forceSettings={};_.default.saveAppSettings(),$.ajaxSetup({beforeSend:function(t){t.setRequestHeader("X-CSRF-TOKEN",e.loginCsrf)}}),window.loginCsrf=e.loginCsrf,n.resolve({email:e.email,accountType:e.accountType,freePlan:e.freePlan,proPlan:e.proPlan,trialEndDate:t,signInType:e.signInType,signInUserId:e.signInUserId,signInUserEmail:e.signInUserEmail,signInShowName:e.signInShowName})},error:function(e){T.error("online auto-login failed"),T.log(e.responseText+" :: "+e.statusText);var t;t="invalid-token"==e.responseText?localString("av_auto_login_token_error"):"user-not-found"==e.responseText?localString("av_auto_login_user_not_found"):localString("av_online_login_failed"),n.reject(t)}}),n.promise}function u(){return w.Promise(function(e,t){$.ajax({url:_.default.makeApiUrl("/api/check-version"),type:"GET",xhrFields:{withCredentials:!0},timeout:1e4,dataType:"json",data:{version:k.CLIENT_VERSION,osName:k.osName,appName:k.appName,lang:k.lang},success:function(t){e(t)},error:function(e){t(e.responseText)}})})}function p(e,t){var n=w.defer();return $.ajax({url:_.default.makeApiUrl("/api/reg-social"),type:"POST",xhrFields:{withCredentials:!0},data:{uid:e,signInType:t.signInType,signInUserId:t.signInUserId,signInUserEmail:t.signInUserEmail,signInShowName:t.signInShowName}}).done(function(){var e=_.default.getAppSettings();e.loginSignInType=t.signInType,e.loginSignInUserId=t.signInUserId,e.loginSignInUserEmail=t.signInUserEmail,e.loginSignInShowName=t.signInShowName,_.default.saveAppSettings(),n.resolve()}).fail(function(e){n.reject(e.responseText)}),n.promise}function m(){return T.info("flowCreateRegAccountWithGoogle"),o().then(function(){var e=w.defer();return chrome.identity.getProfileUserInfo(function(t){i(localString("creating_account")),T.info("found user info:",t),C&&(t.id=""),A&&(t.email=""),t.email&&(t.email=t.email.toLowerCase()),t.id||t.email?e.resolve({signInUserId:t.id,signInUserEmail:t.email,signInShowName:""}):_.default.messageBoxPromise(localString("signin_run_title"),localString("signin_run_body"),{btnOk:!0,btnCancel:!0,okTitle:localString("signin_run_signin"),cancelTitle:localString("signin_run_exit"),cancelType:"dismissive",parentEl:$("#loading-screen")[0]}).then(function(t){"Ok"===t?l().then(function(t){t.signInUserEmail&&t.signInUserId?e.resolve({signInUserId:t.signInUserId,signInUserEmail:t.signInUserEmail,signInShowName:t.signInShowName}):e.reject("Could not find user email or id")},e.reject):window.close()})}),e.promise}).then(function(e){console.assert(e&&(e.signInUserId||e.signInUserEmail));var t=w.defer();return $.ajax({url:_.default.makeApiUrl("/api/new-social-account"),type:"POST",xhrFields:{withCredentials:!0},data:{versionPassToken:window._versionPassToken,lang:k.lang,market:k.market,appName:k.appName,version:k.CLIENT_VERSION,signInType:"Google",signInUserId:e.signInUserId,signInUserEmail:e.signInUserEmail,signInShowName:e.signInShowName}}).done(function(e){e.bNewUser?T.info("created social account succeed"):(T.info("restored social account succeed"),window._bOldUser=!0);var n=_.default.getAppSettings();n.loginUserId=e.uid,n.loginEmail=e.email,n.loginToken=e.loginToken,n.loginAccountType=e.accountType,n.loginSignInType=e.signInType,n.loginSignInUserId=e.signInUserId,n.loginSignInUserEmail=e.signInUserEmail,n.loginSignInShowName=e.signInShowName,_.default.saveAppSettings(),e.preDefSettings&&(window._preDefSettings=e.preDefSettings),t.resolve(e)}).fail(function(e){t.reject()}),t.promise}).then(function(e){return d(e.uid,e.loginToken)})}function f(e){T.info("signInWithGoogle");var t;return w.resolve().then(function(){return l()}).then(function(e){t=e;var n=w.defer();return $.ajax({url:_.default.makeApiUrl("/api/signin-social"),type:"POST",xhrFields:{withCredentials:!0},data:{versionPassToken:window._versionPassToken,signInType:t.signInType,signInUserId:t.signInUserId,signInUserEmail:t.signInUserEmail,appName:k.appName,version:k.CLIENT_VERSION}}).done(function(e){T.info("sign in with google success"),n.resolve(e)}).fail(function(e){T.error("sign in with google failed",e.responseText),n.reject(e.responseText)}),n.promise}).then(function(t){function n(){return{uid:t.uid,email:t.email,accountType:t.accountType,freePlan:t.freePlan,proPlan:t.proPlan,signInType:t.signInType,signInUserId:t.signInUserId,signInShowName:t.signInShowName}}if(e)return n();var i=_.default.getAppSettings();return i.loginUserId=t.uid,i.loginEmail=t.email,i.loginToken=t.loginToken,i.loginAccountType=t.accountType,i.loginSignInType=t.signInType,i.loginSignInUserId=t.signInUserId,i.loginSignInShowName=t.signInShowName,_.default.saveAppSettings(),d(t.uid,t.loginToken).then(function(e){return n()})})}function h(){T.info("signUpWithGoogle");var e,t=_.default.getLoginData("loginUserId"),n=_.default.getLoginData("loginToken");return l().then(function(n){return e=n,p(t,e)}).then(function(){return d(t,n)}).then(function(e){return{uid:t,email:e.email,accountType:e.accountType,freePlan:e.freePlan,proPlan:e.proPlan,trialEndDate:e.trialEndDate,signInType:e.signInType,signInUserId:e.signInUserId,signInShowName:e.signInShowName}})}function g(){}function v(){return window.arOnlineLoginSuccess?w.resolve():(I||a(),L.take(1).toPromise(w.Promise).then(e=>{if("failed"===e)throw localString("login_app_server_failed")}))}n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"f",function(){return g}),n.d(t,"d",function(){return f}),n.d(t,"e",function(){return h}),n.d(t,"c",function(){return v});var b=n(19),y=(n.n(b),n(23)),w=(n.n(y),n(20)),_=(n.n(w),n(22)),x=n(21),S=(n.n(x),n(6)),k=(n.n(S),n(7)),T=(n.n(k),n(91),n(92),log.reg("onlineMgr")),C=!1,A=!1;let L=new Kefir.Bus,I=!1},function(e,t,n){"use strict";function i(e,t,n,i,o){var a=x.default.htmlToElement(localHtml(T)),l=$(Polymer.dom(a).children),s={cp:e,$panels:l,xSlider:t,$parentPanel:n,home:i,panelFolderLists:[l.filter(".panel-folder-list1"),l.filter(".panel-folder-list2")],$panelProg:l.filter(".panel-prog"),curFolderListIdx:0,curFolderId:void 0,subFolderTitles:[],subFolderIds:[],cachedFolders:{}};if(s.options=v.defaults(o||{},{bSelectFolder:!1,bFolderOnly:!1,actionName:localString("cloud_picker_select"),icon:"icon-file",fileNameFilter:null,mimeTypeFilter:null,fileIdFilter:null,bMultiSel:!1,bDownloadData:!1,gdrive_bSharedWithMe:!1,downloadHook:null,bDontDownload:!1,firstPageBackName:s.$parentPanel?localString("common_back"):localString("common_close"),emptyTitleShowName:"",bUpload:!1,uploadPath:null,uploadMimeType:null,uploadDefTitle:"",bCancelable:!1}),"string"==typeof s.options.fileNameFilter)if("*.*"!==s.options.fileNameFilter&&0===s.options.fileNameFilter.indexOf("*.")){var c=s.options.fileNameFilter.replace("*.","");s.options.fileNameFilter=new RegExp(".("+c+")$","i")}else s.options.fileNameFilter=void 0;return f=["<div class='x-list-group-item file-list-item body-action action-enter-folder' data-fid='{=rt_fileId=}' data-title='{=rt_title=}' data-type='Folder' role='option'>","  <div class='file-item-body'>","    <iron-icon icon='moon:folder' class='file-icon' aria-label='{=aria_folder=}' ></iron-icon>","    <div class='flex'>","      <label class='slide-label single-line-text'>{=rt_title=}</label>","      <div class='small' aria-label='{=aria_modified_date=}: {=rt_mDate=}'>{=rt_mDate=}</div>","    </div>","  </div>","  <div class='slide-arrow'>","    <iron-icon icon='bs:chevron-right' role='presentation' aria-label=''></iron-icon>","  </div>","</div>"].join(""),f=localHtml(f),h=["<div class='x-list-group-item file-list-item' data-fid='{=rt_fileId=}' data-title='{=rt_title=}' data-mime-type='{=rt_mimeType=}' data-type='File' role='option'>","  <div class='file-item-body'>","    <iron-icon icon='bs:file'  class='file-icon' aria-label='{=aria_file=}' ></iron-icon>","    <div>","      <label class='slide-label single-line-text'>{=rt_title=}</label>","      <div class='small' aria-label='{=aria_modified_date=}: {=rt_mDate=}''>{=rt_mDate=}</div>","    </div>","  </div>","</div>"].join(""),h=localHtml(h),g=["<div class='x-list-group-item file-list-item target-file body-action' data-fid='{=rt_fileId=}' data-title='{=rt_title=}' data-mime-type='{=rt_mimeType=}' data-type='File' role='option' aria-selected='false'>","  <div class='file-item-body'>","    <iron-icon icon='{=rt_icon=}' class='file-icon' aria-label='{=aria_file=}' ></iron-icon>","    <div class='flex'>","      <label class='slide-label single-line-text'>{=rt_title=}</label>","      <div class='small' aria-label='{=aria_modified_date=}: {=rt_mDate=}'>{=rt_mDate=}</div>","    </div>","    <iron-icon class='icon-check' icon='check-box-outline-blank' role='presentation' aria-label=''/>","  </div>","</div>"].join(""),g=localHtml(g),l.find(".action-select").each(function(e,t){Polymer.dom(t).innerHTML=s.options.actionName}),Polymer.dom(s.$panelProg.find(".action-back-error")[0]).innerHTML=s.options.firstPageBackName,l.each(function(e,n){Polymer.dom(t).appendChild(n)}),t.forceSynchronousItemUpdate(),r(s),s}function o(e,t){e.leaveCb=t,e.subFolderTitles=[],e.subFolderIds=[],e.cachedFolders={};var n=(e.curFolderListIdx+1)%2;c(e,n,!0),$(".slide-form",e.panelFolderLists[n]).html(""),$(".slide-header label",e.panelFolderLists[n]).html("/"),e.$parentPanel?e.xSlider.slide(e.$parentPanel.attr("name"),e.panelFolderLists[n].attr("name"),!0):e.xSlider.selected=e.panelFolderLists[n].attr("name"),d(e,n,"root").then(function(){e.curFolderId="root",e.subFolderTitles.push(""),e.subFolderIds.push("root"),e.curFolderListIdx=n})}function r(e){function t(e){return e.find(".file-list-item[checked]")}var n=e.$panels;e.home;$(".action-back-folder",n).on("click",function(){var t=(e.curFolderListIdx+1)%2;if($(".slide-form",e.panelFolderLists[t]).html(""),e.subFolderTitles.pop(),e.subFolderIds.pop(),e.subFolderIds.length){var n=v.last(e.subFolderTitles),i=v.last(e.subFolderIds);"root"==i&&(n="/"),$(".slide-header label",e.panelFolderLists[t]).html(n),c(e,t,1===e.subFolderIds.length),e.xSlider.slide(e.panelFolderLists[t].attr("name"),e.panelFolderLists[e.curFolderListIdx].attr("name"),!1),d(e,t,i).then(function(){e.curFolderId=i,e.curFolderListIdx=t})}else e.$parentPanel&&e.xSlider.slide(e.$parentPanel.attr("name"),e.panelFolderLists[e.curFolderListIdx].attr("name"),!1),e.leaveCb&&e.leaveCb("Cancel")}),n.on("click",".file-list-item",function(n){var i=this.classList.contains("file-list-item")?$(this):$(this).parents(".x-list-group-item");if(i.is(".action-enter-folder")){var o=(e.curFolderListIdx+1)%2,r=i.data("fid"),a=i.data("title");$(".slide-form",e.panelFolderLists[o]).html(""),$(".slide-header label",e.panelFolderLists[o]).html(a),c(e,o,!1),e.xSlider.slide(e.panelFolderLists[e.curFolderListIdx].attr("name"),e.panelFolderLists[o].attr("name"),!0),d(e,o,r).then(function(){e.curFolderId=r,e.subFolderTitles.push(a),e.subFolderIds.push(r),e.curFolderListIdx=o})}else if(i.is(".target-file")){e.options.bMultiSel||s(e.panelFolderLists[e.curFolderListIdx]);var l=!i.hasAttr("checked");if(i.attr("aria-selected",l).toggleAttr("checked",l),i.find(".icon-check").attr("icon",l?"check-box":"check-box-outline-blank"),!e.options.bSelectFolder&&!e.options.bUpload){var u=$(this).parents(".slide-panel"),p=t(u);$(".action-select",u).toggleAttr("disabled",0===p.length)}}}),n.on("keydown",".file-list-item",function(e){13===e.keyCode&&($(this).click(),e.preventDefault())}),$(".action-select",n).on("click",function(){function n(t,n,i,o,r){return e.cp.download(t,o,r)}function i(t,n,i){var o;return y.resolve().then(function(){var t=_("MobileApp")?"File":"Blob";return y.ninvoke(ar.fileSystem,"loadFile",e.options.uploadPath,{type:t})}).then(function(e){var t=y.defer();if(_("MobileApp"))o=null,t.resolve();else{var n=e;o=n.type;var i=new FileReader;i.onloadend=function(e){var n=e.target.result;t.resolve(n)},i.readAsArrayBuffer(n)}return t.promise}).then(function(r){var a,l={};_("MobileApp")?(a=null,v.extend(l,{byteLength:r.size,fileUrl:r.localURL})):a=r;var s=e.uploadMimeType||o;return e.cp.upload(t,n,i,a,s,void 0,null,null,A,l)}).then(function(e){return e})}var o=e.subFolderTitles.join("/"),r=e.curFolderId;if(e.options.bSelectFolder){e.$parentPanel&&e.xSlider.slide(e.$parentPanel.attr("name"),e.panelFolderLists[e.curFolderListIdx].attr("name"),!1);var l=[];l.push({fid:r,path:o,title:e.subFolderTitles[e.subFolderTitles.length-1]}),e.leaveCb&&e.leaveCb("Ok",l),e.leaveCb=null}else if(e.options.bUpload){e.xSlider.slide($(this).parents(".slide-panel").attr("name"),e.$panelProg.attr("name"),!0);m=y.resolve();function s(...t){function n(){return(e.options.uploadHook||i)(...t)}return e.options.bCancelable?x.default.cancelable(n,localString("cloud_picker_uploading"),0):n()}var c=e.options.uploadDefTitle;(m=m.then(function(){return $(".text-status",e.$panelProg).html(localString("cloud_saving",c)),s(null,r,c).then(function(t){e.leaveCb&&e.leaveCb("Ok",{meta:t}),e.leaveCb=null},void 0,function(t){if("progress"===t.name)if(t.total){var n=t.loaded/t.total;$(".progress-bar",e.$panelProg)[0].value=100*n;o=b.sprintf("%.2fM / %.2fM",t.loaded/1024/1024,t.total/1024/1024);$(".text-prog",e.$panelProg).text(o)}else{var i=t.loaded,o=b.sprintf("%.2fM / *",i/1024/1024);$(".text-prog",e.$panelProg).text(o),$(".progress-bar",e.$panelProg)[0].indeterminate=!0}})})).then(function(){e.$parentPanel&&e.xSlider.slide(e.$parentPanel.attr("name"),e.$panelProg.attr("name"),!1),e.leaveCb&&e.leaveCb("Ok",p),e.leaveCb=null},function(t){$(".text-status",e.$panelProg).html(localString("gdrive_download_failed",x.default.getShowError(t))),$(".action-back-error",e.$panelProg).show()})}else if(e.options.bDontDownload){var d=t($(this).parents(".slide-panel")),u=v.map(d,function(e){return log.assert($(e).data("meta")),$(e).data("meta")});e.leaveCb&&e.leaveCb("Ok",u),e.leaveCb=null}else{d=t($(this).parents(".slide-panel"));e.xSlider.slide($(this).parents(".slide-panel").attr("name"),e.$panelProg.attr("name"),!0);var p=[],m=y.resolve();function f(...t){function i(){return(e.options.downloadHook||n)(...t)}return e.options.bCancelable?x.default.cancelable(i,localString("cloud_picker_downloading"),0):i()}v.each(d,function(t,n){var i=t.dataset.fid,r=t.dataset.title,a=t.dataset.mimeType;m=m.then(function(){if(e.bCanceled)throw"cancel";return $(".text-status",e.$panelProg).html(localString("gdrive_loading",r)),f(i,r,a,A,e.options.downloadOpts).then(function(e){p.push({fid:i,path:o+"/"+r,title:r,blob:e,mimeType:a})},void 0,function(t){if("progress"===t.name)if(t.total){var n=t.loaded/t.total;$(".progress-bar",e.$panelProg)[0].value=100*n;o=b.sprintf("%.2fM / %.2fM",t.loaded/1024/1024,t.total/1024/1024);$(".text-prog",e.$panelProg).text(o)}else{var i=t.loaded,o=b.sprintf("%.2fM / *",i/1024/1024);$(".text-prog",e.$panelProg).text(o),$(".progress-bar",e.$panelProg)[0].indeterminate=!0}})})}),m.then(function(){e.$parentPanel&&e.xSlider.slide(e.$parentPanel.attr("name"),e.$panelProg.attr("name"),!1),e.leaveCb&&e.leaveCb("Ok",p),e.leaveCb=null},function(t){"cancel"===t||t&&"cancel"===t.appName?(log.log("canceled"),a(e)):($(".text-status",e.$panelProg).html(localString("gdrive_download_failed",x.default.getShowError(t))),$(".action-back-error",e.$panelProg).show())})}}),$(e.xSlider).on("x-slider-end.cloud-picker",function(t){e.$parentPanel&&t.originalEvent.detail.shownPage===e.$parentPanel[0]&&(v.each(e.$panels,function(t){Polymer.dom(e.xSlider).removeChild(t)}),$(e.xSlider).off("x-slider-end.cloud-picker"))}),$(".action-back-error",e.$panelProg).on("click",function(t){l(e)})}function a(e){e.bCanceled=!0,e.$parentPanel&&e.xSlider.slide(e.$parentPanel.attr("name"),e.xSlider.selected,!1),e.leaveCb&&e.leaveCb("CancelNetwork"),e.leaveCb=null}function l(e){e.bCanceled=!0,e.$parentPanel&&e.xSlider.slide(e.$parentPanel.attr("name"),e.xSlider.selected,!1),e.leaveCb&&e.leaveCb("Error"),e.leaveCb=null}function s(e){var t=e.find(".target-file");t.attr("aria-selected",!1).toggleAttr("checked",!1),t.find(".icon-check").attr("icon","check-box-outline-blank")}function c(e,t,n){e.panelFolderLists[t].find(".text-error").text("");var i;i=n?e.options.firstPageBackName:localString("common_back"),e.panelFolderLists[t].find(".action-back-folder").each(function(e,t){Polymer.dom(t).innerHTML=i}),e.options.bUpload&&e.panelFolderLists[t].find(".label-filename").text(e.uploadTitle)}function d(e,t,n){function i(){return e.cp.authenticate(ar.accountId,!0).then(function(){return e.cp.listChildren(n,A,{bFolderOnly:e.options.bFolderOnly})})}var o=e.panelFolderLists[t];if(e.options.bSelectFolder||e.options.bUpload||$(".action-select",o).toggleAttr("disabled",!0),n in e.cachedFolders){$(".slide-form",o).html(e.cachedFolders[n]);return o.find(".icon-check").remove(),o.find(".target-file .file-item-body").append("<iron-icon class='icon-check' icon='check-box-outline-blank' role='presentation' aria-label=''/>"),y.resolve()}var r=x.default.addActivityAnimation(o,!0),l=[];return(e.options.bCancelable?x.default.cancelable(i):i()).then(function(t){if(v.each(t,function(t){var n,i=t.mDate.toLocaleString(),o=!0;if("Folder"===t.type)n=localHtml(f,{rt_title:t.title||e.options.emptyTitleShowName,rt_fileId:t.id,rt_mDate:i}),o=!1;else if("File"===t.type){var r=t.title.toLowerCase();e.options.bUpload?o=!1:(e.options.fileNameFilter&&!e.options.fileNameFilter.test(r)&&(o=!1),e.options.mimeTypeFilter&&!x.default.testStringFilter(e.options.mimeTypeFilter,t.mimeType)&&(o=!1),e.options.fileIdFilter&&!x.default.testStringFilter(e.options.fileIdFilter,t.id)&&(o=!1)),n=o?localHtml(g,{rt_title:t.title||e.options.emptyTitleShowName,rt_fileId:t.id,rt_mimeType:t.mimeType,rt_mDate:i,rt_icon:e.options.icon}):localHtml(h,{rt_title:t.title||e.options.emptyTitleShowName,rt_fileId:t.id,rt_mimeType:t.mimeType,rt_mDate:i})}var a=x.default.htmlToElement(n);$(a).data("meta",t),l.push(a)}),l=l.sort(u),e.options.gdrive_bSharedWithMe&&"root"===n&&"GDrive"===e.cp.name){var i=localHtml(f,{rt_title:localString("gdrive_shared_with_me"),rt_fileId:"SharedWithMe",rt_mDate:(new Date).toLocaleString()}),o=x.default.htmlToElement(i);$(o).find(".file-icon").css("color","#8a6d3b"),l.unshift(o)}},null).then(function(){$(".slide-form",o).empty(),$(".slide-form",o).append(l),r.parentNode.removeChild(r),e.cachedFolders[n]=l},function(t){I.fail(L,t),r.parentNode.removeChild(r),"cancel"===t?(log.log("canceled"),a(e)):$(".text-error",o).text(localString("gdrive_fetch_list_failed",x.default.getShowError(t)))})}function u(e,t){if(e.dataset.type!==t.dataset.type)return"File"===e.dataset.type?1:-1;var n=e.dataset.title.toLowerCase(),i=t.dataset.title.toLowerCase();return n>i?1:n<i?-1:0}function p(e,t,n){$("#modal-cloud-picker").remove();var o=$(x.default.htmlToElement(localHtml(C))),r=i(e,o.find("x-slider")[0],null,t,n);return r.$modal=o,r}function m(e,t){w.vars.$appBody.append(e.$modal),e.$modal.showModal(),o(e,function(n,i){"CancelNetwork"===n&&x.default.toastShowShortCenter(localString("operation_canceled")),e.$modal.hideModal(),t(n,i)})}n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return p}),n.d(t,"d",function(){return m});var f,h,g,v=n(19),b=(n.n(v),n(23)),y=(n.n(b),n(20)),w=(n.n(y),n(91),n(8)),_=n(6),x=(n.n(_),n(22)),S=n(21),k=(n.n(S),n(7)),T=(n.n(k),n(92),n(151)),C=(n.n(T),n(152)),A=(n.n(C),"google.gdrive0"),L="[cloudPicker]",I=log.reg("cloudPicker")},function(e,t,n){"use strict";function i(e){var t=$(e).parent().closest(".line");return t.length?t.line():null}function o(e){var t=$(e),n=t.childLns();return n.length?o(n[n.length-1]):t}function r(e){return e.find(">.children").length||e.append("<div class='children'></div>"),e.find(">.children")}function a(){let e,t=P.default.getSelection();if(t&&t.createRange)return(e=t.createRange()).htmlText;if(t){if(console.debug("rangecount: "+t.rangeCount),t.rangeCount>0){var n=(e=t.getRangeAt(0)).cloneContents(),i=document.createElement("div");return i.appendChild(n),i.innerHTML}return""}return""}function l(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=P.default.getSelection();n.removeAllRanges(),n.addRange(t)}function s(e,t){var n=c(e,t);return n.bFound?n.chars:-1}function c(e,t){if(e===t)return{bFound:!0,chars:0};if("#text"===e.nodeName)return{bFound:!1,chars:e.length};for(var n=e.firstChild,i=0,o=!1;n;){var r=c(n,t);if(r.bFound){o=!0,i+=r.chars;break}i+=r.chars,n=n.nextSibling}return{bFound:o,chars:i}}function d(e,t){var n=t;if(!n){var i=P.default.getSelection();if(!(n=i.rangeCount&&i.getRangeAt(0)))return-1}var o=s(e,n.startContainer);return-1!==o?o+n.startOffset:-1}function u(e,t){var n=t;if(!n){var i=P.default.getSelection();if(!(n=i.rangeCount&&i.getRangeAt(0)))return{start:-1,end:-1}}var o=s(e,n.startContainer);if(-1===o)return{start:-1,end:-1};var r=s(e,n.endContainer);return{start:o+n.startOffset,end:r+n.endOffset}}function p(e,t){var n=m(e,t);return n.bFound?{node:n.node,offset:n.offset}:null}function m(e,t){if("#text"===e.nodeName)return e.length>=t?{bFound:!0,node:e,offset:t}:{bFound:!1,lastOffset:t-e.length};var n,i,o,r=!1;if(e.firstChild||0!==t){var a=e.firstChild;for(o=t;a;){var l=m(a,o);if(l.bFound){r=!0,n=l.node,i=l.offset;break}o=l.lastOffset,a=a.nextSibling}}else r=!0,n=e,i=0;return r?{bFound:!0,node:n,offset:i}:{bFound:!1,lastOffset:o}}function f(e,t,n){var i=p(e,t);if(!i)return!1;var o;if(null!=n&&!(o=p(e,n)))return!1;var r=document.createRange();r.setStart(i.node,i.offset),o?r.setEnd(o.node,o.offset):r.collapse(!0);var a=P.default.getSelection();return a.removeAllRanges(),a.addRange(r),!0}function h(){$.fn.line=function(){return this.data("line")},$.fn.lines=function(){return L.map(this,function(e){return $(e).line()})},$.fn.lnContent=function(){return this.find(D.a.CONT_SELECTOR)},$.fn.tlHtml=function(){var e=this.lnContent().html();return D.a.FIX_NO_BACKSPACE_EVT&&0===e.indexOf(D.a.FIX_NO_BACKSPACE_LEADING_STR)&&(e=e.substr(D.a.FIX_NO_BACKSPACE_LEADING_STR.length)),e},$.fn.lnName=function(){return this.length?this[0].dataset.name:void 0},$.fn.lnType=function(){return this.length?this.line().type:void 0},$.fn.lineNames=function(){return L.map(this,function(e){return e.dataset.name})},$.fn.parentLn=function(){return this.parent().closest(".line")},$.fn.childLns=function(e){return e?this.find(".line"):this.find(">.children >.line")},$.fn.prevLn=function(){return this.prev(".line")},$.fn.nextLn=function(){return this.next(".line")},$.fn.aboveLn=function(e){var t=this.prevLn(),n=t.length?o(t):$();if(!n.length){var i=this.parentLn();i.line().name!==D.a.LN_ROOT_NAME&&(n=i)}return n.length&&e&&n.lnType()!==e?n.aboveLn(e):n},$.fn.belowLn=function(e){var t=$(),n=(this.parentLn(),this);for(t=n.childLns().first();!t.length&&(t=n.nextLn(),(n=n.parentLn()).length););return t.length&&e&&t.lnType()!==e?t.belowLn(e):t},$.fn.myLastLn=function(){var e=this.childLns(!0).last();return e.length||(e=this),e}}function g(e){return e.target.classList.contains("content")||0!==$(e.target).parents(".content").length}function v(e){e.el.addEventListener("keydown",t=>{let n=!1;if(P.default.isCopyKeyEvt(t)){let i,o,r=P.default.getSelection(),a=!1,l=g(t);l||(a=!0,i=e.$el[0],o=P.default.selectRangeProxy(r,i)),_(function(t){a&&P.default.unselectRangeProxy(r,i,o),e.handleCopy(t,l)}),document.execCommand("Copy",!1,null),n=!0}else if(P.default.isPasteKeyEvt(t)){let i=g(t);S(function(t){e.handlePaste(t,i)}),document.execCommand("Paste",!1,null),n=!0}else if(P.default.isCutKeyEvt(t)){let i,o,r=P.default.getSelection(),a=!1,l=g(t);l||(a=!0,i=e.$el[0],o=P.default.selectRangeProxy(r,i)),x(function(t){a&&P.default.unselectRangeProxy(r,i,o),e.handleCut(t,l)}),document.execCommand("Cut",!1,null),n=!0}n&&(t.preventDefault(),t.stopPropagation())},!0),M.vars.appDoc.addEventListener("copy",function(e){T&&(T(e),T=null)},!0),M.vars.appDoc.addEventListener("paste",function(e){A&&(A(e),A=null)},!0),M.vars.appDoc.addEventListener("cut",function(e){C&&(C(e),C=null)},!0)}function b(e){k=e}function y(){return k}function w(e,t,n,i,o,r,a){if(a)return r?e.makeBmTimeStr(o+t)+"-"+e.makeBmTimeStr(r+t):e.makeBmTimeStr(o+t);if(r){if(o>t&&o<n?o=t:o>n&&(o+=i),r>t&&r<n?r=t:r>n&&(r+=i),r-o>.1)return e.makeBmTimeStr(o)+"-"+e.makeBmTimeStr(r)}else if(o>=t&&o<n?o=null:o>=n&&(o+=i),o)return e.makeBmTimeStr(o);return null}function _(e){T=e}function x(e){C=e}function S(e){A=e}n.d(t,"c",function(){return V}),n.d(t,"d",function(){return ie}),n.d(t,"b",function(){return K}),n.d(t,"f",function(){return X}),n.d(t,"e",function(){return Y}),n.d(t,"a",function(){return J}),n.d(t,"h",function(){return z}),n.d(t,"g",function(){return G}),n.d(t,"p",function(){return h}),n.d(t,"t",function(){return _}),n.d(t,"r",function(){return b}),n.d(t,"m",function(){return y}),n.d(t,"j",function(){return v}),n.d(t,"i",function(){return w}),n.d(t,"n",function(){return d}),n.d(t,"o",function(){return u}),n.d(t,"q",function(){return l}),n.d(t,"s",function(){return f}),n.d(t,"l",function(){return p}),n.d(t,"k",function(){return o});var k,T,C,A,L=n(19),I=(n.n(L),n(23)),E=(n.n(I),n(20)),N=(n.n(E),n(6)),P=(n.n(N),n(22)),F=n(21),D=(n.n(F),n(91)),M=n(8),O=n(7),R=(n.n(O),n(101)),U=(n(92),n(98)),B=M.isXSmall()?D.a.XS_IMG_MIN_WIDTH:D.a.PAD_IMG_MIN_WIDTH,H=M.isXSmall()?D.a.XS_IMG_MAX_WIDTH:D.a.PAD_IMG_MAX_WIDTH,j=["<div class='line' data-name='{=rt_name=}' data-type='text' style='min-height: {=rt_min_height=}px'>","  <div class='content'>{==rt_content==}</div>","</div>"].join(""),W=["<div class='line' data-name='{=rt_name=}' data-type='image'>","  <div class='content'></div>","</div>"].join(""),V=L.extend(Object.create(P.default.MObject),{create:function(e,t,n){var i=this;L.extend(i,{home:e,el:t,$el:$(t),scrollEl:n,$scrollEl:$(n),bEditable:!0,bModified:!1,editingTextCntCmd:null,$seledLns:$(),$activeLn:$(),activeLnLocalState:null,$keySelStartLn:$(),$keySelEndLn:$(),$selStartLn:$(),savedInsertPos:{$activeLn:$(),$cursorLn:$(),charOffset:0,$seledLns:$()},bMuteMouse:!1,lineHandlers:{},lastAsyncCmdTask:E(),dirtyListTypeLns_:{}}),i.history=Object.create(U.c),i.history.create(),i.$el.attr("tabindex","-1"),i.$el.addClass("line-editor line"),i.$el[0].dataset.name=D.a.LN_ROOT_NAME,r(i.$el),i.$el.append("<div class='bottom-guard'></div>");var o,a=i.$el.css("line-height");o=a&&a.indexOf("px")===a.length-2?parseInt(a.replace("px","")):22,i.setLineHeight(o),i.bindEvents_();var l=Object.create(R.a);l.create(),i.setModel(l)},normalizeImage:function(e){var t=this,n=t.calcImageViewSize(e);"right"===(e.data("curAlign")||e.line().imgAlign)?(e.lnContent().css("height",t.lineHeight).find(".fly").css("height",n.height),e.data("flyHeight",n.height)):(e.lnContent().css("height",n.height),e.data("flyHeight",null))},calcImageViewSize:function(e){var t=this,n=t.lineHeight,i=e.line(),o=(e.line(),t.imageHandler.lineToImage(e),Math.max(B,i.viewWidth?i.viewWidth-10:i.imgWidth));o=Math.min(H,o);var r=Math.round(i.imgHeight/i.imgWidth*(o-10)+10)+4+0;return r+=n-r%n,{width:o,height:r}},getBelowPos:function(e){var t,n=this,o=e.childLns();if(o.length)t=$(o[0]).line();else{var r=e.nextLn();t=r.length?r.line():n.ldoc.getEndChildPos(i(e))}return t},commonNewLineByEnter:function(e,t){var n=this,i=(e.length&&e.line(),e.lnContent(),n.commonNewLinesAtActive(e,t,!0));return L.each(i,function(e){(e.type!==D.a.LineType.TEXT||n.lineToJLine(e).lnContent().text())&&n.triggerLineAbm(n.lineToJLine(e))}),n.linesToJLines(i)},commonNewLinesAtActive:function(e,t,n,i){var o,r=this,a=t?e.line():r.getBelowPos(e),l=[r.ldoc.newTextLine("")],s=a,c=Object.create(U.a);c.create(),(o=Object.create(Y)).create(r),c.add(o),L.each(l,function(e){var t,n=P.default.fastFindWhere(l,"name",e.parentName),i=Object.create(K);t=n?r.ldoc.getEndChildPos(n):s,i.create(r,e,t.name),c.add(i)}),(o=Object.create(J)).create(r,l[0].name),c.add(o);var d=c.execute();return console.assert(E(d).isFulfilled()),c,n?r.history.add(c):i&&i.add(c),l},onNewLines_:function(e){var t=this;if(e.length){("Insert"===ar.recContType||"Replace"===ar.recContType)&&e.addClass("inserting");var n=!1;L.each(e,function(e){var i=$(e);null!=$(e).line().time&&(n=!0,t.fire("time-changed",i))}),n&&t.fire("abm-changed"),L.each(e,function(e){var i=$(e).line();(i.type!==D.a.LineType.TEXT||$(e).lnContent().text())&&t.triggerLineAbm($(e)),null!=i.time&&(n=!0)}),t.reposLinesJob(),L.each(e,function(e){t.fire("new-line",$(e))})}},onRemoveLines_:function(e){var t=this;e.length&&(t.reposLinesJob(),L.each(e,function(e){var n=$(e);t.$seledLns.has(n).length&&t.removeSeledLine(n)}),t.$activeLn.length&&e.has(t.$activeLn)&&(t.$activeLn=$()))},bindEvents_:function(){var e=this;!function(){var t;e.el.addEventListener("mousedown",function(n){var i=e.$el.find(".fly");L.every(i,function(e){var i=e.getClientRects()[0];return!(n.clientX>=i.left&&n.clientX<i.right&&n.clientY>=i.top&&n.clientY<i.bottom)||(t=e,!1)}),t&&(n.preventDefault(),n.stopPropagation())},!0),e.el.addEventListener("mouseup",function(e){t&&(e.preventDefault(),e.stopPropagation())},!0),e.el.addEventListener("click",function(n){t&&(L.delay(function(){t.focus(),e.imageHandler.onImageClicked(t.firstChild),t=null}),n.preventDefault(),n.stopPropagation())},!0)}(),e.$el.on("mousedown",function(t){if(!e.bMuteMouse){var n=void 0;if(1===t.which){if(e.$el.find(".line").removeClass("selected"),e.$selStartLn=e.$findCurLn(t.target),e.clearSeledLines(),e.$keySelStartLn=$(),e.bSelecting=!0,e.lastInContentRange=null,e.selMouseStartY=t.clientY,e.$selStartLn.length){var i=e.$selStartLn.lnContent();e.selCancelTop=i.offset().top,e.selCancelHeight=i.height();var o=e.lineHandlers[e.$selStartLn.line().type];e.selStartActiveState=o.getLineActiveState(e.$selStartLn)}if(e.bEditable)if(t.target===e.el){var r=e.$el.childLns(!0);if(r.length){var a=r.last();e.setActiveLn(a),n=!1}else{var l=e.ldoc.newTextLine();e.ldoc.append(l);var s=e.applyLine_(l);e.setActiveLn(s),n=!1}}else if(t.target.classList.contains("children")){var c,d=e.$el.childLns(!0);L.every(d,function(e){var n=$(e);return!(n.offset().top>t.pageY)&&(c=n,!0)}),c&&(e.getLineHandler(c.lnType()).activateLine(c),n=!1)}}return n}}),e.$el.on("mouseup",function(t){e.bMuteMouse||e.bSelecting&&(e.bSelecting=!1,e.$seledLns.length&&(P.default.getSelection().removeAllRanges(),e.focusWithoutScrolling()))}),e.$el.on("mousemove",function(t){if(!e.bMuteMouse){var n=void 0;if(1===t.which&&e.bSelecting&&e.$selStartLn.length)if(t.clientY>=e.selCancelTop&&t.clientY<e.selCancelTop+e.selCancelHeight)e.$el.find(".line").removeClass("selected"),e.clearSeledLines(),e.lastInContentRange&&((l=P.default.getSelection()).removeAllRanges(),l.addRange(e.lastInContentRange),e.lastInContentRange=null);else{var i=t.clientY>e.selMouseStartY?t.clientY-e.selOverlayHeight:t.clientY+e.selOverlayHeight,o=M.vars.appDoc.elementFromPoint(t.clientX,i),r=e.$findCurLn(o);if(r.length){e.$el.find(".line").removeClass("selected");var a=e.findRangeLines_(e.$selStartLn,r);L.each(a,function(t){e.addSeledLine($(t))});var l=P.default.getSelection();e.$seledLns.length||(e.lastInContentRange=l.rangeCount?l.getRangeAt(0):null,l.rangeCount&&l.collapseToEnd(),e.focusWithoutScrolling()),n=!1}}return n}}),e.$el.on("input",".content",function(e){return!1}),e.$el.on("keydown",".content, .fly",function(t){var n=e.$findCurLn(this),i=n.length&&n.line();if(!(s=e.getLineHandler(i.type)).handleContentKeyDown(n,t)){var o=n.parentLn(),r=(o.length&&o.line(),n.prevLn()),a=(r.length&&r.line(),n.nextLn()),l=(a.length&&a.line(),void 0);if(9!==t.keyCode||t.shiftKey){if(9===t.keyCode&&t.shiftKey)e.cmdOutdent_(),t.preventDefault(),t.stopPropagation();else if(38===t.keyCode||40===t.keyCode){if(t.shiftKey){e.$keySelStartLn=n,e.$keySelEndLn=n;var s=e.lineHandlers[i.type];e.selStartActiveState=s.getLineActiveState(n),e.clearSeledLines(),e.addSeledLine(n),40===t.keyCode&&(e.$keySelEndLn=n.myLastLn()),e.focusWithoutScrolling()}else if(38===t.keyCode){var c=n.aboveLn();c.length&&e.setActiveLn(c)}else{var d=n.belowLn();d.length&&e.setActiveLn(d)}l=!1}}else e.cmdIndent_(),t.preventDefault(),t.stopPropagation();return l}}),e.$el.on("focus",function(e){e.stopPropagation()}),e.$el.on("keydown",function(t){var n=void 0;if(8===t.keyCode||46===t.keyCode)e.handleDel(!1),n=!1;else if(9!==t.keyCode||t.shiftKey){if(9===t.keyCode&&t.shiftKey)e.cmdOutdent_(),n=!1;else if(P.default.isSelAllKeyEvt(t)){e.clearSeledLines();var i=e.$el.childLns();L.each(i,function(t){e.addSeledLine($(t))}),n=!1}else if(38===t.keyCode||40===t.keyCode){if(t.shiftKey){if(e.$keySelStartLn.length){var o=38===t.keyCode?e.$keySelEndLn.aboveLn():e.$keySelEndLn.belowLn();if(o.length){var r=e.findRangeLines_(e.$keySelStartLn,o);e.clearSeledLines(),L.each(r,function(t){e.addSeledLine($(t))}),e.$keySelEndLn=o,40===t.keyCode&&(e.$keySelEndLn=r.last().myLastLn())}}}else e.$keySelStartLn.length?(e.clearSeledLines(),e.setActiveLn(e.$keySelStartLn,e.selStartActiveState),e.selStartActiveState=null,e.$keySelStartLn=$(),e.$keySelEndLn=$()):e.$selStartLn.length&&(e.clearSeledLines(),e.setActiveLn(e.$selStartLn,e.selStartActiveState),e.selStartActiveState=null,e.$selStartLn=$());n=!1}}else e.cmdIndent_(),n=!1;return n}),e.history.on("executed unexecuted",function(){e.setModified(!0),e.bEditable||log.error("readonly leditor was modified!")}),e.$el.on("click",".line-abm",function(t){e.fire("click-line-abm",parseFloat(this.dataset.time))})},makeNewImageCopy:function(e,t){console.assert(e.type===D.a.LineType.IMAGE);var n=this,i=e.filename,o=t+"/images/"+i,r=n.imageHandler.getImageTrashDir()+"/"+i,a=F.genHash(16)+"."+F.getExtension(i);return E().then(function(){return E.ninvoke(ar.fileSystem,"testFile",o)}).then(function(e){var t=e?o:r;return E.ninvoke(ar.fileSystem,"copyTo",t,n.noteDir+"/images/"+a)}).then(function(){e.filename=a})},cmdInsertLine:function(e,t){var n=this,i=Object.create(K);i.create(n,e,t.name),i.execute(),n.history.add(i);var o=n.findLineElem(e.name);return n.onNewLines_(o),o},insertLinesAtBestPos:function(e,t,n,i){var o,r,a=this,l=$(),s=Object.create(U.a);if(s.create(),s.execute(),e.$seledLns.length)o=a.ldoc.getNextPos(e.$seledLns.last().line());else if(e.$activeLn.length){var c=a.lineHandlers[e.$activeLn.line().type].readyNewLinePos(e.$activeLn,e.activeLnLocalState);c&&(o=c.insertPos,c.undoCmd&&s.add(c.undoCmd),c.$splitLn&&$.merge(l,c.$splitLn),c.bEmptyLn&&(r=e.$activeLn))}else e.bAppend&&(o=a.ldoc.getAllEndPos());if(!o)return log.error("invalid pos"),$();var d=Object.create(te);return d.create(a,null,!0),d.execute(),s.add(d),L.each(t,function(e){var n,i=P.default.fastFindWhere(t,"name",e.parentName),r=Object.create(K);n=i?a.ldoc.getEndChildPos(i):o,r.create(a,e,n.name),r.execute(),s.add(r),$.merge(l,a.lineToJLine(e))}),a.$seledLns.length&&((d=a.makeRemoveLinesCmd(a.$seledLns)).execute(),s.add(d),a.clearSeledLines()),r&&((d=a.makeRemoveLinesCmd(r)).execute(),s.add(d)),i&&t.length&&((d=Object.create(ne)).create(a,L.map(t,"name")),d.bMakeVisible=!0,d.execute(),s.add(d)),n?n.add(s):a.history.add(s),a.onNewLines_(l),l},handleNormalPaste:function(e,t){var n=this,i=n.makeInsertPos(),o=e.clipboardData.getData("micnote/line");if(o){e.preventDefault();var r=JSON.parse(o);L.each(r.lines,function(e){var t=R.b(),n=L.where(r.lines,{parentName:e.name});L.each(n,function(e){e.parentName=t}),e.name=t});var a=L.where(r.lines,{type:D.a.LineType.IMAGE});L.reduce(a,function(e,t){return e.then(function(){return n.makeNewImageCopy(t,r.noteDir).catch(function(){log.error("copy image failed, ignore. did you paste from another instance?")})})},E()).then(function(){n.insertLinesAtBestPos(i,r.lines,null,!0)}).catch(function(e){P.default.toastShowLongCenter(localString("common_failed","error"))})}else n.imageHandler.handleNormalPaste(i,e)||L.every(n.lineHandlers,function(t){if(t!==n.imageHandler)return!t.handleNormalPaste(i,e)})},copyLines:function(e,t,n){var i=this,o=[];if(n)o=e.lines();else{var r=[];L.each(e,function(e){var t=$(e).line();r.push(t);var n=$(e).find(".line");L.each(n,function(e){r.push($(e).line())})}),o=r}var a=JSON.stringify({noteDir:i.noteDir,lines:o});t.setData("micnote/line",a);var l="",s=[];L.each(e,function(e){var t=$(e);l+=i.doGenReadableHtml(t,"div",!1,n),i.doGenReadableText(s,t,0,"",n)}),t.setData("text/html",l);var c=s.join("\n");t.setData("text/plain",c)},doGenReadableHtml:function(e,t,n,i){var o=this,r=e.line(),a=o.getLineHandler(r.type),l="";if(t){let i;l+="<"+t+">"+(i=n&&r.time?"<span style='color:rgb(66, 139, 202)'>["+o.home.makeBmTimeStr(r.time)+"]</span>":"")+a.toReadableHtml(e,n)+"</"+t+">"}var s=e.childLns();if(!i&&s.length){var c="";L.each(s,function(e,t){var i=$(e);r.listType===D.a.ListType.NULL?c+=o.doGenReadableHtml(i,"div",n,!1):r.listType===D.a.ListType.BULLET?c+=o.doGenReadableHtml(i,"li",n,!1):r.listType===D.a.ListType.NUMBERED&&(c+=o.doGenReadableHtml(i,"li",n,!1))}),r.listType===D.a.ListType.NULL?l+="<blockquote style='margin-left: 2em'>"+c+"</blockquote>":r.listType===D.a.ListType.BULLET?l+="<ul>"+c+"</ul>":r.listType===D.a.ListType.NUMBERED&&(l+="<ol>"+c+"</ol>")}return l},doGenReadableText:function(e,t,n,i,o,r){var a=this,l=t.line(),s=a.getLineHandler(l.type),c=n||0,d=i||"";r||e.push("    ".repeat(c)+d+s.toReadableText(t));var u=t.childLns();!o&&u.length&&L.each(u,function(t,n){var i=$(t);l.listType===D.a.ListType.NULL?a.doGenReadableText(e,i,c+1,"",!1):l.listType===D.a.ListType.BULLET?a.doGenReadableText(e,i,c+1,"* ",!1):l.listType===D.a.ListType.NUMBERED&&a.doGenReadableText(e,i,c+1,n+1+". ",!1)})},genReadableHtml:function(e){var t=this;return t.doGenReadableHtml(t.$el,null,e)},genReadableText:function(){var e=this,t=[];return e.doGenReadableText(t,e.$el,0,"",!1,!0),t.join("\n")},copySelectedLines:function(e){var t=this;return!!t.$seledLns.length&&(t.copyLines(t.$seledLns,e.clipboardData),!0)},flatLns:function(e){var t=$();return L.each(e,function(e){var n=$(e),i=n.childLns(!0);$.merge(t,n),$.merge(t,i)}),t},makeRemoveLinesCmd:function(e){var t=this,n=Object.create(U.a);n.create();var i=t.flatLns(e).lines();return L.each(i.reverse(),function(e){var i=Object.create(X);i.create(t,e),n.add(i)}),n},doRemoveLines:function(e,t){var n=this,i=[];L.each(e,function(e){var t=$(e);i.push(t.parentLn()[0]),n.getLineHandler(t.lnType()).removeLine(t)}),t&&(i=L.uniq(i),L.each(i,function(e){$(e).line().listType!==D.a.ListType.NULL&&n.applyListTypeJob($(e),!1)}))},empty:function(){this.el.dataset.name="",this.$el.find(">.children").empty(),this.$seledLns=$()},setModel:function(e,t){var n=this;n.ldoc=e,n.noteDir=t,n.bModified=!1,n.commit=F.genCommitHash(),n.history.clear(),n.updateActiveLn(null),n.clearSeledLines(),n.dirtyListTypeLns_={},n.stopAllJobs(),n.empty(),e&&(n.$el.data("line",e.root),n.el.dataset.name=e.root.name,n.ldoc.walk(function(e){e.name!==D.a.LN_ROOT_NAME&&n.applyLine_(e,!0)}),L.each(n.ldoc.lines,function(e){var t=n.findLineElem(e);n.applyListType_(t)}),n.reposLinesJob(),n.fire("model-changed"),n.fire("abm-changed"))},getModel:function(){return this.ldoc},$findCurLn:function(e,t){var n=this;if(!e||!n.$el.has(e))return $();if(e.classList.contains("fly"))return n.findLineElem(e.dataset.lnName);var i=e?$(e).closest(".line"):$();return i.length&&!t&&i.lnName()===D.a.LN_ROOT_NAME?$():i},findLineElem:function(e){var t="string"==typeof e?e:e.name,n=this;return t===D.a.LN_ROOT_NAME?n.$el:n.$el.find("*[data-name='"+t+"']")},getAllLns:function(e){var t=this.$el.childLns(!0);return e&&$.merge(t,this.$el),t},lineToJLine:function(e){return this.findLineElem(e.name)},linesToJLines:function(e){var t=this,n=[];return L.each(e,function(e){var i=t.findLineElem(e.name);n.push(i[0])}),$(n)},applyLine_:function(e,t){var n,i=this;if(e.type===D.a.LineType.TEXT){var o;o=e.content,n=localHtml(j,{rt_name:e.name,rt_content:o,rt_min_height:i.lineHeight})}else e.type===D.a.LineType.IMAGE?n=localHtml(W,{rt_name:e.name}):console.assert(!1);var a=P.default.htmlToElement(n),l=$(a),s=i.ldoc.findPrev(e);if(s){var c=i.findLineElem(s.name);l.insertAfter(c)}else{var d=i.findLineElem(e.parentName);console.assert(d.length),r(d).prepend(a)}if(l.data("line",e),e.type===D.a.LineType.IMAGE){var u=new Image,p=$(u);p.css("width","number"==typeof e.viewWidth?e.viewWidth:""),p.css("height",""),p.css("max-width",H),p.css("min-width",B),p.addClass("il-img"),u.src=m;var m;i.imageHandler.handleImageSrc?i.imageHandler.handleImageSrc(u,e):u.src=ar.fileSystem.getDirUrl(i.noteDir+"/images")+"/"+e.filename,i.reposImageLine(l,p)}if(i.setLineEditable(l),!t){var f=l.parent().closest(".line");i.applyListTypeJob(f)}return l},isModified:function(){return this.bModified},setModified:function(e){var t=this.bModified;this.bModified=e,e&&(this.commit=F.genCommitHash()),t!==e&&this.fire("modified-changed",e)},getCommit:function(){return this.commit},autoSave:function(){var e=this;L.each(e.lineHandlers,function(e){e.autoSave()})},applyListTypeJob:function(e,t){var n=this,i=n.dirtyListTypeLns_[e.lnName()];i?i.bRecursive=t||i.bRecursive:n.dirtyListTypeLns_[e.lnName()]={bRecursive:!!t},n.job("applyListType",function(){L.each(n.dirtyListTypeLns_,function(e,t){var i=n.findLineElem(t);i.length&&n.applyListType_(i,e.bRecursive)}),n.dirtyListTypeLns_={}})},applyListType_:function(e,t){var n=this,i=e.line();if(i){var o,r=i.listType,a=e[0];r===D.a.ListType.NULL?delete a.dataset.list:r===D.a.ListType.BULLET?(o="bullet",a.dataset.list=o):r===D.a.ListType.NUMBERED?(o="numbered",a.dataset.list=o):log.assert(!1);var l=e.find(">.children>.line");if(r===D.a.ListType.NULL)delete a.dataset.listLevel,l.find(">.prefix").remove();else{l.find(">.prefix").remove();var s=a===n.el?0:e.parents(".line:not(.line-editor)").length+1;L.each(l,function(e,t){var i,o=$(e);if(r===D.a.ListType.BULLET){s%=7,a.dataset.listLevel=s;l=["<div class='prefix' style='height:{=rt_height=}px'>","<div></div>","</div>"].join("");i=localHtml(l,{rt_height:n.lineHeight})}else if(r===D.a.ListType.NUMBERED){var l="<div class='prefix' style='height:{=rt_height=}px'>{=rt_mark=}</div>";s%=6,a.dataset.listLevel=s;var c;c=0===s?t+1+".":1===s?String.fromCharCode("a".charCodeAt(0)+t%26).repeat(parseInt(t/26)+1)+".":2===s?P.default.romanize(t+1).toLowerCase()+".":3===s?t+1+")":4===s?String.fromCharCode("a".charCodeAt(0)+t%26).repeat(parseInt(t/26)+1)+")":P.default.romanize(t+1).toLowerCase()+")";i=localHtml(l,{rt_height:n.lineHeight,rt_mark:c})}var d=P.default.htmlToElement(i);o.append(d)})}t&&L.each(l,function(e){n.applyListType_($(e),!0)})}else log.assert(!1,"no linked line data found")},cmdIndent_:function(e){var t,n=this;if(!(t=n.$seledLns.length?n.$seledLns:n.$activeLn)||!t.length)return!1;var i=Object.create(U.a);i.create();var o=Object.create(Y);o.create(n),i.add(o);var r=0;return L.each(t,function(e){var t=$(e).line();(o=Object.create(Z)).create(n,t.name),o.isValid()&&(r++,i.add(o))}),(o=Object.create(J)).create(n),o.saveCurrent(),i.add(o),r===t.length&&(i.execute(),n.history.add(i)),!0},cmdOutdent_:function(e){var t,n=this;if(!(t=n.$seledLns.length?n.$seledLns:n.$activeLn)||!t.length)return!1;var i=Object.create(U.a);i.create();var o=Object.create(Y);o.create(n),i.add(o);var r=0,a=L.toArray(t).reverse();return L.each(a,function(e){var t=$(e).line();(o=Object.create(ee)).create(n,t.name),o.isValid()&&(r++,i.add(o))}),(o=Object.create(J)).create(n),o.saveCurrent(),i.add(o),r===t.length&&(i.execute(),n.history.add(i)),!0},cmdListType:function(e){var t=this,n=t.$activeLn;n[0];if(n.length&&n.line()){var i=n.parent().closest(".line"),o=i.line();if(o){var r;r=o.listType===e?D.a.ListType.NULL:e;var a=Object.create(G);a.create(t,o.name,{listType:r},function(){t.applyListTypeJob(i)}),a.execute(),t.history.add(a)}}},cmdSetLinesTime:function(e,t){var n,i=this;n=void 0===t?i.home.getCurAudioTime():t;var o=Object.create(q);return o.create(i,e,{time:n}),o.execute(),i.history.add(o),o},findRangeLines_:function(e,t){var n=this.$el.find(".line"),i=n.index(e),o=n.index(t);if(i>o){var r=i;i=o,o=r}for(var a=$(),l=i;l<=o;++l)a.has(n[l]).length||(a=a.add(n[l]));return a},addSeledLine:function(e){var t=this;return t.$seledLns||(t.$seledLns=$()),!t.$seledLns.has(e).length&&(t.$seledLns=t.$seledLns.add(e[0]),e.addClass("selected"),t.getLineHandler(e.lnType()).addSeledLine(e),document.activeElement!==t.el&&t.focusWithoutScrolling(),!0)},removeSeledLine:function(e){var t=this;return t.$seledLns||(t.$seledLns=$()),e.removeClass("selected"),t.getLineHandler(e.lnType()).removeSeledLine(e),!!t.$seledLns.has(e).length&&(t.$seledLns=t.$seledLns.not(e),!0)},clearSeledLines:function(){var e=this;e.$el.find(".line").removeClass("selected"),e.$seledLns=$(),L.each(e.lineHandlers,function(e){e.clearSeledLines()})},getSeledLineNames_:function(){return L.map(this.$seledLns,function(e){return $(e).line().name})},insertBefore:function(e,t){var n=this;if(t.type===D.a.LineType.END)r(n.findLineElem(t.parentName)).append(e);else{var i=n.findLineElem(t.name);e.insertBefore(i)}},handleCopy:function(e,t,n){var i=this,o=i.getActiveLn();if(i.copySelectedLines(e))e.preventDefault();else if(o.length&&o.line().type===D.a.LineType.IMAGE)i.copyLines(o,e.clipboardData,n),e.preventDefault();else if(t)try{var r=a();e.clipboardData.setData("micnote/content-html",r);var l=P.default.htmlToElement("<div>"+r+"</div>").innerText;e.clipboardData.setData("text/plain",l),e.preventDefault()}catch(e){log.error("copy error")}else log.warn("unhandle copy cmd")},handlePaste:function(e,t){this.handleNormalPaste(e,t)},handleCut:function(e,t){var n=this;if(t);else if(n.copySelectedLines(e))e.preventDefault();else{var i=n.getActiveLn();i.length&&(n.copyLines(i,e.clipboardData),e.preventDefault())}n.handleDel(t)},handleDel:function(e){var t=this;if(e);else if(t.$seledLns&&t.$seledLns.length)t.cmdDeleteLines(t.$seledLns),t.clearSeledLines();else{var n=t.getActiveLn();n.length&&t.cmdDeleteLines(n)}},cmdDeleteLines:function(e){var t=this;if(!e.length)return!1;var n=Object.create(U.a);n.create();var i;return(i=Object.create(te)).create(t,t.getSeledLineNames_()),n.add(i),i=t.makeRemoveLinesCmd(e),n.add(i),n.execute(),t.history.add(n),!0},setLineEditable:function(e,t){var n=t||this.bEditable,i=e.line();if(i.type===D.a.LineType.TEXT){var o=e.lnContent();o.toggleAttr("contenteditable",n),n?o.attr("tabindex","-1"):o.attr("tabindex",null)}else i.type===D.a.LineType.IMAGE&&e.lnContent().attr("tabindex",n?-1:"")},toggleEditable:function(e){var t=this;t.bEditable=void 0===e?!t.bEditable:e;var n=t.$el.find(".line");L.each(n,function(e){t.setLineEditable($(e))})},isEditable:function(){return this.bEditable},refocus:function(){var e=this;e.$activeLn.length&&e.$activeLn.lnType()===D.a.LineType.TEXT&&e.$activeLn.lnContent().focus()},saveSelection:function(){var e=this,t=P.default.getSelection();t.rangeCount?e.savedRange_=t.getRangeAt(0).cloneRange():e.savedRange_=null,O.DEBUG_FOCUS&&log.debug("leditor: save selection",e.savedRange_)},restoreSelection:function(e){var t=e||this.savedRange_,n=P.default.getSelection();t&&(n.removeAllRanges(),n.addRange(t)),O.DEBUG_FOCUS&&log.debug("leditor: restore selection",t)},makeInsertPos:function(e){var t=this,n={};if(e&&-1===e.indexOf("active")?(n.$activeLn=$(),n.activeLnLocalState=null):(n.$activeLn=$(t.$activeLn),t.$activeLn.length?n.activeLnLocalState=t.activeLnLocalState?L.clone(t.activeLnLocalState):null:n.activeLnLocalState=null),e&&-1===e.indexOf("cursor"))n.$cursorLn=$(),n.charOffset=0;else if(n.$cursorLn=t.getCursorLn(),n.$cursorLn.length){var i=n.$cursorLn.lnContent();n.charOffset=d(i[0])}else n.charOffset=0;return e&&-1===e.indexOf("selected")?n.$seledLns=$():n.$seledLns=$(t.$seledLns),e&&-1===e.indexOf("append")?n.bAppend=!1:n.bAppend=!0,n},saveInsertPos:function(){self.savedInsertPos=this.makeInsertPos()},restoreInsertPos:function(){var e=this,t=e.savedInsertPos;if(t.$seledLns.length)e.clearSeledLines(),L.each(t.$seledLns,function(t){e.addSeledLine($(t))});else if(t.$cursorLn.length){var n=t.$cursorLn.lnContent();n.focus(),f(n[0],t.charOffset)}else t.$activeLn.length&&e.updateActiveLn(t.$activeLn)},getCursorLn:function(e){var t=this,n=P.default.getSelection();if(!n||1!==n.rangeCount)return $();var i=n.getRangeAt(0),o=$(i.startContainer).closest(".line");return!o.length||!t.$el.has(o)||o.line().name===D.a.LN_ROOT_NAME||e&&o.line().type!==e?$():o},getFocusedLn:function(e){var t=this,n=document.activeElement;if(!n)return $();var i=n?$(n).closest(".line"):$();return i.length&&!e&&i.line().name===D.a.LN_ROOT_NAME||!t.$el.has(i)?$():i},updateActiveLn:function(e,t){var n=this;n.$activeLn&&n.$activeLn.removeClass("active"),L.each(n.lineHandlers,function(e,t){e.clearActiveLns()}),e&&e.length?(e.addClass("active"),n.$activeLn=$(e),n.activeLnLocalState=t):(n.$activeLn=$(),n.activeLnLocalState=null),O.DEBUG_FOCUS&&log.debug("update active state, state:",n.activeLnLocalState)},updateActiveLnLocalState:function(e){this.activeLnLocalState=e?L.clone(e):null,O.DEBUG_FOCUS&&log.debug("update active state, state:",e)},manualUpdateLineActivelState:function(){var e=this;if(e.$activeLn.length){var t=e.lineHandlers[e.$activeLn.line().type].getLineActiveState(e.$activeLn);return e.updateActiveLnLocalState(t),!0}return!1},restoreActiveLn:function(){var e=this;return e.$activeLn.length?(O.DEBUG_FOCUS&&log.debug("restoreActiveLn, state:",e.activeLnLocalState),e.lineHandlers[e.$activeLn.line().type].activateLine(e.$activeLn,e.activeLnLocalState),!0):(O.DEBUG_FOCUS&&log.debug("restoreActiveLn failed"),!1)},setActiveLn:function(e,t){var n=this;n.updateActiveLn(e,t),e&&e.length&&n.lineHandlers[e.line().type].activateLine(e,t)},getActiveLn:function(){return this.$activeLn},onLinesChangedByCmd:function(){var e=this;e.reposLinesJob(),e.fire("abm-changed")},resizeImage:function(e,t,n){var i=this,o=e.line();console.assert(o.type===D.a.LineType.IMAGE),o.viewWidth=t,o.viewHeight=n;var r=i.imageHandler.lineToImage(e);r.css("width","number"==typeof t?t:""),r.css("height","number"==typeof n?n:""),i.normalizeImage(e),i.setModified(!0)},getSuggestedTitle:function(){var e=this,t=e.$el.childLns().first();return e.getFocusedLn()[0]!==t[0]&&t.length&&t.lnContent().text()?t.lnContent().text():null},removeAbm:function(e,t,n,i){var o=this,r=o.home,a=0;n||(n=0);var l=o.getAllLns(),s=-(t-e)+n,c=Object.create(U.a);return c.create(),L.each(l,function(n){var i=$(n).line();if("number"==typeof i.time){var l=i.time,d=n.classList.contains("inserting"),u=w(r,e,t,s,l,null,d);if(u){var p=r.parseAbm(u)[0];Math.abs(i.time-p)>.1&&(a++,(m=Object.create(z)).create(o,i.name,{time:p}),c.add(m)),d&&n.classList.remove("inserting")}else{var m=Object.create(z);m.create(o,i.name,{time:null}),c.add(m),a++}}}),c.execute(),i&&i.add(c),a+=o.textHandler.removeAbm(e,t,n,i)},triggerLineAbm:function(e,t,n){var i=this,o=e.line();"number"!=typeof o.time&&(i.fire("trigger-line-abm",{$ln:e,bOffsetable:n}),"number"==typeof o.time&&(i.fire("abm-changed"),i.fire("time-changed",e)))},regLineHandler:function(e){var t=this;t.lineHandlers[e.type]=e,e.type===D.a.LineType.TEXT?t.textHandler=e:e.type===D.a.LineType.IMAGE&&(t.imageHandler=e)},getLineHandler:function(e){return this.lineHandlers[e]},tryDeleteActiveLine:function(e){var t=this,n=this,i=e.parentLn(),o=(i.length&&i.line(),e.prevLn());o.length&&o.line();if(e.childLns().length)return!1;var r=o;r.length||(r=i),r.length&&r.lnName()===D.a.LN_ROOT_NAME&&(r=$());var a=Object.create(U.a);a.create();var l;if((l=Object.create(Y)).create(t),a.add(l),l=n.makeRemoveLinesCmd(e),a.add(l),r.length){var s=r.line(),c=t.getLineHandler(s.type);(l=Object.create(J)).create(n,s.name,c.makeCursorLastActiveState(s.name)),l.bVisibleWithoutChildren=!0,a.add(l)}return a.execute(),n.history.add(a),!0},makeLinesVisible:function(e,t){var n=this;if(n.scrollEl){var i;1===e.length&&void 0!==(i=e.first().data("flyHeight"))&&(i=Math.max(i,e.first().outerHeight()));var o;o=t?e.lnContent():e,P.default.makeElemsInScrollVisible(n.$scrollEl,o,i)}},getLinesDirPosInScroll:function(e,t){var n=this;if(n.scrollEl){var i;1===e.length&&void 0!==(i=e.first().data("flyHeight"))&&(i=Math.max(i,e.first().outerHeight()));var o;return o=1===e.length&&t?e.lnContent():e,P.default.getElemsDirPosInScroll(n.$scrollEl,o,i)}return"Inside"},focusWithoutScrolling:function(){var e=this;if(e.scrollEl){var t=e.scrollEl.scrollLeft,n=e.scrollEl.scrollTop;e.$el.focus(),e.scrollEl.scrollLeft=t,e.scrollEl.scrollTop=n}else e.$el.focus();P.default.getSelection().removeAllRanges()},execEditCmd:function(e,t){var n=this,i=Object.create(U.a);if(i.create(),i.execute(),n.$seledLns.length){var o=n.flatLns(n.$seledLns),r=L.groupBy(o,function(e){return $(e).line().type});L.each(r,function(o,r){var a=n.getLineHandler(r),l=$(o);a.execEditCmd(l,e,t,i,!0)})}else if(n.$activeLn.length){var a=n.$activeLn;n.getLineHandler(a.lnType()).execEditCmd(a,e,t,i,!1)}i.getNumCmds()&&n.history.add(i)},onClickMarginSpace:function(){var e=this;e.focusWithoutScrolling(),e.clearSeledLines()},readyAlignImageLine:function(e,t,n){console.assert("auto"!==t);var i=this,o=n||i.imageHandler.lineToImage(e);console.assert(o.length);var r=e.line(),a=e.lnContent(),l=e.data("curAlign");if(l!==t){"left"===l?(a.empty(),a.css("height","")):"right"===l&&a.empty();var s;if("left"===t)a.append(o),s=a;else{var c=["<div class='fly-arrow-cont'>","  <div>","    <div class='fly-strick'></div>","    <iron-icon icon='bs:picture'></iron-icon>","  </div>","</div>"].join("");a.append(c);var d=P.default.simpleHtmlToElement("<div class='fly' tabindex='-1'></div>");o.appendTo(d),a.append(d),e.css("clear","right"),s=$(d)}s.addClass("il-img-cont"),s[0].dataset.lnName=r.name,e.data("curAlign",t),i.normalizeImage(e)}},reposImageLine:function(e,t,n,i){var o,r=this;if(M.isXSmall()||i)o="left";else{var a=e.line();if("auto"===a.imgAlign){var l=n||r.$el.width();o=r.home.getLineContentWidth(e,l,!1,"middle")-r.calcImageViewSize(e).width<200?"left":"right"}else o=a.imgAlign}r.readyAlignImageLine(e,o,t)},reposLinesJob:function(){var e=this;e.job("reposLines",function(){e.reposLines()})},reposLines:function(e,t){var n=this,i=n.$el.find(".line[data-type='image']"),o=e||n.$el.width();L.each(i,function(e){n.reposImageLine($(e),null,o,t)})},onResize:function(e){var t=this,n=t.$el.width();(e||n!==t.lastWidth)&&(t.reposLines(),t.lastWidth=n),L.each(t.lineHandlers,function(e){e.onResize()})},addAsyncCmdTask:function(e){var t=this;t.lastAsyncCmdTask=t.lastAsyncCmdTask.then(function(){return e()})},saveEditorState:function(){var e=this;return{activeLnName:e.$activeLn.lnName(),scrollTop:e.scrollEl?e.scrollEl.scrollTop:0}},isEditorStateChanged:function(e){var t=this.saveEditorState();return!e||t.activeLnName!==e.activeLnName||t.scrollTop!==e.scrollTop},restoreEditorState:function(e){var t=this;t.bEditable&&e.activeLnName&&t.setActiveLn(t.findLineElem(e.activeLnName)),t.scrollEl&&"number"==typeof e.scrollTop&&(t.scrollEl.scrollTop=e.scrollTop)},lastLine:function(){return this.$el.childLns(!0).last()},firstLine:function(){return this.$el.childLns().first()},getOperatingLns:function(){return this.$seledLns.length?this.flatLns(this.$seledLns):this.$activeLn},updateAbmListJob:function(){var e=this;e.job("updateAbmList",function(){e.home.updateAbmList(),e.fire("abm-list-updated")})},setLineHeight:function(e){var t=this;t.lineHeight=e,t.selOverlayHeight=Math.min(t.lineHeight/2,10);var n=t.getAllLns();L.each(n,function(e){var n=$(e),i=n.lnType();i===D.a.LineType.IMAGE?t.normalizeImage(n):i===D.a.LineType.TEXT&&n.css("min-height",t.lineHeight)}),t.reposLinesJob()}}),G=L.extend(Object.create(U.b),{create:function(e,t,n,i){L.extend(this,{leditor:e,lnName:t,newAttrs:n?L.clone(n):{},afterHandler:i})},execute:function(){var e=this,t=e.leditor.findLineElem(e.lnName).line();e.oldAttrs={},L.each(e.newAttrs,function(n,i){t.hasOwnProperty(i)?e.oldAttrs[i]=t[i]:log.error("no attr found:",i,"in",t)}),L.each(e.newAttrs,function(e,n){t[n]=e}),e.afterHandler&&e.afterHandler()},unexecute:function(){var e=this,t=e.leditor.findLineElem(e.lnName).line();L.each(e.oldAttrs,function(e,n){t[n]=e}),e.afterHandler&&e.afterHandler()},isAttrChanged:function(e){var t=this;return void 0!==t.newAttrs[e]&&t.newAttrs[e]!==t.oldAttrs[e]}}),z=L.extend(Object.create(U.b),{create:function(e,t,n,i){var o=this;L.extend(o,{leditor:e,lnName:t}),o.cmd=Object.create(G),o.cmd.create(e,t,n,i)},execute:function(){var e=this,t=e.leditor.findLineElem(e.lnName),n=(t.line(),e.cmd.execute());return e.isTimeChanged()&&(e.leditor.fire("abm-changed"),e.leditor.fire("time-changed",t)),n},unexecute:function(){var e=this,t=e.leditor.findLineElem(e.lnName),n=(t.line(),e.cmd.unexecute());return e.isTimeChanged()&&(e.leditor.fire("abm-changed"),e.leditor.fire("time-changed",t)),n},isTimeChanged:function(){var e=this;return typeof e.cmd.newAttrs.time!=typeof e.cmd.oldAttrs.time||"number"==typeof e.cmd.newAttrs.time&&Math.abs(e.cmd.newAttrs.time-e.cmd.oldAttrs.time)>D.a.TIME_EPSILON}}),q=(L.extend(Object.create(U.b),{create:function(e,t,n,i){var o=this,r=Object.create(U.a);r.create(),L.each(t,function(t,o){var a=$(t),l=Object.create(G),s=0===o?i:void 0;l.create(e,a.lnName(),n,s),r.add(l)}),o.cmd=r},execute:function(){return this.cmd.execute()},unexecute:function(){return this.cmd.unexecute()}}),L.extend(Object.create(U.b),{create:function(e,t,n,i){var o=this,r=Object.create(U.a);r.create(),L.each(t,function(t,o){var a=$(t),l=Object.create(z),s=0===o?i:void 0;l.create(e,a.lnName(),n,s),r.add(l)}),o.cmd=r},execute:function(){return this.cmd.execute()},unexecute:function(){return this.cmd.unexecute()}})),K=L.extend(Object.create(U.b),{create:function(e,t,n){L.extend(this,{leditor:e,line:t,posName:n})},execute:function(){var e=this,t=e.leditor,n=t.ldoc;console.assert(e.line.name!==D.a.LN_ROOT_NAME),console.assert(e.posName);t.getLineHandler(e.line.type).insertLine(e.line,e.posName);var i=n.findLine(e.line.parentName);if(i.listType!==D.a.ListType.NULL){var o=t.findLineElem(i);t.applyListTypeJob(o,!1)}t.onLinesChangedByCmd()},unexecute:function(){var e=this,t=e.leditor,n=(t.ldoc,t.findLineElem(e.line.name));console.assert(0===n.childLns().length),t.doRemoveLines(n,!0),t.onRemoveLines_(n),t.onLinesChangedByCmd()}}),X=L.extend(Object.create(U.b),{create:function(e,t){var n=this;n.insertCmd=Object.create(K),n.insertCmd.create(e,t,null)},execute:function(){var e=this,t=e.insertCmd.leditor.ldoc;return console.assert(0===t.findAllChildren(e.insertCmd.line).length),e.insertCmd.posName=t.getNextPos(e.insertCmd.line).name,e.insertCmd.unexecute()},unexecute:function(){var e=this;e.insertCmd.leditor.ldoc;return e.insertCmd.execute()}}),J=L.extend(Object.create(U.b),{create:function(e,t,n){var i=this;L.extend(i,{leditor:e,lnName:t,localState:n,bMakeLineVisible:!0,bVisibleWithoutChildren:!1})},saveCurrent:function(){var e=this,t=e.leditor,n=t.$findCurLn(document.activeElement);if(n.length){var i=n.line();e.lnName=i.name;var o=t.lineHandlers[i.type];e.localState=o.getLineActiveState(n)}else e.lnName=null},execute:function(){var e=this,t=e.leditor,n=e.lnName&&t.findLineElem(e.lnName);if(n&&n.length){n.line();t.setActiveLn(n,e.localState),e.bMakeLineVisible&&t.makeLinesVisible(n,e.bVisibleWithoutChildren)}},unexecute:function(){}}),Y=L.extend(Object.create(U.b),{create:function(e){var t=this;L.extend(t,{leditor:e}),t.cmd=Object.create(J),t.cmd.create(e)},execute:function(){this.cmd.saveCurrent()},unexecute:function(){var e=this;e.leditor;return e.cmd.execute()}}),Q=L.extend(Object.create(U.b),{create:function(e,t,n,i){L.extend(this,{leditor:e,lnName:t,newPosName:n,newParListType:i})},execute:function(){var e=this,t=e.leditor,n=t.ldoc,i=t.findLineElem(e.lnName),o=i.line(),r=i.parentLn(),a=(r.length&&r.line(),i.prevLn());a.length&&a.line();e.oldPosName=n.getNextPos(o).name;var l=n.findPos(e.newPosName);n.removeLine(o),n.insertBefore(o,l),n.normalize(),i.detach(),t.insertBefore(i,l);var s=i.parentLn(),c=s.line();e.newParListType&&(e.newParOrigListType=c.listType,c.listType=e.newParListType),t.applyListTypeJob(r,!1),t.applyListTypeJob(s,!1),t.applyListTypeJob(i,!0)},unexecute:function(){var e=this,t=e.leditor,n=t.ldoc,i=t.findLineElem(e.lnName),o=i.line(),r=i.parentLn(),a=(r.length&&r.line(),i.prevLn()),l=(a.length&&a.line(),i.nextLn()),s=(l.length&&l.line(),n.findPos(e.oldPosName));n.removeLine(o),n.insertBefore(o,s),n.normalize(),i.detach(),t.insertBefore(i,s),e.newParOrigListType&&(o.listType=e.newParOrigListType),t.applyListTypeJob(r,!1);var c=i.parentLn();t.applyListTypeJob(c,!1),t.applyListTypeJob(i,!0)}}),Z=L.extend(Object.create(U.b),{create:function(e,t){L.extend(this,{leditor:e,lnName:t})},execute:function(){var e=this,t=e.leditor,n=t.ldoc,i=t.findLineElem(e.lnName),o=i.line(),a=i.parentLn(),l=a.length&&a.line(),s=i.prevLn(),c=s.length&&s.line();if(s.length){var d,u=n.getEndChildPos(c);0===r(s).find(">.line").length&&(d=l.listType);var p=Object.create(Q);p.create(t,o.name,u.name,d),e.moveCmd=p;var m=p.execute();return t.fire("indented",i),t.fire("abm-changed"),m}},unexecute:function(){var e=this,t=e.leditor,n=t.findLineElem(e.lnName);if(e.moveCmd){var i=e.moveCmd.unexecute();return t.fire("outdented",n),t.fire("abm-changed"),i}},isValid:function(){var e=this,t=e.leditor;t.ldoc;return 0!==t.findLineElem(e.lnName).prevLn().length}}),ee=L.extend(Object.create(U.b),{create:function(e,t){L.extend(this,{leditor:e,lnName:t})},execute:function(){var e=this,t=e.leditor,n=t.ldoc,i=(c=t.findLineElem(e.lnName)).line(),o=c.parentLn(),r=o.length&&o.line();console.assert(r&&r.name!==D.a.LN_ROOT_NAME);var a=n.getNextPos(r),l=Object.create(Q);l.create(t,i.name,a.name),e.moveCmd=l;var s=l.execute(),c=t.findLineElem(e.lnName);return t.fire("outdented",c),t.fire("abm-changed"),s},unexecute:function(){var e=this,t=e.leditor,n=e.moveCmd.unexecute(),i=t.findLineElem(e.lnName);return t.fire("indented",i),t.fire("abm-changed"),n},isValid:function(){var e=this,t=e.leditor,n=(t.ldoc,t.findLineElem(e.lnName).parentLn()),i=n.length&&n.line();return i&&i.name!==D.a.LN_ROOT_NAME}}),te=L.extend(Object.create(U.b),{create:function(e,t,n){this.leditor=e,this.lineNames=t,this.bFallbackToFocus=n},execute:function(){var e=this,t=e.leditor;if(e.lineNames||(e.lineNames=t.getSeledLineNames_()),!e.lineNames.length&&e.bFallbackToFocus){var n=Object.create(Y);n.create(t),n.execute(),e.preserveActCmd=n}t.scrollEl&&(e.savedScrollTop=t.scrollEl.scrollTop)},unexecute:function(){var e=this,t=e.leditor;t.clearSeledLines(),e.lineNames.length?L.each(e.lineNames,function(e){var n=t.findLineElem(e);t.addSeledLine(n)}):e.bFallbackToFocus&&e.preserveActCmd&&e.preserveActCmd.unexecute(),e.savedScrollTop&&(t.scrollEl.scrollTop=e.savedScrollTop)}}),ne=L.extend(Object.create(U.b),{create:function(e,t){this.leditor=e,this.newLnNames=t,this.bMakeVisible=!1},execute:function(){var e=this,t=e.leditor;e.newLnNames&&(t.clearSeledLines(),L.each(e.newLnNames,function(e){t.addSeledLine(t.findLineElem(e))}),e.bMakeVisible&&t.makeLinesVisible(t.$seledLns))},unexecute:function(){this.leditor}}),ie=L.extend(Object.create(P.default.Observer),{activateLine:function(e,t){e.lnContent().focus()},clearActiveLns:function(){},addSeledLine:function(e){},removeSeledLine:function(e){},clearSeledLines:function(){},autoSave:function(){},handleNormalPaste:function(e,t){return!1},readyNewLinePos:function(e){return{insertPos:this.leditor.getBelowPos(e)}},getLineActiveState:function(){return null},makeCursorLastActiveState:function(){return null},execEditCmd:function(e,t,n,i,o){},insertLine:function(e,t){var n=this.leditor,i=n.ldoc.findPos(t);return n.ldoc.insertBefore(e,i),n.applyLine_(e)},removeLine:function(e){var t=this.leditor,n=e.line();return console.assert(0===e.childLns().length),console.assert(0===t.ldoc.findAllChildren(n).length),t.ldoc.removeLine(n,!1),e.remove(),$()},toReadableHtml:function(e,t){throw"unimplemented"},toReadableText:function(e){throw"unimplemented"},handleContentKeyDown:function(e,t){throw"unimplemented"},onResize:function(){}})},function(e,t,n){"use strict";n.d(t,"c",function(){return p}),n.d(t,"b",function(){return d}),n.d(t,"a",function(){return u});var i=n(19),o=(n.n(i),n(23)),r=(n.n(o),n(20)),a=(n.n(r),n(6)),l=(n.n(a),n(22)),s=n(21),c=(n.n(s),n(91),n(7)),d=(n.n(c),{execute:null,unexecute:null,showName:""}),u=i.extend(Object.create(d),{create:function(e){this.subCmds=e||[]},add:function(e){this.subCmds.push(e)},getNumCmds:function(){return this.subCmds.length},execute:function(){var e,t=this.subCmds.slice(0);return i.each(t,function(t){if(e)e=e.then(function(){return t.execute()});else{var n=t.execute();r.isPromise(n)&&(e=n)}}),e||void 0},unexecute:function(){var e,t=this.subCmds.slice(0);return t.reverse(),i.each(t,function(t){if(e)e=e.then(function(){return t.unexecute()});else{var n=t.unexecute();r.isPromise(n)&&(e=n)}}),e||void 0}}),p=i.extend(Object.create(l.default.Observer),{create:function(e){this.maxNum=e||20,this.cmds=[],this.lastExecedIdx=-1},getNumCmds:function(){return this.cmds.length},clear:function(){this.cmds=[],this.lastExecedIdx=-1,this.fire("changed")},add:function(e){if(this.cmds.splice(this.lastExecedIdx+1),this.cmds.push(e),this.lastExecedIdx=this.cmds.length-1,this.cmds.length>this.maxNum){var t=this.cmds.length-this.maxNum;this.lastExecedIdx-=t,this.cmds.splice(0,t)}this.fire("changed"),this.fire("executed")},undo:function(){if(this.lastExecedIdx<0)return r.resolve();var e=this.cmds[this.lastExecedIdx],t=this;return r(e.unexecute()).then(function(){t.lastExecedIdx--,t.fire("changed"),t.fire("unexecuted")})},redo:function(){if(this.lastExecedIdx+1>=this.cmds.length)return r.resolve();var e=this.cmds[this.lastExecedIdx+1],t=this;return r(e.execute()).then(function(){t.lastExecedIdx++,t.fire("changed"),t.fire("executed")})},canUndo:function(){return this.lastExecedIdx>=0},canRedo:function(){return this.lastExecedIdx+1<this.cmds.length},getUndoShowName:function(){var e=this.getUndoCmd();return e?e.showName:""},getRedoShowName:function(){var e=this.getRedoCmd();return e?e.showName:""},getUndoCmd:function(){return this.canUndo()?this.cmds[this.lastExecedIdx]:null},getRedoCmd:function(){return this.canRedo()?this.cmds[this.lastExecedIdx+1]:null},cancelLastCmd(){var e=this;return e.lastExecedIdx>=0&&(e.lastExecedIdx--,e.fire("changed"),e.fire("unexecuted"),!0)}});i.extend(Object.create(d),{create:function(e){this.cmd=e},execute:function(){return this.cmd.unexecute()},unexecute:function(){return this.cmd.execute()}}),i.extend(Object.create(d),{create:function(e,t){self.cmd=e,this.handlers=t},execute:function(){this.handlers.before&&this.handlers.before(),this.handlers.beforeExecute&&this.handlers.beforeExecute();var e=this.cmd.execute();return this.handlers.afterExecute&&this.handlers.afterExecute(),this.handlers.after&&this.handlers.after(),e},unexecute:function(){this.handlers.before&&this.handlers.before(),this.handlers.beforeUnexecute&&this.handlers.beforeUnexecute();var e=this.cmd.unexecute();return this.handlers.afterUnexecute&&this.handlers.afterUnexecute(),this.handlers.after&&this.handlers.after(),e}})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i={defaultParams:{height:128,barHeight:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,markWidth:1,skipLength:2,minPxPerSec:1,samples:3,pixelRatio:1,fillParent:!0,scrollParent:!1,normalize:!1,audioContext:null,container:null,renderer:"Canvas",backendMethod:"WebAudio"},init:function(e){this.params=i.util.extend({},this.defaultParams,e),this.markers={},this.once("marked",this.bindMarks.bind(this)),this.savedVolume=0,this.isMuted=!1,this.createBackend(),this.createDrawer()},createDrawer:function(){var e=this;this.drawer=Object.create(i.Drawer[this.params.renderer]),this.drawer.init(this.params),this.drawer.on("redraw",function(){e.drawBuffer()}),this.drawer.on("click",function(t){e.seekTo(t),e.fireEvent("seek-by-click",t)}),this.seekByClick=Kefir.fromEvents(this.drawer,"click").map(t=>(e.seekTo(t),t)),this.seekByClick.onValue(()=>{}),this.dragStarted=Kefir.fromEvents(this.drawer,"drag-started"),this.dragEnded=Kefir.fromEvents(this.drawer,"drag-ended"),this.dragging=Kefir.fromEvents(this.drawer,"dragging"),this.dragging.onValue(t=>{e.seekTo(t)}),this.dragStarted.onValue(()=>{let e=!this.isPaused();e&&this.pause(),this.dragEnded.take(1).onValue(()=>{e&&this.play()})})},createBackend:function(){var e,t=this;if("WebAudio"===this.params.backendMethod)e=i.WebAudio;else if("TagAudio"==this.params.backendMethod)e=i.TagAudio;else{if("MediaAudio"!=this.params.backendMethod)throw"Wavesurfer: no backend method provided.";e=i.MediaAudio}this.backend=Object.create(e),this.backend.on("play",function(){t.fireEvent("play")}),this.on("play",function(){t.restartAnimationLoop()}),this.on("progress",function(e){t.backend.onProgress&&t.backend.onProgress(e),t.backend.isPaused()?t.drawer.progress(e):t.drawer.progress(t.backend.getPlayedPercents())}),this.backend.init(this.params),this.playerPaused=Kefir.fromEvents(this.backend,"pause"),this.playerStarted=Kefir.fromEvents(this.backend,"play"),this.playerProgress=Kefir.fromEvents(this,"progress"),this.playerSeek=Kefir.fromEvents(this,"seek")},restartAnimationLoop:function(){var e=this,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame,n=function(){e.fireEvent("progress",e.backend.getPlayedPercents()),e.backend.isPaused()||t(n)};n()},playAt:function(e){this.backend.play(this.backend.getDuration()*e)},play:function(){this.backend.play()},pause:function(){this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPaused:function(){return this.backend.isPaused()},skipBackward:function(e){this.skip(e||-this.params.skipLength)},skipForward:function(e){this.skip(e||this.params.skipLength)},skip:function(e){var t=this.timings(e),n=t[0]/t[1];this.seekTo(n)},seekTo:function(e){var t=this.backend.isPaused();this.backend.seekTo(this.backend.getDuration()*e),this.fireEvent("progress",this.backend.getPlayedPercents()),t&&this.pause(),this.fireEvent("seek",e)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(e){this.backend.setVolume(e)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},mark:function(e){if(e.id&&e.id in this.markers)return this.markers[e.id].update(e);var t=this,n=i.util.extend({id:i.util.getId(),position:this.backend.getCurrentTime(),width:this.params.markWidth,height:this.params.height},e),o=Object.create(i.Mark);return o.on("update",function(){var e=t.backend.getDuration()||1;null==o.position&&(o.position=o.percentage*e),o.percentage=o.position/e,t.markers[o.id]=o,t.drawer.addMark(o)}),o.on("remove",function(){t.drawer.removeMark(o),delete t.markers[o.id]}),this.fireEvent("marked",o),o.init(n)},redrawMarks:function(){Object.keys(this.markers).forEach(function(e){var t=this.markers[e];this.drawer.addMark(t)},this)},clearMarks:function(e){Object.keys(this.markers).forEach(function(t){var n=this.markers[t];e&&!e(n.id)||this.markers[t].remove()},this)},timings:function(e){var t=this.backend.getCurrentTime()||0,n=this.backend.getDuration()||1;return t=Math.max(0,Math.min(n,t+(e||0))),[t,n]},drawBuffer:function(){this.drawer.clear();var e,t;this.params.fillParent&&!this.params.scrollParent?e=this.drawer.getWidth():((e=this.backend.getDuration()*this.params.minPxPerSec)>8e3&&(e=8e3),e<this.drawer.getWidth()&&(e=this.drawer.getWidth())),this.wave?this.drawer.drawPeaks(this.wave.left,e,this.params.scrollParent?this.backend.getDuration():null):(t=this.backend.getPeaks(e),this.drawer.drawPeaks(t,e,this.params.scrollParent?this.backend.getDuration():null)),this.drawer.progress(this.backend.getPlayedPercents()),this.redrawMarks()},loadBuffer:function(e,t,n,i){var o=this;this.pause(),o.fireEvent("decoding");let r=t?t.duration:i;this.backend.loadBuffer(e,r,function(){o.wave=t,o.clearMarks(),o.drawBuffer(),o.fireEvent("ready"),n&&n()},function(){o.fireEvent("error","Error decoding audio"),n&&n("Error decoding audio")})},onProgress:function(e){if(e.lengthComputable)var t=e.loaded/e.total;else t=e.loaded/(e.loaded+1e6);this.fireEvent("loading",Math.round(100*t),e.target)},load:function(e,t,n,i){if(e instanceof ArrayBuffer)this.empty(),this.loadBuffer(e,t,n,i);else if("string"==typeof e)if("MediaAudio"==this.params.backendMethod){this.empty(),this.pause(),this.fireEvent("decoding");var o=this;this.backend.loadFromUrl(e,t?t.duration:null,function(){o.wave=t,o.clearMarks(),o.drawBuffer(),o.fireEvent("ready"),n&&n()})}else this.empty(),this.loadBuffer(e,t,n,i);else console.assert(!1)},downloadAudio:function(e,t){var n=this,i=new XMLHttpRequest;i.open("POST",e,!0),i.withCredentials="true",i.send(),i.responseType="arraybuffer",i.addEventListener("progress",function(e){n.onProgress(e)}),i.addEventListener("load",function(e){200==i.status?t(null,i.response):(n.fireEvent("error","Error loading, server response: "+i.statusText,"ERROR_DOWNLOAD"),t("error"))}),i.addEventListener("error",function(e){n.fireEvent("error","Error loading audio"),t(e)})},bindMarks:function(){var e=this,t=0;this.backend.on("play",function(){Object.keys(e.markers).forEach(function(t){e.markers[t].played=!1})}),this.backend.on("audioprocess",function(n){Object.keys(e.markers).forEach(function(i){var o=e.markers[i];o.played||o.position<=n&&o.position>=t&&(o.played=!0,e.fireEvent("mark",o),o.fireEvent("reached"))}),t=n})},empty:function(){this.pause(),this.clearMarks(),this.backend.loadEmpty(),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},changeWaveMode:function(e){this.params.scrollParent=e,this.drawer.changeWaveMode(e),this.drawBuffer()}};i.Mark={defaultParams:{id:null,position:0,percentage:0,width:1,height:20,color:"#333"},init:function(e){return this.update(i.util.extend({},this.defaultParams,e))},getTitle:function(){var e=new Date(1e3*this.position);return e.getMinutes()+":"+e.getSeconds()},update:function(e){return Object.keys(e).forEach(function(t){t in this.defaultParams&&(this[t]=e[t])},this),null==e.position&&null!=e.percentage&&(this.position=null),this.fireEvent("update"),this},remove:function(){this.fireEvent("remove")}},i.Observer={on:function(e,t){this.handlers||(this.handlers={});var n=this.handlers[e];n||(n=this.handlers[e]=[]),n.push(t)},off:function(e,t){if(this.handlers){var n=this.handlers[e];if(n)if(t)for(var i=n.length-1;i>=0;i--)n[i]==t&&n.splice(i,1);else n.length=0}},once:function(e,t){var n=function(){t(),this.off(e,n)}.bind(this);this.on(e,n)},fireEvent:function(e){if(this.handlers){var t=this.handlers[e],n=Array.prototype.slice.call(arguments,1);if(t)for(var i=0,o=t.length;i<o;i+=1)t[i].apply(null,n)}}},i.util={extend:function(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){null!=t&&Object.keys(t).forEach(function(n){e[n]=t[n]})}),e},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},max:function(e){for(var t=-1/0,n=0,i=e.length;n<i;n++){var o=e[n];o>t&&(t=o)}return t}},i.util.extend(i,i.Observer),i.util.extend(i.Mark,i.Observer)},function(e,t,n){"use strict";function i(e){l=e}function o(e,t,n){var i,o;return u.resolve().then(function(){return u.nfcall(l.nativeUnzip,t,l.getNoteDir(e))}).then(function(){var t=l.getNoteDir(e)+"/properties.json";return u.ninvoke(ar.fileSystem,"loadFile",t,{type:"Text"}).catch(function(){return null})}).then(function(t){t?(i=s.jsonDates.parse(t),o="string"==typeof n?n:i.title||""):(console.error("emtpy properties"),i=l.DEF_ARTICLE_PROP(),o=n||""),i.version>l.PROP_VERSION&&log.warn("version too new",e.artTitle)}).then(function(){i.version<=3?e.audioName="audio.mp3":e.audioName=i.audioName,e.audioSize=i.audioSize||0,e.audioFormat=i.audioFormat||p.a.AUDIO_FMT_MN,e.audioTime=i.audioTime||0,i.bEmptyAudio&&c("ChromeApp")&&(e.audioCommit=p.a.NEW_AUDIO_COMMIT)}).then(function(){return e.version=i.version,l.saveArticle(e),l.setArtTitle(e,o,!0)})}function r(e,t,n){var i,r=u.resolve();return r=r.then(function(){return l.doNewNote({title:"",audioCommit:s.genCommitHash(),parentName:t})}).then(function(t){i=t;l.getNoteDir(i);return o(i,e,n)}).then(function(){return i.noteCommit=s.genCommitHash(),l.saveArticle(i),m.a.onNoteCached(i),i})}function a(e,t){var n=t;return u.resolve().then(function(){return l.readyForMicnoteFile(e)}).then(function(){return u.nfcall(l.nativeZip,l.getNoteDir(e),n)})}n.d(t,"a",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return r}),n.d(t,"b",function(){return a});n(22);var l,s=n(21),c=(n.n(s),n(6)),d=(n.n(c),n(19)),u=(n.n(d),n(20)),p=(n.n(u),n(91)),m=(n(101),n(92))},function(e,t,n){"use strict";function i(){return p.genHash(16)}function o(e,t,n){var i=Object.create(v);i.create();var o=document.createElement("div");o.innerHTML=t,r(e,i,o.childNodes,0,i.root,null,null);var s=l.where(i.lines,{type:m.a.LineType.IMAGE}),d=l.reduce(s,function(e,t){return e.then(function(){return t.embeddedSrc?(log.log("strip embedded image: ",t),a(t.embeddedSrc,n).then(function(e){t.filename=e,delete t.embeddedSrc})):void 0}).then(function(){var e=ar.fileSystem.getDirUrl(n)+"/images/"+t.filename;return u.default.getImageSize(e).then(function(e){t.imgWidth=e.width,t.imgHeight=e.height,t.imgHeight<m.a.IMG_DEF_ALIGN_LEFT_MAX_HEIGHT&&(t.imgAlign="left"),null===t.viewWidth&&(t.viewWidth=e.width)})}).then(function(){var e=n+"/images/"+t.filename;return c.ninvoke(ar.fileSystem,"getFileSize",e).then(function(e){t.size=e})}).catch(function(e){log.error("ready image failed",t),log.fail(e)})},c());return(d=d.then(function(){l.each(i.lines,function(e){e.type===m.a.LineType.TEXT&&""===e.content&&"number"==typeof e.time&&(e.time=null)})})).then(function(){return i})}function r(e,t,n,i,o,a,l,s){function c(){l||(f=t.newTextLine(),t.append(f,o),l=f,a=f,s&&(u(l,s),s=null))}function u(t,n){var i="["+n+"]",o=e.parseAbm(i);o&&o.length&&(t.time=o[0])}for(var f,h=i;h<n.length;++h){var g=n[h];if("DIV"===g.nodeName||"LI"===g.nodeName){g.dataset&&g.dataset.abm&&(s=g.dataset.abm);var v=r(e,t,g.childNodes,0,o,a,null,s);v!==a&&(s=null,a=v),l=null}else if("BR"===g.nodeName)g.dataset&&g.dataset.abm&&(s=g.dataset.abm),l?l=null:c();else if("BLOCKQUOTE"===g.nodeName)a?(r(e,t,g.childNodes,0,a,null,null,s),a=null,l=null,s=null):(r(e,t,g.childNodes,0,o,null,null,s),a=null,l=null,s=null);else if("UL"===g.nodeName||"OL"===g.nodeName)a?(a.listType="UL"===g.nodeName?m.a.ListType.BULLET:m.a.ListType.NUMBERED,r(e,t,g.childNodes,0,a,null,null,s),a=null,l=null,s=null):(o.listType="UL"===g.nodeName?m.a.ListType.BULLET:m.a.ListType.NUMBERED,r(e,t,g.childNodes,0,o,null,null,s),a=null,l=null,s=null);else if("#text"===g.nodeName)c(),l.content+=g.data;else if("IMG"===g.nodeName){var b,y,w;-1!==(w=d("MobileApp")?g.attributes.src.value:g.src).indexOf("/images/")?b=p.getFileName(w):-1!==w.indexOf("data:")?y=w:log.error("ignored unknown type of image: ",w),(b||y)&&((f=t.newImageLine()).filename=b,y&&(f.embeddedSrc=y),g.style.width&&(f.viewWidth=$(g).width()),t.append(f,o),l=null,a=null)}else g.tagName?(c(),l.content+=g.outerHTML):log.error("cant process node: ",g.nodeName,g)}return a&&a.parentName===o.name?a:null}function a(e,t){return c.resolve().then(function(){var n=c.defer(),i=u.default.dataUrlToBlob(e),o=i.type.replace("image/","");"jpeg"===o&&(o="jpg");var r=p.genHash(16)+"."+o,a=t+"/images/"+r;return ar.fileSystem.saveFile(a,i,i.type,function(e){if(e)n.reject(e);else{ar.fileSystem.getDirUrl(t+"/images");d("AndroidApp")?setTimeout(function(){n.resolve()},1e3):n.resolve(r)}}),n.promise})}n.d(t,"a",function(){return v}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o});var l=n(19),s=(n.n(l),n(23)),c=(n.n(s),n(20)),d=(n.n(c),n(6)),u=(n.n(d),n(22)),p=n(21),m=(n.n(p),n(91)),f={listType:m.a.ListType.NULL,parentName:m.a.LN_ROOT_NAME,time:null},h=l.defaults({type:m.a.LineType.TEXT,content:""},f),g=l.defaults({type:m.a.LineType.IMAGE,filename:"",origFileName:null,imgWidth:0,imgHeight:0,viewWidth:null,viewHeight:null,imgAlign:"auto",size:0},f),v=l.extend(Object.create(u.default.Observer),{create:function(){this.empty()},empty:function(){var e=this;l.extend(e,{lines:[l.defaults({name:m.a.LN_ROOT_NAME,type:m.a.LineType.TEXT,parentName:null,content:""},f)],cachedEndPoses:{}}),e.root=e.lines[0]},load:function(e){var t,n=this;try{t=JSON.parse(e)}catch(e){log.error("parse ldoc error"),t=null}if(!t)return!1;var i={},o=[];return l.each(t.lines,function(e){i[e.name]?log.error("found duplicated line name, drop:",e):e.type===m.a.LineType.END?log.error("found end line, drop:",e):(o.push(e),i[e.name]=e)}),n.lines=o,n.lines[0].name!==m.a.LN_ROOT_NAME?(log.error("root line pos error"),!1):(n.root=n.lines[0],console.assert(n.root.name===m.a.LN_ROOT_NAME),n.cachedEndPoses={},l.each(n.lines,function(e){e=e.type===m.a.LineType.TEXT?l.defaults(e,h):e.type===m.a.LineType.IMAGE?l.defaults(e,g):l.defaults(e,f)}),n.normalize(),!0)},save:function(){var e=this;console.assert(!u.default.fastFindWhere(e.lines,"type",m.a.LineType.END));var t={version:0,lines:e.lines};return JSON.stringify(t)},getAllLines:function(){return this.lines},findLine:function(e){return u.default.fastFindWhere(this.lines,"name",e)},findNext:function(e){for(var t=this.lines.indexOf(e)+1;t<this.lines.length&&this.lines[t].parentName!==e.parentName;++t);return t<this.lines.length?this.lines[t]:null},findPrev:function(e){for(var t=this.lines.indexOf(e)-1;t>=0&&this.lines[t].parentName!==e.parentName;--t);return t>=0?this.lines[t]:null},parent:function(e){return this.findLine(e.parentName)},makeEndChildPos_:function(e){console.assert(e.name);var t=e.name+"_end",n=this.cachedEndPoses[t];return n||(n={name:t,type:m.a.LineType.END,parentName:e.name},this.cachedEndPoses[t]=n),n},findPos:function(e){var t=this.findLine(e);return t||(t=this.cachedEndPoses[e]),t},getNextPos:function(e){return console.assert(e.type!==m.a.LineType.END),this.findNext(e)||this.makeEndChildPos_(this.parent(e))},getEndPos:function(e){console.assert(e.type!==m.a.LineType.END);for(var t=e;t.type!==m.a.LineType.END;)t=this.getNextPos(t);return t},getFirstChildPos:function(e){return u.default.fastFindWhere(this.lines,"parentName",e.name)||this.makeEndChildPos_(e)},getEndChildPos:function(e){return this.makeEndChildPos_(e)},getAllEndPos:function(){return this.getEndChildPos(this.root)},newTextLine:function(e){return l.defaults({name:i(),content:e||""},h)},newImageLine:function(e){return l.defaults({name:i(),filename:e},g)},removeLine:function(e,t){var n=this;if(t){var i=n.findAllChildren(e);l.each(i,function(e){n.removeLine(e,!1)})}var o=n.lines.indexOf(e);console.assert(-1!==o),n.lines.splice(o,1)},setLineParent:function(e,t){console.assert(t),e.parentName=t},insertAfter:function(e,t){console.assert(!this.findLine(e.name)),console.assert(t.type!==m.a.LineType.END);var n=this,i=n.lines.indexOf(t);e.parentName=t.parentName,n.lines.splice(i+1,0,e)},insertBefore:function(e,t){console.assert(!this.findLine(e.name));var n=this;if(t.type===m.a.LineType.END)n.append(e,n.parent(t));else{var i=n.lines.indexOf(t);e.parentName=t.parentName,n.lines.splice(i,0,e)}},append:function(e,t){console.assert(!this.findLine(e.name));var n=this,i=t||n.root;e.parentName=i.name,n.lines.push(e)},walk:function(e,t){var n=this,i=t||n.root;e(i),l.each(n.lines,function(t){t.parentName===i.name&&n.walk(e,t)})},findAllChildren:function(e){var t=[];return this.walk(function(n){n!==e&&t.push(n)},e),t},normalize:function(){var e=this,t=[];e.walk(function(e){t.push(e)},e.root),t.length!==e.lines.length&&log.error("ldoc: found isolated lines, discard %d lines",e.lines.length-t.length),e.lines=t},cloneAllLines:function(e){var t=this,n=[];return l.each(t.lines,function(t){if(e||t.name!==m.a.LN_ROOT_NAME){var o=l.clone(t);o.name=i(),n.push(o)}}),n},getTextHtmlContent:function(e){return l.reduce(this.lines,function(e,t){return t.type===m.a.LineType.TEXT?e+="<div>"+t.content+"</div>":e},"")},getTotalChars:function(){var e=0;return l.each(this.lines,function(t){t.type===m.a.LineType.TEXT&&(e+=t.content.replace(/<[^>]*>/g,"").length)}),e},getTotalImages:function(){var e=0;return l.each(this.lines,function(t){t.type===m.a.LineType.IMAGE&&e++}),e},getTotalImageSize:function(){var e=0;return l.each(this.lines,function(t){t.type===m.a.LineType.IMAGE&&(e+=t.size)}),e}})},function(e,t,n){"use strict";function i(e){return e}function o(e){return e}function r(e,t){e.$el.find("#modal-settings").remove();var n,i=(n=T.isXSmall()?$(A.default.htmlToElement(j,!0)):$(A.default.htmlToElement(W,!0)))[0],o=$(A.default.htmlToElement(H,!0)),r=Polymer.dom(i);T.isXSmall()?(n.find(".pos-general").replaceWith(o.find(".page-general")),n.find(".pos-sync").replaceWith(o.find(".page-sync")),n.find(".pos-auto-export").replaceWith(o.find(".page-auto-export")),n.find(".pos-account").replaceWith(o.find(".page-account"))):n.find(".pos-pages").replaceWith(o.find(".pages").children());var s=_.toArray(Polymer.dom(o.find(".panels")[0]).children),c=r.querySelector(".pos-panels"),d=c.parentElement;Polymer.dom.flush(),_.each(s,function(e){Polymer.dom(d).insertBefore(e,c),Polymer.dom.flush()}),Polymer.dom(d).removeChild(c);var u=$(".panel-main",n),p={home:e,tabName:t,$el:n,el:i,xSlider:$("x-slider",n)[0],$panelMain:u,$panelUpgrade:$(".panel-upgrade",n),$pageGeneral:$(".page-general",n),$pageSync:$(".page-sync",n),$pageAutoExp:$(".page-auto-export",n),$pageAccount:$(".page-account",n),$panelShareFolder:$(".panel-share-folder",n),$panelBm:$(".panel-bm",n)};T.isXSmall()?_.extend(p,{$panelGeneral:$(".panel-general",n),$panelSync:$(".panel-sync",n),$panelAutoExp:$(".panel-auto-export",n),$panelAccount:$(".panel-account",n)}):_.extend(p,{$panelGeneral:u,$panelSync:u,$panelAutoExp:u,$panelAccount:u}),l(p),a(p)}function a(e){var t=e.home,n=e.$el;n.appendTo(t.$el),t.updateProOnlyUI(n);{$(".action-sel-workspace",e.$pageGeneral).on("click",function(){}),I.ENABLE_PRO&&ar.commits.accountType!==ar.AT_Pro&&($(".check-auto-new-note",e.$pageGeneral).addAttr("disabled"),$(".text-pro-only",e.$pageGeneral).text("("+localString("pro_only")+")")),$(".check-auto-new-note",e.$pageGeneral).checked(ar.settings.bAutoNewNote),$(".check-insert-marker",e.$pageGeneral).checked(ar.settings.bContRecMarker),S("MobileApp")&&$(".check-wifi-only",e.$pageGeneral).checked(ar.settings.bWifiOnly),B&&($(".slider-gain",e.$pageGeneral).on("value-change",function(t){$(".text-gain",e.$pageGeneral).text(x.sprintf("%d",o(parseInt(this.value))))}),$(".slider-gain",e.$pageGeneral)[0].value=i(ar.settings.gain),$(".text-gain",e.$pageGeneral).text(x.sprintf("%d",i(ar.settings.gain))),$("#aria-gain-desc",e.$pageGenerial).html(localString("gain_footnote",A.default.getDefaultGainLevel())));var r=_$(".combo-offset-abm",e.$pageGeneral);_.delay(()=>{r.selected=ar.settings.offsetAbmTime}),ar.signInUserId||ar.signInUserEmail?$(".save-settings-on-server-need-signin",e.$pageGeneral).text(""):($(".action-save-settings-on-server",e.$pageGeneral).addAttr("disabled"),$(".save-settings-on-server-need-signin",e.$pageGeneral).html(localString("save_settings_to_server_need_signin"))),c(e);var a=_$(".combo-rewind-speed",e.$pageGeneral);a&&_.delay(()=>{a.selected=ar.settings.rewindSpeed}),$(".action-reset-all-tutorials",e.$pageGeneral).on("click",function(){ar.settings.tips={},t.saveSettings(),A.default.toastShowLongCenter(localString("common_success"))});let n=_$(".combo-font-size",e.$pageGeneral);n&&_.delay(()=>{n.selected=ar.settings.fontSizeName}),void 0!==A.default.getAppSettings().forceSettings.bDisableSpellCheck&&($(".check-disable-spell-check",e.$pageGeneral).addAttr("disabled"),$(".text-force-spell-check",e.$pageGeneral).show()),$(".check-disable-spell-check",e.$pageGeneral).checked(ar.settings.bDisableSpellCheck)}$("#check_auto_sync").checked(ar.settings.bAutoSync),d(e),$(".cloud-list > paper-item",e.$pageAutoExp).removeClass("active").attr("aria-checked","false"),$(".cloud-list > paper-item[data-value='"+ar.settings.autoExpProvider+"']",e.$pageAutoExp).addClass("active").attr("aria-checked","true"),b(e);var l;if(l=ar.signInUserEmail?x.sprintf("%s (%s)",ar.signInUserEmail,ar.signInType):ar.signInShowName?x.sprintf("%s (%s)",ar.signInShowName,ar.signInType):ar.signInUserId?x.sprintf("ID_%.8s...(%s)",ar.signInUserId,ar.signInType):localString("settings_unreg"),$(".label-account-name",n).text(l).title(l),$(".label-notes",n).text(t.getArtNum("Note")),$(".text-space-used",n).text(x.sprintf("%.2fM",t.calcTotalCacheSize()/1024/1024)),S("AndroidApp")){u=ar.fileSystem.getRootPath().replace("file://","");$(".text-android-data-folder",n).text(u)}if(S("Node")){var u=ar.fileSystem.getRootPath();$(".text-node-data-folder",n).text(u)}if($.ajax({url:A.default.makeApiUrl("/api/get-pro-price"),type:"GET",xhrFields:{withCredentials:!0},dataType:"json"}).done(t=>{$(".pro-price",e.$panelUpgrade).text("("+t.proPriceShowString+")"),t.proPromoMsg&&($(".promo-msg > div",e.$panelUpgrade).text(t.proPromoMsg),$(".promo-msg").show())}).fail(e=>{log.error("getting price failed,",e)}),$(".pro-price-show-string",e.$panelUpgrade).text(C.a.DEF_PRICE_SHOW_STRING),$(".text-upgrade-rec-time-help",e.$panelUpgrade).html(localString("upgrade_max_rec_time_help",t.getFreeAccountRecTimeInMinutes())),$(".text-upgrade-images-help",e.$panelUpgrade).html(localString("upgrade_images_help",t.getProAccountMaxImages(),t.getFreeAccountMaxImages())),ar.signInUserEmail)$(".action-signin",e.$panelUpgrade).hide(),$(".text-show-name",e.$panelUpgrade).text(ar.signInUserEmail);else if(ar.signInShowName)$(".action-signin",e.$panelUpgrade).hide(),$(".text-show-name",e.$panelUpgrade).text(ar.signInShowName);else if(ar.signInUserId){$(".action-signin",e.$panelUpgrade).hide();var p=x.sprintf("ID_%.8s...",ar.signInUserId);$(".text-show-name",e.$panelUpgrade).text(p)}else $(".text-show-name",e.$panelUpgrade).hide(),$(".action-signin",e.$panelUpgrade).show();S("AndroidApp")&&ar.commits.accountType===ar.AT_Free?$(".text-trial-prompt",e.$panelUpgrade).text(localString("upgrade_free_upgrade_prompt")).addClass("text-success"):$(".text-trial-prompt",e.$panelUpgrade).hide();var m=e.$panelBm.find(".string-templ"),f=m.find(".color .dropdown")[0];_.each(C.a.FORE_COLORS,function(e,t){var n=document.createElement("PAPER-ITEM");n.dataset.idx=t,n.style.background=e,Polymer.dom(f).appendChild(n),Polymer.dom.flush()});var h=Polymer.dom(m[0]).innerHTML;Polymer.dom(m[0].parentElement).removeChild(m[0]);for(var g=e.$panelBm.find(".item-bm-strings .string-list"),v=0;v<6;++v)g.append(h),Polymer.dom.flush();s(e),"purchase"===e.tabName?($(x.sprintf(".nav-tab paper-item[data-name=account]"),e.$panelMain).click(),$(".action-upgrade",e.$panelAccount).click()):"share-folder"===e.tabName?($(x.sprintf(".nav-tab paper-item[data-name=general]"),e.$panelMain).click(),$(".action-share-folder",e.$pageGeneral).click()):"bookmark"===e.tabName?($(x.sprintf(".nav-tab paper-item[data-name=general]"),e.$panelMain).click(),$(".action-bm",e.$pageGeneral).click()):T.isXSmall()?$(x.sprintf(".panel-main .action-%s",e.tabName),n).click():$(x.sprintf(".nav-tab paper-item[data-name=%s]",e.tabName||ar.settings.lastSeledTabInSettings),e.$panelMain).click(),n.showModal()}function l(e){function t(){var e;return k.resolve().then(function(){return k($.ajax({url:A.default.makeApiUrl("/api/gwallet-pro-setup?v=2"),type:"GET",xhrFields:{withCredentials:!0},data:{appId:chrome.runtime.id}})).catch(function(e){throw e&&"already-pro"===e.responseText?localString("purchase_ready_pro"):localString("gwallet_mn_server_returned_error",A.default.getShowError(e&&e.responseText||e))})}).then(function(t){var i=k.defer();return n.e(2).then(function(){var o=[n(113)];(function(){A.default.getAppSettings().bRestartAfterTryingBuyPro=!0,A.default.saveAppSettings(),e=A.default.messageBox("Purchase","You are being redireting to Google Wallet page. <br><strong>DONT CLOSE APP DURING OPERATION!</strong>",{btnOk:!1,bDisableBackdropClose:!0},function(e){}),window.google.payments.inapp.buy({parameters:{env:t.env},sku:t.sku,success:function(e){var t,n,o;try{t=e.jwt}catch(e){t="unknown jwt"}try{o=e.request.cartId}catch(e){o="unknown cart id"}try{n=e.response.orderId}catch(e){n="unknown order id"}i.resolve({jwt:t,cartId:o,orderId:n})},failure:function(t){log.error("Failure: "+JSON.stringify(t)),A.default.hideMessageBox(e),t&&t.response&&"PURCHASE_CANCELED"===t.response.errorType?i.reject(localString("purchase_canceled")):i.reject("Google Wallet returned error: "+JSON.stringify(t))}})}).apply(null,o)}).catch(n.oe),i.promise}).then(function(t){return k($.ajax({url:A.default.makeApiUrl("/api/gwallet-pro-verify?v=2"),type:"POST",xhrFields:{withCredentials:!0},data:t})).then(function(){A.default.hideMessageBox(e)},function(e){throw localString("gwallet_mn_server_returned_error",A.default.getShowError(e))})})}function i(){var e=k.defer(),t=A.default.messageBox("Purchase","You are being redireting to Google Wallet page.",{btnOk:!0},function(e){});return window.google.payments.inapp.buy({sku:"micnote_pro",consume:!1,success:function(n){log.log("Success: "+JSON.stringify(n)),A.default.hideMessageBox(t),e.resolve()},failure:function(n){log.error("Failure: "+JSON.stringify(n)),A.default.hideMessageBox(t),n&&n.response&&"PURCHASE_CANCELED"===n.response.errorType?e.reject(localString("purchase_canceled")):e.reject("Google Wallet returned error: "+JSON.stringify(n))}}),e.promise}function o(){$(".cloud-list > paper-item",e.$panelShareFolder).removeClass("active").attr("aria-checked","false"),$(".cloud-list > paper-item[data-value='"+ar.settings.shareFolderProvider+"']",e.$panelShareFolder).addClass("active").attr("aria-checked","true");var t=ar.settings.shareFolderProvider,n="Disable"===t?"N/A":"/"+localString("def_share_folder_name");$(".text-folder",e.$panelShareFolder).text(n),"Disable"===t?($(".text-folder",e.$panelShareFolder).text("N/A"),$(".action-sel-folder",e.$panelShareFolder).removeClass("body-action").find(".slide-arrow").hide()):($(".text-folder",e.$panelShareFolder).text(ar.settings.shareFolderShowPath).title(ar.settings.shareFolderShowPath),$(".action-sel-folder",e.$panelShareFolder).addClass("body-action").find(".slide-arrow").show())}var a=e.home,l=e.$el;T.isXSmall()?($(".panel-main .action-general",l).on("click",function(){e.xSlider.slide("main","general",!0)}),$(".panel-main .action-sync",l).on("click",function(){e.xSlider.slide("main","sync",!0)}),$(".panel-main .action-auto-export",l).on("click",function(){e.xSlider.slide("main","auto-export",!0)}),$(".panel-main .action-account",l).on("click",function(){e.xSlider.slide("main","account",!0)}),$(".panel-general .action-back",l).on("click",function(){e.xSlider.slide("main","general",!1)}),$(".panel-sync .action-back",l).on("click",function(){e.xSlider.slide("main","sync",!1)}),$(".panel-auto-export .action-back",l).on("click",function(){e.xSlider.slide("main","auto-export",!1)}),$(".panel-account .action-back",l).on("click",function(){e.xSlider.slide("main","account",!1)})):$(".nav-tab",l).on("click","paper-item",function(e){$(".nav-tab paper-item").removeClass("active"),$(e.currentTarget).addClass("active"),$("#modal-settings .setting-page").css("display","none"),$("#modal-settings .page-"+this.dataset.name).css("display","")}),l.on("iron-overlay-opened",function(t){t.target===t.currentTarget&&($(".cloud-list > paper-item[data-value='"+ar.settings.cloudProvider+"']",e.$pageSync).trigger("selected.app"),$(".cloud-list > paper-item[data-value='"+ar.settings.autoExpProvider+"']",e.$pageAutoExp).trigger("selected.app"))}),l.on("iron-overlay-closed",function(t){t.target===t.currentTarget&&(T.isXSmall()||(ar.settings.lastSeledTabInSettings=$(".nav-tab paper-item.active",e.$panelMain).data("name"),e.home.saveSettings()),V.emit())}),$(".action-signin",e.$panelUpgrade).on("click",function(){l.hideModal(),a.signInAccount().then(function(t){$(".text-signin-warning",e.$panelUpgrade).css("visibility","hidden"),"need-restart"!==t&&r(a,"purchase")})}),$("#pay-with-paypal",l).on("click",function(t){if(ar.signInUserId||ar.signInUserEmail){a.reportAccount();var n=A.default.makeWebUrl("/templates/paypalStart.html");n+="?uid="+ar.uid+"&prodId=pro&v=2",Object(U.openExternalLink)(n),A.default.getAppSettings().bRestartAfterTryingBuyPro=!0,A.default.saveAppSettings(),l.hideModal(),A.default.messageBox("Purchase","You are being redireting to PalPay site, please <strong>restart</strong> this app after you have finished your purchase.",{btnOk:!0},function(e){})}else $(".text-signin-warning",e.$panelUpgrade).css("visibility","visible")}),$("#pay-with-gwallet",l).on("click",function(n){if(ar.signInUserId||ar.signInUserEmail){a.reportAccount();k.resolve().then(function(){return l.hideModal(),S("ChromeApp")?t():S("AndroidApp")?i():void console.assert(!1)}).then(function(){A.default.messageBox("Purchase Succeed","Please <strong>restart</strong> this app to have all Pro features worked properly",{btnOk:!1,bDisableBackdropClose:!0},function(e){})}).catch(function(e){A.default.messageBoxPromise("Purchase Failed",A.default.getShowError(e),{btnOk:!0}).then(function(e){r(a,"purchase")})})}else $(".text-signin-warning",e.$panelUpgrade).css("visibility","visible")}),$(".action-buy-vol",e.$panelUpgrade).on("click",function(e){var t;t=I.bDebug?"http://127.0.0.1:3000/micnote/chrome/price":"https://www.micnote.audio/price",Object(U.openExternalLink)(t)}),$(".action-restore-purchase",e.$panelUpgrade).on("click",function(t){if(ar.signInUserId){A.default.addActivityAnimation(e.$panelUpgrade,!0);n.e(2).then(function(){var e=[n(113)];(function(){google.payments.inapp.getPurchases({parameters:{env:"prod"},success:function(e){console.log(e)},failure:function(e){console.log(e)}})}).apply(null,e)}).catch(n.oe)}else $(".text-signin-warning",e.$panelUpgrade).css("visibility","visible")}),$(".action-upgrade",e.$panelAccount).on("click",function(t){e.xSlider.slide(e.$panelAccount.attr("name"),"upgrade",!0)}),$(".action-back",e.$panelUpgrade).on("click",function(t){e.xSlider.slide(e.$panelAccount.attr("name"),"upgrade",!1)}),$(".action-close",l).on("click",function(t){l.hideModal(),u(e),$("#menu-gen-rec-share-link").toggleAttr("disabled","Disable"===ar.settings.shareFolderProvider),ar.settingsChanged.emit({settings:ar.settings,hint:"close-settings-dialog"}),E.a.onSettingsChanged(),"Disable"!==ar.settings.cloudProvider&&(a.syncer.isSyncInited()?e.bSyncChanged&&$("#sync").click():a.syncer.showInitSync())}),$(".cloud-list",e.$pageSync).on("click",">paper-item",function(t){var n=$(this)[0].dataset.value;m(e,n)}),$("#menu-reg").on("click",function(e){window.location.hash="signup",e.preventDefault()}),$(".action-reg",l).on("click",function(e){window.location.hash="signup",e.preventDefault()}),$(".action-clear-cache",l).on("click",function(t){if("Disable"!==ar.settings.cloudProvider){var n=0,i=k.resolve(),o=_.where(ar.lsArticles,{type:"Note"});o.sort(function(e,t){return-(e.vDate.getTime()-t.vDate.getTime())}),_.each(o,function(e){(n+=a.calcArticleCacheSize(e))>10485760&&(e==ar.curArticle||e.noteCommit!==e.noteSyncCommit||"Disable"!==ar.settings.autoExpProvider&&e.noteCommit!==e.aeNoteSyncCommit||(i=i.then(function(){return e.noteCommit=null,e.noteSyncCommit=null,e.aeNoteSyncCommit=null,e.ldoc=null,e.artCommit=null,e.audioCommit=null,e.audioSize=0,k.ninvoke(ar.fileSystem,"removeDir",ar.userDir+e.artName)})))}),i.then(function(){a.saveArticleList(),$(".text-total-cache",e.$pageSync).text(localPrintf("cache_total_size",n/1024/1024)),A.default.toastShowShortCenter(localString("common_success"))})}}),$(".action-sel-sync-folder",e.$panelSync).on("click",function(){if(this.classList.contains("body-action")){var t=O.b(a.getSelSyncFolderProvider(),e.xSlider,e.$panelSync,a,{bSelectFolder:!0,bFolderOnly:!0,bMultiSel:!1,bCancelable:!0});O.c(t,function(t,n){if("Ok"===t){var i=n[0],o=i.path||"/";$(".text-sync-folder",e.$panelSync).text(o).title(o),f(e,i.fid,i.path)}})}}),$(".action-options",e.$pageAutoExp).on("click",function(){D.c(a.getAEProvider(),e.xSlider,e.$panelAutoExp,a);e.xSlider.slide("main","ae-main",!0)}),$(e.xSlider).on("x-slider-end",function(t){t.originalEvent.detail.shownPage===e.$panelAutoExp[0]&&$(".cloud-list > paper-item[data-value='"+ar.settings.autoExpProvider+"']",e.$pageAutoExp).trigger("selected.app")}),$(".cloud-list",e.$pageAutoExp).on("click",">paper-item",function(t){var n=this.dataset.value;ar.settings.autoExpProvider!=n&&(ar.settings.autoExpProvider=n,ar.settings.autoExpFolderPath="/Mic Note Exports",ar.settings.gdriveAutoExpFolderId=null,v(e.home),b(e)),$(".cloud-list  > paper-item",e.$pageAutoExp).removeClass("active").attr("aria-checked","false"),$(this).addClass("active").attr("aria-checked","true").trigger("selected.app")}),$(".cloud-list > paper-item",e.$pageAutoExp).on("selected.app",function(t){if("Disable"===this.dataset.value)$(".action-options",e.$pageAutoExp).css("display","none"),$(".text-options",e.$pageAutoExp).text("N/A"),$(".options-footnote",e.$pageAutoExp).html("&nbsp");else{$(".action-options",e.$pageAutoExp).css("display",""),$(".text-options",e.$pageAutoExp).text(a.getCloudShowName(this.dataset.value));var n=[];ar.settings.bAutoExpMicnote&&n.push(".micnote"),ar.settings.bAutoExpRecording&&n.push(ar.AUDIO_EXT),ar.settings.bAutoExpPdf&&n.push("pdf"),ar.settings.bAutoExpGDoc&&n.push("gdoc"),ar.settings.bAutoExpHtml&&n.push("html"),n.length?$(".options-footnote",e.$pageAutoExp).html(localString("auto_exp_in_formats",ar.settings.autoExpFolderPath,n.join(", "))):$(".options-footnote",e.$pageAutoExp).html(localString("auto_exp_no_formats"))}}),S("AndroidApp")&&$(".action-disable-keyboard-sound",e.$pageGeneral).on("click",function(){window.mobileUtil.disableKeyboardSound()}),$(".action-save-settings-on-server",e.$pageGeneral).on("click",function(){u(e);var t=y(),n=JSON.stringify(t);$.ajax({url:A.default.makeApiUrl("/api/save-settings"),type:"POST",xhrFields:{withCredentials:!0},data:{settings:n}}).done(function(e){A.default.toastShowShortCenter(localString("common_success"))}).fail(function(e){A.default.toastShowShortCenter(localString("common_failed")),log.error(e.responseText)})}),$(".action-upgrade-gdrive-folder",e.$pageSync).on("click",function(){p()&&new Promise(function(e){e()}).then(function(){var t=[n(108)];(function(t){var n=e.home;l.hideModal(),t.tryUpgradeGDriveInAppFolder().then(function(){r(n,"sync")})}).apply(null,t)}).catch(n.oe)}),$(".action-share-folder",e.$pageGeneral).on("click",function(){o(),e.xSlider.slide(e.$panelGeneral.attr("name"),"share-folder",!0)}),$(".cloud-list paper-item",e.$panelShareFolder).on("click",function(){var t=this.dataset.value;ar.settings.shareFolderProvider=t,ar.settings.shareFolderId=null,ar.settings.shareFolderShowPath="Disable"===t?"":"/"+localString("def_share_folder_name"),e.home.saveSettings(),o()}),$(".action-sel-folder",e.$panelShareFolder).on("click",function(){var t=e.$panelShareFolder.find(".cloud-list paper-item.active").data("value");console.assert("Disable"!==t);var n=M.getStdProvider(t),i=O.b(n,e.xSlider,e.$panelShareFolder,a,{bSelectFolder:!0,bFolderOnly:!0,bMultiSel:!1,bCancelable:!0});O.c(i,function(n,i){if("Ok"===n){var r=i[0];ar.settings.shareFolderProvider=t,ar.settings.shareFolderId=r.fid,ar.settings.shareFolderShowPath=r.path,e.home.saveSettings(),o()}})}),$(".action-back",e.$panelShareFolder).on("click",function(){c(e),e.xSlider.slide(e.$panelGeneral.attr("name"),"share-folder",!1)}),$(".action-bm",e.$panelGeneral).on("click",function(){e.xSlider.slide(e.$panelGeneral.attr("name"),"bookmark",!0)}),$(".action-back",e.$panelBm).on("click",function(){e.xSlider.slide(e.$panelGeneral.attr("name"),"bookmark",!1)}),$(".item-bm-strings .action-reset",e.$panelBm).on("click",function(){ar.settings.bmStrings=[{colorIdx:1,string:localString("bm_def_1")},{colorIdx:2,string:localString("bm_def_2")},{colorIdx:3,string:localString("bm_def_3")}],s(e)}),$(".item-bm-strings",e.$panelBm).on("click",".color .dropdown paper-item",function(e){var t=$(this).closest(".string-item")[0],n=t.querySelector(".string"),i=t.querySelector(".color x-icon-button"),o=C.a.FORE_COLORS[this.dataset.idx];Polymer.dom(n.root).querySelector("input").style.color=o,n.dataset.colorIdx=this.dataset.idx,i.style.color=o})}function s(e){var t=e.$panelBm.find(".item-bm-strings .string");_.each(t,function(e,t){t<ar.settings.bmStrings.length?(e.value=ar.settings.bmStrings[t].string,Polymer.dom(e.root).querySelector("input").style.color=C.a.FORE_COLORS[ar.settings.bmStrings[t].colorIdx],e.dataset.colorIdx=ar.settings.bmStrings[t].colorIdx):(e.value="",Polymer.dom(e.root).querySelector("input").style.color=C.a.FORE_COLORS[0],e.dataset.colorIdx=0)});var n=e.$panelBm.find(".item-bm-strings .color x-icon-button");_.each(n,function(e,t){t<ar.settings.bmStrings.length?e.style.color=C.a.FORE_COLORS[ar.settings.bmStrings[t].colorIdx]:e.style.color=C.a.FORE_COLORS[0]})}function c(e){var t;if("Disable"!==ar.settings.shareFolderProvider){var n=M.getStdProvider(ar.settings.shareFolderProvider);t=x.sprintf("[%s]%s",n.showName,ar.settings.shareFolderShowPath)}else t=localString("share_folder_none");$(".text-share-folder",e.$pageGeneral).text(t).title(t)}function d(e){if("GDrive"===ar.settings.cloudProvider&&"appdata"===ar.settings.syncFolderId?$(".item-upgrade-gdrive-folder",e.$pageSync).show():$(".item-upgrade-gdrive-folder",e.$pageSync).hide(),$(".cloud-list > paper-item",e.$pageSync).removeClass("active").attr("aria-checked","false"),$(".cloud-list > paper-item[data-value="+ar.settings.cloudProvider+"]",e.$pageSync).addClass("active").attr("aria-checked","true"),"Disable"!==ar.settings.cloudProvider?$("#check_auto_sync").toggleAttr("disabled",!1):$("#check_auto_sync").toggleAttr("disabled",!0),"Disable"===ar.settings.cloudProvider)$(".text-sync-folder",e.$panelSync).text("N/A"),$(".action-sel-sync-folder",e.$panelSync).removeClass("body-action").find(".slide-arrow").hide();else if("GDrive"===ar.settings.cloudProvider&&"appdata"===ar.settings.syncFolderId)$(".text-sync-folder",e.$panelSync).text("In [Mic Note] App"),$(".action-sel-sync-folder",e.$panelSync).removeClass("body-action").find(".slide-arrow").hide();else{var t=ar.settings.syncFolderPath||"/";$(".text-sync-folder",e.$panelSync).text(t).title(t),$(".action-sel-sync-folder",e.$panelSync).addClass("body-action").find(".slide-arrow").show()}"GDrive"===ar.settings.cloudProvider&&"appdata"!==ar.settings.syncFolderId?$(".gdrive-only",e.$pageSync).show():$(".gdrive-only",e.$pageSync).hide(),"Disable"!==ar.settings.cloudProvider?($(".action-clear-cache",e.$pageSync).removeAttr("disabled"),$(".text-total-cache",e.$pageSync).text(localPrintf("cache_total_size",e.home.calcTotalCacheSize()/1024/1024))):($(".action-clear-cache",e.$pageSync).addAttr("disabled"),$(".text-total-cache",e.$pageSync).text(""))}function u(e){var t=e.home,n=e.$el;B&&(ar.settings.gain=o($(".slider-gain",e.$pageGeneral)[0].value),e.home.saveSettings()),ar.settings.bAutoNewNote=$(".check-auto-new-note",n).checked(),ar.settings.bContRecMarker=$(".check-insert-marker",n).checked(),S("MobileApp")&&(ar.settings.bWifiOnly=$(".check-wifi-only",n).checked());var i=_$(".combo-offset-abm",n);ar.settings.offsetAbmTime=parseFloat(i.selected);var r=_$(".combo-rewind-speed",n);r&&(ar.settings.rewindSpeed=parseFloat(r.selected),R.j()),$(".check-disable-spell-check",n).checked()!==ar.settings.bDisableSpellCheck&&(ar.settings.bDisableSpellCheck=$(".check-disable-spell-check",n).checked(),t.editorUtil.applySpellCheck());var a=_$(".combo-font-size",n);a&&a.selected!==ar.settings.fontSizeName&&(ar.settings.fontSizeName=a.selected,t.editorUtil.applyFontSize());var l=$("#check_auto_sync",n).checked();ar.settings.bAutoSync=l;var s=e.$panelBm.find(".item-bm-strings paper-input");ar.settings.bmStrings=[],_.each(s,function(e){e.value&&ar.settings.bmStrings.push({colorIdx:e.dataset.colorIdx,string:e.value})}),t.saveSettings()}function p(){return!ar.bSyncing||(A.default.messageBox(localString("common_warning"),localString("sync_running_cannot_change")),!1)}function m(e,t){function n(n){e.home;if("Disable"!=ar.settings.cloudProvider){var o;o="Disable"===t?localString("disable_sync_q"):localString("change_sync_provider_q"),A.default.messageBox(localString("common_warning"),o,{btnOk:!0,btnCancel:!0,okClass:"btn-warning",okTitle:localString("common_yes")},function(e){"Ok"===e&&i()})}else i(n)}function i(n){k.resolve().then(()=>{let t=e.home.getSyncProvider();return t?t.clearCachedAuthToken(ar.accountId).catch(e=>{log.error("clearCachedAuthToken failed: "+e)}):null}).then(()=>{ar.settings.cloudProvider=t,"Disable"===ar.settings.cloudProvider?(ar.settings.syncFolderId=null,ar.settings.syncFolderPath=""):n?(ar.settings.syncFolderId="appdata",ar.settings.syncFolderPath="In [Mic Note] App"):(ar.settings.syncFolderId=null,ar.settings.syncFolderPath="/My Mic Notes"),h(e)})}if(ar.settings.cloudProvider!==t&&p())if("GDrive"===t&&"GDrive"!==ar.settings.cloudProvider){var o=e.home.getCloudProviders().gdrive,r=A.default.addActivityAnimation(e.$el,!0);A.default.cancelable(()=>o.authenticate(ar.accountId,!0).then(function(){return o.listChildren("appdata","google.gdrive0")})).then(function(t){var i=_.findWhere(t,{title:"changes"}),o=_.findWhere(t,{title:"upgraded"});r&&$(r).remove(),o||!i?n():(n(!0),$(".item-upgrade-gdrive-folder",e.$pageSync).show())},null).catch(function(e){"cancel"===e||e&&"cancel"===e.appName?log.log("canceled"):(log.fail(e),A.default.toastShowLongCenter(A.default.getShowError(e),"error")),r&&$(r).remove()})}else n()}function f(e,t,n){ar.settings.syncFolderId!==t&&p()&&(ar.settings.syncFolderId=t,ar.settings.syncFolderPath=n,h(e))}function h(e){g(e.home),d(e),e.bSyncChanged=!0}function g(e){new Promise(function(e){e()}).then(function(){var t=[n(108)];(function(t){t.clearUnfetchedNotes(),"Disable"!==ar.settings.cloudProvider&&e.getSyncProvider().setSyncRoot(ar.settings.syncFolderId),e.saveSettings()}).apply(null,t)}).catch(n.oe)}function v(e){var t=e.getAllAutoExpFileIdFieldNames(!0);ar.lsArticles.forEach(function(e){_.each(t,function(t){e.gdrive[t]=null}),e.aeNoteSyncCommit=null,e.aeFolderSyncCommit=null}),e.saveArticleList(),e.saveSettings()}function b(e){"GDrive"===ar.settings.autoExpProvider?$(".gdrive-only",e.$pageAutoExp).show():$(".gdrive-only",e.$pageAutoExp).hide()}function y(){return{gain:ar.settings.gain,bAutoNewNote:ar.settings.bAutoNewNote,bContRecMarker:ar.settings.bContRecMarker,bWifiOnly:ar.settings.bWifiOnly,bmStrings:ar.settings.bmStrings,bAutoSync:ar.settings.bAutoSync,cloudProvider:ar.settings.cloudProvider,syncFolderId:ar.settings.syncFolderId,syncFolderPath:ar.settings.syncFolderPath,autoExpProvider:ar.settings.autoExpProvider,bAutoExpMicnote:ar.settings.bAutoExpMicnote,bAutoExpRecording:ar.settings.bAutoExpRecording,bAutoExpPdf:ar.settings.bAutoExpPdf,bAutoExpGDoc:ar.settings.bAutoExpGDoc,bAutoExpHtml:ar.settings.bAutoExpHtml,autoExpFolderPath:ar.settings.autoExpFolderPath,gdriveAutoExpFolderId:ar.settings.gdriveAutoExpFolderId,exports:_.extend({},ar.settings.exports),fontSizeName:ar.settings.fontSizeName}}function w(e,t){ar.settings.gain=e.gain,ar.settings.bAutoNewNote=e.bAutoNewNote,ar.settings.bContRecMarker=e.bContRecMarker,ar.settings.bWifiOnly=e.bWifiOnly,e.bmStrings&&(ar.settings.bmStrings=e.bmStrings),ar.settings.bAutoSync=e.bAutoSync,ar.settings.cloudProvider=e.cloudProvider,ar.settings.syncFolderId=e.syncFolderId,ar.settings.syncFolderPath=e.syncFolderPath,ar.settings.autoExpProvider=e.autoExpProvider,ar.settings.bAutoExpMicnote=e.bAutoExpMicnote,ar.settings.bAutoExpRecording=e.bAutoExpRecording,ar.settings.bAutoExpPdf=e.bAutoExpPdf,ar.settings.bAutoExpGDoc=e.bAutoExpGDoc,ar.settings.bAutoExpHtml=e.bAutoExpHtml,ar.settings.autoExpFolderPath=e.autoExpFolderPath,ar.settings.gdriveAutoExpFolderId=e.gdriveAutoExpFolderId,ar.settings.exports=_.extend({},e.exports),e.fontSizeName&&(ar.settings.fontSizeName=e.fontSizeName),g(t),v(t),t.editorUtil.applyFontSize()}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"showSettings",function(){return r}),n.d(t,"restoreSettingsDataForServer",function(){return w}),n.d(t,"settingsClosed",function(){return V});var _=n(19),x=(n.n(_),n(23)),S=(n.n(x),n(6)),k=(n.n(S),n(20)),T=(n.n(k),n(8)),C=n(91),A=n(22),L=n(21),I=(n.n(L),n(7)),E=(n.n(I),n(92)),N=n(154),P=(n.n(N),n(155)),F=(n.n(P),n(156)),D=(n.n(F),n(112)),M=n(94),O=n(96),R=n(107),U=n(24),B=!0,H=window.localHtml(N),j=window.localHtml(F),W=window.localHtml(P);let V=new Kefir.Bus},,function(e,t,n){"use strict";function i(){function e(){if(D&&D.length&&M<D.length){var e=v.getCurAudioTime();let l=o(D,e,M);if(l!==M){a();var t=l-1;if(t>=0){var n=D[t],i=ar.leditor.findLineElem(n.name);i.length&&i.addClass("playing-prev"),O=n,r()}M=l}}}function t(){return null!=D}function n(){var e=ar.leditor.getAllLns();D=R.pipe(R.map(e=>$(e).line()),R.map(R.pick(["name","time"])),R.filter(e=>null!=e.time),R.sortBy(R.prop("time")))(e.toArray()),M=0}function i(){a(!0),D=null,M=0}function l(){M=0}if($("#note-title").on("click",function(e){if(ar.leditor.bEditable){$(this).addAttr("hidden"),$("#input-note-title").removeAttr("hidden").val(ar.curArticle.artTitle);var t=$("#input-note-title")[0];t.setSelectionRange(0,ar.curArticle.artTitle.length),t.focus()}}),$("#input-note-title").on("blur keyup",function(e){if("keyup"!==e.type||13===e.keyCode){$(this).attr("hidden",!0),$("#note-title").removeAttr("hidden");var t=$(this).val();v.setArtTitle(ar.curArticle,t),"keyup"===e.type&&13===e.keyCode&&$("#note-title").focus()}}),$("#composer-view").on("click",function(){y&&d(null)}),$("#toolbar .action-in-note-search").on("click",function(e){b.is(":visible")?$("#in-note-search-bar .action-done").click():($(".input-search",b).val(""),$(".text-result",b).text(""),$(".action-forward",b).toggleAttr("disabled",!0),$(".action-backward",b).toggleAttr("disabled",!0),b.show("fast",function(){b.find(".input-search").focus()}),$(this).toggleAttr("active",!0))}),$(".input-search",b).on("input",function(e){var t=u(this.value),n=d(0===t.length?null:t);t.length?$(".text-result",b).text(localString("search_matches",n)):$(".text-result",b).text(""),$(".action-forward",b).toggleAttr("disabled",0===n),$(".action-backward",b).toggleAttr("disabled",0===n)}),$(".input-search",b).on("keydown",function(e){27===e.keyCode?""===this.value&&$("#in-note-search-bar .action-done").click():13===e.keyCode&&($(".action-forward",b).hasAttr("disabled")||$(".action-forward",b).click())}),$(".action-forward, .action-backward",b).on("click",function(){var e=ar.editor.find(".kw-highlight");if(e.length){for(var t=0;t<e.length&&!e[t].classList.contains("selected");++t);if(t===e.length)e[0].classList.add("selected");else{var n=e[t],i=e[t=this.classList.contains("action-forward")?(t+1)%e.length:(t+e.length-1)%e.length];n.classList.remove("selected"),i.classList.add("selected");let o=ar.leditor.$findCurLn(i);o.length&&ar.leditor.makeLinesVisible(o,!0)}}}),$("#in-note-search-bar .action-done").on("click",function(e){d(null),$("#in-note-search-bar").hide("fast"),$("#toolbar .action-in-note-search").toggleAttr("active",!1)}),A.isXSmall()||A.isMiddle()){var s=Kefir.fromEvents($(".action-edit-done",v.$el),"click");let e,t;{let n=k.default.createTapHoldExplosionStream($(".action-edit-mode",v.$el),{rippleColor:"#ff4081"});e=n.filter(e=>!e).filter(()=>!(ar.settings.bVisitedHotPad&&!v.isRunTimeTipFinish("bFastEnterHotPad"))||(v.checkRunTimeTipWithPic("bFastEnterHotPad",localString("tip_fast_enter_hotpad"),"./img/holdEditModeButton.jpg",localString("tip_tap_and_hold")),!1)),t=n.filter(e=>e),Kefir.merge([t.map(()=>!1),v.noteList.editModeByTapHoldNewNote.map(()=>!0)]).delay(500).onValue(function(e){B.emit(e)})}ar.noteModeStream=Kefir.merge([e.map(()=>"Edit"),s.map(()=>"Review"),t.map(()=>"Edit"),v.noteList.editModeByNewNote.map(()=>"Edit"),v.noteList.editModeByTapHoldNewNote.map(()=>"Edit")]),ar.noteMode=ar.noteModeStream.toProperty(()=>"Review"),ar.noteMode.onValue(function(e){if(ar.curNoteMode=e,"Review"===e)$("#home-main").attr("xsNoteMode","review"),ar.leditor.toggleEditable(!1),v.toggleMiniWaveBar(!1),ar.editorMode="Readonly",$(".action-edit-mode",v.$el).fadeIn(),A.isXSmall()?$(".start-record",v.$el).fadeOut():(v.hideNoteList(ar.settings.bHideNoteList),$(".start-record",v.$el).hide(),v.toggleMiniWaveBar(!1)),A.isMiddle()&&(_$("#note-nav-cont",v.$el).selected="review-nav"),$("#toolbar-view",v.$el).fadeOut(),$(".auto-edit-hide",v.$el).show();else{$("#home-main").attr("xsNoteMode","edit"),d(null),ar.leditor.toggleEditable(!0),ar.editorMode="Edit";var t=ar.leditor.lastLine();if(t.length){var n;t.lnType()===C.a.LineType.TEXT&&(n=ar.leditor.textHandler.makeLineActiveState(t.lnName(),-1)),ar.leditor.setActiveLn(t,n),x("MobileApp")||x("FakeMobile")?ar.createKeyboardShowSoonOnce().onValue(()=>{ar.leditor.makeLinesVisible(t)}):ar.leditor.makeLinesVisible(t)}$(".action-edit-mode",v.$el).fadeOut(),A.isXSmall()||(v.hideNoteList(!0),v.toggleMiniWaveBar(!1)),A.isMiddle()&&(_$("#note-nav-cont",v.$el).selected="edit-nav"),$(".start-record",v.$el).fadeIn(),$("#toolbar-view",v.$el).fadeIn(),$(".auto-edit-hide",v.$el).hide()}}),(x("MobileApp")||x("FakeMobile"))&&L.DEBUG_MOBILE_KEYBOARD&&ar.leditor.textHandler.contFocusProp.debounce(100).skipDuplicates().onValue(function(e){e?w.delay(window.dbgShowKeyboard):w.delay(window.dbgHideKeyboard)}),Kefir.combine([ar.noteMode,ar.keyboardShown]).onValue(function([e,t]){var n=_$("#hp-animated-pages"),i="hp-toggler-view"!==n.selected&&"hp-invisible-view"!==n.selected;i||(n.selected="Edit"!==e||t?"hp-invisible-view":"hp-toggler-view"),A.isXSmall()&&("Edit"===e&&t&&!i?$("#floating-editor-toolbar").fadeIn():$("#floating-editor-toolbar").fadeOut())}),Kefir.combine([ar.keyboardShown],[ar.noteMode,ar.leditor.textHandler.contFocusProp],function(e,t,n){return!!e&&("Edit"===t&&n)}).onValue(function(e){$("#toolbar-container").toggle(e)}),$("#note-bottom-bar").hide(),"cn"===L.market&&window.AdMob&&(Kefir.merge([e,t]).onValue(()=>{v.hasAd(!0)&&window.AdMob.prepareInterstitial({adId:L.admobid.interstitial,isTesting:L.bDebug})}),s.onValue(()=>{v.hasAd()&&window.AdMob.showInterstitial()}))}(A.isXSmall()||A.isMiddle())&&$("#hp-toggler-view").css("bottom","0px"),A.isXSmall()&&($("#hp-toggler-view").addClass("toast-push").get(0).dataset.toastPushBase="0"),x("DesktopApp")&&!x("FakeMobile")&&(_$("#hp-animated-pages").selected="hp-toggler-view",v.noteList.fastRecordingDesktop.delay(500).onValue(function(){B.emit(!0)})),$("#art-name-bar, #abm-list-col").on("click",function(e){e.target===e.currentTarget&&ar.leditor.onClickMarginSpace()}),C.a.ENABLE_PHOTO_VIEW&&ar.leditor.on("new-line",function(e){var t=e.line();if(t.type===C.a.LineType.IMAGE){var n,i=e.belowLn(C.a.LineType.IMAGE);i.length&&(n=ar.pview.findItem(i.lnName()),console.assert(n)),ar.pview.addItem({name:t.filename,origFileName:t.origFileName,width:t.imgWidth,height:t.imgHeight,time:t.time,imgSrc:ar.pview.makeImgUrl(t.filename)},n)}});let c=ar.wavesurfer.playerStarted.flatMap(()=>Kefir.merge([Kefir.later(0,"start"),ar.wavesurfer.playerProgress.map(()=>"update"),ar.wavesurfer.playerSeek.map(()=>"repos")]).takeUntilBy(ar.wavesurfer.playerPaused).beforeEnd(()=>"end")),p=ar.wavesurfer.dragStarted.filter(()=>!t()).flatMap(()=>Kefir.merge([Kefir.later(0,"start"),ar.wavesurfer.dragging.flatMap(()=>Kefir.sequentially(0,["repos","update"]))]).takeUntilBy(ar.wavesurfer.dragEnded).beforeEnd(()=>"end")),m=Kefir.merge([c,p]),f=new Kefir.Bus;m.onValue(t=>{"update"===t?(e(),f.emit({name:"changed",curLn:O})):"repos"===t?l():"end"===t?(i(),f.emit({name:"ended"})):"start"==t&&(n(),f.emit({name:"started"}))}),H.plug(f.skipDuplicates((e,t)=>"changed"===e.name&&"changed"===t.name&&e.curLn===t.curLn)),ar.wavesurfer.dragStarted.flatMap(()=>H.filter(e=>"changed"===e.name).takeUntilBy(ar.wavesurfer.dragEnded)).onValue(()=>{let e=O,t=D.indexOf(O);if(e&&-1!==t){let n=ar.leditor.findLineElem(e.name),i=D[t+1],o=i&&ar.leditor.findLineElem(i.name),r=D[t-1],a=r&&ar.leditor.findLineElem(r.name),l=$(R.pipe(R.reject(R.isNil),R.map(R.head))([a,n,o]));ar.leditor.makeLinesVisible(l,!0)}}),ar.leditor.$scrollEl.on("scroll",function(){O&&r()})}function o(e,t,n){let i;if(e.length)if(n>=e.length)i=n;else{var o=e.length;for(i=n;i<o;){var r=e[i].time;if(t+C.a.TIME_EPSILON<r)break;i++}}else i=null;return i}function r(){var e=O&&ar.leditor.findLineElem(O.name);if(e&&e.length){var t=ar.leditor.getLinesDirPosInScroll(e,!0);"Above"===t?$("#playing-pos-arrow-above").fadeIn("fast"):"Below"===t?$("#playing-pos-arrow-below").fadeIn("fast"):($("#playing-pos-arrow-above").fadeOut("fast"),$("#playing-pos-arrow-below").fadeOut("fast"))}}function a(e){var t=O&&ar.leditor.findLineElem(O.name);t&&t.length&&t.removeClass("playing-prev"),O=null,e&&($("#playing-pos-arrow-above").fadeOut("fast"),$("#playing-pos-arrow-below").fadeOut("fast"))}function l(e){for(var t,n=e.length,i=0,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="",a=new Array(3),l=new Array(4);i<n;){for(t=0;t<3;++t)a[t]=i<n?255&e.charCodeAt(i++):0;switch(l[0]=a[0]>>2,l[1]=(3&a[0])<<4|a[1]>>4,l[2]=(15&a[1])<<2|a[2]>>6,l[3]=63&a[2],i-(n-1)){case 1:l[3]=64;break;case 2:l[3]=64,l[2]=64}for(t=0;t<4;++t)r+=o.charAt(l[t])}return r}function s(e){var t=e.find("img"),n=_.resolve();return t.each(function(e,t){k.default.isLocalUrl(t.src)&&(n=n.then(function(){var e=_.defer(),n=new XMLHttpRequest;return n.open("GET",t.src,!0),n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(){if(200===n.status||x("Node")&&0===n.status){var i="png"===T.getExtension(t.src).toLowerCase()?"image/png":"image/jpg";t.src="data:"+i+";base64,"+l(n.responseText),e.resolve()}else console.error(n.statusText),e.resolve()},n.onerror=function(){console.error(n.statusText),e.resolve()},n.send(),e.promise}))}),n}function c(e){var t=k.default.simpleHtmlToElement(e);return s($(t)).then(function(){return t.outerHTML})}function d(e){if(e&&ar.leditor.bEditable?ar.leditor.toggleEditable(!1):e||ar.leditor.bEditable||ar.leditor.toggleEditable("Edit"===ar.editorMode),ar.leToolbar.updateButtonStates(!!e),ar.curArticle&&ar.curArticle.ldoc){if(e){ar.leditor.$el.removeHighlight();var t=ar.leditor.$el.highlight(e);y=e;var n=ar.leditor.$el.find("span.kw-highlight")[0],i=ar.leditor.$findCurLn(n);return i.length?ar.leditor.makeLinesVisible(i):ar.leditor.scrollEl.scrollTop=0,t}v.getNoteDir(ar.curArticle);return ar.leditor.$el.removeHighlight(),ar.leditor.$el.find("span.kw-highlight").length&&(ar.leditor.$el.removeHighlight(),U.error("found keywords highlight left! something error.")),y=null,0}}function u(e){var t=e.toLowerCase(),n=[],i=t.match(/'(.*?)'/g);return i&&(n=n.concat(i)),(i=t.match(/"(.*?)"/g))&&(n=n.concat(i)),n=w.map(n,function(e){return t=t.replace(e,""),e.substring(1,e.length-1)}),n=n.concat(t.split(" ")),n=w.filter(n,function(e){return""!==e})}function p(e){var t=Object.create(E.a);t.create(e),e.regLineHandler(t);var n=Object.create(N.a);n.create(e),e.regLineHandler(n)}function m(e,t=null,n=null){let i=C.a.FONT_SIZE_HEIGHTS[e];n&&(n.dataset.fontSize=e),t&&t.setLineHeight(i)}Object.defineProperty(t,"__esModule",{value:!0});var f,h,g,v,b,y,w=n(19),_=(n.n(w),n(20)),x=(n.n(_),n(6)),S=(n.n(x),n(92)),k=n(22),T=n(21),C=(n.n(T),n(91)),A=(n(110),n(8)),L=n(7),I=(n.n(L),n(117),n(98),n(97)),E=n(118),N=n(119),P=n(129),F=n(180),D=null,M=0,O=null,U=log.reg("editor");let B=new Kefir.Bus;var H=Kefir.pool();S.a.addListener("UI_onBkgrdImgChanged",function(e){if(e===ar.curArticle){var t=e.bkgrdImgFileName;if(t){var n=v.getNoteDir(e),i=ar.fileSystem.getDirUrl(n+"/images")+"/"+t;ar.editor.css("background-image","url("+i+")")}else ar.editor.css("background-image","")}}),t.default={create:function(e){if(v=e,f=$("#editor"),console.assert(f.length),h=$("*[data-role='editor-toolbar']"),g=$("#editor-view"),b=$("#in-note-search-bar"),i(),C.a.ENABLE_PHOTO_VIEW){var t=Object.create(P.a.PhotoView);t.create(v,ar.tmpDir,ar.settings.pvSettings),ar.pview=t,t.on("model-changed",function(){var e=ar.curArticle;e&&(P.a.getModel(e.photos),e.noteCommit=T.genCommitHash(),e.noteCommitMd5="INVALID",v.saveArticle(e),$("#view-togglers .action-photo").toggleClass("highlight",e.photos.length>0).find(".label-photo-num").text("x"+e.photos.length))}),t.on("disable-toggler",function(){$("#view-togglers").fadeOut()}),t.on("enable-toggler",function(){$("#view-togglers").fadeIn()}),t.on("settings-changed",function(e){ar.settings.pvSettings=e,v.saveSettings()})}var n=Object.create(F.a);n.create(v,ar.settings.ivSettings),ar.imgView=n,n.on("settings-changed",function(e){ar.settings.ivSettings=e,v.saveSettings()}),L.NO_ACCESSBILITY||$("#toolbar").find("x-icon-button").attr("tabindex","-1")},onResize:function(){ar.imgView&&ar.imgView.isViewActive()?ar.imgView.onResize():ar.leditor.onResize()},embedImages:s,updateKeywords:d,parseKeywords:u,addAllEditorPlugins:p,genEditorHtml:function(e,t,n,i,o,r,a,l){var s=Object.create(I.c),c=document.createElement("DIV");return s.create(e,c),p(s),l&&(s.imageHandler.handleImageSrc=((e,t)=>{let n=l[t.filename];n?(e.src=n.hostLink,e.dataset.link=n.link):log.error("no host link: ",t.filename)})),s.setModel(t,n),s.toggleEditable(!1),m(o,s),s.reposLines(r,a),e.updateAbmList(s.$el,t,o,!1),i||s.textHandler.removeInlineAbmFromElem(s.el),s.el.outerHTML},genReadableHtml:function(e,t,n,i,o,r){var a=Object.create(I.c),l=document.createElement("DIV");return a.create(e,l),p(a),a.imageHandler._bGenHtmlEmbedImage=!!o,a.setModel(t,n),a.toggleEditable(!1),a.reposLines(!0),c(a.genReadableHtml(r)).then(e=>{let t=ar.commits.accountType===ar.AT_Pro?"":localString("exported_note_footnote");return`\n<div>\n  <h2 style="text-align:center">${i}</h2>\n  ${e}\n  <h4 style="color:gray; margin-top: 20px;">\n    ${t}\n  </h4>\n</div>\n`})},genReadableText:function(e,t,n){var i=Object.create(I.c),o=document.createElement("DIV");return i.create(e,o),i.setModel(t,n),i.toggleEditable(!1),i.reposLines(!0),i.genReadableText()},applyFontSize:function(){m(ar.settings.fontSizeName,ar.leditor,_$("#editor-view"));let e=ar.leditor.ldoc,t=A.isXSmall();if(v.updateAbmList(ar.leditor.$el,e,ar.settings.fontSizeName,t),L.bDebug){var n=$("#editor-view").css("line-height");n&&n.indexOf("px")===n.length-2||log.error("no line hieght found, error css?")}},applySpellCheck:function(e){var t=ar.settings.bDisableSpellCheck;$("#input-note-title").attr("spellcheck",t?"false":null),ar.leditor.$el.attr("spellcheck",t?"false":null),e||v.reloadCurArticle()},openHotPadByEditMode:B,hotLineChanged:H}},function(e,t,n){"use strict";function i(e){var t,n=$(m.default.htmlToElement(localHtml(g),!0));t=p("MobileApp")||p("FakeMobile")?"#modal-export-disk-mobile":"#modal-export-disk-desktop",$(t).remove();var i=n.find(t),o={$el:i,home:e,xSlider:$("x-slider",i),$panelMain:$(".panel-main",i)};return l(o),o}function o(e){e.home.$el.append(e.$el),e.$el[0].toggle()}function r(e,t,n){var i="/"+n,o=u.defer();return ar.fileSystem.copyTo(t,i,function(t){if(t)log.fail(t),o.reject(t);else{var r=ar.fileSystem.getRootPath()+f.removeFirstSplash(n);window.plugins.socialsharing.share(null,null,r,null,function(t){t?(ar.settings.lastSharedFilePaths.push(i),e.saveSettings(),o.resolve()):(ar.fileSystem.removeFile(i),o.reject("cancel"))},function(){ar.fileSystem.removeFile(i)})}}),o.promise}function a(e){var t=ar.userDir+ar.curArticle.artName+"/"+ar.curArticle.audioName,n=f.getExtension(ar.curArticle.audioName).toLowerCase(),i=e.getArtTitleShowName(ar.curArticle);return i=f.sanitizeFilename(i+"."+n),p("DesktopApp")?v.saveFile(t,i):r(e,t,i).then(function(){return i})}function l(e){var t=e.$el;$(".action-close",t).on("click",function(){e.home.saveSettings(),t[0].toggle()}),$(".action-export-audio",e.$panelMain).on("click",function(){a(e.home).then(function(t){p("DesktopApp")&&$(".text-disk-status",e.$panelMain).html(localString("export_disk_succeed",t))},function(t){"cancel"!==t&&p("DesktopApp")&&$(".text-disk-status",e.$panelMain).html(localString("export_disk_save_failed_no_fn"))})}),$(".action-export-micnote",e.$panelMain).on("click",function(){var t=ar.userDir+"~export.zip",n=ar.curArticle;u.resolve().then(function(){return m.default.showFullscreenWaiting(!0),e.home.readyForMicnoteFile(n)}).then(function(){return u.nfcall(e.home.nativeZip,e.home.getNoteDir(n),t)}).then(function(){m.default.showFullscreenWaiting(!1);var i=e.home.getArtTitleShowName(n);return i=f.sanitizeFilename(i+".micnote"),p("DesktopApp")?v.saveFile(t,i).then(t=>{$(".text-disk-status",e.$panelMain).html(localString("export_disk_succeed",t))},function(t){"cancel"!==t&&$(".text-disk-status",e.$panelMain).html(localString("export_disk_save_failed_no_fn"))}):void r(e.home,t,i)}).then(()=>{m.default.showFullscreenWaiting(!1)},t=>{log.fail(t),m.default.showFullscreenWaiting(!1),$(".text-disk-status",e.$panelMain).html(d.sprintf("<span class='text-danger'>%s</span>",m.default.getShowError(t)))})}),$(".action-export-pdf",e.$panelMain).on("click",function(){s(e.home,ar.curArticle)}),$(".action-export-html",e.$panelMain).on("click",function(){var t=ar.curArticle;e.home.createPrintableHtml(t,!1,!0,!0).then(function(n){var i=e.home.getArtTitleShowName(t);i=f.sanitizeFilename(i+".html"),p("DesktopApp")?v.saveTextToFile(n,i,"text/html").then(t=>{$(".text-disk-status",e.$panelMain).html(localString("export_disk_succeed",t))},t=>{"cancel"!==t&&$(".text-disk-status",e.$panelMain).html(localString("export_disk_save_failed_no_fn"))}):console.assert(!1)})}),$(".action-export-text",e.$panelMain).on("click",function(){console.assert(!p("DesktopApp"));var t=ar.curArticle,n=ar.leditor.genReadableText();window.plugins.socialsharing.share(n,e.home.getArtTitleShowName(t))})}function s(e,t){e.createPrintableHtml(t,!0,!1,!0).then(function(e){var t=ar.userDir+"~pdfBody.html";return u.ninvoke(ar.fileSystem,"saveFile",t,e,"text/html")}).then(function(){if(p("ChromeApp")){let n={body:ar.fileSystem.getDirUrl(f.removeLastSplash(ar.userDir))+"/~pdfBody.html",title:e.getArtTitleShowName(t)},i="/printIndex.html?"+$.param(n);chrome.app.window.create(i,{width:1024,height:800,frame:"true",id:"MicNote_Print"})}else if(p("Node")){let n=new v.node.BrowserWindow({width:1024,height:800,show:!0,"node-integration":!1,"web-preferences":{"web-security":!1}}),i={body:ar.fileSystem.getDirUrl(ar.userDir)+"/~pdfBody.html",title:e.getArtTitleShowName(t)},o="/printIndex.html?"+$.param(i),r="file://"+window.__dirname+o;n.loadUrl(r)}}).catch(function(e){log.fail(e),m.default.toastShowLongCenter(localString("common_failed"),"error")})}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return i}),n.d(t,"showExportNoteWnd",function(){return o}),n.d(t,"exportRecording",function(){return a}),n.d(t,"mobileShareFile",function(){return r}),n.d(t,"printNote",function(){return s});var c=n(19),d=(n.n(c),n(23)),u=(n.n(d),n(20)),p=(n.n(u),n(6)),m=(n.n(p),n(22)),f=n(21),h=(n.n(f),n(91),n(7)),g=(n.n(h),n(92),n(178)),v=(n.n(g),n(24))},function(e,t,n){"use strict";function i(e,t){let n=l.defer(),i=new d.node.BrowserWindow({width:500,height:800,show:!1,"node-integration":!1,"web-security":!1});return i.loadUrl(e),i.webContents.on("did-stop-loading",function(e,t,n,o){i&&i.show()}),i.webContents.on("did-get-redirect-request",function(e,r,s,d){let p=c.parseUrlQueryString(s);p&&p.code?Object(u.c)().then(()=>l(a.ajax({url:t,type:"POST",xhrFields:{withCredentials:!0},dataType:"json",data:{code:p.code}})).then(e=>{log.debug("data",e),n.resolve(e.ncode),i&&i.close(),i=null},e=>{log.error("server auth failed!",e&&e.statusCode,e&&e.responseText),n.reject(e.responseText),i&&i.close(),i=null})):p&&p.error?(log.error("redirect error:",p.error),o.delay(function(){n.reject(p.error)}),i&&i.close(),i=null):log.log("ignore a redirect:",s)}),i.on("closed",function(){i&&(n.reject("cancel"),i=null)}),n.promise}n.d(t,"a",function(){return i});var o=n(19),r=(n.n(o),n(23)),a=(n.n(r),n(9)),l=(n.n(a),n(20)),s=(n.n(l),n(91),n(7)),c=(n.n(s),n(22),n(21)),d=(n.n(c),n(24)),u=n(95)},,function(e,t,n){"use strict";function i(e){P=e}function o(){console.assert(!ar.rootArticle.gdrive.fileId),P.setStableInfo("Sync",localString("sync_initing"));var e=P.getSyncProvider();return e.getSyncRootFileId(G).then(function(e){ar.rootArticle.gdrive.fileId=e,ar.rootArticle.folderSyncCommit=ar.rootArticle.folderCommit,P.saveArticleList()}).then(function(){return b()}).then(function(){return A(e,ar.rootArticle.gdrive.fileId)}).then(function(){function t(i){return e.listChildren(i.gdrive.fileId,G).then(function(e){var o=M.resolve();return e.forEach(function(e){var r=P.findArticleByFileId(e.id);if(r)r.parentName!==i.artName&&(Y.warn(J,"Articles's parent is reseted to server's, art: %s, parent: %s",r.artTitle,i.artTitle),r.parentName=i.artName,P.saveArticleList());else{var a;"File"===e.type?(a=F.findWhere(ar.lsArticles,{type:"Note",noteCommitMd5:e.md5,bTrash:!1}))&&a.gdrive.fileId?(Y.warn("something wrong, found notes with same md5. title: ",e.title),a=0):a&&(Y.log("found same note exist on local, cancel creating new note.",a.artTitle),a.gdrive.fileId=e.id,console.assert(a.noteCommit),a.noteSyncCommit=a.noteCommit,console.assert(a.folderCommit),a.folderSyncCommit=a.folderCommit,P.saveArticleList()):"Folder"===e.type&&(a=F.findWhere(ar.lsArticles,{type:"Folder",artTitle:e.title,bTrash:!1}))&&(Y.log("found folder exist on local, cancel creating new folder.",a.artTitle),a.gdrive.fileId=e.id,console.assert(a.folderCommit),a.folderSyncCommit=a.folderCommit,P.saveArticleList(),o=o.then(function(){return t(a)})),a||(o=o.then(n.bind(window,e)))}}),o})}function n(e){return v(e).then(function(e){return e&&ar.lsArticles.forEach(function(t){t===e||t.bTrash||t.parentName!==e.parentName||t.artTitle!==e.artTitle||t.gdrive.fileId||P.setArtTitle(t,t.artTitle+localString("sync_conflict_postfix"))}),e&&"Folder"===e.type?t(e):void 0})}return t(ar.rootArticle)})}function r(e){var t=P.getSyncProvider();return M.resolve().then(function(){if(ar.commits.serverChangesFileId){var e={responseType:"json",bWithETag:!0,bSyncSpecial:!0};return t.download(ar.commits.serverChangesFileId,G,e)}return console.assert(!ar.serverChangesETag),void(ar.serverChanges=[])}).then(function(n){if(n&&n.content){var i=n.content;ar.serverChanges=i.changes,ar.serverChangesETag=n.etag}else ar.serverChanges=[],ar.serverChangesETag=void 0;var o;if(ar.commits.lastMergedCommit){o=[];for(var r=!1,a=ar.serverChanges.length-1;a>=0;--a)if(ar.serverChanges[a].commit===ar.commits.lastMergedCommit){o=ar.serverChanges.slice(a+1),r=!0;break}if(!r&&ar.serverChanges.length){var l=new Date(ar.serverChanges[0].date);ar.commits.lastMergedDate<l?U.default.messageBox(localString("common_error"),localString("sync_local_too_old")):Y.error(J,"last commit wasn't found in all changes, lastMergedCommit:",ar.commits.lastMergedCommit)}}else if(o=[],ar.serverChanges.length){var s=ar.serverChanges[ar.serverChanges.length-1];ar.commits.lastMergedCommit=s.commit,ar.commits.lastMergedDate=s.date,P.saveCommits(),Y.log(J,"inited lastMergedCommit")}o=x(o),Y.log(J,o.length?"merge changes: start":"no changes on server");var c=M.resolve();return o.forEach(function(n){if(O("MobileApp")&&e&&!P.checkWifiOnly())throw"Wi-Fi is not available, operation canceled.";Y.log(J,"merge changes: "+n.command),console.assert(n.fileId),c=c.then(function(){return t.downloadMeta(n.fileId,G).catch(function(){})}),c=c.then(function(e){var t=P.findArticleByFileId(n.fileId),i=t?t.artTitle:e?B.removeExtension(e.title):"",o=localString("syncing_art",F.escape(i));if(P.setStableInfo("Sync",o),"updateNote"===n.command){if(t)return console.assert("Note"===t.type),M.resolve().then(()=>P.isNoteOnCloudOnly(t)?h(t):g(t)).catch(function(e){if(!e||"string"!=typeof e.message||-1===e.message.indexOf("|FileNotFound"))throw e;Y.log(J,"updateNote: file missing, possible deleted in further commits, skip")});if(e)return Y.error(J,"something wrong! updated note not found. create new one."),v(e).then(function(e){});Y.error(J,"something wrong! updated note not found, skip.")}else if("delete"===n.command){if(t)return Y.log(J,"merge changes: delete "+t.artTitle),t.gdrive.fileId=null,ar.trash.push(t),P.deleteSelectedArticles([t]).then(function(){ar.curArticle===t&&P.selectArticle(null)})}else if("newNote"===n.command||"newFolder"===n.command){if(console.assert(!t),!t&&e)return Y.log(J,"merge changes: new  "+e.title),v(e).then(function(e){})}else if("move"===n.command){if(console.assert(t),t&&e){var r;r="Folder"===t.type?e.title:B.removeExtension(e.title),t.artTitle!==r&&(Y.log(J,"merge changes: new title  "+e.title),P.setArtTitle(t,r,!0));var a=P.findArticleByFileId(e.parentId);a?a.artName!==t.parentName&&(Y.log(J,"merge changes: move to  "+a.artTitle),t.parentName=a.artName,Q.emit(t)):Y.warn(J,"merge changes: couldn't find new folder, ignore. ",e.parentId,e.title)}}else console.assert(!1),Y.error(J,"ignore unsupported command: "+n.command)}),c=c.then(function(){ar.commits.lastMergedCommit=n.commit,ar.commits.lastMergedDate=n.date,P.saveCommits()})}),c}).then(function(){P.setStableInfo("Sync",localString("syncing_info"))})}function a(e,t){console.assert("Folder"===t.type),console.assert(!t.bTrash);var n=P.findLocalArticle(t.parentName);t.folderSyncCommit?t.folderCommit!==t.folderSyncCommit&&(console.assert("Root"!==t.artName),console.assert(t.folderCommit),e.push({command:"move",artName:t.artName}),t.folderSyncCommit=t.folderCommit):(console.assert("Root"===t.artName||n),console.assert(t.folderCommit),e.push({command:"newFolder",artName:t.artName}),t.folderSyncCommit=t.folderCommit),F.each(ar.lsArticles,function(n){n.bTrash||"Folder"!==n.type||n.parentName!==t.artName||a(e,n)})}function l(e,t,n,i){function o(e,t){let n;n=e?P.getAEProvider():P.getSyncProvider(),t&&"need-redir"===t.appName?P.mainNav.setSlientError(function(){U.default.messageBox(localString("mb_slient_error_title"),localString("mb_reauth_msg",n.showName),{okTitle:localString("mb_reauth_auth"),btnCancel:!0},function(e){"Ok"===e&&(U.default.showFullscreenWaiting(!0),n.authenticateEx(G,"Storage",!0).then(function(){U.default.toastShowShortCenter(localString("common_success"))}).finally(function(){U.default.showFullscreenWaiting(!1)}))})}):t&&"sync-folder-not-found"===t.appName&&P.mainNav.setSlientError(function(){U.default.messageBox(localString("mb_slient_error_title"),localString("mb_sync_folder_lost_msg",n.showName),{okTitle:localString("mb_sync_folder_lost_set_db"),btnCancel:!0},function(t){"Ok"===t&&P.settingView.showSettings(P,e?"auto-export":"sync")})})}if(ar.bSyncing)return n&&P.requestInfoBar("Sync"),M.resolve();if(H.bAppOffline)return M.resolve();let r=!t;if(r&&!P.checkWifiOnly())return M.resolve();var a=B.getCurTime();return e&&a-ar.lastAutoSyncTime<e?M.resolve():(n&&P.requestInfoBar("Sync"),ar.bSyncing=!0,R.a.onSyncRunning(!0),s(r,t).catch(e=>{throw o(!1,e),e}).then(function(){return"Disable"!==ar.settings.cloudProvider?M.delay(3e3):void 0}).then(function(){return d().catch(e=>{throw o(!0,e),e})}).finally(function(){ar.bSyncing=!1,R.a.onSyncRunning(!1),P.releaseInfoBar("Sync")}).then(()=>{ee.emit(null)},e=>{throw ee.emit(e||"Error"),e}))}function s(e,t){if("Disable"===ar.settings.cloudProvider)return M.resolve();var n=P.getSyncProvider();return M.resolve().then(function(){return P.setStableInfo("Sync",localString("sync_connecting_to",n.showName)),n.authenticateEx(G,"Storage",t)}).then(function(){return P.setStableInfo("Sync",localString("home_syncing")),I()?void 0:o()}).then(function(){return c()}).then(function(){return r(e)}).then(function(){var t=[];ar.commits.gdriveDeledFileIds.forEach(function(e){t.push({command:"delete",fileId:e})}),ar.commits.gdriveDeledFileIds=[],a(t,ar.rootArticle),ar.lsArticles.forEach(function(e){if(!e.bTrash&&"Note"===e.type){P.findLocalArticle(e.parentName);e.noteCommit&&!e.noteSyncCommit?(console.assert(e.noteCommit&&e.folderCommit),t.push({command:"newNote",artName:e.artName}),e.noteSyncCommit=e.noteCommit,e.folderSyncCommit=e.folderCommit,e.audioSyncCommit=e.audioCommit,e.artSyncCommit=e.artCommit):e.folderCommit!==e.folderSyncCommit?(console.assert(e.folderCommit),t.push({command:"move",artName:e.artName}),e.folderSyncCommit=e.folderCommit):e.noteCommit&&e.noteCommit!==e.noteSyncCommit&&(t.push({command:"updateNote",artName:e.artName}),e.noteSyncCommit=e.noteCommit)}}),ar.commits.commitList=ar.commits.commitList.concat(t),P.saveArticleList(),P.saveCommits();var i=B.genCommitHash(),o=new Date,r=M.resolve();return ar.commits.commitList.forEach(function(t){r=r.then(function(){if(e&&!P.checkWifiOnly())throw"Wi-Fi is not available, operation canceled.";Y.log(J,"execCommit: "+t.command);var n,r=t.artName?P.findLocalArticle(t.artName):null;return n=r?localString("syncing_art",F.escape(r.artTitle)):localString("home_syncing"),P.setStableInfo("Sync",n),y(t).then(function(){var e=ar.commits.commitList.shift();console.assert(e===t),e.commit=i,e.date=o,r&&(e.fileId=r.gdrive.fileId),ar.commits.localChanges.push(e),P.saveCommits()},function(e){if(Y.fail(J,e),!e||"string"!=typeof e.message||-1===e.message.indexOf("|FileNotFound"))throw D.sprintf("title: %s, %s",P.getArtTitleShowName(r),U.default.getShowError(e));Y.error(J,"file missing, ignore a commit.")})})}),r=r.then(function(){M.resolve();if(ar.commits.localChanges.length){var e=ar.serverChanges.concat(ar.commits.localChanges);if(X)for(;e.length<q;)e=e.concat(e);e.length>q&&(e=e.slice(e.length-q));var t={version:1,changes:e},i=JSON.stringify(t),o=ar.commits.serverChangesFileId,r=K,a=ar.rootArticle.gdrive.fileId,l=ar.serverChangesETag;return n.upload(o,a,r,i,"application/json; charset=UTF-8",l,void 0,void 0,G,{bSyncSpecial:!0}).then(function(t){o||(ar.commits.serverChangesFileId=t.id),ar.commits.localChanges=[];var n=e[e.length-1];ar.commits.lastMergedCommit=n.commit,ar.commits.lastMergedDate=n.date,P.saveCommits()},function(e){throw e&&"string"==typeof e.message&&-1!==e.message.indexOf("|ETagChanged")?"Seems another sync is running, please retry later!|Retry":D.sprintf("Failed to save changes to %s. Reason: ",P.getCloudShowName(ar.settings.cloudProvider),U.default.getShowError(e))})}})}).then(function(){var e=localString("all_notes_synced_succeed");P.setStableInfo("Sync",e)},function(e){Y.fail(J,e);var t=localString("sync_failed",U.default.getShowError(e));throw P.setStableError("Sync",t),e})}function c(){return P.getSyncProvider().downloadMeta(ar.rootArticle.gdrive.fileId,G,null,!0).catch(function(e){if(e&&404===e.code){var t=new Error("File not found");throw t.appName="sync-folder-not-found",t}throw e})}function d(){return"Disable"===ar.settings.autoExpProvider?M.resolve():M.resolve().then(function(){return P.setStableInfo("Sync",localString("exporting_info")),W.a()}).then(function(){P.setStableInfo("Sync",localString("export_succeed"))},function(e){throw Y.fail(J,e),P.setStableError("Sync",localString("export_failed",U.default.getShowError(e))),e})}function u(){var e=ar.settingsChanged.map(function(e){return I()&&"close-settings-dialog"===e.hint&&e.settings.bAutoSync&&"Disable"!==e.settings.cloudProvider}).toProperty(function(){return ar.settings.bAutoSync&&"Disable"!==ar.settings.cloudProvider}),t=Kefir.stream(function(e){return ar.sinkInTimeSync=e.emit,function(){}}).filter(function(e){return!e||e.noteSyncCommit!=e.noteCommit});return Kefir.interval(1e3*z).merge(t).filterBy(e)}function p(e,t){let n=u().map(function(){return[z]}),i=e?Kefir.constant([]):Kefir.never(),o=Z.flatMap(([e,t,n])=>{return t&&P.requestInfoBar("Sync"),n>=3?(P.setStableError("Sync",localString("sync_retry_all_failed")),P.releaseInfoBar("Sync"),Kefir.never()):(P.setStableInfo("Sync",localString("sync_waiting_retry",n)),P.releaseInfoBar("Sync"),Kefir.later(1e4*Math.pow(2,n-1)).map(()=>[void 0,e,t,n]))});Kefir.merge([i,n,t.map(function(){return[void 0,!0,!0,0]}),o]).onValue(([e,t,n,i])=>{l(e,t,n).catch(e=>{throw null!=i&&"string"==typeof e&&-1!==e.indexOf("|Retry")&&Z.emit([t,n,i+1]),e}).done()})}function m(e,t){return M.Promise(function(n,i){var o=O("MobileApp")?"File":"ArrayBuffer";ar.fileSystem.loadFile(t,{type:o},function(t,o){if(t)i(t);else{var r=e.gdrive.fileId,a=P.getArtTitleShowName(e)+".micnote",l=P.findLocalArticle(e.parentName);console.assert(l.gdrive.fileId);var s,c,d=r?void 0:e.cDate,u=P.getSyncProvider();O("MobileApp")?(s=null,c={byteLength:o.size,fileUrl:o.localURL}):(s=o,c={}),"application/micnote",u.upload(r,l.gdrive.fileId,a,s,"application/micnote",void 0,d,e.mDate,G,c).then(function(t){e.gdrive.fileId||P.findLocalArticle(e.artName)||(Y.log(J,"new note was deleted while pushing"),console.assert(-1===ar.commits.gdriveDeledFileIds.indexOf(t.id)),ar.commits.gdriveDeledFileIds.push(t.id),P.saveCommits()),e.gdrive.fileId=t.id,e.noteCommitMd5=t.md5,P.saveArticleList(),n(t)},function(t){"string"==typeof t.message&&-1!=t.message.indexOf("|FileNotFound")?(e.gdrive.fileId&&(e.gdrive.fileId=null),i(t)):i(t)},function(t){if("progress"===t.name){var n=U.default.getCloudProgressShowString(t.loaded,t.total,!0);P.setStableInfo("Sync",localString("sync_saving_to_progress",F.escape(P.getArtTitleShowName(e)),P.getCloudShowName(ar.settings.cloudProvider),n))}})}})})}function f(e,t){return P.getSyncProvider().authenticateEx(G,"Storage",!0).then(function(){return g(e,t)})}function h(e){console.assert(e.gdrive.fileId&&"Note"===e.type);var t=P.getSyncProvider();return M.resolve().then(function(){return t.downloadMeta(e.gdrive.fileId,G)}).then(function(t){e.mDate=t.mDate,e.cDate=t.cDate,P.saveArticle(e),ar.artDateChanged.emit(e)})}function g(e,t){console.assert(e.gdrive.fileId&&"Note"===e.type);var n=ar.userDir+"~unzipping.zip",i=P.getSyncProvider();return M.resolve().then(function(){return i.downloadMeta(e.gdrive.fileId,G)}).then(function(o){var r=o.mDate,a=o.cDate,l={};return O("MobileApp")&&(l.targetUrl=ar.fileSystem.getDirUrl(ar.userDir)+"/~unzipping.zip"),R.a.onFetchingNoteProgress({type:"start",artName:e.artName}),i.download(e.gdrive.fileId,G,l).then(function(e){return O("MobileApp")?void 0:M.ninvoke(ar.fileSystem,"saveFile",n,e,"application/zip")},function(e){throw R.a.onFetchingNoteProgress({type:"failed"}),e},function(n){if("progress"===n.name){if(n.total){var i=n.loaded/n.total,o=D.sprintf("%d%%",100*i);P.setStableInfo(t||"Sync",localString("sync_loading_from",F.escape(e.artTitle),P.getCloudShowName(ar.settings.cloudProvider),o))}else{var r=n.loaded,o=D.sprintf("%.2fM",r/1024/1024);P.setStableInfo(t||"Sync",localString("sync_loading_from",F.escape(e.artTitle),P.getCloudShowName(ar.settings.cloudProvider),o))}R.a.onFetchingNoteProgress({type:"progress",artName:e.artName,loaded:n.loaded,total:n.total})}}).then(function(){if(R.a.onFetchingNoteProgress({type:"end",artName:e.artName}),e.noteCommit===e.noteSyncCommit)return P.createNoteDir(e.artName).then(function(){return j.c(e,n,e.artTitle)}).then(function(){e.noteCommit=B.genCommitHash(),e.noteSyncCommit=e.noteCommit,e.noteCommitMd5=o.md5,e.mDate=r,e.cDate=a,P.saveArticleList(),R.a.UI_onArticleChanged(e)});P.setStableInfo(t||"Sync",localString("sync_found_conflicted",F.escape(e.artTitle)));return P.doNewNote({parentName:e.parentName,title:e.artTitle,ldoc:null}).then(function(t){return P.createNoteDir(t.artName).then(function(){return j.c(t,n,e.artTitle)}).then(function(){t.noteCommit=B.genCommitHash(),t.mDate=r,t.cDate=a;var n=e.mDate<r,i=D.sprintf("%s[Conflicted|Early %s]",e.artTitle,(new Date).toLocaleString());n?P.setArtTitle(e,i):P.setArtTitle(t,i),P.saveArticleList()})}).catch(function(e){if("out-of-note-num"!==e)throw e;Y.error(J,"confliction and creating new note is limited by maximum note number.")})})})}function v(e){if(console.assert(e.cDate&&e.mDate),"File"!==e.type&&"Folder"!==e.type)return Y.warn(J,"mergeNew: discard an un-recognized file: "+e.title+" type: "+e.type),M.resolve();var t=e.parentId,n=P.findArticleByFileId(t);if(!n)return Y.warn(J,"mergeNew: could not find parent folder, discard. "+e.title),M.resolve();if("Folder"===e.type)return P.setStableInfo("Sync",localString("sync_merging_folder",F.escape(e.title))),M(P.newFolder({parentName:n.artName,title:e.title})).then(function(t){return t.gdrive.fileId=e.id,t.mDate=e.mDate,t.cDate=e.cDate,t.folderSyncCommit=B.genCommitHash(),t.folderCommit=t.folderSyncCommit,P.saveArticleList(),t});if("micnote"===B.getExtension(e.title).toLowerCase()){P.setStableInfo("Sync",localString("sync_merging_note",F.escape(e.title)));var i=B.removeExtension(e.title);return P.doNewNote({parentName:n.artName,title:i,ldoc:null}).then(function(t){return t.gdrive.fileId=e.id,t.mDate=e.mDate,t.cDate=e.cDate,t.ldoc=null,t.audioCommit=null,t.noteCommit=null,t.noteSyncCommit=null,t.folderSyncCommit=B.genCommitHash(),t.folderCommit=t.folderSyncCommit,P.saveArticleList(),t})}return Y.warn(J,"mergeNew: discard an un-recognized file: "+e.title+" mimeType: "+e.mimeType),M.resolve()}function b(){var e=M.resolve();return ar.commits.serverChangesFileId||(e=e.then(function(){console.assert(ar.rootArticle.gdrive.fileId);var e={title:K,bSyncSpecial:!0};return P.getSyncProvider().listChildren(ar.rootArticle.gdrive.fileId,G,e).then(function(e){console.assert(e.length<=1),e.length&&(ar.commits.serverChangesFileId=e[0].id,P.saveCommits())})})),e}function y(e){return te[e.command].call(this,e)}function w(e){var t=P.findLocalArticle(e.artName);if(!t)return Y.warn(J,"updateNote: article is missing, skip."+e.artName),M.resolve();if(t.bTrash)return Y.warn(J,"updateNote: article was trashed, skip."+e.artName),M.resolve();console.assert("Note"===t.type);var n=P.findLocalArticle(t.parentName);if(!n||!n.gdrive.fileId)return Y.warn(J,"commit newNote: parent error, skip."+t.parentName),M.resolve();var i=ar.userDir+"~zipping.zip",o=M.resolve();return o=o.then(function(){return Y.log(J,"start push: ",t.artTitle),P.readyForMicnoteFile(t)}).then(function(){return P.setStableInfo("Sync",localString("sync_saving_to_no_percent",F.escape(P.getArtTitleShowName(t)),P.getCloudShowName(ar.settings.cloudProvider))),M.nfcall(P.nativeZip,P.getNoteDir(t),i)}).then(function(){return M.ninvoke(ar.fileSystem,"loadDir",ar.userDir+t.artName)}).then(function(){return m(t,i)})}function _(){ar.commits.devVersion<2&&(ar.lsArticles.forEach(function(e){e.noteCommit||(e.noteCommit=B.genCommitHash()),e.folderCommit||(e.folderCommit=B.genCommitHash())}),"Disable"!==ar.settings.cloudProvider&&(ar.lsArticles.forEach(function(e){e.gdrive.fileId&&(e.folderSyncCommit=e.folderCommit,e.noteSyncCommit=e.noteCommit)}),b()),P.saveArticleList())}function x(e){var t=[];F.each(e,function(e){-1===ar.commits.gdriveDeledFileIds.indexOf(e.fileId)&&t.push(e)});var n=[],i=t.slice(0);for(i.reverse();i.length;){for(var o=i[0],r=[],a=1,l=i.length;a<l;++a){var s=i[a];s.command===o.command&&s.fileId===o.fileId?Y.log(J,"simplify: drop cmd: "+s.command+" fileId: "+s.fileId):r.push(s)}i=r,n.push(o)}return n.reverse(),n}function S(){function e(e){ar.bSyncing=!1,t.resolve(e)}var t=M.defer(),n=P.getCloudProviders().gdrive,i=P.getCloudProviders().getDefSyncFolderName();return ar.bSyncing=!0,n.listChildren("appdata",G,{title:"upgraded"}).then(function(t){t.length>1&&Y.error(J,"found multiply upgraded files, uses the first one",t.length),t.length?(Y.log(J,"appdata is upgraded, re-link all notes"),n.download(t[0].id,G,{responseType:"json"}).then(function(t){ar.settings.syncFolderId=t.syncFolderId,ar.settings.syncFolderPath="/"+i,ar.rootArticle.gdrive.fileId=t.syncFolderId,ar.commits.serverChangesFileId=t.serverChangesFileId,F.each(t.articles,function(e){var t=P.findArticleByFileId(e.oldFileId);t?t.gdrive.fileId=e.newFileId:Y.warn(J,"could not find fileId to re-link.",e.oldFileId)}),F.each(ar.lsArticles,function(e){"Root"!==e.artName&&e.gdrive&&e.gdrive.fileId&&!F.findWhere(t.articles,{newFileId:e.gdrive.fileId})&&(e.gdrive.fileId=null,e.folderSyncCommit=null,e.noteSyncCommit=null,e.artSyncCommit=null,e.audioSyncCommit=null,Y.warn(J,"could not find file in new sync folder, file id is cleared,",e.artTitle))}),P.saveArticleList(),P.saveSettings(),U.default.messageBox("Upgrade database folder on Google Drive",D.sprintf('Your database folder has been re-linked to Google Drive folder "%s" succeed.',"/"+i),{},function(){e("fixed")})})):e("not-found")},function(e){U.default.messageBox("Error","Failed to upgrade database folder on Google Drive, reason: "+U.default.getShowError(e),{},function(){ar.bSyncing=!1,t.reject()})}),t.promise}function k(){function e(e){"success"===e?U.default.messageBox("Success","Upgrading sync folder succeeded!",{btnOk:!0,btnCancel:!0,okTitle:"View Database Folder",cancelTitle:"Close"},function(t){if("Ok"===t){var i=D.sprintf("https://drive.google.com/drive/#folders/%s",ar.settings.syncFolderId);Object(V.openExternalLink)(i)}ar.bSyncing=!1,n.resolve(e)}):(ar.bSyncing=!1,n.resolve(e))}function t(e){Y.fail(J,e),U.default.messageBox("Failed","Upgrading sync folder failed, reason: "+U.default.getShowError(e),{},function(){ar.bSyncing=!1,n.resolve()})}var n=M.defer(),i=P.getCloudProviders().gdrive,o=P.getCloudProviders().getDefSyncFolderName();return ar.bSyncing=!0,U.default.messageBox("Upgrade database folder on Google Drive",'You are currently syncing notes to "<strong>In [Mic Note] App</strong>" on Google Drive, it is a hidden folder. In the new version we decided to move it to an external folder which is visible for you. By default it is "<strong>My Mic Notes</strong>" folder in your Google Drive root folder, you can change it later via Settings. We suggest you <strong>UPGRADE RIGHT NOW</strong>.',{btnOk:!0,btnCancel:!0,okTitle:"Upgrade Right Now",cancelTitle:"Maybe Later"},function(n){"Ok"===n?T().then(function(t){ar.settings.syncFolderId=t,i.setSyncRoot(t),ar.settings.syncFolderPath="/"+o,ar.rootArticle.gdrive.fileId&&(ar.rootArticle.gdrive.fileId=t),P.saveArticleList(),P.saveSettings(),e("success")},t):e("cancel")}),n.promise}function T(){var e,t,n=M.resolve(),i=P.getCloudProviders().gdrive,o="google.gdrive0",r={articles:[]};return n=n.then(function(){return Y.info(J,"moving gdrive in-app folder to explicite folder"),U.default.showFullscreenWaiting(!0),i.listChildren("appdata",o)}).then(function(t){return e=t,i.createDir(o,P.getCloudProviders().getDefSyncFolderName(),"root")}).then(function(e){t=e,r.syncFolderId=e}).then(function(){var n=M.resolve();return F.each(e,function(e){n=n.then(function(){return U.default.toastShowLongCenter(D.sprintf("Copying %s...",e.title)),"File"===e.type?i.copyFile(o,e.id,e.title,t).then(function(t){return"changes"===e.title&&(r.serverChangesFileId=t.id),t.id}):"Folder"===e.type?C(i,e.id,e.title,t,r):void 0}).then(function(t){t&&r.articles.push({oldFileId:e.id,newFileId:t})})}),n=n.then(function(){return i.download(r.serverChangesFileId,o,{responseType:"json"})}).then(function(e){var n=JSON.stringify(e);F.each(r.articles,function(e){n=n.replace(new RegExp(e.oldFileId,"g"),e.newFileId)});return i.upload(r.serverChangesFileId,t,"changes",n,"application/json",void 0,void 0,void 0,o)}).then(function(){return A(i,t)})}).then(function(){var e=JSON.stringify(r);return i.upload(null,"appdata","upgraded",e,"application/json",void 0,void 0,void 0,o)}).then(function(){return ar.commits.serverChangesFileId&&(ar.commits.serverChangesFileId=r.serverChangesFileId),F.each(r.articles,function(e){var t=P.findArticleByFileId(e.oldFileId);t?t.gdrive.fileId=e.newFileId:Y.warn(J,"found an isolate file/folder:",e.oldFileId)}),t},function(e){throw t&&i.deleteFile(o,t),e}).finally(function(){U.default.hideToast(),U.default.showFullscreenWaiting(!1)})}function C(e,t,n,i,o){var r;return e.createDir(G,n,i).then(function(n){return r=n,e.listChildren(t,G)}).then(function(t){var n=M.resolve();return F.each(t,function(t){n=n.then(function(){return"File"===t.type?e.copyFile(G,t.id,t.title,r).then(function(e){return e.id}):"Folder"===t.type?C(e,t.id,t.title,r,o):void 0}).then(function(e){e&&o.articles.push({oldFileId:t.id,newFileId:e})})}),n}).then(function(){return r})}function A(e,t){var n=localString("sync_warning_file_title"),i=localString("sync_warning_file_content"),o={title:n,bSyncSpecial:!0};return e.listChildren(t,G,o).then(function(r){if(!r.length){return e.upload(null,t,n,i,"text/plain; charset=UTF-8",void 0,void 0,void 0,G,o)}})}function L(){M.resolve().then(()=>{var e=ar.lsArticles.slice(0),t=[];F.each(e,function(e){!e.bTrash&&"Note"===e.type&&P.isNoteOnCloudOnly(e)&&t.push(e)});let n=e.length-t.length;return P.deleteSelectedArticles(t).then(()=>n)}).then(e=>{console.assert(ar.lsArticles.length===e),ar.lsArticles=ar.lsArticles.filter(function(e){return!(!e.bTrash&&"Folder"===e.type&&"Root"!=e.artName)||0!=P.getNotesInFolder(e.artName,!0).length}),ar.lsArticles.forEach(function(e){e.bTrash||N(e)}),ar.commits.gdriveDeledFileIds=[],ar.commits.commitList=[],ar.commits.lastMergedCommit=null,ar.commits.serverChangesFileId=null,P.saveCommits(),P.saveArticleList(),R.a.UI_onArtListChanged()})}function I(){return!!ar.rootArticle.gdrive.fileId}function E(){return console.assert(!ar.rootArticle.gdrive.fileId),$("#modal-init-sync").showModal(),l(void 0,!0,!0).then(function(){$("#modal-init-sync").hideModal()},function(e){return L(),P.getSyncProvider().setSyncRoot(null),ar.settings.cloudProvider="Disable",P.saveSettings(),$("#modal-init-sync").hideModal(),U.default.messageBoxPromise(localString("common_error"),localString("init_sync_failed",U.default.getShowError(e)))})}function N(e){e.gdrive.fileId=null,e.folderSyncCommit=null,e.noteSyncCommit=null,e.artSyncCommit=null,e.audioSyncCommit=null}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return i}),n.d(t,"createSyncAll",function(){return p}),n.d(t,"fetchNoteForLoad",function(){return f}),n.d(t,"upgrade",function(){return _}),n.d(t,"tryUpgradeGDriveInAppFolder",function(){return k}),n.d(t,"tryFixGDriveInAppFolder",function(){return S}),n.d(t,"clearUnfetchedNotes",function(){return L}),n.d(t,"isSyncInited",function(){return I}),n.d(t,"showInitSync",function(){return E}),n.d(t,"clearArtSyncData",function(){return N}),n.d(t,"artFolderChanged",function(){return Q});var P,F=n(19),D=(n.n(F),n(23)),M=(n.n(D),n(20)),O=(n.n(M),n(8),n(6)),R=(n.n(O),n(92)),U=n(22),B=n(21),H=(n.n(B),n(91),n(7)),j=(n.n(H),n(93),n(100)),W=n(112),V=(n(101),n(24)),G="google.gdrive0",z=600,q=1e3,K="changes",X=!0,J="[sync]",Y=log.reg("sync");let Q=new Kefir.Bus,Z=new Kefir.Bus,ee=new Kefir.Bus;var te={};te.delete=function(e){var t=e.fileId;return Y.log(J,"push: delete file "+t),P.getSyncProvider().deleteFile(G,t)},te.move=function(e){var t=P.findLocalArticle(e.artName);if(!t)return Y.warn(J,"commit move: article is missing, skip."+e.artName),M.resolve();if(t.bTrash)return Y.warn(J,"commit move: article was trashed, skip."+e.artName),M.resolve();var n=P.findLocalArticle(t.parentName);if(!n||!n.gdrive.fileId)return Y.warn(J,"commit move: parent error, skip."+t.parentName),M.resolve();var i;return i="Note"===t.type?P.getArtTitleShowName(t)+".micnote":t.artTitle,P.getSyncProvider().moveFile(G,t.gdrive.fileId,n.gdrive.fileId,i)},te.newFolder=function(e){var t=P.findLocalArticle(e.artName);if(!t)return Y.warn(J,"commit newFolder: article is missing, skip."+e.artName),M.resolve();if(t.bTrash)return Y.warn(J,"commit newFolder: article was trashed, skip."+e.artName),M.resolve();console.assert("Folder"===t.type);var n=P.findLocalArticle(t.parentName);if(!("Root"===t.artName||n&&n.gdrive.fileId))return Y.warn(J,"commit newFolder: parent error, skip."+t.parentName),M.resolve();var i,o;return"Root"===t.artName?(i="MicNote",o=null):(i=t.artTitle,o=n.gdrive.fileId),function(e,t){return P.getSyncProvider().createDir(G,e,t)}(i,o).then(function(e){t.gdrive.fileId=e,P.saveArticleList()})},te.updateNote=function(e){return w(e)},te.newNote=function(e){return w(e)},H.bDebug&&(window.dbgRemoveUpgraded=function(e){var t=e||"upgraded",n=P.getCloudProviders().gdrive;n.listChildren("appdata","google.gdrive0").then(function(e){var i=F.findWhere(e,{title:t});i?n.deleteFile("google.gdrive0",i.id).then(function(e){log.debug("removed succeed")}):log.debug("not found upgraded")})})},,function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(19),o=(n.n(i),n(20)),r=(n.n(o),n(6)),a=(n.n(r),n(92),n(22)),l=n(21),s=(n.n(l),n(100),n(91),n(7)),c=(n.n(s),n(98),n(148),n(111)),d=n(96),u=n(94),p=n(24),m=n(173),f=(n.n(m),window.localHtml(m)),h={create:function(e,t,n){var o=this;i.extend(o,{home:e,cbImportPdf:n}),o.options=i.defaults(t||{},{heading:localString("menu_insert_pdf")});var r=f;r=window.localHtml(r,{rt_heading:o.options.heading}),o.el=a.default.htmlToElement(r,!0),o.$el=$(o.el),o.bindEvents()},bindEvents:function(){self=this;var e=self.home,t=this.$el;t.on("iron-overlay-closed",function(){self.bExecuted||self.onImportPdf(null,[])}),$("paper-item",t).on("click",function(t){if(self.bExecuted=!0,self.$el.hideModal(),"Disk"===this.dataset.value)Object(p.filePicker)({fileType:"PDF",bMultiSel:!1},self.onImportPdf.bind(self));else if("Link"===this.dataset.value){var n=c.a(e);c.b(n,"*.*",{footnote:localString("import_pdf_link_accept_types")},self.onImportPdf.bind(self))}else if("GDrive"===this.dataset.value){var i={bSelectFolder:!1,icon:"bs:file",bMultiSel:!0,actionName:localString("import_gdrive_import"),gdrive_bSharedWithMe:!0,mimeTypeFilter:["application/pdf","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/msword","application/vnd.google-apps.presentation","application/vnd.google-apps.document","application/vnd.google-apps.drawing","application/vnd.google-apps.spreadsheet"],downloadOpts:{format:"application/pdf"},downloadHook:self.gdriveDownloadFun.bind(self),bDownloadData:!0,bCancelable:!0},o=d.a(u.gdrive,e,i);d.d(o,self.onImportPdf.bind(self))}else if("Dropbox"===this.dataset.value){var i={bSelectFolder:!1,icon:"moon:file-pdf",bMultiSel:!0,actionName:localString("import_gdrive_import"),gdrive_bSharedWithMe:!0,mimeTypeFilter:"application/pdf",bDownloadData:!0,bCancelable:!0},o=d.a(u.dropboxStd,e,i);d.d(o,self.onImportPdf.bind(self))}else log.error("unknown command:",this.dataset.value),self.onImportPdf("unknown command")})},gdriveDownloadFun:function(e,t,n,i,r){if("application/vnd.ms-powerpoint"!==n&&"application/vnd.openxmlformats-officedocument.wordprocessingml.document"!==n&&"application/vnd.openxmlformats-officedocument.presentationml.presentation"!==n&&"application/msword"!==n)return u.gdrive.download(e,i,r);var a;return o.resolve().then(function(){return u.gdrive.copyFile("google.gdrive0",e,t+".converting_pdf",null,{gdriveConvert:!0})}).then(function(e){return a=e,u.gdrive.download(e.id,i,r)}).finally(function(){return a?u.gdrive.deleteFile("google.gdrive0",a.id):void 0})},onImportPdf:function(e,t){console.assert(!t||t.length<=1);var n=this;if("Ok"===e){$.ajax({url:a.default.makeApiUrl("/api/report-ga"),type:"POST",xhrFields:{withCredentials:!0},data:{category:"Trivals",action:"ImportPDF(PPT,GDoc)",label:s.appName,value:0},success:function(e){},error:function(e){log.info("report ga failed")}}),a.default.showFullscreenWaiting(!0);var r=o.resolve(),l=0;i.each(t,function(e){r=r.then(function(){var t=e.blob,i=e.title;return a.default.blobToArrayBuffer(t).then(function(e){return n.doImportPdf(e,i)}).then(function(e){l+=e})})}),r.finally(function(){a.default.showFullscreenWaiting(!1)}).then(function(){log.log("imported",l,"pages"),n.cbImportPdf(null,null)},function(e){n.cbImportPdf(e)})}},doImportPdf:function(e,t){var i=this,r=o.defer();return n.e(9).then(function(){var l=[n(174)];(function(n){PDFJS.disableWorker=!0,PDFJS.workerSrc="vendor/pdf.worker.min.js",PDFJS.getDocument(e).then(function(e){for(var n=o.resolve(),l=e.numPages,s=[],c=[],d=0,u=document.createElement("canvas"),p=u.getContext("2d"),m=0;m<l;++m)!function(o){n=n.then(function(){return e.getPage(o+1).then(function(e){var n=e.getViewport(1);return u.height=n.height,u.width=n.width,s.push(n.height),c.push(n.width),d=Math.max(d,n.width),e.render({canvasContext:p,viewport:n}).then(function(){var e=u.toDataURL();return a.default.dataUrlToBlob(e)}).then(function(e){return i.cbImportPdf(null,{blob:e,pageIdx:o,title:t,totalPages:l})})})})}(m);n.then(function(){r.resolve(l)},r.reject)})}).apply(null,l)}).catch(n.oe),r.promise},show:function(e,t){t||(t=$("#common")[0]),this.el.togglerElem=e,$(t).append(this.el),this.$el.showModal()}}},function(e,t,n){"use strict";function i(e){$("#modal-import-link").remove();var t={$el:$(d.default.htmlToElement(localHtml(m))),home:e};return r(t),t}function o(e,t,n,i){var o=e.$el;e.home.$el.append(o),e.options=a.defaults(n||{},{footnote:""}),e.fileType=t,p.bDebug&&("*.micnote"===e.fileType?$("input",o).val("http://192.168.1.201:7070/test/ImportTest.micnote"):"*.*"===e.fileType&&$("input",o).val("http://192.168.1.201:7070/test/ImportTest.png"),$(".action-import-link",o).toggleAttr("disabled",!1)),o.find(".form-item-footnote").html(e.options.footnote),e.curImportWndOnResult=i,o[0].open()}function r(e){var t=e.$el;$(".action-cancel",t).on("click",function(){e.home.saveSettings(),t[0].toggle()}),t.on("iron-overlay-closed",function(t){e.curImportWndOnResult&&(e.curImportWndOnResult("Cancel"),e.curImportWndOnResult=void 0)}),$("input",t).on("input",function(){$(".action-import-link",t).toggleAttr("disabled",""===this.value)}),$(".action-import-link",t).on("click",function(n){function i(){r.parentNode.removeChild(r),$(".alert",t).css("visibility","").html(localString("import_link_down_failed",a.statusText)).alterClass("alert-*","alert-danger"),$(".action-import-link",t).css("display",""),$(".progress",e.$el).css("display","none")}var o=$("input",t).val(),r=d.default.addActivityAnimation(t,!0);$(".progress-bar",e.$el)[0].value=0,$(".text-prog",e.$el).text("0%"),$(".action-import-link",t).css("display","none"),$(".progress",e.$el).css("display","");var a=new XMLHttpRequest;a.open("GET",o),a.responseType="blob",a.onload=function(){if(200===a.status){r.parentNode.removeChild(r);var o=a.response;t[0].toggle();var l=[{blob:o,title:"Untitled"}];e.curImportWndOnResult&&e.curImportWndOnResult("Ok",l),e.curImportWndOnResult=void 0,n.stopImmediatePropagation()}else i()},a.onerror=i,a.onprogress=function(t){if(t.lengthComputable){var n=t.loaded/t.total,i=l.sprintf("%d%%",100*n);$(".progress-bar",e.$el)[0].value=n,$(".text-prog",e.$el).text(i)}},a.send()})}n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var a=n(19),l=(n.n(a),n(23)),s=(n.n(l),n(20)),c=(n.n(s),n(6)),d=(n.n(c),n(22)),u=n(21),p=(n.n(u),n(91),n(7)),m=(n.n(p),n(92),n(100),n(150));n.n(m)},function(e,t,n){"use strict";function i(e,t,n,i){var r=window.localHtml(k,{rt_cloud_name:e.showName}),a=$($(b.default.htmlToElement(r,!0)).children());a.each(function(e,n){Polymer.dom(t).appendChild(n)}),a.find(".text-title").text(localString("export_cloud_title",e.showName)),a.find(".action-open-gdrive").text(localString("export_cloud_open_web",e.showName)),b.default.clearCloudElements(a,e.source);var l={cp:e,$panels:a,xSlider:t,$parentPanel:n,home:i,$panelMain:a.filter(".panel-gdrive")};return o(l),$(".check-micnote",l.$panelMain).checked(ar.settings.bAutoExpMicnote),$(".check-recording",l.$panelMain).checked(ar.settings.bAutoExpRecording),$(".check-pdf",l.$panelMain).checked(ar.settings.bAutoExpPdf),$(".check-gdoc",l.$panelMain).checked(ar.settings.bAutoExpGDoc),$(".check-html",l.$panelMain).checked(ar.settings.bAutoExpHtml),$(".check-with-abm",l.$panelMain).checked(ar.settings.bAutoExpWithAbm),$(".text-folder",l.$panelMain).text(ar.settings.autoExpFolderPath).get(0).title=ar.settings.autoExpFolderPath,l}function o(e){e.$panels;var t=e.home,n=e.$panelMain;$(".action-sel-folder",e.$panelMain).on("click",function(){var i=x.b(e.cp,e.xSlider,e.$panelMain,t,{bSelectFolder:!0,bFolderOnly:!0,bMultiSel:!1,bCancelable:!0});x.c(i,function(t,i){if("Ok"===t){var o=i[0];e.seledFolderPath=o.path,e.seledFolderId=o.fid,$(".text-folder",n).text(e.seledFolderPath).get(0).title=e.seledFolderPath}})}),$(".action-back",n).on("click",function(i){e.seledFolderId&&(e.seledFolderId!==ar.settings.gdriveAutoExpFolderId&&ar.lsArticles.forEach(function(e){if(!e.bTrash)if(e.aeNoteSyncCommit=null,e.aeFolderSyncCommit=null,"Folder"===e.type)e.gdrive.aeFolderId=null;else{var n=t.getAllAutoExpFileIdFieldNames();f.each(n,function(t){e.gdrive[t]=null})}}),ar.settings.autoExpFolderPath=e.seledFolderPath,ar.settings.gdriveAutoExpFolderId=e.seledFolderId,"root"===e.seledFolderId&&(ar.settings.autoExpFolderPath="/"),t.saveArticleList());var o=$(".check-micnote",e.$panels).checked(),r=$(".check-recording",e.$panels).checked(),a="GDrive"===e.cp.name&&$(".check-pdf",e.$panels).checked(),l="GDrive"===e.cp.name&&$(".check-gdoc",e.$panels).checked(),s=$(".check-html",e.$panels).checked(),c=$(".check-with-abm",e.$panels).checked();o===ar.settings.bAutoExpMicnote&&r===ar.settings.bAutoExpRecording&&a===ar.settings.bAutoExpPdf&&l===ar.settings.bAutoExpGDoc&&s===ar.settings.bAutoExpHtml&&c===ar.settings.bAutoExpWithAbm||(ar.settings.bAutoExpMicnote=o,ar.settings.bAutoExpRecording=r,ar.settings.bAutoExpPdf=a,ar.settings.bAutoExpGDoc=l,ar.settings.bAutoExpHtml=s,ar.settings.bAutoExpWithAbm=c,ar.lsArticles.forEach(function(e){!e.bTrash&&e.aeNoteSyncCommit&&(e.aeNoteSyncCommit=y.genCommitHash())})),t.saveSettings(),e.xSlider.slide(e.$parentPanel.attr("name"),n.attr("name"),!1)}),$(e.xSlider).on("x-slider-end.auto-exp",function(t){t.originalEvent.detail.shownPage===n[0]?$(".text-disk-status",n).html(""):t.originalEvent.detail.shownPage===e.$parentPanel[0]&&(f.each(e.$panels,function(t){Polymer.dom(e.xSlider).removeChild(t)}),$(e.xSlider).off("x-slider-end.auto-exp"))})}function r(e){m=e}function a(e,t){console.assert("Folder"===t.type);var n=m.findLocalArticle(t.parentName);t.aeFolderSyncCommit?t.folderCommit!==t.aeFolderSyncCommit&&(console.assert("Root"!==t.artName),console.assert(t.folderCommit),e.push({command:"move",artName:t.artName}),t.aeFolderSyncCommit=t.folderCommit):(console.assert("Root"===t.artName||n),console.assert(t.folderCommit),e.push({command:"newFolder",artName:t.artName}),t.aeFolderSyncCommit=t.folderCommit),f.each(ar.lsArticles,function(n){n.bTrash||"Folder"!==n.type||n.parentName!==t.artName||a(e,n)})}function l(){var e=g.resolve();return e=e.then(function(){return m.getAEProvider().authenticateEx(T,"Storage")}),ar.rootArticle.gdrive.aeFolderId||(e=e.then(function(){return s()})),e=e.then(function(){return c()})}function s(){return ar.settings.gdriveAutoExpFolderId?(ar.rootArticle.gdrive.aeFolderId=ar.settings.gdriveAutoExpFolderId,ar.rootArticle.aeFolderSyncCommit=ar.rootArticle.folderCommit,void m.saveArticleList()):g.resolve().then(function(){return p(m.getAEProvider(),ar.rootArticle,"Mic Note Exports",null).then(function(e){function t(e){ar.settings.gdriveAutoExpFolderId=e,ar.rootArticle.gdrive.aeFolderId=e,m.saveSettings(),m.saveArticleList()}return e?void t(e):u("Mic Note Exports",null).then(function(e){t(e)})})})}function c(){var e=[];a(e,ar.rootArticle),ar.lsArticles.forEach(function(t){if(!t.bTrash&&"Note"===t.type){m.findLocalArticle(t.parentName);t.noteCommit&&(t.aeNoteSyncCommit?(t.folderCommit!==t.aeFolderSyncCommit&&(console.assert(t.folderCommit),e.push({command:"move",artName:t.artName}),t.aeFolderSyncCommit=t.folderCommit),t.noteCommit!==t.aeNoteSyncCommit&&(e.push({command:"updateNote",artName:t.artName}),t.aeNoteSyncCommit=t.noteCommit)):(console.assert(t.noteCommit&&t.folderCommit),e.push({command:"newNote",artName:t.artName}),t.aeNoteSyncCommit=t.noteCommit,t.aeFolderSyncCommit=t.folderCommit))}}),ar.commits.aeCommitList=ar.commits.aeCommitList.concat(e),m.saveArticleList(),m.saveCommits();var t=g.resolve();return ar.commits.aeCommitList.forEach(function(e){t=t.then(function(){A.info("execCommit: "+e.command);var t,n=e.artName?m.findLocalArticle(e.artName):null;return t=n&&"Note"==n.type?localString("exporting_art",f.escape(n.artTitle)):localString("exporting_info"),m.setStableInfo("Sync",t),d(e).catch(function(e){if(A.fail(C,e),!e||"string"!=typeof e.message||-1===e.message.indexOf("|FileNotFound"))throw h.sprintf("title: %s, %s",m.getArtTitleShowName(n),b.default.getShowError(e));A.error("file missing, ignore a commit.")}).then(function(){m.setStableInfo("Sync",localString("exporting_info"));var t=ar.commits.aeCommitList.shift();console.assert(t===e),m.saveCommits()})})}),t}function d(e){return L[e.command].call(this,e)}function u(e,t){return m.getAEProvider().createDir(T,e,t)}function p(e,t,n,i){var o=f.where(ar.lsArticles,{parentName:t.parentName,artTitle:t.artTitle,bTrash:!1});return log.assert(o&&o.length>=1),o&&1===o.length?(A.assert(o[0]===t),e.listChildren(i,T,{title:n,bFolderOnly:!0}).then(function(e){return 1===e.length?(A.log("re-link exported folder: ",n),e[0].id):g.resolve(null)})):g.resolve(null)}n.d(t,"c",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"a",function(){return l});var m,f=n(19),h=(n.n(f),n(23)),g=(n.n(h),n(20)),v=(n.n(g),n(6)),b=(n.n(v),n(22)),y=n(21),w=(n.n(y),n(91),n(7)),_=(n.n(w),n(92),n(125)),x=n(96),S=n(157),k=(n.n(S),window.localHtml(S)),T="google.gdrive0",C="[autoExportNote]",A=log.reg("autoExportNote"),L={};L.move=function(e){var t=m.findLocalArticle(e.artName);if(!t)return A.warn("commit move: article is missing, skip."+e.artName),g.resolve();if(t.bTrash)return A.warn("commit move: article was trashed, skip."+e.artName),g.resolve();var n=m.findLocalArticle(t.parentName);if(!n||!n.gdrive.aeFolderId)return A.warn("commit move: parent error, skip."+t.parentName),g.resolve();var i=g.resolve(),o=m.getAEProvider();return"Folder"===t.type?i=i.then(function(){var e=m.getArtTitleShowName(t);return o.moveFile(T,t.gdrive.aeFolderId,n.gdrive.aeFolderId,e).then(function(e){if("Dropbox"===o.source&&t.gdrive.aeFolderId!==e){var n=m.getAllArticlesInFolder(t.artName,!0,!1),i=t.gdrive.aeFolderId,r=e,a=m.getAllAutoExpFileIdFieldNames(!0);f.each(n,function(e){f.each(a,function(t){e.gdrive[t]&&(console.assert(0===e.gdrive[t].indexOf(i)),e.gdrive[t]=r+e.gdrive[t].substring(i.length))})}),t.gdrive.aeFolderId=e}})}):"Note"===t.type&&(ar.settings.bAutoExpMicnote&&(i=i.then(function(){console.assert(t.gdrive.aeMicnoteFileId);var e=m.getArtTitleShowName(t)+".micnote";return o.moveFile(T,t.gdrive.aeMicnoteFileId,n.gdrive.aeFolderId,e).then(function(e){"Dropbox"===o.source&&(t.gdrive.aeMicnoteFileId=e)})})),ar.settings.bAutoExpRecording&&(console.assert(t.gdrive.aeRecFileId),i=i.then(function(){var e=y.getExtension(t.audioName).toLowerCase(),i=m.getArtTitleShowName(t)+"."+e;return o.moveFile(T,t.gdrive.aeRecFileId,n.gdrive.aeFolderId,i).then(function(e){"Dropbox"===o.source&&(t.gdrive.aeRecFileId=e)})})),ar.settings.bAutoExpPdf&&"GDrive"===o.source&&(console.assert(t.gdrive.aePdfFileId),i=i.then(function(){var e=m.getArtTitleShowName(t)+".pdf";return o.moveFile(T,t.gdrive.aePdfFileId,n.gdrive.aeFolderId,e).then(function(e){"Dropbox"===o.source&&(t.gdrive.aePdfFileId=e)})})),ar.settings.bAutoExpGDoc&&"GDrive"===o.source&&(console.assert(t.gdrive.aeGDocFileId),i=i.then(function(){var e=m.getArtTitleShowName(t);return o.moveFile(T,t.gdrive.aeGDocFileId,n.gdrive.aeFolderId,e).then(function(e){"Dropbox"===o.source&&(t.gdrive.aeGDocFileId=e)})})),ar.settings.bAutoExpHtml&&(console.assert(t.gdrive.aeHtmlFileId),i=i.then(function(){var e=m.getArtTitleShowName(t)+".html";return o.moveFile(T,t.gdrive.aeHtmlFileId,n.gdrive.aeFolderId,e).then(function(e){"Dropbox"===o.source&&(t.gdrive.aeHtmlFileId=e)})}))),i},L.newFolder=function(e){var t=m.findLocalArticle(e.artName);if(!t)return A.warn("commit newFolder: article is missing, skip."+e.artName),g.resolve();if(t.bTrash)return A.warn("commit newFolder: article was trashed, skip."+e.artName),g.resolve();console.assert("Folder"===t.type);var n=m.findLocalArticle(t.parentName);if(!n||!n.gdrive.aeFolderId)return A.warn("commit newFolder: parent error, skip."+t.parentName),g.resolve();var i,o;i=t.artTitle,o=n.gdrive.aeFolderId;var r=g.resolve();return r=r.then(function(){return t.gdrive.aeFolderId?t.gdrive.aeFolderId:p(m.getAEProvider(),t,i,o)}),r=r.then(function(e){return e||u(i,o)}).then(function(e){t.gdrive.aeFolderId=e,m.saveArticleList()})},L.updateNote=function(e){function t(e,t,n,i,o){if(t)return g.resolve(null);var r=f.where(ar.lsArticles,{parentName:o.parentName,artTitle:o.artTitle,bTrash:!1});return log.assert(r&&r.length>=1),r&&1===r.length?(A.assert(r[0]===o),e.listChildren(i,T,{title:n}).then(function(e){return 1===e.length?(A.log("re-link exported file: ",n),e[0].id):g.resolve(null)})):g.resolve(null)}var n=m.findLocalArticle(e.artName);if(!n)return A.warn("commit newFolder: article is missing, skip."+e.artName),g.resolve();if(n.bTrash)return A.warn("commit newFolder: article was trashed, skip."+e.artName),g.resolve();console.assert("Note"===n.type);var i=m.findLocalArticle(n.parentName);if(!i||!i.gdrive.aeFolderId)return A.warn("commit newNote: parent error, skip."+n.parentName),g.resolve();var o=g.resolve(),r=i.gdrive.aeFolderId;if(ar.settings.bAutoExpMicnote&&(o=o.then(function(){A.info("start export micnote: ",n.artTitle);var e=m.getArtTitleShowName(n)+".micnote";return m.setStableInfo("Sync",localString("exporting_art",f.escape(e))),t(m.getAEProvider(),n.gdrive.aeMicnoteFileId,e,r,n).then(function(t){return t&&(n.gdrive.aeMicnoteFileId=t),_.c(m.getAEProvider(),m,n,n.gdrive.aeMicnoteFileId,r,function(t){"progress"===t.name&&m.setStableInfo("Sync",localString("exporting_art_progress",f.escape(e),b.default.getCloudProgressShowString(t.loaded,t.total,!0)))})}).then(function(e){n.gdrive.aeMicnoteFileId=e},function(e){throw"string"==typeof e.message&&-1!=e.message.indexOf("|FileNotFound")&&(n.gdrive.aeMicnoteFileId=null),e})})),ar.settings.bAutoExpRecording){var a=y.getExtension(n.audioName).toLowerCase();o=o.then(function(){A.info("start export rec: ",n.artTitle);var e=m.getArtTitleShowName(n)+"."+a;return m.setStableInfo("Sync",localString("exporting_art",f.escape(e))),t(m.getAEProvider(),n.gdrive.aeRecFileId,e,r,n).then(function(t){return t&&(n.gdrive.aeRecFileId=t),_.e(m.getAEProvider(),m,n,n.gdrive.aeRecFileId,r,function(t){"progress"===t.name&&m.setStableInfo("Sync",localString("exporting_art_progress",f.escape(e),b.default.getCloudProgressShowString(t.loaded,t.total,!0)))})}).then(function(e){n.gdrive.aeRecFileId=e},function(e){throw"string"==typeof e.message&&-1!=e.message.indexOf("|FileNotFound")&&(n.gdrive.aeRecFileId=null),e})})}return ar.settings.bAutoExpPdf&&(o=o.then(function(){A.info("start export pdf: ",n.artTitle);var e=m.getArtTitleShowName(n)+".pdf";return m.setStableInfo("Sync",localString("exporting_art",f.escape(e))),t(m.getAEProvider(),n.gdrive.aeMicnoteFileId,e,r,n).then(function(t){return t&&(n.gdrive.aePdfFileId=t),_.d(m.getAEProvider(),m,n,n.gdrive.aePdfFileId,r,function(t){"progress"===t.name&&m.setStableInfo("Sync",localString("exporting_art_progress",f.escape(e),b.default.getCloudProgressShowString(t.loaded,t.total,!0)))},null,ar.settings.bAutoExpWithAbm)}).then(function(e){n.gdrive.aePdfFileId=e},function(e){throw"string"==typeof e.message&&-1!=e.message.indexOf("|FileNotFound")&&(n.gdrive.aePdfFileId=null),e})})),ar.settings.bAutoExpGDoc&&(o=o.then(function(){A.info("start export gdoc: ",n.artTitle);var e=m.getArtTitleShowName(n);return m.setStableInfo("Sync",localString("exporting_art",f.escape(e))),t(m.getAEProvider(),n.gdrive.aeMicnoteFileId,e,r,n).then(function(t){return t&&(n.gdrive.aeGDocFileId=t),_.a(m.getAEProvider(),m,n,n.gdrive.aeGDocFileId,r,function(t){"progress"===t.name&&m.setStableInfo("Sync",localString("exporting_art_progress",f.escape(e),b.default.getCloudProgressShowString(t.loaded,t.total,!0)))},null,ar.settings.bAutoExpWithAbm)}).then(function(e){n.gdrive.aeGDocFileId=e},function(e){throw"string"==typeof e.message&&-1!=e.message.indexOf("|FileNotFound")&&(n.gdrive.aeGDocFileId=null),e})})),ar.settings.bAutoExpHtml&&(o=o.then(function(){A.info("start export html: ",n.artTitle);var e=m.getArtTitleShowName(n)+".html";return m.setStableInfo("Sync",localString("exporting_art",f.escape(e))),t(m.getAEProvider(),n.gdrive.aeMicnoteFileId,e,r,n).then(function(t){return t&&(n.gdrive.aeHtmlFileId=t),_.b(m.getAEProvider(),m,n,n.gdrive.aeHtmlFileId,r,function(t){"progress"===t.name&&m.setStableInfo("Sync",localString("exporting_art_progress",f.escape(e),b.default.getCloudProgressShowString(t.loaded,t.total,!0)))},ar.settings.bAutoExpWithAbm)}).then(function(e){n.gdrive.aeHtmlFileId=e},function(e){throw"string"==typeof e.message&&-1!=e.message.indexOf("|FileNotFound")&&(n.gdrive.aeHtmlFileId=null),e})})),o.then(function(){m.saveArticleList()})},L.newNote=L.updateNote},,function(e,t,n){function i(){}function o(e){if(!h(e))return e;var t=[];for(var n in e)r(t,n,e[n]);return t.join("&")}function r(e,t,n){if(null!=n)if(Array.isArray(n))n.forEach(function(n){r(e,t,n)});else if(h(n))for(var i in n)r(e,t+"["+i+"]",n[i]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));else null===n&&e.push(encodeURIComponent(t))}function a(e){for(var t,n,i={},o=e.split("&"),r=0,a=o.length;r<a;++r)-1==(n=(t=o[r]).indexOf("="))?i[decodeURIComponent(t)]="":i[decodeURIComponent(t.slice(0,n))]=decodeURIComponent(t.slice(n+1));return i}function l(e){var t,n,i,o,r=e.split(/\r?\n/),a={};r.pop();for(var l=0,s=r.length;l<s;++l)t=(n=r[l]).indexOf(":"),i=n.slice(0,t).toLowerCase(),o=y(n.slice(t+1)),a[i]=o;return a}function s(e){return/[\/+]json\b/.test(e)}function c(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=l(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function d(e,t){var n=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new c(n)}catch(t){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=t,n.xhr?(e.rawResponse=void 0===n.xhr.responseType?n.xhr.responseText:n.xhr.response,e.status=n.xhr.status?n.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),n.callback(e)}n.emit("response",t);var i;try{n._isResponseOK(t)||((i=new Error(t.statusText||"Unsuccessful HTTP response")).original=e,i.response=t,i.status=t.status)}catch(e){i=e}i?n.callback(i,t):n.callback(null,t)})}function u(e,t,n){var i=b("DELETE",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i}var p;"undefined"!=typeof window?p=window:"undefined"!=typeof self?p=self:(console.warn("Using browser-only version of superagent in non-browser environment"),p=this);var m=n(164),f=n(165),h=n(127),g=n(166),v=n(168),b=t=e.exports=function(e,n){return"function"==typeof n?new t.Request("GET",e).end(n):1==arguments.length?new t.Request("GET",e):new t.Request(e,n)};t.Request=d,b.getXHR=function(){if(!(!p.XMLHttpRequest||p.location&&"file:"==p.location.protocol&&p.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var y="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};b.serializeObject=o,b.parseString=a,b.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},b.serialize={"application/x-www-form-urlencoded":o,"application/json":JSON.stringify},b.parse={"application/x-www-form-urlencoded":a,"application/json":JSON.parse},g(c.prototype),c.prototype._parseBody=function(e){var t=b.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&s(this.type)&&(t=b.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},c.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,i="cannot "+t+" "+n+" ("+this.status+")",o=new Error(i);return o.status=this.status,o.method=t,o.url=n,o},b.Response=c,m(d.prototype),f(d.prototype),d.prototype.type=function(e){return this.set("Content-Type",b.types[e]||e),this},d.prototype.accept=function(e){return this.set("Accept",b.types[e]||e),this},d.prototype.auth=function(e,t,n){switch("object"==typeof t&&null!==t&&(n=t),n||(n={type:"function"==typeof btoa?"basic":"auto"}),n.type){case"basic":this.set("Authorization","Basic "+btoa(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},d.prototype.query=function(e){return"string"!=typeof e&&(e=o(e)),e&&this._query.push(e),this},d.prototype.attach=function(e,t,n){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,n||t.name)}return this},d.prototype._getFormData=function(){return this._formData||(this._formData=new p.FormData),this._formData},d.prototype.callback=function(e,t){if(this._maxRetries&&this._retries++<this._maxRetries&&v(e,t))return this._retry();var n=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),n(e,t)},d.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},d.prototype.buffer=d.prototype.ca=d.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},d.prototype.pipe=d.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},d.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},d.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||i,this._finalizeQueryString(),this._end()},d.prototype._end=function(){var e=this,t=this.xhr=b.getXHR(),n=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var n=t.readyState;if(n>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==n){var i;try{i=t.status}catch(e){i=0}if(!i){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var i=function(t,n){n.total>0&&(n.percent=n.loaded/n.total*100),n.direction=t,e.emit("progress",n)};if(this.hasListeners("progress"))try{t.onprogress=i.bind(null,"download"),t.upload&&(t.upload.onprogress=i.bind(null,"upload"))}catch(e){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(e){return this.callback(e)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof n&&!this._isHost(n)){var o=this._header["content-type"],r=this._serializer||b.serialize[o?o.split(";")[0]:""];!r&&s(o)&&(r=b.serialize["application/json"]),r&&(n=r(n))}for(var a in this.header)null!=this.header[a]&&this.header.hasOwnProperty(a)&&t.setRequestHeader(a,this.header[a]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send(void 0!==n?n:null),this},b.get=function(e,t,n){var i=b("GET",e);return"function"==typeof t&&(n=t,t=null),t&&i.query(t),n&&i.end(n),i},b.head=function(e,t,n){var i=b("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&i.query(t),n&&i.end(n),i},b.options=function(e,t,n){var i=b("OPTIONS",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},b.del=u,b.delete=u,b.patch=function(e,t,n){var i=b("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},b.post=function(e,t,n){var i=b("POST",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},b.put=function(e,t,n){var i=b("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i}},function(e,t,n){(function(t,i){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.1.1
 */
!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function o(e){return"function"==typeof e}function r(){return void 0!==R?function(){R(l)}:a()}function a(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<O;e+=2)(0,z[e])(z[e+1]),z[e]=void 0,z[e+1]=void 0;O=0}function s(e,t){var n=arguments,i=this,o=new this.constructor(d);void 0===o[K]&&L(o);var r=i._state;return r?function(){var e=n[r-1];B(function(){return C(r,o,e,i._result)})}():x(i,o,e,t),o}function c(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(d);return b(n,e),n}function d(){}function u(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(e){return Q.error=e,Q}}function f(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}function h(e,t,n){B(function(e){var i=!1,o=f(n,t,function(n){i||(i=!0,t!==n?b(e,n):w(e,n))},function(t){i||(i=!0,_(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&o&&(i=!0,_(e,o))},e)}function g(e,t){t._state===J?w(e,t._result):t._state===Y?_(e,t._result):x(t,void 0,function(t){return b(e,t)},function(t){return _(e,t)})}function v(e,t,n){t.constructor===e.constructor&&n===s&&t.constructor.resolve===c?g(e,t):n===Q?(_(e,Q.error),Q.error=null):void 0===n?w(e,t):o(n)?h(e,t,n):w(e,t)}function b(t,n){t===n?_(t,u()):e(n)?v(t,n,m(n)):w(t,n)}function y(e){e._onerror&&e._onerror(e._result),S(e)}function w(e,t){e._state===X&&(e._result=t,e._state=J,0!==e._subscribers.length&&B(S,e))}function _(e,t){e._state===X&&(e._state=Y,e._result=t,B(y,e))}function x(e,t,n,i){var o=e._subscribers,r=o.length;e._onerror=null,o[r]=t,o[r+J]=n,o[r+Y]=i,0===r&&e._state&&B(S,e)}function S(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,o=void 0,r=e._result,a=0;a<t.length;a+=3)i=t[a],o=t[a+n],i?C(n,i,o,r):o(r);e._subscribers.length=0}}function k(){this.error=null}function T(e,t){try{return e(t)}catch(e){return Z.error=e,Z}}function C(e,t,n,i){var r=o(n),a=void 0,l=void 0,s=void 0,c=void 0;if(r){if((a=T(n,i))===Z?(c=!0,l=a.error,a.error=null):s=!0,t===a)return void _(t,p())}else a=i,s=!0;t._state!==X||(r&&s?b(t,a):c?_(t,l):e===J?w(t,a):e===Y&&_(t,a))}function A(e,t){try{t(function(t){b(e,t)},function(t){_(e,t)})}catch(t){_(e,t)}}function $(){return ee++}function L(e){e[K]=ee++,e._state=void 0,e._result=void 0,e._subscribers=[]}function I(e,t){this._instanceConstructor=e,this.promise=new e(d),this.promise[K]||L(this.promise),M(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&w(this.promise,this._result))):_(this.promise,E())}function E(){return new Error("Array Methods must be provided an Array")}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function P(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(e){this[K]=$(),this._result=this._state=void 0,this._subscribers=[],d!==e&&("function"!=typeof e&&N(),this instanceof F?A(this,e):P())}var D=void 0,M=D=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},O=0,R=void 0,U=void 0,B=function(e,t){z[O]=e,z[O+1]=t,2===(O+=2)&&(U?U(l):q())},H="undefined"!=typeof window?window:void 0,j=H||{},W=j.MutationObserver||j.WebKitMutationObserver,V="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),G="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,z=new Array(1e3),q=void 0;q=V?function(){return t.nextTick(l)}:W?function(){var e=0,t=new W(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():G?function(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}():void 0===H?function(){try{var e=n(169);return R=e.runOnLoop||e.runOnContext,r()}catch(e){return a()}}():a();var K=Math.random().toString(36).substring(16),X=void 0,J=1,Y=2,Q=new k,Z=new k,ee=0;return I.prototype._enumerate=function(e){for(var t=0;this._state===X&&t<e.length;t++)this._eachEntry(e[t],t)},I.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===c){var o=m(e);if(o===s&&e._state!==X)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===F){var r=new n(d);v(r,e,o),this._willSettleAt(r,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},I.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===X&&(this._remaining--,e===Y?_(i,n):this._result[t]=n),0===this._remaining&&w(i,this._result)},I.prototype._willSettleAt=function(e,t){var n=this;x(e,void 0,function(e){return n._settledAt(J,t,e)},function(e){return n._settledAt(Y,t,e)})},F.all=function(e){return new I(this,e).promise},F.race=function(e){var t=this;return new t(M(e)?function(n,i){for(var o=e.length,r=0;r<o;r++)t.resolve(e[r]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},F.resolve=c,F.reject=function(e){var t=new this(d);return _(t,e),t},F._setScheduler=function(e){U=e},F._setAsap=function(e){B=e},F._asap=B,F.prototype={constructor:F,then:s,catch:function(e){return this.then(null,e)}},F.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=F},F.Promise=F,F})}).call(t,n(83),n(109))},function(e,t){e.exports=function(e){return"https://"+e+".dropboxapi.com/2/"}},function(e,t,n){"use strict";function i(e,t){var n,i="Camera"===e?Camera.PictureSourceType.CAMERA:Camera.PictureSourceType.PHOTOLIBRARY;l.resolve().then(function(){var e=l.defer();return ar.bMobileDontSleep=!0,navigator.camera.getPicture(function(t){e.resolve(t)},e.reject,{destinationType:Camera.DestinationType.FILE_URI,sourceType:i,correctOrientation:!0}),e.promise}).then(function(e){return c.default.showFullscreenWaiting(!0),l.ninvoke(ar.fileSystem,"loadFile",e,{type:"Blob"})}).then(function(e){var i=new c.default.DateFmt("%y-%m-%d_%H.%M.%S"),r=e.type.replace("image/","");"jpeg"===r&&(r="jpg");var a=i.format(new Date)+"."+r;o("Ok",[{title:n=a,blob:e}],t,"Blob")}).catch(function(e){log.error("mobileTakePhoto:",e),o("Cancel",null,t)}).finally(function(){c.default.showFullscreenWaiting(!1),ar.bMobileDontSleep=!1}).done()}function o(e,t,n,i){if("Ok"===e)if("Blob"===i){a=r.map(t,function(e){return{data:e.blob,title:e.title}});n(null,a)}else if("DataUrl"===i){c.default.showFullscreenWaiting(!0);var o=l.resolve(),a=[];r.each(t,function(e){var t=e.blob,n=e.title;t.type&&!/^image\//.test(t.type)||(o=o.then(function(){return c.default.blobToDataUrl(t)}).then(function(e){a.push({data:e,title:n})}))}),o.then(function(){n(null,a)},function(e){n(e)}).finally(function(e){c.default.showFullscreenWaiting(!1)})}else log.error("unsupported type:",i);else n(null,[])}n.d(t,"a",function(){return v}),n.d(t,"b",function(){return i});var r=n(19),a=(n.n(r),n(23)),l=(n.n(a),n(20)),s=(n.n(l),n(6)),c=(n.n(s),n(22)),d=n(21),u=(n.n(d),n(91),n(7)),p=(n.n(u),n(111)),m=n(94),f=n(96),h=n(175),g=(n.n(h),n(24)),v={create:function(e,t,n){this.home=e,this.cbImportImage=n,this.options=r.defaults(t||{},{type:"Blob",bNoCamera:!1,heading:localString("toolbar_insert_pic")});var i=window.localHtml(h);i=window.localHtml(i,{rt_heading:this.options.heading}),this.el=c.default.htmlToElement(i,!0),this.$el=$(this.el),this.options.bNoCamera&&this.$el.find("*[data-value='Camera']").remove(),this.bindEvents()},bindEvents:function(){var e=this,t=this.home,n=this.$el;n.on("iron-overlay-closed",function(){e.bExecuted||e.myImportImage(null,[])}),$("paper-item",n).on("click",function(n){if(e.bExecuted=!0,e.$el.hideModal(),"Disk"===this.dataset.value)Object(g.filePicker)({fileType:"Image",bMultiSel:!0},e.myImportImage.bind(e));else if("Link"===this.dataset.value){var o=p.a(t);p.b(o,"*.*",{footnote:localString("import_img_link_accept_types")},e.myImportImage.bind(e))}else if("GDrive"===this.dataset.value){var r={bSelectFolder:!1,icon:"bs:picture",mimeTypeFilter:/^image\//,bMultiSel:!0,actionName:localString("import_gdrive_import"),bCancelable:!0},a=f.a(m.gdrive,t,r);f.d(a,e.myImportImage.bind(e))}else if("Dropbox"===this.dataset.value){var r={bSelectFolder:!1,icon:"bs:picture",mimeTypeFilter:/^image\//,bMultiSel:!0,actionName:localString("import_gdrive_import"),bCancelable:!0},a=f.a(m.dropboxStd,t,r);f.d(a,e.myImportImage.bind(e))}else!s("MobileApp")||"Camera"!==this.dataset.value&&"Library"!==this.dataset.value?(log.error("unknown command:",this.dataset.value),e.cbImportImage("unknown cmd")):i(this.dataset.value,e.cbImportImage)})},myImportImage:function(e,t){var n=this;o(e,t,n.cbImportImage,n.options.type)},show:function(e,t){t||(t=$("#common")[0]),this.el.togglerElem=e,$(t).append(this.el),this.$el.showModal()}}},function(e,t,n){"use strict";function i(e){for(var t=0;e=e.previousSibling;)t++;return t}function o(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function r(e,t,n){if(e!==t&&!$(e).has(t).length)return null;var a;if("#text"===t.nodeName&&(a=t.splitText(n)),!a){a=t.cloneNode(!1);for(var l;l=t.childNodes[n];)a.appendChild(l);o(a,t)}return t===e?a:r(e,a.parentNode,i(a))}function a(e){var t=document.createElement("a");return t.href=e.data,t.target="_blank",t.appendChild(e),t}function l(e){return"A"!=e.tagName}function s(e,t,n,i){for(var o=e.lastChild;o;)o.nodeType==document.ELEMENT_NODE&&i(e)?s(o,t,a,i):o.nodeType==document.TEXT_NODE&&c(o,t,n),o=o.previousSibling}function c(e,t,n){for(var i,o,r,a,l=e.parentNode;e&&(i=t.exec(e.data));)r=e.splitText(i.index),a=i[0].length,e=r.length>a?r.splitText(a):null,o=n(r.cloneNode(!0)),l.insertBefore(o,r),l.removeChild(r)}function d(e){var t=new RegExp(String.fromCharCode(160),"g");return e.replace(t," ")}function u(e,t){for(var n=e.lastChild;n;){if(t(n)){var i=d(n.innerText),o=document.createTextNode(i);e.insertBefore(o,n),n.remove(),n=o}else n.nodeType==document.TEXT_NODE&&u(n,t);n=n.previousSibling}}function p(e){u(e,function(e){return"A"===e.nodeName&&"#home/a-abm"!==e.hash}),e.normalize()}function m(e,t){var n=e.cloneNode(!0);if(p(n),s(n,L,a,l),n.innerHTML!==e.innerHTML){var i;return t&&-1===(i=_.n(e))?(log.error("update link failed, cant find char offset"),!1):(e.innerHTML=n.innerHTML,t&&_.s(e,i),!0)}return!1}n.d(t,"a",function(){return I});var f=n(19),h=(n.n(f),n(20)),g=(n.n(h),n(6)),v=(n.n(g),n(92),n(22)),b=n(21),y=(n.n(b),n(91)),w=(n(8),n(7)),_=(n.n(w),n(97)),x=n(98),S=n(24),k=".line[data-type='text']"+y.a.CONT_SELECTOR,T=_.n,C=_.o,A=_.l;_.k;document.getElementById("textbox");var L=/http(s?):\/\/($|[^ ]+)/,I=f.extend(Object.create(_.d),{create:function(e){var t=this;f.extend(t,{type:y.a.LineType.TEXT,leditor:e,el:e.el,$el:e.$el,home:e.home,bFreezeInputEvt:!1}),t.cursorMoveStream=new Kefir.Bus,t.contFocusStream=new Kefir.Bus,t.contFocusProp=t.contFocusStream.map(function(e){return e.bFocused}).toProperty(function(){return!1}),t.bindEvents_()},bindEvents_:function(){var e=this,t=e.leditor;e.el.addEventListener("blur",n=>{if($(n.target).is(k)){w.DEBUG_FOCUS&&log.debug("textLine: .content blur");var i=t.$findCurLn(n.target),o=v.default.getSelection();e.contFocusStream.emit({bFocused:!1,lnName:i.lnName()}),i.removeClass("content-focus"),e.stopEditingTCCmd_();var r=i.lnContent(),a=r[0];if(m(a,!1),e.saveLine_(i),t.$activeLn[0]===i[0]&&i.line()&&(o.baseNode===a||r.has(o.baseNode).length)){var l=e.getLineActiveState(i);t.updateActiveLnLocalState(l)}t.bNoSaveSelForBlur||g("MobileApp")||(o.removeAllRanges(),w.DEBUG_FOCUS&&log.debug("removeAllRanges since .content is blur")),e.extHandleCancel&&e.extHandleCancel(n)}},!0),e.el.addEventListener("focus",n=>{if($(n.target).is(k)){w.DEBUG_FOCUS&&log.debug("textLine: .content focus");var i=t.$findCurLn(n.target);e.contFocusStream.emit({bFocused:!0,lnName:i.lnName()});e.leditor.updateActiveLn(i,null),i.addClass("content-focus"),(g("MobileApp")||g("FakeMobile"))&&e.home.onKeyboardShownSoon(function(){e.leditor.makeLinesVisible(i)})}},!0),e.$el.on("input",k,function(n){if(!e.bFreezeInputEvt){var i=t.$findCurLn(this),o=i.length&&i.line(),r=i.lnContent();if(y.a.FIX_NO_BACKSPACE_EVT)if(""===r.html())f.delay(function(){r[0].innerHTML=y.a.FIX_NO_BACKSPACE_LEADING_HTML,e.moveCursorToEnd(r[0])});else if(r.html()===y.a.FIX_NO_BACKSPACE_LEADING_STR)return f.delay(function(){t.tryDeleteActiveLine(i),n.preventDefault()}),!1;if(e.editingTCCmd&&e.editingTCCmd.lnName!==o.name&&e.stopEditingTCCmd_(),!e.editingTCCmd&&e.editingTCKeydownLnName===o.name){var a=Object.create(E),l=e.editingTCKeydownOffset;a.create(e,o.name,e.editingTCKeydownCont,this.innerHTML,l,-1),a.oldTime=o.time,t.history.add(a),e.editingTCCmd=a}t.triggerLineAbm(i,!1,!0),e.editingTCCmd&&(e.editingTCCmd.newContent=this.innerHTML,e.editingTCCmd.newTime=o.time,e.editingTCCmd.newOffset=T(this)),e.leditor.setModified(!0)}return!1}),g("DesktopApp")&&!g("FakeMobile")?(e.$el.on("mouseup",k,function(n){if(t.bEditable){var i=v.default.getSelection();if(i.baseNode&&$(this).has(i.baseNode)&&"A"===i.baseNode.parentNode.nodeName&&i.baseNode&&i.baseNode.length!==i.baseOffset&&0!==i.baseOffset)if("#home/a-abm"===i.baseNode.parentNode.hash){var o=i.baseNode.parentNode;e.fire("click-doc-abm",o)}else i.baseNode.parentNode.href&&Object(S.openExternalLink)(i.baseNode.parentNode.href)}}),e.$el.on("click",".line[data-type='text'] a",function(n){t.bEditable||("#home/a-abm"===n.target.hash?e.fire("click-doc-abm",this):n.target.href&&"#void"!==n.target.hash&&Object(S.openExternalLink)(n.target.href))})):e.$el.on("click",".line[data-type='text'] a",function(n){t.bEditable||("#home/a-abm"===n.target.hash?e.fire("click-doc-abm",this):n.target.href&&"#void"!==n.target.hash&&Object(S.openExternalLink)(n.target.href))}),e.$el.on("click",k,function(t){e.stopEditingTCCmd_()})},handleContentKeyDown:function(e,t){var n=this,i=n.leditor,o=t.target;if(n.cursorMoveStream.emit(),27===t.keyCode&&n.extHandleCancel&&n.extHandleCancel(t))return!0;var r=e.length&&e.line(),a=e.parentLn(),l=(a.length&&a.line(),e.prevLn()),s=(l.length&&l.line(),e.nextLn()),c=(s.length&&s.line(),T(o));n.editingTCKeydownOffset=c,n.editingTCKeydownCont=o.innerHTML,n.editingTCKeydownLnName=r.name,t.keyCode!==v.default.KeyCode.VK_UP&&t.keyCode!==v.default.KeyCode.VK_DOWN&&t.keyCode!==v.default.KeyCode.VK_LEFT&&t.keyCode!==v.default.KeyCode.VK_RIGHT||n.stopEditingTCCmd_();var d=!1;if(8===t.keyCode)if("ChromeOS"===v.default.getOSName()&&t.altKey)t.stopPropagation(),d=!0;else{if(""===e.lnContent().text())i.tryDeleteActiveLine(e),t.preventDefault();else{var u=v.default.getSelection(),p=T(e.lnContent()[0]);e.lnContent()[0].firstChild===u.baseNode&&0===p&&u.isCollapsed&&(n.tryMergeToPrevLine(e),t.preventDefault())}t.stopPropagation()}else if(46===t.keyCode)t.stopPropagation(),d=!0;else if(13===t.keyCode)n.handleEnter(t,e);else if(38===t.keyCode)0!==v.default.getLinesAtCursorByWrap(o,i.lineHeight)&&(d=!0,t.stopPropagation());else if(40===t.keyCode){v.default.getLinesAtCursorByWrap(o,i.lineHeight)!==v.default.getTotalLinesByWrap(o,i.lineHeight)-1&&(d=!0,t.stopPropagation())}else v.default.isSelAllKeyEvt(t)?t.stopPropagation():v.default.isCutKeyEvt(t)&&(t.stopPropagation(),d=!0);return d},readyNewLinePos:function(e,t){var n,i,o,a,l,s=this,c=s.leditor,d=e.line(),u=e.lnContent(),p=u[0];do{var m;if(!(m=t||s.getLineActiveState(e)))break;var f=m.startOffset,g=u.text().length;if(i=0===g,g===f){var v=e.childLns();(T=Object.create(x.a)).create(),o=v.length?$(v[0]).line():c.ldoc.getNextPos(d),l="NewLine"}else if(i||0===f)o=d,l="NewLine";else{var b=e.lnContent().html(),y=A(p,f);if(!y){log.error("readyNewLinePos failed! no node in offset found");break}var w=r(p,y.node,y.offset);if(!w){log.error("splitNoteAt: not child");break}var S=w.innerHTML,k=e.lnContent().html();w.remove();var T=Object.create(x.a);T.create();var C=Object.create(E);C.create(s,d.name,b,S,f,-1),T.add(C);var L=c.ldoc.newTextLine("");L.content=k,L.parentName=d.parentName,(C=Object.create(_.b)).create(c,L,d.name),T.add(C);var I=d.time;(C=Object.create(_.h)).create(c,d.name,{time:null}),T.add(C),L.time=I,o=d;var N=T.execute();console.assert(h(N).isFulfilled()),a=T,n=c.lineToJLine(L),l="CurLine"}}while(!1);return o?{$splitLn:n,bEmptyLn:i,insertPos:o,undoCmd:a,suggestedFocus:l}:null},autoSave:function(){var e=this,t=e.leditor.getCursorLn(y.a.ListType.TEXT);t.length&&e.saveLine_(t[0])},saveLine_:function(e,t){var n=this,i=n.leditor,o=$(e),r=(o[0],o.line());if(r){var a=o.lnContent(),l=o.tlHtml();if(l!==r.content){if(t){var s=Object.create(E),c=T(a[0]);s.create(n,r.name,r.content,l,-1,c),i.history.add(s)}r.content=l}}},cmdInsertAbm:function(){var e=this,t=e.leditor,n=t.getCursorLn();if(n.length){var i,o="Insert"===ar.recContType||"Replace"===ar.recContType?'<a href="#home/a-abm" class="inserting">TM_STR</a>':'<a href="#home/a-abm">TM_STR</a>',r=t.home.getCurAudioTime();i="["+t.home.makeBmTimeStr(r)+"]";var a=Object.create(E),l=n.lnContent().html(),s=T(n.lnContent()[0]);o=o.replace("TM_STR",i),e.execCommand("insertHTML",!1,o);var c=s+i.length;e.setCursorByCharOffset(n.lnContent()[0],c);var d=n.lnContent().html();a.create(e,n.line().name,l,d,s,c),t.history.add(a),e.stopEditingTCCmd_(!0)}},removeAbm:function(e,t,n,i){var o=this,r=o.leditor,a=o.home,l=0,s=(r.getAllLns(),-(t-e)+n),c=Object.create(x.a);c.create();var d=r.$el.find(".line[data-type='text']");return f.each(d,function(n){var i=$(n),r=i.line(),d=i.find(y.a.CONT_SELECTOR+" a"),u=i.lnContent().html(),p=!1;if(f.each(d,function(n){if("#home/a-abm"===n.hash){var i=a.parseAbm(n.innerHTML),o=i[0],r=i[1],c=n.classList.contains("inserting"),d=_.i(a,e,t,s,o,r,c);if(d){var u="["+d+"]";n.innerHTML!=u&&(n.innerHTML=u,p=!0,l++),c&&n.classList.remove("inserting")}else n.remove(),p=!0,l++}}),p){var m=Object.create(E);m.create(o,r.name,u,i.lnContent().html()),c.add(m)}}),c.execute(),i&&i.add(c),l},stopEditingTCCmd_:function(e){var t=this,n=t.leditor;if(t.editingTCCmd&&(n.history.getUndoCmd()===t.editingTCCmd&&t.editingTCCmd.newContent===t.editingTCCmd.oldContent&&n.history.cancelLastCmd(),t.editingTCCmd=null),t.editingTCKeydownLnName=null,e){var i=n.getCursorLn();i.length&&i.line().type===y.a.LineType.TEXT&&(t.editingTCKeydownCont=i.lnContent().html(),t.editingTCKeydownOffset=T(i.lnContent()[0]),t.editingTCKeydownLnName=i.line().name)}},activateLine:function(e,t){console.assert(e.length&&e.line().type===y.a.LineType.TEXT);var n=this,i=e.lnContent();g("MobileApp")||document.activeElement===i[0]||(i.focus(),w.DEBUG_FOCUS&&log.debug("activate .content line, focus me.")),t?(console.assert(t.lineName===e.line().name),-1!==t.startOffset?n.setCursorByCharOffset(e.lnContent()[0],t.startOffset,t.endOffset):n.moveCursorToEnd(e.lnContent()[0])):n.setCursorByCharOffset(e.lnContent()[0],0),g("MobileApp")&&document.activeElement!==i[0]&&(i.focus(),w.DEBUG_FOCUS&&log.debug("activate .content line, focus me."))},clearActiveLns:function(){},pasteTextAtInsertPos:function(e,t){var n=this.leditor,i=t.split("\n"),o=[],r=document.createElement("DIV");f.each(i,function(e){r.innerHTML=e,m(r,!1),e=r.innerHTML;var t=n.ldoc.newTextLine(e);o.push(t)}),n.insertLinesAtBestPos(e,o,null,!0)},handleNormalPaste:function(e,t){function n(e,t){v.default.getSelection().rangeCount?f.delay(function(){var n=e.line(),r=e.lnContent().html(),a=Object.create(x.a);a.create(),a.execute();var l=Object.create(N);l.create(i,n.name,!0,!0),l.execute(),a.add(l),i.execCommand("insertHTML",!1,t),e.lnContent().html()!==r&&((l=Object.create(P)).create(i,n.name,""),l.saveCurrent(!0,!0),a.add(l),o.history.add(a)),e.lnContent().text()&&i.leditor.triggerLineAbm(e)}):log.error("pasteContentHtml failed")}var i=this,o=i.leditor,r=t.clipboardData.getData("micnote/content-html"),a=t.clipboardData.getData("text/html"),l=t.clipboardData.getData("text/plain"),s=!1;if(r)e.$cursorLn.length&&(n(e.$cursorLn,r),t.preventDefault()),s=!0;else if(l){if(-1!==l.indexOf("\n"))i.pasteTextAtInsertPos(e,l),t.preventDefault();else if(e.$cursorLn.length){var c=document.createElement("DIV");c.innerHTML=l,m(c,!1),l=c.innerHTML,n(e.$cursorLn,l),t.preventDefault()}s=!0}else if(a){l=v.default.htmlToElement("<div>"+a+"</div>").innerText;i.pasteTextAtInsertPos(e,l),t.preventDefault(),s=!0}return s},cmdInsertTextLine:function(e,t,n){var i=this.leditor,o=t||i.makeInsertPos(),r=i.ldoc.newTextLine(e);i.insertLinesAtBestPos(o,[r],n);return h(i.lineToJLine(r))},handleEnter:function(e,t){var n=this,i=n.leditor;if(n.extHandleEnter&&n.extHandleEnter(e))return e.preventDefault(),void e.stopPropagation();var o=t.line(),r=t.lnContent();if(-1===T(r[0]))return log.error("keydown on a non-cursor content, ignored."),e.preventDefault(),void e.stopPropagation();i.bNoSaveSelForBlur=!0;var a=Object.create(x.a);a.create(),a.execute(),(d=Object.create(_.e)).create(i),d.execute(),a.add(d);var l=n.readyNewLinePos(t);if(!l)return log.debug("ready new line failed"),e.preventDefault(),e.stopPropagation(),void(i.bNoSaveSelForBlur=!1);l.undoCmd&&a.add(l.undoCmd);var s=[];if(l.$splitLn)s.push(l.$splitLn.line());else{var c=i.ldoc.newTextLine(""),d=Object.create(_.b);d.create(i,c,l.insertPos.name),d.execute(),a.add(d),s.push(c)}d=Object.create(_.a);var u;u="NewLine"===l.suggestedFocus?s[0]:o,d.create(i,u.name),d.execute(),a.add(d),i.history.add(a),i.onNewLines_(i.linesToJLines(s)),e.preventDefault(),e.stopPropagation(),i.bNoSaveSelForBlur=!1},tryMergeToPrevLine:function(e){var t=this,n=t.leditor;if(e.childLns().length)return!1;var i=e.line(),o=e.prevLn(),r=o.line();if(!r||r.type!==y.a.LineType.TEXT)return!1;var a=Object.create(x.a);a.create(),a.execute();var l;(l=Object.create(_.e)).create(n),l.execute(),a.add(l),l=Object.create(E);var s=o.lnContent().html(),c=s+e.lnContent().html(),d=o.lnContent().text().length;return l.create(t,r.name,s,c,-1,d),l.execute(),a.add(l),(l=Object.create(_.f)).create(n,i),l.execute(),a.add(l),(l=Object.create(_.a)).create(n,r.name,t.makeLineActiveState(r.name,s.length)),l.execute(),a.add(l),n.history.add(a),!0},getLineActiveState:function(e){var t=e.lnContent(),n=C(t[0]);return console.assert(n.end>=n.start),{lineName:e.line().name,startOffset:n.start,endOffset:n.end}},makeLineActiveState:function(e,t,n){var i={lineName:e,startOffset:t,endOffset:null==n?t:n};return console.assert(i.endOffset>=i.startOffset),i},makeCursorLastActiveState:function(e){var t=this.leditor.findLineElem(e).lnContent().text().length;return{lineName:e,startOffset:t,endOffset:t}},execEditCmd:function(e,t,n,i,o){function r(e,t,n){var i=e.childNodes[0];return i&&void 0!==i.style&&i.style[t]===n}function a(e,t,n){var i=0;f.each(e,function(e){r($(e).lnContent()[0],t,n)&&i++}),i&&i!==e.length&&e.lnContent().find("*").css(t,"")}var l=this,s=l.leditor,c=s.getCursorLn(y.a.ListType.TEXT);if(s.bNoSaveSelForBlur=!0,o){v.default.saveSelection();var d=v.default.getSelection();d.removeAllRanges();var u=[];f.each(e,function(e){var t=$(e).lnContent().html();u.push(t)}),"bold"===(t=t.toLowerCase())?a(e,"font-weight","bold"):"italic"===t?a(e,"font-style","italic"):"strikethrough"===t&&a(e,"text-decoration","line-through"),f.each(e,function(e,o){var r=$(e),a=r.lnContent(),s=u[o];d.removeAllRanges();var c=document.createRange();c.selectNodeContents(a[0]),d.addRange(c),l.execCommand(t,!1,n),log.debug("exec",t);var p=a.html();if(s!==p){var m=Object.create(E);m.create(l,r.line().name,s,p),i.add(m)}}),v.default.restoreSelection()}else if(c[0]!==e[0])log.error("cursor line is not active line");else{console.assert(1===e.length);var p=e.first(),m=p.lnContent().html();if(l.execCommand(t,!1,n),m!==p.lnContent().html()){var h=Object.create(E);h.create(l,p.line().name,m,p.lnContent().html()),i.add(h)}}s.bNoSaveSelForBlur=!1},execCommand:function(e,t,n){var i=this;i.bFreezeInputEvt=!0,document.execCommand(e,t,n),i.bFreezeInputEvt=!1,w.DEBUG_FOCUS&&log.debug("textLine: execCommand",e,n)},toReadableHtml:function(e,t){var n=this,i=e.tlHtml();if(!t){var o=document.createElement("DIV");o.innerHTML=i,n.removeInlineAbmFromElem(o),i=o.textContent||o.innerText}return i},removeInlineAbmFromElem:function(e){$(e).find("a[href='#home/a-abm']").remove()},toReadableText:function(e){return e.lnContent()[0].innerText},isEmpty:function(e,t){var n=e.line();return n.type===y.a.LineType.TEXT&&""===e.tlHtml()&&(!t||null==n.time)},moveCursorToEnd:function(){var e=this;_.q.apply(window,arguments),e.cursorMoveStream.emit()},setCursorByCharOffset:function(){var e=this;_.s.apply(window,arguments),e.cursorMoveStream.emit()}}),E=f.extend(Object.create(x.b),{create:function(e,t,n,i,o,r){f.extend(this,{handler:e,leditor:e.leditor,lnName:t,oldContent:n,newContent:i,oldOffset:"number"==typeof o?o:-1,newOffset:"number"==typeof r?r:-1,oldTime:void 0,newTime:void 0})},execute:function(){var e=this,t=e.leditor.findLineElem(e.lnName),n=t.lnContent(),i=t.line();void 0!==e.newContent&&(i.content=e.newContent,n.html(i.content)),-1!==e.newOffset&&e.handler.setCursorByCharOffset(n[0],e.newOffset),void 0!==e.newTime&&i.time!==e.newTime&&(i.time=e.newTime,e.leditor.fire("abm-changed"))},unexecute:function(){var e=this,t=e.leditor.findLineElem(e.lnName),n=t.lnContent(),i=t.line();void 0!==e.oldContent&&(i.content=e.oldContent,n.html(i.content)),-1!==e.oldOffset&&e.handler.setCursorByCharOffset(n[0],e.oldOffset),void 0!==e.oldTime&&i.time!==e.oldTime&&(i.time=e.oldTime,e.leditor.fire("abm-changed"))}}),N=f.extend(Object.create(x.b),{create:function(e,t,n,i){f.extend(this,{handler:e,leditor:e.leditor,lnName:t,bPreserveCursor:n,bPreserveTime:i,oldContent:null,oldOffset:null,oldTime:void 0})},saveCurrent:function(){var e=this,t=e.leditor.findLineElem(e.lnName),n=t.lnContent();e.oldContent=n.html(),e.bPreserveCursor&&(e.oldOffset=T(n[0]),-1===e.oldOffset&&(e.oldOffset=null)),e.bPreserveTime&&(e.oldTime=t.line().time)},execute:function(){var e=this,t=e.leditor.findLineElem(e.lnName);t.lnContent(),t.line();null===e.oldContent&&e.saveCurrent()},unexecute:function(){var e=this,t=e.leditor.findLineElem(e.lnName),n=t.lnContent(),i=t.line();i.content=e.oldContent,n.html(e.oldContent),null!==e.oldOffset&&e.handler.setCursorByCharOffset(n[0],e.oldOffset),void 0!==e.oldTime&&i.time!==e.oldTime&&(i.time=e.oldTime,e.leditor.fire("abm-changed"))}}),P=f.extend(Object.create(x.b),{create:function(e,t,n,i,o){f.extend(this,{handler:e,leditor:e.leditor,lnName:t,newContent:n,newOffset:"number"==typeof i?i:null,newTime:"number"==typeof o?o:void 0})},saveCurrent:function(e,t){var n=this,i=n.leditor.findLineElem(n.lnName),o=i.lnContent();n.newContent=o.html(),e&&(n.newOffset=T(o[0]),-1===n.newOffset&&(n.newOffset=null)),t&&(n.newTime=i.line().time)},execute:function(){var e=this,t=e.leditor.findLineElem(e.lnName),n=t.lnContent(),i=t.line();"string"==typeof e.newContent&&(i.content=e.newContent,n.html(e.newContent)),null!==e.newOffset&&e.handler.setCursorByCharOffset(n[0],e.newOffset),void 0!==e.newTime&&i.time!==e.newTime&&(i.time=e.newTime,e.leditor.fire("abm-changed"))},unexecute:function(){}})},function(e,t,n){"use strict";function i(e){g=e,f=$("#editor"),h=$("#editor-view"),m=window.localHtml(E),o(),(k("MobileApp")||k("FakeMobile"))&&(console.assert(1===$("#mobile-image-menu-edit").length),$("#mobile-image-menu-edit").addAttr("no-auto-focus"))}function o(){T.a.addListener("onArticleSelected",function(){l()}),(k("MobileApp")||k("FakeMobile"))&&($("#mobile-image-menu-review paper-item, #mobile-image-menu-edit paper-item").on("click",function(){$(this).parents("x-popover")[0].toggle()}),$("#mobile-image-menu-review .action-share, #mobile-image-menu-edit .action-share").on("click",function(){d(v[0])}),$("#mobile-image-menu-review .action-view, #mobile-image-menu-edit .action-view").on("click",function(){u(v[0])}),$("#mobile-image-menu-edit .action-align").on("click",function(){var e=$("#popover-align-image")[0];e.togglerElem=this,e.open()}),$("#mobile-image-menu-edit .action-del").on("click",function(){c("delete",this)}),$("#mobile-image-menu-edit .action-type-above").on("click",function(){setTimeout(function(){window._bDisableCycleFocus=!0;var e=v[0],t=ar.leditor.imageHandler.imageToLine(e),n=ar.leditor.commonNewLineByEnter(t,!0);ar.leditor.setActiveLn(n),k("AndroidApp")&&window.cordova.plugins.Keyboard.show(),window._bDisableCycleFocus=!1},10)}),$("#mobile-image-menu-edit .action-type-below").on("click",function(){window._bDisableCycleFocus=!0,setTimeout(function(){var e=v[0],t=ar.leditor.imageHandler.imageToLine(e),n=ar.leditor.commonNewLineByEnter(t,!1);ar.leditor.setActiveLn(n),k("AndroidApp")&&window.cordova.plugins.Keyboard.show(),self.home.onKeyboardShownSoon(function(){self.leditor.makeLinesVisible(n),window._bDisableCycleFocus=!1})},10)})),ar.leditor.on("indented outdented reposed-lines",function(e){s()}),h.on("click","#img-toolbar .img-btn",function(e){c(this.dataset.name,this)}),k("ChromeApp")&&!k("FakeMobile")&&h[0].addEventListener("mousedown",function(e){var t=$(e.target);return!(!v||e.target!==v[0])||(!!t.hasClass("img-drag-circle")||(!(!p||!p.has(e.target).length)||(l(),!0)))},!0),(k("MobileApp")||k("FakeMobile"))&&h.on("click",function(e){var t=$(e.target);return!(!v||e.target!==v[0])||(!!t.hasClass("img-drag-circle")||(!(!p||!p.has(e.target).length)||(l(),!0)))}),$("#popover-align-image").on("iron-activate",function(e){var t=e.detail.selected,n=ar.leditor.imageHandler.imageToLine(v),i=n.line(),o=Object.create(I.g);o.create(ar.leditor,i.name,{imgAlign:t},function(){ar.leditor.reposImageLine(n)}),o.execute(),ar.leditor.history.add(o),s(),_$("#popover-align-image").close(),e.preventDefault()})}function r(e){var t=$(e);if(v=$(e),!k("MobileApp")&&!k("FakeMobile")){var n=f.offset(),i=t.offset(),o=i.top-n.top,r=i.left-n.left;p=$(C.default.htmlToElement(m)),h.append(p),p.css("left",0);var l=Math.max(o-32,0),s=r+t.outerWidth()/2-p.outerWidth()/2;if(s<0?s=0:s+p.outerWidth()+0>h.outerWidth()&&(s=h.outerWidth()-p.outerWidth()-0),p.css("top",l+"px"),p.css("left",s+"px"),p.css("z-index","1"),(b=$(document.createElement("DIV"))).addClass("img-proxy"),b.css("width",e.offsetWidth+"px"),b.css("height",e.offsetHeight+"px"),b.css("top",o+"px"),b.css("left",r+"px"),h.append(b),N){y=[];for(var c=0;c<4;++c){var d=$(document.createElement("SPAN"));d.addClass("img-drag-circle"),d.data("index",c),y.push(d),h.append(y[c])}a()}var u=ar.leditor.imageHandler.imageToLine(e);return ar.leditor.setActiveLn(u),!0}}function a(){var e=b[0],t=e.offsetLeft,n=e.offsetTop,i=e.offsetWidth,o=e.offsetHeight;y[0].css("top",n-P+"px"),y[0].css("left",t-P+"px"),y[1].css("top",n-P+"px"),y[1].css("left",t+i-P+"px"),y[2].css("top",n+o-P+"px"),y[2].css("left",t+i-P+"px"),y[3].css("top",n+o-P+"px"),y[3].css("left",t-P+"px")}function l(){if(b&&(b.remove(),v=null),y){for(var e=0;e<4;++e)y[e].remove();y=null}w&&(w.remove(),w=null),p&&p.remove()}function s(){if(v&&v.length){var e=v[0];l(),r(e)}}function c(e,t){var n=ar.leditor.imageHandler.imageToLine(v),i=n.line();if("delete"===e)ar.leditor.handleDel(!1);else if("copy"===e){var o=C.default.getSelection();let e=p.find("a[data-name='copy']")[0],t=C.default.selectRangeProxy(o,e);I.t(function(n){C.default.unselectRangeProxy(o,e,t),ar.leditor.handleCopy(n,!1,!0)}),document.execCommand("Copy",!1,null)}else if("view"===e)ar.imgView.cmdViewImage(n);else if("align"===e){var r=$("#popover-align-image")[0];$("#popover-align-image paper-listbox")[0].selected=i.imgAlign,r.togglerElem=t,r.open()}else k("AndroidApp")&&("share"===this.dataset.name?d(v[0]):"view"===this.dataset.name&&u(v[0]))}function d(e){k("AndroidApp")?window.plugins.socialsharing.share(null,null,e.src):console.assert(!1,"not implemented")}function u(e){var t=ar.leditor.imageHandler.imageToLine(e);t.line();ar.imgView.cmdViewImage(t)}n.d(t,"b",function(){return i}),n.d(t,"a",function(){return D});var p,m,f,h,g,v,b,y,w,_=n(19),x=(n.n(_),n(23)),S=(n.n(x),n(20)),k=(n.n(S),n(6)),T=(n.n(k),n(92)),C=n(22),A=n(21),L=(n.n(A),n(91)),I=(n(8),n(97)),E=(n(104),n(176)),N=(n.n(E),!1),P=15,F=".line[data-type='image']"+L.a.CONT_SELECTOR,D=_.extend(Object.create(I.d),{create:function(e){var t=this;_.extend(t,{type:L.a.LineType.IMAGE,leditor:e,el:e.el,$el:e.$el,home:e.home}),t.bindEvents_()},bindEvents_:function(){var e=this;e.leditor;e.$el.on("mousedown",F,function(t){var n=ar.leditor.$findCurLn(this);e.leditor.setActiveLn(n)}),e.$el.on("mousedown",".fly-arrow-cont",function(t){var n=ar.leditor.$findCurLn(this);e.leditor.setActiveLn(n)}),e.$el.on("click",".il-img",function(t){return 1!==t.which||(e.onImageClicked(this),!(k("ChromeApp")&&!k("FakeMobile"))||void 0)}),e.onImageClicked=function(e){if(k("MobileApp")||k("FakeMobile")){v=$(e);var t=ar.leditor.imageHandler.imageToLine(e);ar.leditor.setActiveLn(t),setTimeout(function(){ar.leditor.bEditable?_$("#mobile-image-menu-edit").toggle():_$("#mobile-image-menu-review").toggle()},0)}else l(),r(e)},k("MobileApp")||k("FakeMobile")||e.$el.on("dblclick",".il-img",function(t){var n=e.imageToLine(this);ar.imgView.cmdViewImage(n)})},handleContentKeyDown:function(e,t){var n=this.leditor;t.target,e.length&&e.line();if(8===t.keyCode||46===t.keyCode)n.tryDeleteActiveLine(e),t.preventDefault(),t.stopPropagation();else if(13===t.keyCode){var i=t.shiftKey;n.commonNewLineByEnter(e,i),t.preventDefault(),t.stopPropagation(),l()}else C.default.isCopyKeyEvt(t)&&v&&(I.t(function(e){ar.leditor.handleCopy(e,!1,!0)}),document.execCommand("Copy",!1,null),t.preventDefault(),t.stopPropagation(),!0)},handleNormalPaste:function(e,t){var n=this,i=(n.leditor,!1),o=(t.clipboardData||t.clipboardData).items;if(o){for(var r,a=0;a<o.length;++a){var l=o[a];if(/^image\//.test(l.type)){r=l;break}}if(r){if(n.checkAndPromptMaxImages()){var s=r.getAsFile();n.cmdInsertImage(s).catch(function(e){log.fail(e),C.default.toastShowLongCenter(localString("common_failed_with_reason",C.default.getShowError(e)),"error")})}i=!0}}return i&&t.preventDefault(),i},checkAndPromptMaxImages:function(e,t){var n=this.leditor,i=e||1;return!!n.home.checkMaxImages(n.ldoc.getTotalImages()+i,t)||(C.default.toastShowLongCenter(localString("too_many_pictures_error",n.home.getMaxImageNum()),"error"),!1)},cmdInsertImage:function(e,t,n,i){var o=this,r=o.leditor,a=n||r.makeInsertPos(),l=e.type.replace("image/","");"jpeg"===l&&(l="jpg"),C.default.isImageExtension(l)||(l=A.getExtension(t));var s=r.noteDir,c=A.genHash(16)+"."+l,d=s+"/images/"+c;return S.resolve().then(function(){return S.ninvoke(ar.fileSystem,"saveFile",d,e,e.type)}).then(function(){return k("AndroidApp")?S.delay(1e3):void 0}).then(function(){return C.default.getImageSize(o.makeImageUrl(c))}).then(function(t){var n=r.ldoc.newImageLine(c);return n.imgWidth=t.width,n.imgHeight=t.height,n.size=e.size,ar.bRecording&&ar.bRecordingRealStarted&&(n.time=r.home.getCurAudioTime()),n.imgHeight<L.a.IMG_DEF_ALIGN_LEFT_MAX_HEIGHT&&(n.imgAlign="left"),r.insertLinesAtBestPos(a,[n],i),r.lineToJLine(n)})},makeImageUrl:function(e){var t=this.leditor;return ar.fileSystem.getDirUrl(t.noteDir+"/images")+"/"+e},lineToImage:function(e){var t=this;t.leditor;return t.getImageCont(e).find("img")},imageToLine:function(e){var t=this.leditor,n=$(e).closest(".il-img-cont")[0].dataset.lnName;return t.findLineElem(n)},getImageCont:function(e){return this.leditor.$el.find(x.sprintf(".il-img-cont[data-ln-name='%s']",e.lnName()))},activateLine:function(e,t){console.assert(e.length&&e.line().type===L.a.LineType.IMAGE);var n=this;n.leditor;if(e.length){var i=n.getImageCont(e);i.focus(),i.addClass("il-active")}},clearActiveLns:function(){return this.leditor.$el.find(".il-img-cont").removeClass("il-active")},addSeledLine:function(e){this.getImageCont(e).addClass("il-selected")},removeSeledLine:function(e){this.getImageCont(e).removeClass("il-selected")},clearSeledLines:function(){this.leditor.$el.find(".il-img-cont").removeClass("il-selected")},getImageDir:function(){return this.leditor.noteDir+"/images"},insertLine:function(e,t){var n=this,i=n.leditor,o=I.d.insertLine.call(n,e,t);if(e._bImgTrashed){var r=n.getImageTrashDir()+"/"+e.filename,a=n.getImageDir()+"/"+e.filename;i.addAsyncCmdTask(function(){return S.ninvoke(ar.fileSystem,"moveTo",r,a).then(function(){delete e._bImgTrashed})})}return o},removeLine:function(e){var t=this,n=t.leditor,i=t.getImageCont(e);v&&i.has(v).length&&l();var o=e.line(),r=t.getImageDir()+"/"+o.filename,a=t.getImageTrashDir()+"/"+o.filename;return n.addAsyncCmdTask(function(){return S.ninvoke(ar.fileSystem,"moveTo",r,a)}),o._bImgTrashed=!0,I.d.removeLine.call(this,e)},getImageTrashDir:function(){return ar.tmpDir},toReadableHtml:function(e,t){var n=this;if(n._bGenHtmlEmbedImage){var i=e.line(),o=ar.fileSystem.getDirUrl(n.leditor.noteDir+"/images")+"/"+i.filename;return"<img width='"+(i.imgWidth>L.a.PAD_IMG_MAX_WIDTH?L.a.PAD_IMG_MAX_WIDTH:i.imgWidth<L.a.PAD_IMG_MIN_WIDTH?L.a.PAD_IMG_MIN_WIDTH:i.imgWidth)+"px' src='"+o+"' ></img>"}return n.toReadableText(e)},toReadableText:function(e){var t=e.line();return"[IMAGE]"+(t.filename||t.origFileName)},onResize:function(){s()}})},function(e,t,n){"use strict";function i(e){v=(g=e).$el.find("#edit-wave-bar"),r();var t=_$("#extract-audio-popover-templ");b=Polymer.dom(t).innerHTML,t.parentNode.removeChild(t),t=_$("#insert-rec-popover-templ"),y=Polymer.dom(t).innerHTML,t.parentNode.removeChild(t),ar.settings.bShowEditWave&&(v.show(),$("#wave").trigger("markChanged"),c())}function o(e){e.audioCommit=F.genCommitHash(),e.noteCommit=F.genCommitHash(),g.saveArticle(e)}function r(){function e(e,t,n,i){var o=L.defer(),r=window.localHtml(b,{rt_wnd_title:e,rt_btn_title:t,rt_desc:n||""}),a=$(P.default.htmlToElement(r));return a.appendTo(E.vars.$appBody),a[0].toggle(),a.find(".edit-title").val(i).inputSelectAll(),a.on("iron-overlay-closed",function(){o&&o.reject({result:"Cancel"})}),$(".action-ok",a).on("click",function(){var e=a.find(".edit-title").val()||i;o.resolve({result:"Ok",title:e}),o=null,a[0].toggle()}),o.promise}function t(){if(ar.commits.accountType===ar.AT_Pro)return!0;L.defer();return g.reportAccount(),P.default.messageBox(localString("need_to_be_pro_title"),localString("need_to_be_pro_msg"),{okTitle:localString("view_more_pro_features"),okClass:"btn-success",btnCancel:!0,btnClose:!0},function(e){"Ok"==e&&D.showSettings(g,"purchase")}),!1}$(".action-del",v).on("click",function(){function e(e,t,n){var i=L.defer();let o={path:e,start:t,end:n};return U.deleteAudio(o,(e,t)=>{e?i.reject(e):i.resolve()}),i.promise}var n=ar.markA.position,i=ar.markB.position;P.default.showConfirmPopover({pos:"bottom",btnStyle:"text-danger"},this,localPrintf("edt_rec_del_title",i-n),localString("common_delete"),localString("edt_rec_del_help")).then(function(r){if("Ok"===r&&t()){var c=ar.curArticle,d=g.getNoteDir(c)+"/"+c.audioName;w="Delete",_=c.audioFormat,x=c.audioName,S=n,k=i,ar.wavesurfer.backend.getDuration()-i<.1&&(i=ar.wavesurfer.backend.getDuration()+.1),I("DesktopApp")?(P.default.showFullscreenWaiting(!0),e(d,n,i).then(function(){var e=Object.create(R.a);return e.create(),e.execute(),ar.leditor.removeAbm(n,i,void 0,e),ar.leditor.history.add(e),L.nfcall(g.loadAudio,c)}).then(function(){o(c),g.setMarkA(n),g.setMarkB(ar.wavesurfer.backend.getDuration()),s(w),P.default.toastShowLongCenter(localString("edt_rec_del_succeed"),"info",null,localString("common_undo"),a)},function(e){log.fail(e),l(),P.default.toastShowLongCenter(localString("edt_rec_del_failed",P.default.getShowError(e)),"error")}).finally(function(){P.default.showFullscreenWaiting(!1)})):B.error("unimplemented")}})}),$(".action-trim",v).on("click",function(){function e(e,t,n){var i=L.defer();let o={path:e,start:t,end:n};return U.trimAudio(o,(e,t)=>{e?i.reject(e):i.resolve()}),i.promise}var n=ar.markA.position,i=ar.markB.position;P.default.showConfirmPopover({pos:"bottom",btnStyle:"text-danger"},this,localPrintf("edt_rec_trim_title",i-n),localString("edt_rec_trim_name"),localString("edt_rec_trim_help")).then(function(r){if("Ok"===r&&t()){var c=ar.curArticle,d=g.getNoteDir(c)+"/"+c.audioName;w="Trim",_=c.audioFormat,x=c.audioName,S=n,k=i,ar.wavesurfer.backend.getDuration()-i<.1&&(i=ar.wavesurfer.backend.getDuration()+.1),I("DesktopApp")?(P.default.showFullscreenWaiting(!0),e(d,n,i).then(function(){var e=Object.create(R.a);return e.create(),e.execute(),ar.leditor.removeAbm(0,n,void 0,e),ar.leditor.removeAbm(i,ar.wavesurfer.backend.getDuration()+999.99,void 0,e),ar.leditor.history.add(e),L.nfcall(g.loadAudio,c)}).then(function(){o(c),g.setMarkA(null),g.setMarkB(null),s(w),P.default.toastShowLongCenter(localString("edt_rec_trim_succeed"),"info",null,localString("common_undo"),a)},function(e){log.fail(e),l(),P.default.toastShowLongCenter(localString("edt_rec_trim_failed",P.default.getShowError(e)),"error")}).finally(function(){P.default.showFullscreenWaiting(!1)})):B.error("unimplemented")}})}),$(".action-extract",v).on("click",function(){function n(e,t,n,i){var o=L.defer();let r={path:e,start:t,end:n,targetPath:i};return U.extractAudio(r,(e,t)=>{e?o.reject(e):o.resolve()}),o.promise}var i=ar.curArticle,o=ar.markA.position,r=ar.markB.position;ar.wavesurfer.backend.getDuration()-r<.1&&(r=ar.wavesurfer.backend.getDuration()+.1);var a=A.sprintf("%s_%s-%s",g.getArtTitleShowName(i),g.makeBmTimeStr(o),g.makeBmTimeStr(r));e(localPrintf("edt_rec_extract_title",r-o),localString("edt_rec_extract_name"),"",a).then(function(e){if("Ok"===e.result&&t()){var a=g.getNoteDir(i)+"/"+i.audioName;P.default.showFullscreenWaiting(!0);var l,s=Object.create(O.a);s.create(),g.doNewNote({parentName:i.parentName,title:e.title,ldoc:s}).then(function(e){l=e,g.noteList.makeNoteVisible(l);var t=g.getNoteDir(l)+"/"+i.audioName;if(I("DesktopApp"))return n(a,o,r,t);throw B.error("unimplemented"),"unimplemented"}).then(function(){P.default.toastShowLongCenter(localString("edt_rec_extract_succeed",l.artTitle),"info")},function(e){log.fail(e),P.default.toastShowLongCenter(localString("edt_rec_extract_failed",P.default.getShowError(e)),"error")}).finally(function(){P.default.showFullscreenWaiting(!1)})}})}),$(".action-insert",v).on("click",function(){(function(){var e=L.defer(),t=window.localHtml(y,{}),n=$(P.default.htmlToElement(t));n.appendTo(E.vars.$appBody);var i=ar.markA&&ar.markB&&ar.markB.position-ar.markA.position>.1;return n.find(".action-rec-replace").toggleAttr("disabled",!i),n.find(".action-note-replace").toggleAttr("disabled",!i),n[0].toggle(),n.on("iron-overlay-closed",function(){e&&e.resolve("Cancel")}),$(".action-rec-insert",n).on("click",function(){e.resolve("RecInsert"),e=null,n[0].toggle()}),$(".action-rec-replace",n).on("click",function(){e.resolve("RecReplace"),e=null,n[0].toggle()}),$(".action-note-insert",n).on("click",function(){e.resolve("NoteInsert"),e=null,n[0].toggle()}),$(".action-note-replace",n).on("click",function(){e.resolve("NoteReplace"),e=null,n[0].toggle()}),e.promise})().then(function(e){function n(){N.a.removeListener("onRecordStopped",n),f(),p(a,i,o,r,ar.recordSyncTime)}if("Cancel"!==e&&t()){var i,o,r;if("RecInsert"===e||"RecReplace"===e){"RecInsert"===e?(i=o=g.getCurAudioTime(),r="Insert",T.emit(["start",r])):"RecReplace"===e?(i=ar.markA.position,o=ar.markB.position,r="Replace",T.emit(["start",r])):console.assert(!1),g.setMarkA(null),g.setMarkB(null);var a=ar.curArticle;N.a.addListener("onRecordStopped",n),ar.settings.lastInsertingArtName=a.artName,ar.settings.lastInsertingContType=r,ar.settings.lastInsertingStart=i,ar.settings.lastInsertingEnd=o,g.saveSettings()}else if("NoteInsert"===e||"NoteReplace"===e){"NoteInsert"===e?(i=o=g.getCurAudioTime(),r="Insert"):"NoteReplace"===e?(i=ar.markA.position,o=ar.markB.position,r="Replace"):console.assert(!1);var l=new RegExp(A.sprintf("^(?!%s).*$",ar.curArticle.artName),"");M.a(g,{fileIdFilter:l}).then(function(e){log.assert(1===e.length);var t=g.findLocalArticle(e[0]);u(ar.curArticle,i,o,r,t)})}else log.assert(!1,e)}}).catch(function(e){log.fail(e),P.default.toastShowLongCenter(localString("insert_rec_failed",P.default.getShowError(e)),"error")})}),$(".action-clear-all",v).on("click",function(){P.default.showConfirmPopover({pos:"bottom",btnStyle:"text-danger"},this,localString("edt_rec_clear_all_title"),localString("edt_rec_clear_all_name")).then(function(e){"Ok"===e&&h()})}),$(".action-undo",v).click(function(){a()}),$("#wave",g.$el).on("markChanged",function(){c()}),N.a.addListener("onRecordStarted",function(){g.setMarkA(),g.setMarkB(),c(),l()}),N.a.addListener("onRecordStopped",function(){c()}),N.a.addListener("onArticleSelected",function(){l()}),N.a.addListener("onAudioChanged",function(){c()}),Kefir.merge([Kefir.constant(ar.settings.bWaveScroll),$(".action-zoom-in",v).asStream("click").map(()=>!ar.settings.bWaveScroll)]).onValue(e=>{g.recorder.changeWaveMode(e),$(".action-zoom-in",v).toggleAttr("active",e)})}function a(){var e=ar.curArticle,t=g.getNoteDir(e)+"/"+e.audioName,n=g.getNoteDir(e)+"/"+x,i=!1;L.ninvoke(ar.fileSystem,"moveTo",t,"/tmp_backup_audio.mp3").then(function(){i=!0}).then(function(){return L.ninvoke(ar.fileSystem,"moveTo",H,n)}).then(function(){return console.assert(_&&x),e.audioFormat=_,e.audioName=x,g.saveArticle(e),L.nfcall(g.loadAudio,e)}).then(function(){g.setMarkA(S),g.setMarkB(k),N.a.onAudioChanged(),P.default.toastShowLongCenter(localString("edt_rec_undo_succeed",w)),l()},function(e){log.fail(e),i&&L.ninvoke(ar.fileSystem,"moveTo","/tmp_backup_audio.mp3",t),P.default.toastShowLongCenter(localString("edt_rec_undo_failed",P.default.getShowError(e)),"error")})}function l(){w=null,_=null,x=null,S=null,k=null,$(".action-undo",v).hide()}function s(e){var t=localString("edt_rec_undo",e);$(".action-undo",v).html(t).show(.5)}function c(){var e=g.isAudioEditable(ar.curArticle);if(ar.bRecording)v.find("paper-button").toggleAttr("disabled",!0);else{v.find("paper-button").toggleAttr("disabled",!1);var t=ar.markA&&ar.markB&&ar.markB.position-ar.markA.position>.1;v.find(".action-del").toggleAttr("disabled",!t||!e),v.find(".action-trim").toggleAttr("disabled",!t||!e),v.find(".action-extract").toggleAttr("disabled",!t||!e),v.find(".action-insert").toggleAttr("disabled",!e)}}function d(e,t,n,i,o,r){var a=L.defer();let l={targetPath:e,targetStart:t,targetEnd:n,srcPath:i,srcStart:o,srcEnd:r};return U.insertAudio(l,(e,t)=>{e?a.reject(e):a.resolve(t.insertDur)}),a.promise}function u(e,t,n,i,o){if(console.assert("Insert"===i||"Replace"===i),o.noteCommit){var r=g.getNoteDir(e)+"/"+e.audioName,l=g.getNoteDir(o)+"/"+e.audioName;w="Insert"===i?localString("edt_rec_insert_name"):localString("edt_rec_replace_name"),_=e.audioFormat,x=e.audioName,S=t,k=n,P.default.showFullscreenWaiting(!0);var c;d(r,t,n,l,0,-1).then(function(t){return c=t,L.nfcall(g.loadAudio,e)}).then(function(){return s(w),g.setMarkA(t),g.setMarkB(t+c),"Insert"===i?P.default.toastShowLongCenter(localString("insert_rec_succeeded"),"info",null,localString("common_undo"),a):P.default.toastShowLongCenter(localString("replace_rec_succeeded"),"info",null,localString("common_undo"),a),g.loadArtContent(o).then(function(){return o.ldoc?P.default.messageBoxPromise(localString("merging_note_title"),localString("merging_note_q",g.getArtTitleShowName(o)),{btnCancel:!0,btnOk:!0,cancelTitle:localString("common_no"),okTitle:localString("common_yes")}):"Cancel"})}).then(function(e){if("Ok"===e){var i=o.ldoc.cloneAllLines(!1),r=ar.leditor.makeInsertPos(["append"]);ar.leditor.insertLinesAtBestPos(r,i);var a=ar.leditor.linesToJLines(i);C.each(a,function(e){e.classList.add("inserting")});var l=Object.create(R.a);return l.create(),l.execute(),ar.leditor.removeAbm(t,n,c,l),void ar.leditor.history.add(l)}}).catch(function(e){log.fail(e),P.default.toastShowLongCenter(localString("insert_rec_failed",P.default.getShowError(e)),"error")}).finally(function(){P.default.showFullscreenWaiting(!1)})}else P.default.toastShowLongCenter(localString("insert_rec_no_local_copy",g.getArtTitleShowName(o)),"error")}function p(e,t,n,i,r){console.assert("Insert"===i||"Replace"===i);var l=g.getNoteDir(e)+"/"+e.audioName,c=ar.userDir+"tmp_inserting.mp3";w="Insert"===i?localString("edt_rec_insert_name"):localString("edt_rec_replace_name"),_=e.audioFormat,x=e.audioName,S=t,k=n,P.default.showFullscreenWaiting(!0),d(l,t,n,c,0,-1).then(function(){var i=Object.create(R.a);return i.create(),i.execute(),ar.leditor.removeAbm(t,n,r,i),ar.leditor.history.add(i),o(e),L.nfcall(g.loadAudio,e)}).then(function(){s(w),g.setMarkA(t),g.setMarkB(t+r),"Insert"===i?P.default.toastShowLongCenter(localString("insert_rec_succeeded"),"info",null,localString("common_undo"),a):P.default.toastShowLongCenter(localString("replace_rec_succeeded"),"info",null,localString("common_undo"),a)},function(e){log.fail(e),P.default.toastShowLongCenter(localString("insert_rec_failed",P.default.getShowError(e)),"error")}).finally(function(){P.default.showFullscreenWaiting(!1)})}function m(){if(ar.settings.lastInsertingArtName)if(ar.curArticle&&ar.curArticle.artName===ar.settings.lastInsertingArtName){var e=ar.curArticle,t=ar.settings.lastInsertingStart,n=ar.settings.lastInsertingEnd,i=ar.settings.lastInsertingContType;f();p(e,t,n,i,0)}else f()}function f(){delete ar.settings.lastInsertingArtName,delete ar.settings.lastInsertingContType,delete ar.settings.lastInsertingStart,delete ar.settings.lastInsertingEnd,g.saveSettings()}function h(){var e=ar.curArticle,t=g.getNoteDir(e)+"/"+e.audioName;L.ninvoke(ar.fileSystem,"removeFile",H).catch(function(){}).then(function(){return L.ninvoke(ar.fileSystem,"moveTo",t,H)}).then(function(){return _=e.audioFormat,x=e.audioName,w="Clear All",S=ar.markA?ar.markA.position:null,k=ar.markB?ar.markB.position:null,g.emptyRecording(e)}).then(function(){var t=ar.wavesurfer.backend.getDuration(),n=Object.create(R.a);return n.create(),n.execute(),ar.leditor.removeAbm(0,t,void 0,n),ar.leditor.history.add(n),L.nfcall(g.loadAudio,e)}).then(function(){N.a.onAudioChanged(),g.setMarkA(null),g.setMarkB(null),P.default.toastShowLongCenter(localString("edt_rec_clear_all_succeed"),"info",null,localString("common_undo"),a),s(w)},function(e){l(),log.fail(e),P.default.toastShowLongCenter(localString("edt_rec_clear_all_failed",P.default.getShowError(e)),"error")})}n.d(t,"b",function(){return i}),n.d(t,"d",function(){return m}),n.d(t,"a",function(){return h}),n.d(t,"c",function(){return j});var g,v,b,y,w,_,x,S,k,T,C=n(19),A=(n.n(C),n(23)),L=(n.n(A),n(20)),I=(n.n(L),n(6)),E=(n.n(I),n(8)),N=n(92),P=n(22),F=n(21),D=(n.n(F),n(91),n(102)),M=n(182),O=n(101),R=n(98),U=n(24),B=log.reg("editWave"),H="/tmp_undo_audio.mp3",j=Kefir.stream(function(e){return T=e,function(){}})},function(e,t,n){"use strict";function i(){function e(e,t){I.acId=e.acId;I.pc=new k(null,{optional:[]}),I.pc.onicecandidate=function(e){l({candidate:e.candidate})},L&&(I.pc.onaddstream=function(e){if(console.debug("recv stream:",e.stream),!I.streamPlayer){var t=document.createElement("audio");t.id="capturer-stream-player",$("#home-main").append(t),I.streamPlayer=t}I.streamPlayer.src=URL.createObjectURL(e.stream),I.streamPlayer.play()}),I.pc.ondatachannel=function(e){console.debug("ondatachannel:",e),console.assert(ar.remoteAudioBufferSampleRate),I.receiveChannel=e.channel,I.receiveChannel.onerror=function(e){console.log("Data Channel Error:",e)},I.receiveChannel.onmessage=function(e){if(e.data instanceof ArrayBuffer&&ar.bRecording&&"RemoteAudioBuffer"===ar.audioInputName){var t=e.data,n=new Float32Array(t),i=Math.abs(n[0]);S.chromeOnRemoteWaveData(t,i)}},I.receiveChannel.onopen=function(){console.log("data channel opened"),I.bDataChannelOpened=!0,r()},I.receiveChannel.onclose=function(){console.log("The Data Channel was Closed"),I.bDataChannelOpened=!1}},window._m=I,I.bInited=!0,t({result:"success"})}b("ChromeApp")&&chrome.runtime.onMessageExternal.addListener(function(t,n,i){if(I.acId&&n.id!==I.acId)log.debug("ignore message from: ",n.id);else if("init"===t.name)e(t,i);else if("ready"===t.name)o(i);else if("close"===t.name)a(i);else{if(!I.pc||"close"===I.pc.iceConnectionState)return void log.debug("peer connection is not ready, ignore message.");t.sdp?(ar.remoteAudioBufferSampleRate=t.sampleRate,I.curSourceName=t.sourceName,I.pc.setRemoteDescription(new C(t.sdp),function(){console.debug("setRemoteDescription"),I.pc.createAnswer(function(e){I.pc.setLocalDescription(e,function(){console.debug("setLocalDescription"),A?l({sdp:e}):i({sdp:e})})})})):t.candidate&&I.pc.addIceCandidate(new T(t.candidate))}})}function o(e){I.bRemoteReady=!0,e({result:"success"}),r()}function r(){I.bRemoteReady&&I.bDataChannelOpened&&(I.bRemoteAudioBuffer=!0,y.a.onCapturerConnected())}function a(e){I.streamPlayer&&(I.streamPlayer.parentNode.removeChild(I.streamPlayer),I.streamPlayer=null),I.bRemoteReady=!1,I.bRemoteAudioBuffer=!1,y.a.onCapturerDisconnected()}function l(e,t,n){var i=n||I.acId;console.debug("send",e),chrome.runtime.sendMessage(i,e,function(e){t&&t(e)})}function s(e){f=e,i()}function c(){return I.curSourceName}function d(){return I.bRemoteAudioBuffer}function u(e){v.defer();l({name:"echo"},function(t){log.debug("echo back:",t),e("echo"===t?!0:!1)},_.AC_ID_FOR_CHECK)}function p(){var e="https://chrome.google.com/webstore/detail/"+_.AC_ID_FOR_CHECK;Object(x.openExternalLink)(e)}function m(e){l({name:"uninstall"},function(n){log.debug("uninstall back:",n),e&&(e("cancel"),e=null),t&&(clearTimeout(t),t=null)},_.AC_ID_FOR_CHECK);var t=setTimeout(function(){e&&u(function(t){e&&t?e("unknown"):e&&!t&&e("success"),e=null})},1e3)}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return s}),n.d(t,"getCurSourceName",function(){return c}),n.d(t,"isRemoteAudioReady",function(){return d}),n.d(t,"isCapturerInstalled",function(){return u}),n.d(t,"installCapturer",function(){return p}),n.d(t,"uninstallCapturer",function(){return m});var f,h=n(19),g=(n.n(h),n(23)),v=(n.n(g),n(20)),b=(n.n(v),n(8),n(6)),y=(n.n(b),n(92)),w=(n(22),n(21)),_=(n.n(w),n(7)),x=(n.n(_),n(91),n(24)),S=n(135),k=window.RTCPeerConnection||window.webkitRTCPeerConnection,T=window.RTCIceCandidate||window.webkitRTCIceCandidate,C=window.RTCSessionDescription||window.webkitRTCSessionDescription,A=!0,L=!0,I={acId:null,bRemoteAudioBuffer:!1,curSourceName:"",streamPlayer:null,bDataChannelOpened:!1}},,function(e,t,n){"use strict";function i(){function e(){return{version:le,artName:null,artTitle:"",type:"Note",parentName:null,cDate:null,mDate:null,bTrash:!1,bDirectTrash:!1,folderSyncCommit:null,folderCommit:null,gdrive:{},ldoc:null,audioName:"audio.mp3",audioFormat:g.a.AUDIO_FMT_MN,noteCommit:null,noteSyncCommit:null,noteCommitMd5:"INVALID",artCommit:null,artSyncCommit:null,audioCommit:null,audioSyncCommit:null,commitMapCloud:null,commitMapApp:null,audioDate:null,audioKey:null,audioSize:0,audioTime:0,usedImages:[],vDate:new Date,bkgrdImgShowName:"",bkgrdImgFileName:"",bFixImageUrl:!1,aeNoteSyncCommit:null,aeFolderSyncCommit:null,lastPlayPos:0,lastViewMode:tn.VM_Text,lastShareLink:null}}function t(){return{artName:null,artTitle:"",type:"Folder",parentName:null,cDate:null,mDate:null,bTrash:!1,bDirectTrash:!1,folderSyncCommit:null,folderCommit:null,gdrive:{},aeFolderSyncCommit:null}}function i(){return{devVersion:ae,accountType:tn.AT_Free,freePlan:"N/A",artListMDate:null,artListCommit:null,artListSyncCommit:null,gdrive:{},gdriveDeledFileIds:[],commitList:[],localChanges:[],serverChangesFileId:null,aeCommitList:[],lastMergedCommit:null,lastMergedDate:null,trialEndDate:null}}function o(){return{speechLang:"en-US",bRecordDefOnServer:!1,bRecordListActive:!1,lastArticleName:"",lastFolderName:"",bWaveScroll:!1,bRemoveAd:!1,bSmartB:!1,bInsertAbmOnNewLine:!0,gain:v.default.getDefaultGainLevel(),offsetAbmTime:0,cloudProvider:"Disable",bAutoSync:!y("MobileApp"),backupType:"MicNote",tips:{},numSeekByClick:0,bAutoNewNote:!1,bContRecMarker:!1,bWifiOnly:!!y("MobileApp"),exports:{},autoExpProvider:"Disable",bAutoExpMicnote:!0,bAutoExpRecording:!1,bAutoExpPdf:!1,bAutoExpGDoc:!1,bAutoExpHtml:!1,bAutoExpWithAbm:!0,autoExpFolderPath:"/Mic Note Exports",gdriveAutoExpFolderId:null,lastSeledTabInSettings:"cn"===d.market?"general":"sync",bHideNoteList:!1,bHideWaveBar:!1,lastSharedFilePaths:[],bEmailRec:!0,bEmailNotes:!0,emailNoteToHistory:[],emailNoteSenderEmail:null,shareFolderProvider:"GDrive",shareFolderId:null,shareFolderShowPath:"/"+localString("def_share_folder_name"),lastPlaySpeed:.6,rewindSpeed:3,ivSettings:{},bTransOnAir:!1,fontSizeName:"middle",bmStrings:[{colorIdx:1,string:localString("bm_def_1")},{colorIdx:2,string:localString("bm_def_2")},{colorIdx:3,string:localString("bm_def_3")}],noteListWidth:240,bAgreeGenShareLink:!1,shareLinkShareType:"Full"}}function u(){return{version:le,title:"",usedImages:[],audioName:"audio.mp3"}}function I(e){tn.uid=e,tn.userDir=Ge(e)+"/",tn.tmpDir=tn.userDir+"temp"}function E(e,t,n,i){tn.signInType=e,tn.signInUserId=t,tn.signInUserEmail=n,tn.signInShowName=i,L.updateSignInShowName()}function N(){var e=Object.create(H.a);e.create();var t=localString("home_welcome_content").split("<br>");p.each(t,function(t){var n=e.newTextLine();n.content=t,e.append(n)});return Me({title:localString("home_welcome_title"),ldoc:e}).then(function(e){return e})}function M(){var e=tn.tmpDir+"/Sample.micnote";return f.resolve().then(function(){log.info("add sample note");var t=f.defer(),n=new XMLHttpRequest;return n.open("GET","Sample.micnote",!0),n.withCredentials="true",n.setRequestHeader("X-CSRF-TOKEN",window.loginCsrf),n.responseType="arraybuffer",n.addEventListener("load",function(i){if(200===n.status||y("Node")&&0===n.status){var o=i.target.response;tn.fileSystem.saveFile(e,o,"application/octet-stream",function(e){e?pe.fail(ue,"download sample note failed"):t.resolve()})}else pe.error(ue,"fetching sample.micnote failed",n.statusText),t.reject(n.statusText)}),n.addEventListener("error",function(e){pe.fail(ue,e),t.reject(e)}),n.send(),t.promise}).then(function(){return w.d(e,"Root")})}function V(){var e;return N().then(function(t){return e=t,M()}).then(function(){return e}).catch(log.fail)}function G(e){tn.curArticle&&(e?$("#text-saving").text(localString("note_modified")):$("#text-saving").text(localString("note_all_changes_saved")))}function se(e){var t=tn.curArticle;if(t.ldoc){t.mDate=new Date,t.artCommit=b.genCommitHash(),t.noteCommit=b.genCommitHash(),t.noteCommitMd5="INVALID";var n=tn.leditor.getCommit();qe(t).then(function(){n===tn.leditor.getCommit()&&tn.leditor.setModified(!1),xt(function(){tn.artDateChanged.emit(t),e&&e()})}),ce(t)}else pe.error(ue,"null ldoc")}function ce(e){var t=!e||!e.ldoc||0===e.ldoc.getTotalChars();$("#view-togglers .action-text").toggleClass("highlight",!t)}function me(){tn.curArticle?$("#note-bottom-bar .text-modified-date").text(localString("bottom_modified_date",tn.curArticle.mDate.toLocaleString())):$("#note-bottom-bar .text-modified-date").text("")}function fe(e,t,n){e===tn.VM_Text?(t?($("#photo-view").hide(),$("#text-view").show()):($("#photo-view").fadeOut(),$("#text-view").fadeIn()),nn.find(".action-text").hide(),nn.find(".action-photo").show()):e===tn.VM_Photo?(t?($("#photo-view").show(),$("#text-view").hide()):($("#photo-view").fadeIn(),$("#text-view").fadeOut()),tn.pview.enter(),nn.find(".action-text").show(),nn.find(".action-photo").hide(),$("#photo-view .action-take-photo").css("bottom",0)):console.assert(!1),tn.curViewMode=e,!n&&tn.curArticle&&(tn.curArticle.lastViewMode=e,Xe(tn.curArticle))}function he(e){pe.info(ue,"notifyInitReady: "+e),"Main"==e?tn.bMainReady=!0:"Editor"==e?tn.bEditorReady=!0:"FileSystem"==e&&(tn.bFSReady=!0),tn.bMainReady&&tn.bEditorReady&&tn.bFSReady&&Xt()}function ge(e){console.assert(!1)}function ve(e){tn.settings.bHideWaveBar=void 0===e?!tn.settings.bHideWaveBar:e,mn.saveSettings(),$(".mini-wave-bar-toggler").attr("icon",tn.settings.bHideWaveBar?"unfold-less":"unfold-more").toggleAttr("active",tn.settings.bHideWaveBar).attr("aria-checked",tn.settings.bHideWaveBar),tn.settings.bHideWaveBar?($("#wave-bar").fadeOut("fast"),$("#mini-wave-bar").show("fast"),tn.settings.bShowEditWave&&$("#edit-wave-bar").fadeOut("fast"),tn.settings.bShowTrans&&z.k(mn.transView,!1)):($("#wave-bar").fadeIn("fast"),$("#mini-wave-bar").hide("fast"),tn.settings.bShowEditWave&&$("#edit-wave-bar").fadeIn("fast"),mn.transView&&tn.settings.bShowTrans&&z.k(mn.transView,!0)),tn.wavesurfer.drawer.redraw(),yt()}function be(e){var t=$("#edit-wave-bar"),n=void 0===e?!tn.settings.bShowEditWave:e;tn.settings.bHideWaveBar&&ve(!1),t.css("z-index","1").fadeTo("fast",n?1:0,function(){$(this).css("z-index","auto"),t.toggle(n)}),tn.settings.bShowEditWave=n,Et(),n||(W.setMarkA(),W.setMarkB()),W.changeWaveMode(!!n&&tn.bWaveScroll),we(),yt()}function ye(e){var t=mn.transView.$el,n=void 0===e?!tn.settings.bShowTrans:e;tn.settings.bHideWaveBar&&ve(!1),t.css("z-index","1").fadeTo("fast",n?1:0,function(){$(this).css("z-index","auto"),z.k(mn.transView,n,!0)}),tn.settings.bShowTrans=n,Et(),we(),yt()}function we(){var e=tn.settings.bShowTrans||tn.settings.bShowEditWave;mn.$el.find(".repeat-bar").hide(),e&&tn.settings.bShowEditWave?$("#edit-wave-bar").find(".repeat-bar").show():e&&tn.settings.bShowTrans&&mn.transView.$el.find(".repeat-bar").show()}function _e(e){var t=f.defer();if(e&&e.items&&e.items.length){var n=e.items[0].entry,i=Vt(),o=Tt(i),r="Root"===i?"/":o.artTitle;v.default.messageBox(localString("open_file"),localString("must_import_first",n.name,n.name,r),{btnOk:!0,btnCancel:!0,okTitle:"Import"},function(e){"Ok"===e&&n.file(function(e){l.importMicnotes([{blob:e,title:n.name}]).then(t.resolve,t.reject)},function(){v.default.toastShowLongCenter(localString("open_file_failed"),"error"),t.reject("error")})})}else t.resolve();return t.promise}function xe(){let e;return T.b().then(function(){var e=f.defer();return window._serverNewVersion?y("MobileApp")||y("FakeMobile")||y("Node")?v.default.getAppSettings().lastPromptedVer==window._serverNewVersion?e.resolve():(v.default.getAppSettings().lastPromptedVer=window._serverNewVersion,v.default.saveAppSettings(),X.hasUpdateAppLink()?v.default.toastShowLongCenter(localString("av_found_new_ver",window._serverNewVersion),"info",null,localString("toast_update_app"),function(){X.openUpdateAppLink()}):v.default.toastShowLongCenter(localString("av_found_new_ver",window._serverNewVersion),"info")):y("ChromeApp")?(pe.log("new version available:",window._serverNewVersion),e.resolve()):(pe.assert(!1),e.resolve()):e.resolve(),e.promise}).then(function(){(y("MobileApp")||y("FakeMobile")||y("Node"))&&window._serverNewVersion&&window._serverNewVersion!=b.getMajorVersion(d.CLIENT_VERSION)&&$("#menu-update-app").show()}).then(function(){var t=f.defer(),n=v.default.getAppSettings();return tn.commits.accountType=n.loginAccountType,tn.commits.freePlan=n.loginFreePlan,tn.commits.proPlan=n.loginProPlan,tn.commits.trialEndDate=n.loginTrialEndDate,kt(),E(n.loginSignInType,n.loginSignInUserId,n.loginSignInUserEmail,n.loginSignInShowName),Lt(),n.bRestartAfterTryingBuyPro&&n.loginAccountType===tn.AT_Pro&&n.loginProPlan!==tn.PP_Trial?v.default.messageBox(localString("welcome_pro_title"),localString("welcome_pro_msg"),{},function(){delete n.bRestartAfterTryingBuyPro,v.default.saveAppSettings(),t.resolve()}):t.resolve(),Se(),e=(n.loginSignInUserEmail||"No Email")+", "+n.loginAccountType+", ",n.loginAccountType==tn.AT_Pro?e+=n.loginProPlan:e+=n.loginFreePlan,t.promise}).then(function(){var e=v.default.getAppSettings();void 0!==e.forceSettings.bDisableSpellCheck&&(tn.settings.bDisableSpellCheck=e.forceSettings.bDisableSpellCheck),Et(),x.default.applySpellCheck(!0)}).then(function(){return"GDrive"===tn.settings.cloudProvider&&"appdata"===tn.settings.syncFolderId?C.tryFixGDriveInAppFolder().then(function(e){return"not-found"===e?C.tryUpgradeGDriveInAppFolder():void 0}):void 0}).then(()=>{tn.bottomMsgType=window.ar_bottomMsgType,tn.bottomMsgBody=window.ar_bottomMsgBody,tn.bottomMsgArg=window.ar_bottomMsgArg,delete window.ar_bottomMsgType,delete window.ar_bottomMsgBody,delete window.ar_bottomMsgArg,It(),log.info("Account:",e)}).catch(e=>{if("version-too-low"===e){let e=$("#mb-app-ver-too-low");X.hasUpdateAppLink()||e.find(".action-update").hide(),$(".action-update",e).on("click",e=>{X.openUpdateAppLink()}),e.showModal()}else log.fail("online login failed",e)})}function Se(){var e=Pe("Note"),t=Fe();$.ajax({url:v.default.makeApiUrl("/api/report-account"),type:"POST",xhrFields:{withCredentials:!0},data:{noteNum:e,maxAudioTime:t.maxTime,totalAudioTime:t.totalTime,totalImages:t.totalImages,userAgent:navigator.userAgent,osName:v.default.getOSName(),syncProvider:tn.settings.cloudProvider,autoExpProvider:tn.settings.autoExpProvider,bAutoExpMicnote:"Disable"!==tn.settings.autoExpProvider&&tn.settings.bAutoExpMicnote,bAutoExpRecording:"Disable"!==tn.settings.autoExpProvider&&tn.settings.bAutoExpRecording,bAutoExpPdf:"Disable"!==tn.settings.autoExpProvider&&tn.settings.bAutoExpPdf,bAutoExpGDoc:"Disable"!==tn.settings.autoExpProvider&&tn.settings.bAutoExpGDoc,bAutoExpHtml:"Disable"!==tn.settings.autoExpProvider&&tn.settings.bAutoExpHtml,version:d.CLIENT_VERSION}}).done(function(e){"upgrade-for-free"===e?v.default.messageBox(localString("upgrade_for_free_title"),localString("upgrade_for_free_msg"),{},function(){}):"signin-for-free"===e&&v.default.messageBox(localString("signin_for_free_title"),localString("signin_for_free_msg"))}).fail(function(e){pe.error(ue,e.responseText)})}function ke(){function e(){tn.stopAutoSaveCb?tn.stopAutoSaveCb.call():tn.nextAutoSaveTimerId=setTimeout(ke,re)}console.assert(!tn.bAutoSaving),tn.nextAutoSaveTimerId=null,tn.curArticle&&tn.curArticle.ldoc?f.resolve().then(function(){if(tn.leditor.autoSave(),tn.leditor.isModified()){var e=f.defer();if(!tn.curArticle.artTitle){var t=tn.leditor.getSuggestedTitle();"string"==typeof t&&Nt(tn.curArticle,t)}return tn.bAutoSaving=!0,se(function(){tn.bAutoSaving=!1,e.resolve()}),e.promise}}).then(function(){return Te()}).then(function(){e()}):e()}function Te(){var e=tn.curArticle;if(!e||e.lastEditorState&&!tn.leditor.isEditorStateChanged(e.lastEditorState))return f.resolve();var t=tn.leditor.saveEditorState();return e.lastEditorState=t,Je(e)}function Ce(){tn.bAutoSaveStarted||(tn.bAutoSaveStarted=!0,ke())}function Ae(e){tn.nextAutoSaveTimerId&&clearTimeout(tn.nextAutoSaveTimerId),tn.bAutoSaving?tn.stopAutoSaveCb=function(){tn.bAutoSaveStarted=!1,tn.stopAutoSaveCb=null,e()}:(tn.bAutoSaveStarted=!1,e())}function $e(e,t){if(!e||H.a.isPrototypeOf(e)){var n=t&&ze(t);tn.leditor.setModel(e,n),Ot()}else console.warn("setComposerValue: not a LineDoc, ignored")}function Le(){return tn.commits.accountType===tn.AT_Pro?ie:(tn.commits.accountType,tn.AT_Edu,ne)}function Ie(){return Y&&tn.commits.accountType!==tn.AT_Pro?tn.commits.accountType===tn.AT_Edu?ee:Q:Z}function Ee(e,t){return!(Y&&e>Ie())||(t||(Se(),v.default.messageBox(localString("home_out_of_art_num"),localString("home_out_of_art_prompt",Ie()),{okTitle:localString("view_more_pro_features"),okClass:"btn-success",btnCancel:!0,btnClose:!0},function(e){"Ok"==e&&k.showSettings(mn,"purchase")})),!1)}function Ne(e,t,n){var i=[];return tn.lsArticles.forEach(function(o){o.parentName!==e||!n&&o.bTrash||("Note"===o.type?i.push(o):i=i.concat(Ne(o.artName,t)))}),i}function Pe(e,t){var n=0;return tn.lsArticles.forEach(function(i){e&&i.type!==e||i.bTrash&&!t||n++}),n}function Fe(){var e=0,t=0,n=0;return tn.lsArticles.forEach(function(i){!i.bTrash&&"Note"===i.type&&i.audioTime&&(i.audioTime>e&&(e=i.audioTime),t+=i.audioTime),i.bTrash||"Note"!==i.type||(n+=i.usedImages.length)}),{maxTime:e,totalTime:t,totalImages:n}}function De(e){var t=tn.userDir+e;return f.ninvoke(tn.fileSystem,"createDir",t).then(function(){return f.ninvoke(tn.fileSystem,"createDir",t+"/images")}).then(function(){return y("AndroidApp")?f.resolve().then(function(){var e=t+"/.nomedia";return v.default.createEmptyFile(e).then(function(){},function(e){pe.fail(ue,"create .nomedia file failed")})}).then(function(){var e=t+"/images/.nomedia";return v.default.createEmptyFile(e).then(function(){},function(e){pe.fail(ue,"create .nomedia file failed")})}):void 0})}function Me(t){var n=t||{},i=b.genHash(16);if(n.bCheckNoteNum&&!Ee(Pe("Note")+1))return f.reject("out-of-note-num");var o;return f.resolve().then(function(){return De(i)}).then(function(){var t=new Date;(o=p.defaults({artName:i,type:"Note",parentName:n.parentName||"Root",cDate:new Date(t),mDate:new Date(t),folderCommit:b.genCommitHash(),noteCommitMd5:"INVALID",artCommit:b.genCommitHash(),ldoc:n.ldoc,audioCommit:n.audioCommit||g.a.NEW_AUDIO_COMMIT,recordListCommit:b.genCommitHash(),recordListMDate:new Date,artTitle:n.title||""},e())).noteCommit=n.ldoc?b.genCommitHash():null,y("AndroidApp")&&(o.audioName=tn.AUDIO_NAME),st(o),o.ldoc&&qe(o),Xe(o)}).then(function(){var e="/Caches/"+at(),t=tn.userDir+i+"/"+o.audioName;return f.ninvoke(tn.fileSystem,"copyTo",e,t)}).then(function(){return o})}function Oe(e,t){var n,i;if($.isArray(e)?(n=e[0],i=e[1]):n=e,null!==n&&tn.infoBar.html(n),i?(tn.infoBar.attr("role","alert"),tn.infoBar.attr("aria-label",i)):tn.infoBar.removeAttr("role"),tn.infoBar.css("visibility","visible"),on&&(clearTimeout(on),on=null),void 0===t&&(t=Qt),t>=0&&(on=setTimeout(function(){tn.infoBar.fadeOut("fast",function(){$(this).show().css({visibility:"hidden"})}),h.isXSmall()&&$("#sync-info-bar").fadeOut("fast")},t)),h.isXSmall()&&"NoteList"===tn.curMainScreen){var o=$("#sync-info-bar");o.is(":visible")||o.fadeIn("fast"),n&&o.find(">span").html(n)}}function Re(e){on&&(clearTimeout(on),on=null),tn.infoBarUser=e,tn.infoBarStableStrings[e]&&Be(e,tn.infoBarStableStrings[e])}function Ue(e){tn.infoBarUser===e&&(tn.infoBarUser=null,Oe(null,Zt),tn.infoBarStableStrings[e]="")}function Be(e,t){tn.infoBarStableStrings[e]=t,tn.infoBarUser===e&&Oe(t,-1)}function He(e,t){tn.infoBarStableStrings[e]=t,tn.infoBarUser===e&&Oe(m.sprintf("<span class='text-danger'>%s</span>",t),-1)}function je(e){return"wav"==b.getExtension(e).toLowerCase()?"audio/wav":"audio/mpeg"}function We(e,t,n){tn.storage.save(tn.uid+"_"+e,t,n)}function Ve(e,t,n){tn.storage.load(tn.uid+"_"+e,t,n)}function Ge(e){return"/Caches/"+e}function ze(e){return tn.userDir+e.artName}function qe(e){console.assert(e&&e.ldoc);var t=ze(e)+"/content.json",n=e.ldoc.save();return f.ninvoke(tn.fileSystem,"saveFile",t,n,"application/json")}function Ke(e){var t=ze(e)+"/properties.json",n=p.defaults({version:le,title:e.artTitle,audioName:e.audioName,audioFormat:e.audioFormat,audioSize:e.audioSize,audioTime:e.audioTime,bEmptyAudio:e.audioCommit===g.a.NEW_AUDIO_COMMIT},u()),i=JSON.stringify(n);return f.ninvoke(tn.fileSystem,"loadDir",tn.userDir+e.artName).then(function(){return f.ninvoke(tn.fileSystem,"saveFile",t,i,"application/json")})}function Xe(e,t){xt(t)}function Je(e){var t=f.defer();return Xe(e,function(){t.resolve()}),t.promise}function Ye(e){t="";if(e)var t=Wt(e);var n=$("#note-title");""===t?n.html("&nbsp;"):n.text(t),n[0].title=t,n.attr("aria-label",localString("aria_note_title_btn",t))}function Qe(){if(!y("Node")){var e=v.default.getAppSettings();e.nextRateDate||(e.nextRateDate=new Date((new Date).getTime()+864e5),v.default.saveAppSettings()),(d.DEBUG_RATE_ME||J&&e.bPromptRateMe&&e.lastRateVer!=d.CLIENT_VERSION&&e.nextRateDate<new Date)&&($("#modal-rate-me .text-prompt").html(localString("home_reate_me_prompt",d.CLIENT_VERSION)),$("#modal-rate-me").showModal(),$("#modal-rate-me paper-button").on("click",function(){"rate"===this.dataset.name?(X.openRateAppLink(),e.nextRateDate=new Date((new Date).getTime()+7776e6),e.lastRateVer=d.CLIENT_VERSION):"later"===this.dataset.name?e.nextRateDate=new Date((new Date).getTime()+6048e5):e.bPromptRateMe=!1,v.default.saveAppSettings()}))}}function Ze(e){Ae(function(){if(tn.curArticle&&tn.leditor.bEditable&&tn.curArticle===tn.composerArticle){tn.curArticle.ldoc;tn.leditor.autoSave(),tn.leditor.isModified()?se(function(){e()}):e()}else e()})}function et(){if(tn.curArticle){var e=tn.curArticle;return it(null).then(function(){return it(e)})}return f.resolve()}function tt(e){if(e.ldoc)return f.resolve();var t=ze(e)+"/content.json";return f.ninvoke(tn.fileSystem,"loadFile",t,{type:"Text"}).then(function(t){var n=Object.create(H.a);if(!n.load(t))throw"load ldoc error";e.ldoc=n},function(t){var n=ze(e)+"/content.html";return f.ninvoke(tn.fileSystem,"loadFile",n,{type:"Text"}).then(function(t){return log.info("upgrade content.html to line doc:",e.artTitle),H.c(mn,t,ze(e))}).then(function(t){return e.ldoc=t,qe(e)}).then(function(){e.noteCommit=b.genCommitHash(),e.noteCommitMd5="INVALID",e.artCommit=b.genCommitHash(),Xe(e)})})}function nt(e){return f.resolve().then(function(){return f.ninvoke(tn.fileSystem,"loadDir",tn.userDir+e.artName).catch(function(e){throw g.a.FIX_FS_LOST_BUG?"cache-lost":e})}).then(function(){return f.ninvoke(tn.fileSystem,"loadDir",ze(e)+"/images").catch(function(){log.warn("no images directory")})})}function it(e){var t=f.defer();return tn.markA=null,tn.markB=null,$("#wave").trigger("markChanged"),rn(!1,!0),$e(null,null),$("#text-saving").text(""),W.wavesurferLoad(null),Ye(e),W.updatePlayPauseIcon(!0),mn.transView&&z.a(mn.transView,1),e?(tn.settings.lastTryLoadArtName=e.artName,Et(),f.resolve().then(function(){if(ot(e))throw"cache-lost"}).then(function(){return nt(e)}).then(function(){return e.version<2?f.resolve().then(function(){return f.ninvoke(tn.fileSystem,"createDir",mn.getNoteDir(e)+"/images")}):void 0}).then(function(){if(e.version<5){null===e.audioName&&(e.audioName=tn.DEF_AUDIO_NAME);var t=ze(e)+"/content.html";return f.ninvoke(tn.fileSystem,"loadFile",t,{type:"Text"}).then(function(t){return log.info("upgrade content.html to line doc:",e.artTitle),H.c(mn,t,ze(e))}).then(function(t){return e.ldoc=t,qe(e)}).then(function(){e.noteCommit=b.genCommitHash(),e.noteCommitMd5="INVALID",e.artCommit=b.genCommitHash()})}}).then(function(){if(e.version>le)throw"version-too-new";e.version!==le&&(log.info("art was upgraded from",e.version,"to",le),e.version=le,Xe(e))}).then(function(){return e.ldoc=null,tt(e)}).then(function(){return f.nfcall(W.loadAudio,e)}).then(function(){tn.composerArticle=e,e.ldoc||(e.ldoc=Object.create(H.a),e.ldoc.create(),log.debug("note content was updated to line doc")),$e(e.ldoc,e)}).then(function(){e.lastPlayPos>=0&&e.lastPlayPos<tn.wavesurfer.backend.getDuration()&&tn.wavesurfer.seekTo(e.lastPlayPos/tn.wavesurfer.backend.getDuration()),tn.settings.lastTryLoadArtName=null,Et(),Ce(),tn.settings.lastArticleName=e.artName,Et()}).then(function(){if(g.a.ENABLE_PHOTO_VIEW){var t=ze(e)+"/images",n=[];p.each(e.ldoc.lines,function(e){e.type===g.a.LineType.IMAGE&&n.push({name:e.name,filename:e.filename,origFileName:e.filename,width:e.imgWidth,height:e.imgHeight,time:e.time})}),tn.pview.setModel(n,t),fe(e.lastViewMode,!0,!0),ce(e)}}).then(function(){q.isRemoteAudioReady()&&Pt()}).then(function(){rn(!0),y("ChromeApp")||e.lastEditorState&&tn.leditor.restoreEditorState(e.lastEditorState),t.resolve()},function(e){rn(!1,!1),t.reject(e)}),t.promise):(tn.composerArticle=null,t.resolve(),rn(!1,!1),tn.settings.lastArticleName=null,Et(),t.promise)}function ot(e){return console.assert(e&&"Note"===e.type),null===e.noteCommit&&null===e.noteSyncCommit}function rt(){return f.resolve().then(function(){return f.ninvoke(tn.fileSystem,"createDir","/Caches")}).then(function(){return f.ninvoke(tn.fileSystem,"createDir",tn.userDir)}).then(function(){return f.ninvoke(tn.fileSystem,"createDir",tn.tmpDir)}).then(function(){pe.info(ue,"copy empty audio");var e=f.defer(),t=new XMLHttpRequest;let n=at();return t.open("GET",n,!0),t.withCredentials="true",t.setRequestHeader("X-CSRF-TOKEN",window.loginCsrf),t.responseType="arraybuffer",t.addEventListener("load",function(t){var n=t.target.response,i="/Caches/"+at(),o=je(i);tn.fileSystem.saveFile(i,n,o,function(t){t?(pe.fail(ue,"download empty audio failed"),e.reject()):(pe.log(ue,"empty audio is copied to: "+i),e.resolve())})}),t.addEventListener("error",function(t){pe.fail(ue,t),e.reject(t)}),t.send(),e.promise}).then(function(){if(y("AndroidApp")){pe.info(ue,"create .nomedia file");return v.default.createEmptyFile("/Caches/.nomedia").then(function(){pe.log(ue,"create .nomedia file succeed")},function(e){pe.fail(ue,"create .nomedia file failed")})}})}function at(){return"empty.mp3"}function lt(){console.assert(void 0!=tn.bMobile),tn.fileSystem=window.sys_fileSystem;var e=f.resolve();return e=e.then(function(){var e=f.defer(),t=tn.fileSystem;return t.create(function(n){window._bFirstRun?rt().then(function(){he("FileSystem"),e.resolve()},function(t){ge("Failed to init file system"),e.reject()}):t.loadDir("/Caches",function(n){n?(pe.error(ue,"load /Caches failed"),g.a.FIX_FS_LOST_BUG?(Oe("Found local cache lost, need to restore from cloud."),rt().then(function(){he("FileSystem"),e.resolve()},function(t){ge("Failed to init file system"),e.reject()})):(ge("Failed to init file system",Zt),e.reject())):(pe.info(ue,"load /Caches success"),t.loadDir(tn.userDir,function(t){log.debug("load ",tn.userDir,"success"),t?(pe.error(ue,"load ",tn.userDir,"failed"),ge("Failed to init file system"),e.reject()):(he("FileSystem"),e.resolve())}))})}),e.promise}),e=e.then(function(){return f.ninvoke(tn.fileSystem,"removeDir",tn.tmpDir)}).then(function(){return f.ninvoke(tn.fileSystem,"createDir",tn.tmpDir)})}function st(e){tn.lsArticles.push(e),tn.newArtStream.emit(e)}function ct(e,t,n,i){var o=[];return tn.lsArticles.forEach(function(r){r.parentName===e&&("Note"===r.type?!i&&r.bTrash||o.push(r):(n||!i&&r.bTrash||o.push(r),t&&(o=o.concat(ct(r.artName,t,n,i)))))}),o}function dt(e){var t=tn.lsArticles.indexOf(e);if(-1===t)return log.error("not found art in trash to be deleted",e.artTitle),f.resolve();var n=tn.userDir+e.artName;return f.ninvoke(tn.fileSystem,"removeDir",n).then(function(){tn.lsArticles.splice(t,1),xt(),tn.artDeletedStream.emit(e),log.log("deleted article",e.artTitle)}).catch(function(t){pe.error("failed to delete note: ",e.artTitle,t)})}function ut(e){return e.bTrash=!0,e._bDirectTrash&&(e.bDirectTrash=!0),vt(e)?(log.log("trashed ",e.artTitle),f.resolve()):dt(e)}function pt(e,t){if(console.assert(e.bTrash),-1===tn.lsArticles.indexOf(e))return log.error("not found art to be restored",e.artTitle),null;C.clearArtSyncData(e),e.bTrash=!1,e.bDirectTrash=!1,tn.artRestoredStream.emit(e),"Folder"===e.type&&t&&p.each(tn.lsArticles,function(t){t.bTrash&&t.parentName===e.artName&&pt(t,!0)});var n=Tt(e.parentName);return n&&!n.bTrash?n:(e.parentName="Root",tn.rootArticle)}function mt(e,t){return-1===tn.lsArticles.indexOf(e)?(log.error("not found art to be deleted",e.artTitle),f.resolve()):(e.gdrive.fileId&&(tn.commits.gdriveDeledFileIds.push(e.gdrive.fileId),kt()),f().then(function(){return"Folder"===e.type&&0!==Ne(e.artName,!0,!1).length&&log.error("folder is not empty!",e.artTitle),ut(e).then(function(){if(t)return dt(e)})}).then(function(){tn.artTrashedStream.emit(e)}))}function ft(e,t){return p.reduce(e,function(e,n){return e.then(function(){return mt(n,t)})},f()).then(function(){xt(),tn.sinkInTimeSync()})}function ht(e,t){function n(e){var t=!ot(e);e._bDirectTrash=!0,ft([e]).then(function(){var n=t?localString("trash_art_success",Wt(e)):localString("del_art_success",Wt(e));v.default.toastShowShortCenter(n)}).done()}vt(e)&&!gt(1)||(t?v.default.messageBox(localString("home_del_art"),localString("home_del_art_prompt",Wt(e)),{btnOk:!0,btnCancel:!0,btnClose:!0,okTitle:localString("common_delete"),okClass:"btn-danger",cancelClass:"btn-default"},function(t){"Ok"==t&&n(e)}):n(e))}function gt(e,t){return p.where(tn.lsArticles,{bTrash:!0}).length+e<=g.a.MAX_TRASH||(t||v.default.messageBoxPromise(localString("mb_trash_full_title"),localString("mb_trash_full_body",g.a.MAX_TRASH),{btnOk:!0,okTitle:localString("mb_trash_full_goto"),btnCancel:!0}).then(function(e){"Ok"===e&&r.enterFolder("Trash","Trash")}),!1)}function vt(e){return"Folder"===e.type||!ot(e)}function bt(e,t){if("Note"!==e.type)return 0;var n=0;return n+=e.ldoc?e.ldoc.getTotalChars():0,n+=e.ldoc?e.ldoc.getTotalImageSize():0,n+=e.audioSize?e.audioSize:0}function yt(){if(h.isXSmall()){var e=$(window).height(),t=$(window).width();tn.$composerView.offset().top,$("#toolbar").outerHeight();tn.$composerView.css("padding-bottom",35);var n=$("#editor-view"),i=e-n.offset().top;n.css("min-height",i),$("#abm-list-col").css("min-height",i),tn.editor.css("min-height",i),"NoteList"===tn.curMainScreen?tn.$homeMain.css("left",t):"HomeMain"===tn.curMainScreen&&tn.$noteList.css("left",-t)}else{i=$("#composer-view").height()-$("#art-name-bar").height();$("#editor-view").css("min-height",i),$("#abm-list-col").css("min-height",i),tn.editor.css("min-height",i)}x.default.onResize()}function wt(e){var t=e;return{version:t.version,artName:t.artName,artTitle:t.artTitle,type:"Note",audioName:t.audioName,audioFormat:t.audioFormat,cDate:t.cDate,mDate:t.mDate,bTrash:t.bTrash,bDirectTrash:t.bDirectTrash,parentName:t.parentName,noteCommit:t.noteCommit,noteSyncCommit:t.noteSyncCommit,noteCommitMd5:t.noteCommitMd5,folderCommit:t.folderCommit,folderSyncCommit:t.folderSyncCommit,artCommit:t.artCommit,artSyncCommit:t.artSyncCommit,audioCommit:t.audioCommit,audioSyncCommit:t.audioSyncCommit,commitMapCloud:t.commitMapCloud,commitMapApp:t.commitMapApp,audioDate:t.audioDate,audioKey:t.audioKey,audioSize:t.audioSize,audioTime:t.audioTime,usedImages:t.usedImages.slice(0),gdrive:t.gdrive,vDate:t.vDate,bkgrdImgShowName:t.bkgrdImgShowName,bkgrdImgFileName:t.bkgrdImgFileName,aeNoteSyncCommit:t.aeNoteSyncCommit,aeFolderSyncCommit:t.aeFolderSyncCommit,lastPlayPos:t.lastPlayPos,lastEditorState:t.lastEditorState,lastViewMode:t.lastViewMode,lastShareLink:t.lastShareLink}}function _t(e){var t=e;return{artName:t.artName,artTitle:t.artTitle,type:"Folder",folderCommit:t.folderCommit,folderSyncCommit:t.folderSyncCommit,cDate:t.cDate,mDate:t.mDate,bTrash:t.bTrash,bDirectTrash:t.bDirectTrash,parentName:t.parentName,gdrive:t.gdrive,aeFolderSyncCommit:t.aeFolderSyncCommit}}function xt(e){an.add(function(){kt(function(){e&&e()})})}function St(){return f.nfcall(xt)}function kt(e){ln.add(e)}function Tt(e){if(!e)return null;for(var t=0;t<tn.lsArticles.length;t++)if(tn.lsArticles[t].artName==e)return tn.lsArticles[t];return null}function Ct(){function e(){document.addEventListener("onAdFailLoad",function(e){log.error("error: "+e.error+", reason: "+e.reason+", adNetwork:"+e.adNetwork+", adType:"+e.adType+", adEvent:"+e.adEvent)}),document.addEventListener("onAdLoaded",function(e){}),document.addEventListener("onAdPresent",function(e){}),document.addEventListener("onAdLeaveApp",function(e){}),document.addEventListener("onAdDismiss",function(e){})}function t(){var e,t=window.innerHeight;e=t<=400?32:t<=720?50:90,$("#ad-bottom").height(e)}window.AdMob||log.error("admob plugin not ready"),function(){if(window.AdMob&&window.AdMob.setOptions({isTesting:!0,adSize:"SMART_BANNER",position:window.AdMob.AD_POSITION.BOTTOM_CENTER,bgColor:"#607d8b",overlay:!0}),e(),!sn){window.AdMob&&window.AdMob.createBanner({adId:d.admobid.banner,autoShow:!0,isTesting:!0,overlap:!0});var n="onorientationchange"in window?"orientationchange":"resize";window.addEventListener(n,function(){setTimeout(function(){t()},0)},!1),tn.keyboardShown.onValue(e=>{$t()&&$("#ad-bottom").toggle(!e)}),t()}}()}function At(){window.AdMob&&!sn&&window.AdMob.removeBanner()}function $t(e){let t=(y("MobileApp")||y("FakeMobile"))&&tn.commits.accountType===tn.AT_Free&&("D"===tn.commits.freePlan||"E"===tn.commits.freePlan);return e?t&&"D"===tn.commits.freePlan:t}function Lt(e){tn.commits.accountType||console.error("accountType is null"),$t()?tn._bAdInited||(sn||($("#ad-bottom").show(),$("#hp-toggler-view").css("bottom","50px")),Ct(),tn._bAdInited=!0):(sn||($("#ad-bottom").hide(),$("#hp-toggler-view").css("bottom","0px")),At()),tn.commits.accountType===tn.AT_Free?($(".free-only",e).show(),$(".free-hide",e).hide()):($(".free-only",e).hide(),$(".free-hide",e).show()),tn.commits.accountType===tn.AT_Pro?($(".pro-hide",e).hide(),$(".pro-only",e).show()):($(".pro-hide",e).show(),$(".pro-only",e).hide());var t=tn.commits.accountType===tn.AT_Free||tn.commits.proPlan===tn.PP_Trial;$(".can-buy-pro",e).toggle(t),$(".no-buy-pro",e).toggle(!t);var n;n=tn.commits.accountType===tn.AT_Pro?tn.commits.proPlan===tn.PP_GroupSubs?localString("account_name_subs"):tn.commits.proPlan===tn.PP_Trial?localString("account_name_trial"):localString("account_name_pro"):tn.commits.accountType===tn.AT_Edu?localString("account_name_edu"):"",$(".text-account-type",e).text(n),It()}function It(){if(!h.isXSmall())if("None"!==tn.bottomMsgType)"StaticMsg"===tn.bottomMsgType?(_$("#note-bottom-bar").selected="static-msg",$("#note-bottom-bar [name='static-msg']").html(tn.bottomMsgBody)):"ProPromo"!==tn.bottomMsgType&&"Link"!==tn.bottomMsgType||(_$("#note-bottom-bar").selected="link-msg",$("#note-bottom-bar [name='link-msg']").html(tn.bottomMsgBody));else if(tn.commits.accountType===tn.AT_Pro&&tn.commits.proPlan!==tn.PP_Trial||tn.commits.accountType===tn.AT_Free&&!g.a.ENABLE_NEW_TRIAL||y("AndroidApp"))_$("#note-bottom-bar").selected="standard",me();else if(_$("#note-bottom-bar").selected="trial",tn.commits.accountType===tn.AT_Pro){var e=new Date,t=(tn.commits.trialEndDate.getTime()-e.getTime())/864e5;t=Math.max(0,parseInt(t)+1),$("#note-bottom-bar .action-trial").text(localString("bottom_trial_prompt_left",t)).alterClass("text-*","")}else tn.signInUserId?$("#note-bottom-bar .action-trial").text(localString("bottom_trial_prompt_end")).alterClass("text-*","text-danger"):$("#note-bottom-bar .action-trial").text(localString("bottom_trial_prompt_signin")).alterClass("text-*","text-success")}function Et(){cn.add(null)}function Nt(e,t,n){return e.artTitle=t,n||(e.folderCommit=b.genCommitHash()),tn.artTitleChanged.emit(e),"Note"===e.type?(e===tn.curArticle&&Ye(e),St()):St()}function Pt(){tn.bRecording||(q.isRemoteAudioReady()?tn.wavesurfer.drawer.setTitle('Recorder ready for "'+q.getCurSourceName()+'"'):tn.wavesurfer.drawer.setTitle(""))}function Ft(e,t){return e?25:4*g.a.LE_FONT_SIZES[t]}function Dt(e){return 2*g.a.LE_FONT_SIZES[e]+4+2}function Mt(e,t){const n=Dt(e);for(var i=0,o=t;o.length&&o[0].dataset.name!==g.a.LN_ROOT_NAME;)i++,o=o.parent().closest(".line");return--i*n}function Ot(e,t,n,i){let o=e||tn.leditor.$el,r=t||tn.leditor.ldoc,a=n||tn.settings.fontSizeName,l=null==i?h.isXSmall():i;const s=Ft(l,a),c=l?6:0;o.find(".line-abm").remove();var d=o.find(".line");p.each(d,function(e){var t=$(e),n=r.findLine(t.lnName());if("number"!=typeof n.time||n.name===g.a.LN_ROOT_NAME)return;var i=document.createElement("A");i.innerHTML=l?"&#9679;":W.makeBmTimeStr(n.time),i.href=localString("void"),i.classList.add("line-abm"),i.setAttribute("tabindex","-1"),i.dataset.time=n.time;let o=Mt(a,t);i.style.left=-(s+c+o)+"px",e.classList.contains("inserting")&&i.classList.add("inserting"),t.append(i)})}function Rt(e,t,n){h.isXSmall()&&("NoteList"===tn.curMainScreen?$("#note-list-footer").animate({top:-t},1e3*n):"HomeMain"===tn.curMainScreen&&tn.curViewMode===tn.VM_Photo&&$("#photo-view .action-take-photo").animate({bottom:t},1e3*n));var i=$(".toast-push");p.each(i,function(e){var i=$(e),o=parseInt(e.dataset.toastPushBase||"0");i.animate({bottom:o+t},1e3*n)})}function Ut(e,t){if(h.isXSmall()){"HomeMain"===tn.curMainScreen&&"HomeMain"!==e&&W.isPlaying()&&W.pausePlay();var n=$("#main-slider")[0];"HomeMain"===e?n.slide("note-list","home",!0,function(){t&&t(),Qe()}):"NoteList"===e&&(n.querySelector("*>[name=home]").style.zIndex=null,n.slide("note-list","home",!1,function(){t&&t()}),$("#note-list-footer").css("top","")),tn.curMainScreen=e}else t&&t(),"HomeMain"===e&&Qe()}function Bt(){return W.saveLastPlayPos(),f.resolve().then(function(){return Te()}).then(function(){return f.nfcall(Ze)})}function Ht(e){return f.resolve().then(function(){return Bt()}).then(function(){return tn.curArticle=null,it(e)}).then(function(){return tn.curArticle=e,tn.curArtStream.emit(e),Ye(e),_.a.onArticleSelected(),e&&_.a.UI_onBkgrdImgChanged(e),_.a.onAudioChanged(),e&&!Kt(e)&&v.default.toastShowShortCenter(localString("rec_cannot_edit_tip"),"warning"),e.vDate=new Date,Xe(e),e&&tn.curArticle===e?f.nfcall(Ut,"HomeMain"):void 0},function(t){throw"version-too-new"===t?v.default.toastShowLongCenter(localString("open_micnote_too_new",mn.getArtTitleShowName(e)),"error"):"cache-lost"!==t?(pe.fail(ue,t),v.default.toastShowLongCenter(localString("load_art_failed",mn.getArtTitleShowName(e),v.default.getShowError(t)),"error"),tn.curArticle=e,tn.curArtStream.emit(e),Ye(e),_.a.onArticleSelected()):"Disable"!==tn.settings.cloudProvider&&e.gdrive.fileId?d.bAppOffline?v.default.toastShowLongCenter(localString("cache_lost_no_network",e.artTitle,jt(tn.settings.cloudProvider)),"error"):e.bFetching?log.log("fetching is running, ignore..."):(e.bFetching=!0,Re("Fetching"),Be("Fetching",localString("cache_lost_refetch",e.artTitle,jt(tn.settings.cloudProvider))),tn.curArticle=e,Ye(e),tn.bFetchingForLoad=!0,C.fetchNoteForLoad(e,"Fetching").then(function(){tn.bFetchingForLoad=!1,Be("Fetching",localString("load_note_succeed",e.artTitle)),Ue("Fetching"),tn.curArticle===e&&Ut("HomeMain",function(){mn.selectArticle(e)})},function(t){pe.fail(ue,t),He("Fetching",localString("load_note_failed",e.artTitle,jt(tn.settings.cloudProvider),v.default.getShowError(t))),Ue("Fetching"),tn.curArticle===e&&Ht(null)}).finally(function(){e.bFetching=!1})):v.default.toastShowLongCenter(localString("cache_lost_cannot_restore",Wt(e)),"error"),"error"})}function jt(e){return"GDrive"===e?"Google Drive":e}function Wt(e){return e.artTitle?e.artTitle:"Note"===e.type?localString("home_unnamed_note"):localString("unnamed_folder_def_title")}function Vt(){return r.getCurFolderNameForNewArt()}function Gt(){var e=f.defer();return f($.ajax({url:v.default.makeApiUrl("/api/load-settings"),type:"GET",xhrFields:{withCredentials:!0}})).then(function(t){var n,i;if(t)try{n=JSON.parse(t)}catch(e){log.error("restore settings failed"),i=!0,n=null}else log.log("no settings found on server");n?v.default.messageBoxPromise(localString("mb_restore_settings_title"),localString("mb_restore_settings_desc"),{btnOk:!0,btnCancel:!0,okTitle:localString("mb_restore_settings_restore"),cancelTitle:localString("common_cancel")}).then(function(t){"Ok"===t?(k.restoreSettingsDataForServer(n,mn),_.a.onSettingsChanged(),v.default.toastShowLongCenter(localString("restore_settings_succeed")),e.resolve("Success")):e.resolve("Cancel")}):i?e.reject("Error"):e.resolve("NoSettings")},function(t){log.error("loading settings from server failed"),e.reject("Error")}),e.promise}function zt(){return"GDrive"===tn.settings.cloudProvider?O.getProvider("GDrive"):"Dropbox"===tn.settings.cloudProvider?O.getProvider("DropboxSync"):null}function qt(e,t){if(tn.settings.tips[e])return f.resolve();if(!pn){var n=_$("#modal-run-time-tip-templ");pn=Polymer.dom(n).innerHTML,n.parentNode.removeChild(n)}$("#modal-run-time-tip").remove();var i=window.localHtml(pn);i=window.localHtml(i,{rt_content:t});var o=$(v.default.htmlToElement(i,!0)),r=f.defer();return $(".action-got-it",o).on("click",function(){tn.settings.tips[e]=!0,Et(),r.resolve("GotIt")}),$(".action-close",o).on("click",function(){r.resolve("Close")}),v.default.insertModal(o),(o=$("#modal-run-time-tip")).showModal(),r.promise}function Kt(e){return e&&(!e.audioFormat||e.audioFormat===g.a.AUDIO_FMT_MN)}function Xt(){$("#loading-screen").fadeOut(500,function(){$("#loading-screen").remove()}),L.bindMainMenuEvents(),_.a.onSettingsChanged(),y("MobileApp")&&(p.each(tn.settings.lastSharedFilePaths,function(e){tn.fileSystem.removeFile(e)}),tn.settings.lastSharedFilePaths=[],Et()),h.isXSmall()?tn.settings.bHideWaveBar||$("#toggle-wave-bar").click():(tn.settings.bHideWaveBar&&ve(!0),tn.settings.bShowEditWave&&!tn.settings.bHideWaveBar&&be(!0),mn.transView&&tn.settings.bShowTrans&&!tn.settings.bHideWaveBar&&ye(!0)),tn.bMobile&&(tn.bFixIosScroll=!0,tn.scrollDiv=$("#editor"),tn.bFixIosInput=!0),v.default.showFullscreenWaiting(!1);var e=f.resolve();window._bFirstRun&&(e=e.then(function(){if(window._preDefSettings)try{var e=JSON.parse(window._preDefSettings);v.default.unsafeConvertBoolString(e),e.dbDest&&(tn.settings.cloudProvider=e.dbDest,Et()),log.info("loaded pre-defined settings.")}catch(e){log.error("load pre-defined settings failed")}}).then(function(){return window._bOldUser?Gt().then(function(e){return"Disable"===tn.settings.cloudProvider?V():null},function(e){log.error("restore settings failed: ",e)}):V()}).then(function(e){if(e&&(tn.settings.lastArticleName=e.artName),zt()&&zt().setSyncRoot(tn.settings.syncFolderId),"Disable"!==tn.settings.cloudProvider)return console.assert(!C.isSyncInited()),C.showInitSync()})),e=(e=e.then(function(){if(tn.settings.lastTryLoadArtName)log.warn("found possible crashed article: ",tn.settings.lastTryLoadArtName),r.enterFolder("Root","Standard"),Ht(null);else{var e=tn.settings.lastArticleName&&Tt(tn.settings.lastArticleName);if(tn.curArticle||!e||h.isXSmall())r.enterFolder("Root","Standard"),Ht(null);else{var t=tn.settings.lastFolderName||e&&e.parentName||"Root";r.enterFolder(t,"Standard"),Ht(e||tn.lsArticles[0]).then(function(){R.d()})}}zt()&&zt().setSyncRoot(tn.settings.syncFolderId)})).then(function(){if(T.f(),C.upgrade(),d.ENABLE_PRO&&tn.commits.accountType!==tn.AT_Pro&&tn.settings.bAutoNewNote&&(tn.settings.bAutoNewNote=!1,Et()),tn.commits.devVersion<4&&("GDrive"===tn.settings.cloudProvider&&(tn.settings.autoExpProvider="GDrive",tn.settings.gdriveAutoExpFolderId=tn.rootArticle.gdrive.fileId),tn.lsArticles.forEach(function(e){"Note"===e.type?(e.gdrive.aeMicnoteFileId=e.gdrive.fileId,e.aeNoteSyncCommit=e.noteSyncCommit,e.aeFolderSyncCommit=e.folderSyncCommit):(e.gdrive.aeFolderId=e.gdrive.fileId,e.aeFolderSyncCommit=e.folderSyncCommit)}),tn.lsArticles.forEach(function(e){e.gdrive.fileId=null,e.noteSyncCommit=null,e.folderSyncCommit=null}),mn.saveArticleList(),mn.saveSettings(),pe.debug("upgraded to dev 4")),tn.commits.devVersion<6){let t=at();var e=new XMLHttpRequest;e.open("GET",t,!0),e.withCredentials="true",e.setRequestHeader("X-CSRF-TOKEN",window.loginCsrf),e.responseType="arraybuffer",e.addEventListener("load",function(e){var t=e.target.response,n="/Caches/"+at(),i=je(n);tn.fileSystem.saveFile(n,t,i,function(e){e?pe.fail(ue,"download empty audio failed"):pe.log(ue,"empty audio is copied to: "+n)})}),e.addEventListener("error",function(e){pe.fail(ue,e)}),e.send()}tn.commits.devVersion<7&&tn.settings.bSyncPrompted&&(tn.settings.tips.bManualSync=!0),tn.commits.devVersion<8&&(tn.commits.freePlan="A"),tn.commits.devVersion!=ae&&(xt(),kt())}),y("ChromeApp")&&(e=e.then(function(){if(window.onLaunchData=function(e){_e(e)},window.appLaunchData){var e=window.appLaunchData;return window.appLaunchData=null,_e(e)}})),(e=e.then(function(){var e=!1;!tn.settings.bAutoSync||"GDrive"===tn.settings.cloudProvider&&"appdata"===tn.settings.syncFolderId||(e=!0);var t=h.vars.$appBody.asStream("click","#sync").filter(function(e){var t=!1;return"Disable"===tn.settings.cloudProvider&&"Disable"===tn.settings.autoExpProvider?"cn"!==d.market?v.default.messageBoxPromise(localString("mb_save_notes_to_cloud_title"),localString("mb_save_notes_to_cloud_body"),{btnOk:!0,btnCancel:!0,okTitle:localString("mb_save_notes_to_cloud_yes"),cancelTitle:localString("mb_save_notes_to_cloud_no")}).then(function(e){"Ok"===e&&k.showSettings(mn,"sync")}):k.showSettings(mn,"sync"):d.bAppOffline?mn.setInfoBarInfo(localString("offline_cannot_sync")):t=!0,t});C.createSyncAll(e,t),xe().done()})).done()}var Jt=v.default.htmlToElement(window.localHtml(D),!0);$("#pos-note-title-bar").replaceWith(Jt);var Yt=h.isXSmall()?1e4:15e3,Qt=5e3,Zt=h.isXSmall()?1e4:15e3;let en=new Kefir.Bus;var tn={$homeMain:$("#home-main"),curArticle:null,settings:null,commits:null,ARTICLE_PATH:"articlePath",ARTICLE_NAME:"articleName",ARTICLE_CONTENT:"content",AUDIO_NAME:"audio.mp3",AUDIO_EXT:"mp3",DEF_AUDIO_NAME:"audio.mp3",DEF_AUDIO_EXT:"mp3",AT_Pro:"Pro",AT_Free:"Free",AT_Edu:"Edu",PP_Regular:"Regular",PP_Trial:"Trial",PP_GroupSubs:"GroupSubs",PP_GroupPerm:"GroupPerm",VM_Text:"Text",VM_Photo:"Photo",curViewMode:"Text",editor:null,editorMode:h.isXSmall()||h.isMiddle()?"Readonly":"Edit",noteModeStream:null,noteMode:null,keyboardShowEvt:null,keyboardHideEvt:null,keyboardShown:null,artTrashedStream:new Kefir.Bus,artDeletedStream:new Kefir.Bus,artRestoredStream:new Kefir.Bus,curArtStream:en,curArtProp:en.toProperty(null),newArtStream:new Kefir.Bus,artTitleChanged:new Kefir.Bus,artDateChanged:new Kefir.Bus,backButtonOnNoteList:new Kefir.Bus,wavesurfer:null,audioContext:null,bWaveScroll:!1,bMobile:void 0,playSpeed:0,storageType:void 0,bAppCache:void 0,bRecording:!1,bPauseRecording:!1,lastAutoSyncTime:0,syncErrors:[],lsArticles:[],trash:[],fileSystem:null,$composerView:null,audioBackendMethod:null,bHasRecorder:void 0,bKeyboardShown:!1,bCanInvite:!1,bRecordList:!1,recordPlayer:document.getElementById("record_player"),infoBarStableStrings:{},curMainScreen:"NoteList",accountId:"google.gdrive0",bottomMsgType:"None",bottomMsgBody:"",bottomMsgArg:""},nn=$("#view-togglers");$(".action-photo",nn).on("click",function(){fe(tn.VM_Photo)}),$(".action-text",nn).on("click",function(){fe(tn.VM_Text)});var on,rn=function(){var e,t,n;return function(i,o){i?e&&(e.parentNode.removeChild(e),e=null,t=null):e||(e=v.default.createBackdropElem(),$("#note-view").append(e),n=$("#info-bar-container").css("z-index")),o&&e&&!t?t=v.default.addActivityAnimation(e):!o&&t&&(t.parentNode.removeChild(t),t=null)}}();if(y("MobileApp")||y("FakeMobile")){tn.keyboardShowEvt=Kefir.stream(function(e){function t(t){e.emit(t.keyboardHeight)}return window.addEventListener("native.keyboardshow",t),function(){window.removeEventListener("native.keyboardshow",t)}}),tn.keyboardHideEvt=Kefir.stream(function(e){function t(t){e.emit(t.keyboardHeight)}return window.addEventListener("native.keyboardhide",t),function(){window.removeEventListener("native.keyboardhide",t)}});tn.keyboardHideEvt.onValue(function(){y("AndroidApp")||y("FakeMobile");var e=B.m();e&&e.$el.has(document.activeElement).length&&document.activeElement.blur(),tn.bKeyboardShown=!1,tn.keyboardHiddenSoonCb&&(new Date).getTime()<tn.keyboardHiddenSoonExpire&&(tn.keyboardHiddenSoonCb(),tn.keyboardHiddenSoonCb=null)}),tn.keyboardShowEvt.onValue(function(e){y("AndroidApp")||y("FakeMobile"),$("#note-bottom-bar").hide(),tn.bKeyboardShown=!0,tn.keyboardShownSoonCb&&(new Date).getTime()<tn.keyboardShownSoonExpire&&(tn.keyboardShownSoonCb(),tn.keyboardShownSoonCb=null)}),tn.keyboardShown=tn.keyboardShowEvt.map(function(){return!0}).merge(tn.keyboardHideEvt.map(function(){return!1})).toProperty(function(){return!1}),function(){const e=2e3;tn.createKeyboardShowSoonOnce=function(t=e){return tn.keyboardShowEvt.map(()=>"shown").merge(Kefir.later(t,"timeout")).take(1)},tn.createKeyboardHideSoonOnce=function(t=e){return tn.keyboardHideEvt.map(()=>"hidden").merge(Kefir.later(t,"timeout")).take(1)}}(),d.bDebug&&(window.dbgShowKeyboard=function(){var e=new window.CustomEvent("native.keyboardshow");e.keyboardHeight=300,window.dispatchEvent(e)},window.dbgHideKeyboard=function(){var e=new window.CustomEvent("native.keyboardhide");window.dispatchEvent(e)})}let an=Object.create(v.default.FlatLatestWorker);an.create(function(e){for(var t=[],n=0;n<tn.lsArticles.length;n++){var i=tn.lsArticles[n],o="Note"===i.type?wt(i):_t(i);t.push(o)}We("articles",t,e)},!0,"saveArticleList");let ln=Object.create(v.default.FlatLatestWorker);ln.create(function(e){var t=tn.commits.devVersion;tn.commits.devVersion=ae,We(de,tn.commits,e),tn.commits.devVersion=t},!0,"saveCommits");const sn=!0;$("#note-bottom-bar [name='link-msg']").on("click",function(){"ProPromo"===tn.bottomMsgType?k.showSettings(mn,"purchase"):"Link"===tn.bottomMsgType&&X.openExternalLink(tn.bottomMsgArg)}),$("#note-bottom-bar .action-trial").on("click",function(){tn.signInUserId||tn.signInUserEmail?k.showSettings(mn,"purchase"):$("#menu-signin").click()});let cn=Object.create(v.default.FlatLatestWorker);cn.create(e=>{We("settings",tn.settings,e)},!0,"saveSettings"),_.a.addListener("onCapturerConnected",function(e){Pt()});var dn;h.vars.$appBody.on("iron-overlay-closed","#tip-popover",function(e){$(this).remove(),dn&&(dn.resolve(),dn=null)});var un;$("#toggle-wave-bar").on("click",function(e){var t=$(this);t.toggleClass("active"),t.hasClass("active")?($("#wave-bar").toggle(!0),tn.settings.bHideWaveBar=!1,tn.wavesurfer.drawer.redraw()):($("#wave-bar").toggle(!1),tn.settings.bHideWaveBar=!0),Et(),yt()}),window.onfocus=function(){document.body.classList.remove("blurred"),document.body.classList.add("focused")},window.onblur=function(){document.body.classList.remove("focused"),document.body.classList.add("blurred")},(y("AndroidApp")||y("FakeMobile"))&&(d.bDebug&&(window.dbgBackButton=function(){document.dispatchEvent(new Event("backbutton"))},window.dbgMenuButton=function(){document.dispatchEvent(new Event("menubutton"))}),document.addEventListener("backbutton",function(e){if(!v.default.hasBackdrop(h.vars.$appBody)){var t=document.activeElement;if(t){var n=new window.CustomEvent("x-backbutton",{bubbles:!0,cancelable:!0});if(!t.dispatchEvent(n))return!1}e.preventDefault()}},!1),h.vars.$appBody.on("x-backbutton","paper-dialog:not(.slide)",function(e){return log.log("modal dialog exists, ignored backbutton"),!1}),h.vars.$appBody.on("x-backbutton",".slide,x-slider",function(e){if(!h.isXSmall()||"main-slider"!==e.currentTarget.id){var t=$(this);if(v.default.hasBackdrop(t))return!1;var n=$(".slide:visible x-slider > .slide-panel.iron-selected .slide-header").find("paper-button"),i=localString("common_close").toUpperCase(),o=localString("common_back").toUpperCase(),r=p.find(n,function(e){$(e);if(v.default.isButtonClickable(e)){var t=Polymer.dom(e).innerHTML;if((t=t.toUpperCase())===o)return r=e;if(t===i)return r=e}return!1});return r&&(r.hasAttribute("dismissive")?$(r).parents(".slide").hideModal():$(r).click()),!1}}),h.vars.$appBody.on("x-backbutton",function(e){return"Edit"===tn.curNoteMode?v.default.messageBox(null,localString("mb_end_edit_body"),{btnOk:!0,okTitle:localString("mb_end_edit_end"),btnCancel:!0,btnClose:!0},function(e){"Ok"===e&&($(".action-edit-done",mn.$el).click(),tn.noteMode.take(1).onValue(()=>{$("#toggle-note-list").click()}))}):h.isXSmall()?"HomeMain"===tn.curMainScreen?v.default.isButtonClickable($("#toggle-note-list"))&&$("#toggle-note-list").click():"NoteList"===tn.curMainScreen&&tn.backButtonOnNoteList.emit():tn.backButtonOnNoteList.emit(),!1}),document.addEventListener("menubutton",function(e){e.preventDefault(),h.isXSmall()&&($("paper-dialog.visible").length||("NoteList"===tn.curMainScreen?r.toggleMainMenu():"HomeMain"===tn.curMainScreen&&_$("#xs-note-menu").toggle()))})),_.a.addListener("onRecordStarted",function(){if(h.isXSmall()&&$("#toggle-note-list").addClass("disabled"),"Cont"===tn.recContType&&tn.settings.bContRecMarker){var e=tn.curArticle.ldoc.newTextLine();e.content=(new Date).toLocaleString(),e.time=W.getCurAudioTime();var t=tn.leditor.cmdInsertLine(e,tn.leditor.ldoc.getAllEndPos());tn.leditor.setActiveLn(t),tn.leditor.makeLinesVisible(t)}}),_.a.addListener("onRecordStopped",function(){h.isXSmall()&&$("#toggle-note-list").removeClass("disabled")});var pn;d.bDebug&&(window.dbgClearFileSystem=function(){tn.fileSystem.removeDir("/Caches"),tn.fileSystem.removeFile(`_fs_${tn.uid}_articles`),tn.fileSystem.removeFile(`_fs_${tn.uid}_commits`),tn.fileSystem.removeFile(`_fs_${tn.uid}_settings`),tn.fileSystem.removeFile("_fs_appSettings")}),window.ar=tn;var mn={$el:s,saveSettings:Et,saveCommits:kt,findLocalArticle:Tt,findArticleByFileId:function(e){var t;return tn.lsArticles.forEach(function(n){return n.gdrive.fileId===e?(t=n,!1):void 0}),t},saveArticleList:xt,manualSaveCurArticleContent:function(e){tn.curArticle.ldoc,tn.leditor.autoSave(),tn.leditor.isModified()?Ae(function(){se(function(){Ce(),e&&e()})}):(e&&e(),$("#text-saving").text(localString("note_all_changes_saved")))},setInfoBarInfo:Oe,INFO_TIMEOUT_IMPORTANT:Zt,INFO_TIMEOUT_ERROR:Yt,saveArticle:Xe,progressHandlingFunction:function(e){e.lengthComputable&&$("#upload_prog").attr({value:e.loaded,max:e.total})},doNewNote:Me,newFolder:function(e){var n=new Date,i=p.defaults({artName:b.genHash(16),artTitle:e.title||"",type:"Folder",parentName:e.parentName||null,cDate:new Date(n),mDate:new Date(n),folderCommit:b.genCommitHash()},t());return st(i),xt(),i},getAllArticlesInFolder:ct,deleteSelectedArticles:ft,getNotesInFolder:Ne,getAllParents:function(e){for(var t=[],n=Tt(e.parentName);n;)t.prepend(n),n=Tt(n.parentName);return t},getNoteDir:ze,getNoteDirByName:function(e){return tn.userDir+e},selectArticle:Ht,switchMainScreen:Ut,nativeUnzip:function(e,t,n){if(y("ChromeApp"))window.common.naclPostMessage("unzip",{zipPath:e,unzipDir:t},function(e){n&&n(e?"unzip failed: "+e:null)});else if(y("MobileApp")){var i=tn.fileSystem.getRootPath()+b.removeFirstSplash(e),o=tn.fileSystem.getRootPath()+b.removeFirstSplash(t);window.mobileUtil.nativeUnzip(i,o,function(){n&&n()},function(e){n&&n(new Error("unzip failed: "+e))})}else if(y("Node")){var i=X.node.path.normalize(tn.fileSystem.getRootPath()+b.removeFirstSplash(e)),o=X.node.path.normalize(tn.fileSystem.getRootPath()+b.removeFirstSplash(t));X.node.minizip.unzip(i,o,e=>{n&&n(e?"unzip failed: "+e:null)})}else log.error("unimplemented")},setArtTitle:Nt,getArtTitleShowName:Wt,getCurFolderName:Vt,showPopoverTips:function(e,t,n){var i=f.defer(),o=c;o=o.replace("CONTENT",n);var r=$("<div/>").html(o).children();r.appendTo(h.vars.$appBody);var a=r[0];return a.popPos=t.popPos||"top",a.togglerElem=$(e)[0],r.css("width",t.width||""),a.toggle(),dn=i,i.promise},getArtNum:Pe,getMaxNoteNum:Ie,getMaxImageNum:Le,calcTotalCacheSize:function(){var e=0;return tn.lsArticles.forEach(function(t){e+=bt(t)}),e},calcArticleCacheSize:bt,getCloudShowName:jt,setStableError:He,setStableInfo:Be,requestInfoBar:Re,releaseInfoBar:Ue,nativeZip:function(e,t,n){if(y("ChromeApp"))window.common.naclPostMessage("zip",{srcDir:e,zipPath:t},function(e){n&&n(e?"zip failed: "+e:null)});else if(y("MobileApp")){var i=tn.fileSystem.getRootPath()+b.removeFirstSplash(e),o=tn.fileSystem.getRootPath()+b.removeFirstSplash(t);window.mobileUtil.nativeZip(i,o,function(){n&&n()},function(e){n&&n(new Error("zip failed: "+e))})}else if(y("Node")){var i=X.node.path.normalize(tn.fileSystem.getRootPath()+b.removeFirstSplash(e)),o=X.node.path.normalize(tn.fileSystem.getRootPath()+b.removeFirstSplash(t));X.node.minizip.zip(i,o,e=>{n&&n(e?"zip failed: "+e:null)})}else log.error("unimplemented")},editorUtil:x.default,PROP_VERSION:le,checkWifiOnly:function(){return!y("MobileApp")||!tn.settings.bWifiOnly||navigator.connection.type===window.Connection.WIFI},signInAccount:function(){var e=f.defer();v.default.showFullscreenWaiting(!0);var t=tn.commits.accountType;return T.d(!0).then(function(e){console.assert(e.uid);var t=tn.uid,n=e.uid,i=Ge(t),o=Ge(n),r=f.defer();return i!==o?tn.fileSystem.removeDir(o,function(a){a?r.reject(a):tn.fileSystem.dirMoveTo(i,o,function(i){i?r.reject(i):tn.fileSystem.loadDir(o,function(i){i?r.reject(i):T.d(!1).then(function(){I(n),Et(),xt(),kt(),tn.storage.remove(t+"_articles"),tn.storage.remove(t+"_commits"),tn.storage.remove(t+"_settings"),et(),r.resolve(e)},r.reject)})})}):T.d(!1).then(function(){r.resolve(e)},r.reject),r.promise},function(e){if("login-failed"===e)return T.e();throw e}).then(function(n){tn.commits.accountType=n.accountType,tn.commits.freePlan=n.freePlan,tn.commits.proPlan=n.proPlan,tn.commits.trialEndDate=n.trialEndDate,kt(),y("ChromeApp")&&(pe.warn(ue,'FIX $("#menu-upgrade-to-pro"), x-dropdown-button do not support dynamic height.'),$("#menu-upgrade-to-pro").show()),f.resolve().then(function(){v.default.showFullscreenWaiting(!1);var e=v.default.getAppSettings();return E(e.loginSignInType,e.loginSignInUserId,e.loginSignInUserEmail,e.loginSignInShowName),Lt(),v.default.messageBoxPromise(localString("signup_succeed_title"),localString("signup_succeed_msg",e.loginSignInShowName),{okClass:"btn-success"})}).then(function(){return Gt().catch(function(e){log.error(e)})}).then(function(){return t!==tn.commits.accountType&&tn.commits.accountType===tn.AT_Pro&&tn.commits.proPlan!==tn.PP_Trial?v.default.messageBoxPromise(localString("welcome_pro_title"),localString("welcome_pro_msg"),{}):void 0}).then(function(){e.resolve()},function(t){e.reject("error")})},function(t){v.default.showFullscreenWaiting(!1),"cancel"!==t&&v.default.messageBox(localString("common_error"),localString("signin_failed",v.default.getShowError(t)),function(){e.reject()})}),e.promise},updateProOnlyUI:Lt,getSyncProvider:zt,getCloudProviders:function(){return O},getSelSyncFolderProvider:function(){return"GDrive"===tn.settings.cloudProvider?O.getProvider("GDrive"):"Dropbox"===tn.settings.cloudProvider?O.getProvider("DropboxStd"):null},getAEProvider:function(){return"GDrive"===tn.settings.autoExpProvider?O.getProvider("GDrive"):"Dropbox"===tn.settings.autoExpProvider?O.getProvider("DropboxStd"):null},getAllAutoExpFileIdFieldNames:function(e){var t=["aeMicnoteFileId","aeRecFileId","aePdfFileId","aeHtmlFileId","aeGDocFileId"];return e&&t.push("aeFolderId"),t},reportAccount:Se,setMarkA:W.setMarkA,setMarkB:W.setMarkB,playAB:W.playAB,updatePlayPauseIcon:W.updatePlayPauseIcon,emptyRecording:function(e){var t="/Caches/"+at(),n=tn.userDir+e.artName+"/"+tn.DEF_AUDIO_NAME;return f.ninvoke(tn.fileSystem,"copyTo",t,n).then(function(){e.audioName=tn.DEF_AUDIO_NAME,e.audioCommit=g.a.NEW_AUDIO_COMMIT,e.noteCommit=b.genCommitHash(),e.audioFormat=g.a.AUDIO_FMT_MN,Xe(e)})},loadAudio:W.loadAudio,parseAbm:W.parseAbm,toggleMiniWaveBar:ve,toggleEditWave:be,toggleTransBar:ye,loadArtContent:tt,loadNoteDir:nt,clepausePlay:W.pausePlay,playPlay:W.playPlay,stopPlay:W.stopPlay,isPlaying:W.isPlaying,checkRunTimeTip:qt,checkRunTimeTipWithPic:function(e,t,n,i=""){return qt(e,`\n<div>${t}</div>\n<div class="layout horizontal center center-justified" style="padding:10px 0;">\n  <img src="${n}">\n  <h2 style="margin-left: 10px;font-weight: bold;">${i}</h2>\n</div>\n`)},isRunTimeTipFinish:function(e){return tn.settings.tips[e]},getAudioPath:function(e,t){return tn.userDir+tn.curArticle.artName+"/"+(t||tn.curArticle.audioName)},makeBmTimeStr:W.makeBmTimeStr,makeTimeShowStr:W.makeTimeShowStr,isAudioEditable:Kt,updateAudioSize:W.updateAudioSize,readyForMicnoteFile:function(e){return f().then(function(){return Ke(e)})},createNoteDir:De,getFreeAccountRecTimeInMinutes:W.getFreeAccountRecTimeInMinutes,getFreeAccountMaxImages:function(){return ne},getProAccountMaxImages:function(){return ie},gotoAbm:W.gotoAbm,canMakeMoreNotes:function(){return Ee(Pe("Note")+1,!0)},checkNoteNum:Ee,checkMaxImages:function(e,t){return!(e>Le()&&(t||!te||tn.commits.accountType===tn.AT_Pro&&tn.commits.proPlan!==tn.PP_Trial||(tn.settings.bPromptPhotoNum||Se(),v.default.messageBox(localString("home_max_images_title"),localString("home_max_images_body",ne,ie),{okTitle:localString("view_more_pro_features"),okClass:"btn-success",btnCancel:!0,btnClose:!0},function(e){tn.settings.bPromptPhotoNum=!0,Et(),"Ok"==e&&k.showSettings(mn,"purchase")})),1))},DEF_ARTICLE_PROP:u,saveArticleContent:qe,getCurAudioTime:W.getCurAudioTime,updateAbmList:Ot,getLineContentWidth:function(e,t,n,i){return t-Ft(n,i)-Mt(i,e)},onKeyboardShownSoon:function(e){tn.keyboardShownSoonCb=e,tn.keyboardShownSoonExpire=(new Date).getTime()+2e3},getVisibleRepeatBar:function(){return tn.settings.bShowEditWave?$("#edit-wave-bar").find(".repeat-bar"):tn.settings.bShowTrans?mn.transView.$el.find(".repeat-bar"):null},reloadCurArticle:et,isNoteOnCloudOnly:ot,emptyTrash:function(){var e=tn.lsArticles.slice(0);return p.reduce(e,function(e,t){return e.then(function(){if(t.bTrash)return dt(t)})},f.resolve())},restoreTrashedArticle:pt,trashDeleteArticle:dt,checkMaxTrash:gt,isTrashable:vt,hideNoteList:function(e){if(console.assert(!h.isXSmall()),void 0===un||un!==e){var t=$("#note-list-col"),n=$("#home-main"),i=v.default.animRunnerPool.getFree(),o=i.querySelector(".from");if(i.querySelector(".to"),e)i.animationConfig=[{animatable:o,type:"exit"}],o.animationConfig={exit:[{name:"fade-out-animation",node:t[0]}]},n.css("left",0),$(i).one("neon-animation-finish",function(e){n.css("left",0),t.hide(),p.delay(function(){tn.wavesurfer.drawer.redraw(),x.default.onResize()})}),i.playAnimation(null);else{i.animationConfig=[{animatable:o,type:"entry"}],t.show(),o.animationConfig={entry:[{name:"fade-in-animation",node:t[0]}]};var r=t.width();n.css("left",r),$(i).one("neon-animation-finish",function(e){tn.wavesurfer.drawer.redraw(),x.default.onResize()}),i.playAnimation(null)}}},updateRemoteSourceLabel:Pt,hasAd:$t,mainNav:L,syncer:C,settingView:k,leToolbarModule:K,recorder:W};v.default.showFullscreenWaiting(!0),tn.infoBar=$("#info-bar"),v.default.setToastMoveCb(Rt),w.a(mn),C.create(mn),A.b(mn),tn.$composerView=$("#composer-view"),"iOS"==d.osName&&"App"==d.appType||$(".ios-app-only").hide(),console.assert(window.arLoginUserId),I(window.arLoginUserId),E(window.arSignInType,window.arSignInUserId,window.arSignInUserEmail,window.arSignInShowName),tn.bMobile=navigator.userAgent.indexOf("Mobile")>=0,f.resolve().then(function(){return lt()}).then(function(){tn.storageType=window.sys_storageType,tn.storage=window.sys_storage,pe.info(ue,"Storage: "+tn.storageType)}).then(function(){return f.Promise(function(e,t){Ve("settings",o(),function(n,i){n?t(n):(tn.settings=i,tn.settings.tips=p.defaults(tn.settings.tips,{bCreateFolder:!1,bPasteFile:!1,bManualSync:!1}),tn.settings.bHideNoteList=!1,e())})})}).then(function(){tn.settingsChanged=new Kefir.Bus,tn.settingsProp=tn.settingsChanged.map(function(e){return e.settings}).toProperty(function(){return tn.settings})}).then(function(){return f.Promise(function(e,t){Ve(de,i(),function(n,i){n?t(n):(tn.commits=i,void 0===tn.commits.devVersion&&(tn.commits.devVersion=0),tn.commits.accountType==tn.AT_Free&&(tn.settings.bRemoveAd=!1),oe&&(tn.settings.bRemoveAd=!0),tn.commits.trialEndDate||(tn.commits.trialEndDate=new Date((new Date).getTime()+2592e6)),tn.commits.accountType===tn.AT_Pro&&tn.commits.proPlan===tn.PP_Trial&&tn.commits.loginTrialEndDate<new Date&&(tn.commits.accountType=tn.AT_Free,kt()),e())})})}).then(function(){tn.editor=$("#editor"),tn.edtToolbar=$("*[data-role='editor-toolbar']"),B.p(),tn.leditor=Object.create(B.c),tn.leditor.create(mn,_$("#editor"),_$("#composer-view")),B.r(tn.leditor),B.j(tn.leditor),tn.leditor.toggleEditable(!h.isXSmall()),tn.leditor.on("trigger-line-abm",function({$ln:e,bOffsetable:t}){var n=e.line();if("number"!=typeof n.time&&tn.bRecording&&tn.bRecordingRealStarted){var i=W.getCurOffsetedAudioTime(t);n.time=i,"Insert"!==tn.recContType&&"Replace"!==tn.recContType||e.addClass("inserting")}}),tn.leditor.on("abm-changed",function(){tn.leditor.updateAbmListJob()}),tn.leditor.on("modified-changed",function(e){G(e)}),x.default.addAllEditorPlugins(tn.leditor),he("Editor"),$("#editor-view").on("scroll",function(e){var t=this.scrollTop;$("#editor-view").css("background-position-y",-t+"px")})}).then(function(){W.create(mn)}).then(function(){var e=f.defer();return y("DesktopApp")&&!y("FakeMobile")&&(mn.transView=z.g(mn)),n.e(4).then(function(){var t=[n(197),n(104),n(201),n(208)];(function(t,n,i,o){if(!h.isXSmall()){let e;e=h.isMiddle()?v.default.htmlToElement(window.localHtml(F),!0):v.default.htmlToElement(window.localHtml(P),!0),$("#note-nav-main-nav-pos",s).replaceWith(e)}(r=t).create(mn),tn.$noteList=r.getJQElement(),mn.noteList=r,Kefir.merge([r.delNoteStream,L.delNoteStream]).onValue(([e,t])=>{ht(e,t)}),r.delSeledArticlesStream.onValue(e=>{ft(e)}),h.isXSmall()||($("#home-main").css("left",tn.settings.noteListWidth),r.widthResized.onValue(e=>{$("#home-main").css("left",e)})),L.create(mn),x.default.create(mn),x.default.applyFontSize(),x.default.applySpellCheck(),mn.editorUtil=x.default,j.b(mn),tn.leToolbar=Object.create(K.LEToolbar);var c=_$("*[data-role='editor-toolbar']");tn.leToolbar.create(mn,tn.leditor,c),tn.hotPad=Object.create(S.a),tn.hotPad.create(mn,tn.leditor),(a=i).create(mn),mn.shareView=a,(l=o).create(mn),mn.importEx=l,R.b(mn),e.resolve()}).apply(null,t)}).catch(n.oe),e.promise}).then(function(){return tn.commits.devVersion<10?f.ninvoke(tn.fileSystem,"createDir",tn.tmpDir):void 0}).then(function(){return f.Promise(function(n,i){if(window._bFirstRun){var o=new Date,r=p.defaults({artName:"Root",artTitle:localString("common_app_name"),type:"Folder",parentName:null,cDate:new Date(o),mDate:new Date(o),gdrive:{},folderCommit:b.genCommitHash(),noteCommit:b.genCommitHash(),noteCommitMd5:"INVALID"},t());tn.lsArticles=[r],tn.rootArticle=tn.lsArticles[0],xt(),n()}else Ve("articles",null,function(o,r){if(o)i(o);else{if(0===tn.commits.devVersion){var a=new Date,l=p.defaults({artName:"Root",artTitle:localString("common_app_name"),type:"Folder",parentName:null,cDate:new Date(a),mDate:new Date(a),gdrive:{},folderCommit:b.genCommitHash(),noteCommit:b.genCommitHash(),noteCommitMd5:"INVALID"},t());tn.commits.gdrive&&tn.commits.gdrive.prodDirId&&(l.gdrive.fileId=tn.commits.gdrive.prodDirId,delete tn.commits.gdrive),tn.lsArticles=[l],r&&r.forEach(function(e){e.parentName="Root"})}if(r)for(var s=0;s<r.length;++s){var c,d=r[s];d.type&&"Note"!==d.type?c=p.defaults({},d,t()):(void 0===d.version&&(d.version=4),c=p.defaults({},d,e())),c.cDate||(log.error("found null cDate, fixed.",c.artTitle),c.cDate=c.mDate||new Date),tn.lsArticles.push(c)}console.assert(tn.lsArticles.length&&"Root"===tn.lsArticles[0].artName,"no root found"),tn.rootArticle=tn.lsArticles[0],n()}})})}).then(function(){y("AndroidApp")&&(document.addEventListener("pause",function(){tn.bMobileDontSleep||!tn.wavesurfer.backend.isPaused()||tn.bRecording?pe.info("ignore sleep"):(pe.info("allow sleep"),window.plugins.insomnia.allowSleepAgain())},!1),document.addEventListener("resume",function(){pe.info("keep awake"),window.plugins.insomnia.keepAwake()},!1),pe.info("keep awake"),window.plugins.insomnia.keepAwake()),window.onresize=yt,yt()}).then(function(){W.createRecorderCmdStream()}).then(function(){Lt(),U.bindAll(mn),he("Main")}).then(function(){tn.artDateChanged.onValue(e=>{e===tn.curArticle&&me()})}).catch(function(e){pe.error(ue,e instanceof Error?e.stack:e)}),_.a.addListener("onSyncRunning",function(e){e?$("#sync").addClass("rotating"):$("#sync").removeClass("rotating")}),_.a.addListener("onArticleSelected",function(){me()}),_.a.addListener("onArticleContentChanged",function(e){return qe(e)}),_.a.addListener("onArtListPropChanged",function(e){xt()}),_.a.addListener("UI_onArticleChanged",function(e){e!==tn.curArticle||tn.bFetchingForLoad||it(e)}),document.execCommand("styleWithCSS",null,!0),c=Polymer.dom(_$("#tip-popover-templ")).innerHTML,$("#tip-popover-templ").remove()}function o(){if(h.isXSmall()){var e=v.default.htmlToElement(window.localHtml(M),!0),t=v.default.htmlToElement(window.localHtml(E),!0);$(e).find("#home-pos").replaceWith(t),$("#main").append(e)}else if(h.isMiddle()){var n=window.localHtml(N),o=v.default.htmlToElement(n,!0);$("#main").append(o)}else{var n=window.localHtml(I),o=v.default.htmlToElement(n,!0);$("#main").append(o)}s=$("#main"),i()}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"render",function(){return o});var r,a,l,s,c,d=n(7),u=(n.n(d),n(99),n(124),n(138),n(139),n(140),n(141),n(142)),p=(n.n(u),n(19)),m=(n.n(p),n(23)),f=(n.n(m),n(20)),h=(n.n(f),n(8)),g=n(91),v=n(22),b=n(21),y=(n.n(b),n(25),n(103),n(147),n(6)),w=(n.n(y),n(100)),_=(n(93),n(92)),x=n(104),S=n(133),k=n(102),T=n(95),C=n(108),A=n(112),L=n(134),I=n(188),E=(n.n(I),n(189)),N=(n.n(E),n(190)),P=(n.n(N),n(191)),F=(n.n(P),n(192)),D=(n.n(F),n(193)),M=(n.n(D),n(194)),O=(n.n(M),n(94)),R=n(120),U=n(26),B=n(97),H=n(101),j=(n(118),n(119)),W=n(135),V=n(195),G=(n.n(V),n(196)),z=(n.n(G),n(107)),q=n(121),K=n(132),X=n(24);var J=!0,Y=d.ENABLE_PRO&&!d.bDebug,Q=999,Z=999,ee=999,te=d.ENABLE_PRO,ne="cn"===d.market?100:10,ie=100,oe=!0,re=2e3,ae=10,le=5;const se=["c","o","m","m","i","t","s",".","h","a","s","h"].join(""),ce=["c","o","m","m","i","t","s"].join(""),de=y("Node")?se:ce;var ue="[home]",pe=log.reg("home")},function(e,t,n){"use strict";var i=n(99),o=n(22);i.a.Drawer={init:function(e){if(this.container="string"==typeof e.container?document.querySelector(e.container):e.container,!this.container)throw new Error("wavesurfer.js: container element not found");if(this.params=e,this.pixelRatio=this.params.pixelRatio,this.width=0,this.height=e.height*this.pixelRatio,this.barHeight=e.barHeight,this.containerWidth=this.container.clientWidth,this.lastPos=0,this.createWrapper(),this.createElements(),this.params.fillParent){var t=this;window.addEventListener("resize",function(){t.container.clientWidth!=t.containerWidth&&t.redraw()})}},redraw:function(){this.containerWidth=this.container.clientWidth,this.fireEvent("redraw")},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),this.onWaveModeChanged();{let e,t,n;o.default.pointerLeftDownStream(this.wrapper).flatMap(([i,r])=>{i.preventDefault(),e=r.pageX,t=r.pageY,n=r.pageX-$(this.wrapper).offset().left+this.wrapper.scrollLeft,this.fireEvent("click",n/this.scrollWidth);let a=o.default.pointerLeftMoveStream(document).takeUntilBy(o.default.pointerUpStream(document));return a.take(1).onValue(()=>{this.fireEvent("drag-started")}),a.onEnd(()=>{this.fireEvent("drag-ended")}),a}).onValue(([i,o])=>{let r=o.pageX-e,a=o.pageY-t,l=r*Math.max(.1+(100-a)/100*.9,.1),s=(n+l)/this.scrollWidth;s<0?s=0:s>1&&(s=1),this.fireEvent("dragging",s),i.preventDefault()})}},onWaveModeChanged:function(){(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.scrollParent?"scroll":"hidden",overflowY:"hidden"})},clear:function(){this.resetScroll(),this.clearWave()},drawPeaks:function(e,t,n){if(this.setWidth(t),this.params.normalize)var o=i.a.util.max(e);else o=1;this.drawWave(e,o,n)},style:function(e,t){Object.keys(t).forEach(function(n){e.style[n]=t[n]})},resetScroll:function(){this.wrapper.scrollLeft=0},recenter:function(e){var t=this.containerWidth*e;this.recenterOnPosition(t,!0)},recenterOnPosition:function(e,t){var n=this.wrapper.scrollLeft,i=~~(this.containerWidth/2),o=e-i,r=o-n;if(!t&&r>=-i&&r<i){o=n+(r=Math.max(-5,Math.min(5,r)))}0!=r&&(this.wrapper.scrollLeft=o)},getWidth:function(){return this.containerWidth*this.pixelRatio},setWidth:function(e){e!=this.width&&(this.width=e,this.scrollWidth=~~(this.width/this.pixelRatio),this.containerWidth=this.container.clientWidth,this.params.fillParent||this.params.scrollParent||this.style(this.wrapper,{width:this.scrollWidth+"px"}),this.updateWidth())},progress:function(e){var t=1/this.pixelRatio,n=Math.round(e*this.width)*t;(n<this.lastPos||n-this.lastPos>=t)&&(this.lastPos=n,this.updateProgress(e)),this.params.scrollParent&&this.recenterOnPosition(~~(this.scrollWidth*e))},changeWaveMode:function(e){this.params.scrollParent=e,this.onWaveModeChanged()},createElements:function(){},updateWidth:function(){},drawWave:function(e,t){},clearWave:function(){},updateProgress:function(e){},addMark:function(e){},removeMark:function(e){}},i.a.util.extend(i.a.Drawer,i.a.Observer)},function(e,t,n){"use strict";function i(e,t,n,i,o,r,a,l){a||(a={});var s=m("MobileApp")?"File":"ArrayBuffer";return p.Promise(function(c,u){ar.fileSystem.loadFile(n,{type:s},function(n,s){if(n)u(n);else{var p,f=o?void 0:a.cDate||t.cDate,h=a.mDate||t.mDate;m("MobileApp")?(p=null,d.extend(a,{byteLength:s.size,fileUrl:s.localURL})):p=s;var g=a.mimeType||s.type;e.authenticate(b,!0).then(function(){return e.upload(o,r,i,p,g,void 0,f,h,b,a)}).then(function(e){c(e.id)},function(e){u(e)},function(e){l&&l(e)})}})})}function o(e,t,n,o,r,a){var l=t.getArtTitleShowName(n)+".micnote",s=ar.userDir+"~export.zip";return p.resolve().then(function(){return t.loadNoteDir(n)}).then(function(){return t.readyForMicnoteFile(n)}).then(function(){return p.nfcall(t.nativeZip,t.getNoteDir(n),s)}).then(function(){var t=new Date;return i(e,n,s,l,o,r,{cDate:t,mDate:t,mimeType:"application/micnote"},a)})}function r(e,t,n,o,r,a){var l=f.getExtension(n.audioName).toLowerCase(),s=t.getArtTitleShowName(n)+"."+l;return p.resolve().then(function(){return t.loadNoteDir(n)}).then(function(){var t=ar.userDir+n.artName+"/"+n.audioName,l=new Date;return i(e,n,t,s,o,r,{cDate:l,mDate:l},a)})}function a(e,t,n,i,o,r,a,l){return s(e,t,n,i,o,r,a,"application/pdf",l)}function l(e,t,n,i,o,r,a,l){return s(e,t,n,i,o,r,a,"application/vnd.google-apps.document",l)}function s(e,t,n,o,r,a,l,s,c,d){var u,m,f=t.getArtTitleShowName(n)+".html",h=ar.userDir+"~tmp_exp.html",v=ar.userDir+"~tmp_exp.html",y=t.getArtTitleShowName(n)+(d?"."+d:""),w=ar.userDir+"~tmp_exp.xxx";return p.resolve().then(function(){return t.loadNoteDir(n)}).then(function(){if(!n.ldoc)return t.loadArtContent(n)}).then(function(){{let e=t.getArtTitleShowName(n);return console.assert(n.ldoc,"ldoc is not loaded yet"),t.editorUtil.genReadableHtml(t,n.ldoc,t.getNoteDir(n),e,!0,c)}}).then(function(e){return p.ninvoke(ar.fileSystem,"saveFile",v,e,"text/html")}).then(function(){return u=null,"application/vnd.google-apps.document"!==s?i(e,n,v,f,u,r,{bConvertToGDoc:!0,mimeType:"text/html"},a).then(function(e){return u=e,g.default.download(e,b,{format:s})}).then(function(e){return p.ninvoke(ar.fileSystem,"saveFile",w,e,s)}).then(function(){l&&l("Exporting <strong>"+y+"</strong>...");var t=new Date;return i(e,n,w,y,o,r,{mimeType:"application/pdf",cDate:t,mDate:t},a)}).then(function(e){return m=e,g.default.deleteFile(b,u)}).then(function(){return m}):(u=null,i(e,n,h,y,u,r,{bConvertToGDoc:!0,mimeType:"text/html"},a).then(function(e){return u=e}))})}function c(e,t,n,o,r,a,l){var s=t.getArtTitleShowName(n)+".html",c=ar.userDir+"~pdf.html";return p.resolve().then(function(){return t.loadNoteDir(n)}).then(function(){return t.createPrintableHtml(n,!1,!0,l)}).then(function(e){return p.ninvoke(ar.fileSystem,"saveFile",c,e,"text/html")}).then(function(){var t=new Date;return i(e,n,c,s,o,r,{mimeType:"text/html",cDate:t,mDate:t},a)})}n.d(t,"c",function(){return o}),n.d(t,"e",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"a",function(){return l}),n.d(t,"b",function(){return c});var d=n(19),u=(n.n(d),n(23)),p=(n.n(u),n(20)),m=(n.n(p),n(6)),f=(n.n(m),n(22),n(21)),h=(n.n(f),n(91),n(7)),g=(n.n(h),n(92),n(93)),v=(n(96),n(126)),b=(n.n(v),window.localHtml(v),"google.gdrive0");log.reg("exportNote")},function(e,t){e.exports='<paper-dialog id="modal-export-note" class="slide x-dialog"  style="width:400px;height:530px" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key >\n  \x3c!-- <div class="slide-header-bg"></div> --\x3e\n  <x-slider selected="main"  attr-for-selected="name">\n    <div class="slide-panel panel-gdrive" name="main">\n      <div class="slide-header">\n\t<paper-button class="left-action action-close">{=common_close=}</paper-button>\n\t<label class="text-title" >EXPORT CLOUD TITLE</label>\n        <paper-button class="right-action action-export">{=export_cloud_export=}</paper-button>\n      </div>\n      <div class="slide-body">\n\t<div class="slide-form x-list-group">\n\t  <div class="x-list-group-item body-action action-sel-folder">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<div class="text-folder long-text">PATH</div>\n\t      </div>\n\t      <label class="slide-label">{=export_cloud_folder=}</label>\n\t    </div>\n\t    <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right"></iron-icon>\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<paper-checkbox class="check-micnote"></paper-checkbox>\n\t      </div>\n\t      <label class="slide-label">.micnote</label>\n\t    </div>\n\t    <div class="form-item-footnote">\n\t      {=export_cloud_mn_footnote=}\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<paper-checkbox class="check-recording"></paper-checkbox>\n\t      </div>\n\t      <label class="slide-label">{=export_cloud_recording=}</label>\n\t    </div>\n\t    <div class="form-item-footnote">\n\t      {=export_cloud_rec_footnote=}\n\t    </div>\n\t    \x3c!-- <div class="form-item-footnote mobile-hide"> --\x3e\n\t    \x3c!-- \tMp3 format. --\x3e\n\t    \x3c!-- </div> --\x3e\n\t    \x3c!-- <div class="form-item-footnote mobile-only"> --\x3e\n\t    \x3c!-- \tM4A format. --\x3e\n\t    \x3c!-- </div> --\x3e\n\t  </div>\n\t  <div class="x-list-group-item gdrive-only">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<paper-checkbox class="check-pdf" ></paper-checkbox>\n\t      </div>\n\t      <label class="slide-label">PDF</label>\n\t    </div>\n\t    <div class="form-item-footnote">\n\t      {=export_cloud_pdf_footnote=}[1]\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item gdrive-only">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<paper-checkbox class="check-gdoc"></paper-checkbox>\n\t      </div>\n\t      <label class="slide-label">Google Doc</label>\n\t    </div>\n\t    <div class="form-item-footnote">\n\t      {=export_cloud_gdoc_footnote=}[1]\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<paper-checkbox class="check-html"></paper-checkbox>\n\t      </div>\n\t      <label class="slide-label">HTML</label>\n\t    </div>\n\t    <div class="form-item-footnote">\n\t      {=export_cloud_html_footnote=}[1]\n\t    </div>\n\t  </div>\n\t</div>\n        <div class="form-footnote">\n\t  <div class ="" >\n\t    {=export_cloud_options=}\n\t  </div>\n        </div>\n        <div class="slide-form x-list-group">\n\t  <div class="x-list-group-item">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<paper-checkbox class="check-with-abm" ></paper-checkbox>\n\t      </div>\n\t      <label class="slide-label">{=export_cloud_with_abm_label=}</label>\n\t    </div>\n            <div class="form-item-footnote">\n\t      <span class=\'gdrive-only\'>{=export_cloud_with_abm_footnote_gdrive=}</span>\n\t      <span class=\'dropbox-only\'>{=export_cloud_with_abm_footnote_dropbox=}</span>\n\t    </div>\n\t  </div>\n          <div class="form-footnote small">\n\t    <div class ="" >\n\t      [1]{==footnote_exp_doc_problem==}\n\t    </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="slide-panel panel-export" name="export">\n      <div class="slide-header">\n      \t<paper-button class="left-action action-close" disabled >\n\t  {=common_close=}\n\t</paper-button>\n      </div>\n      <div class="slide-body">\n\t<div class="progress">\n\t  <paper-progress class="progress-bar" value="0" style="width:100%">\n\t  </paper-progress>\n          <div class="text-prog" style="text-align:center">\n            &nbsp;\n          </div>\n\t</div>\n\t<div class="text-status">\n\t</div>\n        <p style="text-align: center">\n\t  <paper-button class="action-cancel-exp text-warning" raised>\n\t    {=common_cancel=}\n\t  </paper-button>\n          <paper-button class="action-open-gdrive text-primary" style="display:none" raised>\n\t    OPEN XXX WEB\n          </paper-button>\n        </p>\n      </div>\n    </div>\n  </x-slider>\n</paper-dialog>\n'},function(e,t){e.exports=function(e){return null!==e&&"object"==typeof e}},function(e,t){var n=/[\u007f-\uffff]/g;e.exports=function(e){return JSON.stringify(e).replace(n,function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)})}},function(e,t,n){"use strict";var i,o,r=n(19),a=(n.n(r),n(23)),l=(n.n(a),n(20)),s=(n.n(l),n(6)),c=(n.n(s),n(22)),d=n(21),u=(n.n(d),n(91),n(7)),p=(n.n(u),n(92),n(130)),m=n(131),f=n(117),h=n(98),g=(n(110),r.extend(Object.create(c.default.Observer),{create:function(e,t,n){var a=this;r.extend(a,{home:e,$el:e.$el.find("#photo-view"),$list:e.$el.find("#photo-list"),items:[],curViewMode:"Preview",tmpDir:t,trashedItems:[],curViewer:null}),a.settings=r.defaults(n||{},{bFullViewer:!1});var l=Object.create(h.c);l.create(1),a.history=l,i||(i=e.$el.find("#photo-item-templ")[0].innerHTML,e.$el.find("#photo-item-templ").remove()),o||(o=e.$el.find("#photo-hint-item-templ")[0].innerHTML,e.$el.find("#photo-hint-item-templ").remove()),a.$list[0].dataset.viewMode=a.curViewMode,a.bindEvents();var s=Object.create(y);s.init(a);var d=p.b({home:a.home,lib:s,bSmall:!0});d.on("delete",function(e){var t=a.findItemElem(e);a.uiDeleteItems(t)}),d.on("resize",function(){a.fullViewer.lib.setCurItem(d.lib.getCurItem()),a.$el[0].selected="pv-viewer-full-view",a.curViewer=d,a.$el[0].async(function(){a.fullViewer.refresh().then(function(){})}),a.settings.bFullViewer=!0,a.fire("settings-changed",a.settings)}),d.on("back",function(){if(a.$list.find(".photo-item").removeAttr("hero-id"),a.$list.find(".photo-item").removeAttr("hero"),d.lib.curItem){var e=a.findItemElem(d.lib.curItem.name);e.attr("hero-id","hero"),e.addAttr("hero")}a.$el[0].selected="pv-list-view",a.curViewer=null,a.fire("enable-toggler")}),d.on("time-play",function(){var e=d.lib.curItem;e.time&&a.home.gotoAbm(e.time)}),d.on("set-time",function(){var e=d.lib.curItem,t=Object.create(b),n=a.home.getCurAudioTime();t.create(a,e,n),t.execute(),a.history.add(t)}),a.$el.find("#pv-viewer-embedded-view").append(d.$el),a.embeddedViewer=d;var u=Object.create(y);u.init(a);var f=p.b({home:a.home,lib:u,bSmall:!1});f.on("delete",function(e){var t=a.findItemElem(e);a.uiDeleteItems(t)}),f.on("resize",function(){a.embeddedViewer.lib.setCurItem(f.lib.getCurItem()),a.$el[0].selected="pv-viewer-embedded-view",a.curViewer=f,a.$el[0].async(function(){a.embeddedViewer.refresh().then(function(){})}),a.settings.bFullViewer=!1,a.fire("settings-changed",a.settings)}),f.on("back",function(){if(a.$el[0].selected="pv-list-view",f.lib.curItem){var e=a.findItemElem(f.lib.curItem.name);e.attr("hero-id","hero"),e.addAttr("hero")}a.curViewer=null,a.fire("enable-toggler")}),f.on("time-play",function(){var e=f.lib.curItem;e.time&&a.home.gotoAbm(e.time)}),f.on("set-time",function(){var e=f.lib.curItem;e.time=a.home.getCurAudioTime(),a.updateItemTime(e),a.fire("model-changed")}),a.$el.find("#pv-viewer-full-view").append(f.$el),a.fullViewer=f;var g=Object.create(m.a);g.create(a.home),g.$el.find(".action-take").addAttr("hero").attr("hero-id","hero-photo-taker"),g.$el.addAttr("cross-fade"),g.on("save",function(e){var t=new c.default.DateFmt("%y-%m-%d_%H.%M.%S"),n=e.type.replace("image/","");"jpeg"===n&&(n="jpg");var i=t.format(new Date)+"."+n;a.onImportImage([{data:e,title:i}])}),g.on("back",function(){a.$el[0].selected="pv-list-view",a.curViewer=null,a.fire("enable-toggler")}),a.$el.find("#pv-photo-taker-view").append(g.$el),a.ptaker=g},bindEvents:function(){var e=this,t=e.$el,n=e.home;t.on("click",".photo-item",function(){var n=e.findItem(this.dataset.name);if("Preview"===e.curViewMode){e.$list.find(".photo-item").removeAttr("hero-id"),e.$list.find(".photo-item").removeAttr("hero"),$(this).attr("hero-id","hero"),$(this).addAttr("hero");var i=e.settings.bFullViewer?e.fullViewer:e.embeddedViewer;i.lib.setCurItem(n),t[0].selected=e.settings.bFullViewer?"pv-viewer-full-view":"pv-viewer-embedded-view",e.curViewer=i,t[0].async(function(){i.refresh()}),e.fire("disable-toggler")}else"Select"===e.curViewMode&&(e.bCancelNextSel?e.bCancelNextSel=!1:e.toggleItemSel(n))}),$(".action-take-photo",t).on("click",function(){e.$list.find(".photo-item").removeAttr("hero-id"),e.$list.find(".photo-item").removeAttr("hero"),t[0].selected="pv-photo-taker-view",e.curViewer=null,e.ptaker.enter(),e.fire("disable-toggler")}),$("#pv-menu .action-select",t).on("click",function(){e.changeViewMode("Select")}),$("#pv-sel-toolbar .action-cancel",t).on("click",function(){e.changeViewMode("Preview")}),$("#photo-list[data-view-mode='Preview']",t).on("click",".photo-item .action-play",function(){var t=$(this).parents(".photo-item").data("item");return t.time&&e.home.gotoAbm(t.time),!1}),$("#photo-list[data-view-mode='Preview']",t).on("click",".photo-item .icon-check",function(){e.changeViewMode("Select")}),$("#photo-list[data-view-mode='Preview']",t).hammer({domEvents:!0}).on("press",".photo-item",function(){e.changeViewMode("Select"),e.bCancelNextSel=!0}),$("#pv-sel-toolbar .action-delete",t).on("click",function(){var t=e.getSeledItemElems();e.uiDeleteItems(t)}),$("#pv-toolbar .action-import-pic",t).on("click",function(){var t=Object.create(f.a);t.create(n,{type:"Blob",heading:localString("pv_import_pic")},function(t,n){t?c.default.toastShowLongCenter(localString("insert_image_failed"),"error"):n.length&&e.onImportImage(n)}),t.show(this)}),$("#pv-toolbar .action-import-pdf",t).on("click",function(){ar.leToolbar.showInsertPdfMenu(this,{heading:localString("pv_import_pdf")})}),$("#pv-menu .action-undo",t).on("click",function(){e.undoDelete()}),e.history.on("changed",function(){e.history.canUndo()?$("#pv-menu .action-undo",t).text(window.localString("pv_menu_undo",e.history.getUndoShowName())).removeAttr("disabled"):$("#pv-menu .action-undo",t).text(window.localString("pv_menu_undo","")).addAttr("disabled")})},onImportImage:function(e){var t=this,n=l.resolve(),i=0;r.each(e,function(e){var o=e.data,r=e.title,a=o.type.replace("image/","");"jpeg"===a&&(a="jpg");var s,c,u=d.genHash(16)+"."+a,p=t.photoDir+"/"+u,m=t.makeImgUrl(u);n=n.then(function(){return l.ninvoke(ar.fileSystem,"saveFile",p,o,o.type)}).then(function(){var e=l.defer(),t=new Image;return t.onload=function(){s=this.width,c=this.height,s&&c?e.resolve(!1):(log.error("zero size image"),e.resolve(!0))},t.src=m,e.promise}).then(function(e){if(!e){var n=null;ar.bRecording&&(n=t.home.getCurAudioTime());var o={name:u,origFileName:r,width:s,height:c,imgSrc:m,time:n};t.addItem(o),i++}})}),n.then(function(){c.default.toastShowShortCenter(localString("pv_image_inserted_success",e.length),"info")},function(){c.default.toastShowLongCenter(localString("common_failed"),"error")}).finally(function(){i&&t.fire("model-changed")})},uiDeleteItems:function(e){var t=this,n=Object.create(h.a);n.create(),n.showName=localString("common_delete");var i=l.resolve();r.each(e,function(e){i=i.then(function(){var i=$(e).data("item"),o=t.items.indexOf(i);t.removeItem(i.name);var r=t.photoDir+"/"+i.filename,a=t.tmpDir+"/"+i.filename;return l.ninvoke(ar.fileSystem,"moveTo",r,a).then(function(){var e=Object.create(v);e.create(t,o,i),n.add(e)},function(e){log.error("moved image to temp dir failed")})})}),i.then(function(){t.history.add(n),t.changeViewMode("Preview"),t.fire("model-changed"),c.default.toastShowLongCenter(localString("pv_img_deleted",e.length),"info",null,localString("common_undo"),function(){t.undoDelete()})})},undoDelete:function(){this.history.undo().then(function(){r.delay(function(){c.default.toastShowShortCenter(localString("common_undo_success"))})})},changeViewMode:function(e){var t=this,n=t.$el;"Preview"===e?($("#pv-toolbar",n).show("fast"),$("#pv-sel-toolbar",n).hide("fast"),t.curViewMode="Preview",t.$list[0].dataset.viewMode="Preview",t.toggleAllItemsSel(!1),$(".action-take-photo",n).fadeIn(),t.$el[0].selected="pv-list-view",t.curViewer=null):"Select"===e&&($("#pv-toolbar",n).hide("fast"),$("#pv-sel-toolbar",n).show("fast"),t.curViewMode="Select",t.$list[0].dataset.viewMode="Select",$(".action-take-photo",n).fadeOut())},toggleItemSel:function(e,t){var n=this,i=n.findItemElem(e.name),o="true"===i.attr("data-checked")||!1;o=void 0===t?!o:t,i.attr("data-checked",o),i.find(".icon-check").attr("icon",o?"check-box":"check-box-outline-blank"),n.onSelChanged()},toggleAllItemsSel:function(e){var t=this;r.each(t.items,function(n){t.toggleItemSel(n,e)})},getSeledItemElems:function(){return this.$list.find(".photo-item[data-checked='true']")},onSelChanged:function(){var e=this,t=e.getSeledItemElems();$("#pv-sel-toolbar .action-delete",e.$el).toggleAttr("disabled",0===t.length),$("#pv-sel-toolbar .label-sel-status",e.$el).text(localString("pv_sel_status",t.length))},updateItemTime:function(e,t){var n=this,i="number"==typeof e.time?n.home.makeBmTimeStr(e.time):"",o=t||n.findItemElem(e.name);o.find(".action-play").toggle("number"==typeof e.time),o.find(".action-play .label-time").text(i)},makeImgUrl:function(e){var t=this;return ar.fileSystem.getDirUrl(t.photoDir)+"/"+e},addItem:function(e,t,n){var o=this,r=window.localHtml(i,{rt_name:e.name,rt_img_src:e.imgSrc,rt_time:""}),l=c.default.htmlToElement(r,!0),s=$(l);s.data("item",e),o.updateItemTime(e,s);var d=s.find("img");if(e.width&&e.height)if(e.width>200&&e.height>200)if(e.width>e.height){p=e.width/e.height*200;d.css("height",200),d.css("margin-left",-(p-200)/2)}else{u=e.height/e.width*200;d.css("width",200),d.css("margin-top",-(u-200)/2)}else if(e.width>200){var u=e.height/e.width*200;d.css("margin-top",(200-u)/2),d.css("width",200)}else if(e.height>200){var p=e.width/e.height*200;d.css("margin-left",(200-p)/2),d.css("height",200)}else d.css("margin-top",(200-e.height)/2),d.css("margin-left",(200-e.width)/2);else d.css("max-width",200),d.css("max-height",200);var m;if(m=t?o.$list.find(a.sprintf(".photo-item[data-name='%s']",t.name)):o.$list.find(".hint-item"),s.insertBefore(m),!n)if(t){var f=o.items.indexOf(t);o.items.splice(f,0,e)}else o.items.push(e)},removeItem:function(e,t){var n=this,i=n.findItemElem(e),o=i.data("item");if(i.remove(),!t){var r=n.items.indexOf(o);n.items.splice(r,1)}},findItem:function(e){var t=this;return r.findWhere(t.items,{name:e})},findItemElem:function(e){return this.$list.find(".photo-item[data-name='"+e+"']")},refreshItems:function(){var e=this;e.changeViewMode("Preview"),e.$list.find(".pv-item").remove();var t=window.localHtml(o,{}),n=c.default.htmlToElement(t,!0);e.$list.append(n),r.each(e.items,function(t){e.addItem(t,null,!0)})},enter:function(){this.changeViewMode("Preview")},setModel:function(e,t){var n=this;n.photoDir=t,n.items=[],r.each(e,function(e){var t=r.clone(e);t.imgSrc=n.makeImgUrl(e.filename),n.items.push(t)}),n.refreshItems(),n.history.clear()},getModel:function(e){var t=this;e.splice(0,e.length),r.each(t.items,function(t){e.push({name:t.name,filename:t.filename,origFileName:t.origFileName,width:t.width,height:t.height,time:t.time})})}})),v=r.extend(Object.create(h.b),{create:function(e,t,n){this.pview=e,this.idx=t,this.item=n,this.showName=localString("common_delete")},unexecute:function(){var e=this.item,t=this.pview.tmpDir+"/"+e.filename,n=this.pview.photoDir+"/"+e.filename,i=this;return l.ninvoke(ar.fileSystem,"moveTo",t,n).then(function(){var t=i.pview.items[i.idx];i.pview.addItem(e,t,!1),i.pview.fire("model-changed")})}}),b=r.extend(Object.create(h.b),{create:function(e,t,n){this.pview=e,this.item=t,this.time=n,this.showName=localString("pv_set_time_cmd")},execute:function(){var e=this.item.time;this.item.time=this.time,this.time=e,this.pview.updateItemTime(this.item),c.default.FunObserver.fire(this.pview,"model-changed"),this.pview.curViewer&&this.pview.curViewer.lib.curItem===this.item&&this.pview.curViewer.updateTime(!0);var t=this;c.default.toastShowLongCenter(localString("pv_set_time_success",t.pview.home.makeBmTimeStr(this.item.time)),"info",null,localString("common_undo"),function(){t.pview.history.undo().then(function(){c.default.toastShowShortCenter(localString("common_undo_success"))})})},unexecute:function(){var e=this.item,t=e.time;e.time=this.time,this.time=t,this.pview.updateItemTime(this.item),c.default.FunObserver.fire(this.pview,"model-changed"),this.pview.curViewer&&this.pview.curViewer.lib.curItem===this.item&&this.pview.curViewer.updateTime(!0)}}),y=r.extend(Object.create(p.a),{init:function(e,t){this.pview=e,this.curItem=t},setCurItem:function(e){this.curItem=e},getCurItem:function(){return this.curItem},getCurImgSrc:function(){return this.curItem.imgSrc},getCurImgName:function(){return this.curItem.name},getCurImgSaveFileName:function(){return this.curItem.origFileName||this.curItem.filename},getCurImgPath:function(){return this.pview.photoDir+"/"+this.curItem.filename},getCurImgWidth:function(){return this.curItem.width},getCurImgHeight:function(){return this.curItem.height},getCurImgTimeStr:function(){return"number"==typeof this.curItem.time&&this.pview.home.makeBmTimeStr(this.curItem.time)},prev:function(){var e=this.pview.items,t=r.indexOf(e,this.curItem);if(t>0){var n=e[t-1];return this.curItem=n,!0}return!1},next:function(){var e=this.pview.items,t=r.indexOf(e,this.curItem);if(t<e.length-1){var n=e[t+1];return this.curItem=n,!0}return!1},hasPrev:function(){var e=this.pview.items;return r.indexOf(e,this.curItem)>0},hasNext:function(){var e=this.pview.items;return r.indexOf(e,this.curItem)<e.length-1}});t.a=g},function(e,t,n){"use strict";function i(e,t){var n=Object.create(f);return n.create(e.home,e.lib,e.bSmall,t),n}n.d(t,"b",function(){return i}),n.d(t,"a",function(){return h});var o,r=n(19),a=(n.n(r),n(23)),l=(n.n(a),n(20)),s=(n.n(l),n(6)),c=(n.n(s),n(22)),d=n(21),u=(n.n(d),n(91),n(7)),p=(n.n(u),n(92),n(177)),m=n(105),f=r.extend(Object.create(c.default.Observer),{create:function(e,t,n,i){var r=this;if(r.home=e,r.lib=t,r.cbOnClose=i,r.touchStartDistSq=null,!o){var a=$("#common").find("#pic-viewer-templ")[0];o=Polymer.dom(a).innerHTML,a.parentNode.removeChild(a)}var l=window.localHtml(o),s=c.default.htmlToElement(l,!0);r.el=s,r.$el=$(s),r.$el.css("display",""),r.animPages=r.$el.find(".img-anim")[0];var d=r.$el.find(".img-anim .img-cont");console.assert(3===d.length),r.items=[];for(var u=0;u<3;++u)r.items.push({$cont:$(d[u]),image:$(d[u]).find("img")[0]});r.curImgIdx=0,r.cur=r.items[r.curImgIdx],r.bindEvents(),r.resize(n)},bindEvents:function(){function e(e){var t=e[0].pageX,n=e[0].pageY,i=e[1].pageX,o=e[1].pageY;return(i-t)*(i-t)+(o-n)*(o-n)}function t(t,n){i.touchStartDistSq=e(t),i.touchStartScale=i.cur.imgCurScale;var o=(t[0].pageX+t[1].pageX)/2,r=(t[0].pageY+t[1].pageY)/2,a=$(n).find("img").offset(),l=o-a.left,s=r-a.top,c=l/i.cur.imgViewWidth,d=s/i.cur.imgViewHeight;i.touchRelXInImg=c,i.touchRelYInImg=d}function n(){var e=_$(".img-cont",i.$el),t=e.scrollLeft+e.clientWidth/2,n=e.scrollTop+ +e.clientHeight/2;return{x:t/i.cur.imgViewWidth,y:n/i.cur.imgViewHeight}}var i=this,o=i.$el;i.home;o.on("keydown",function(e){27===e.keyCode?c.default.clickButtonWithAnim($(".action-back",o)):37===e.keyCode?c.default.clickButtonWithAnim($(".action-prev",o)):39===e.keyCode&&c.default.clickButtonWithAnim($(".action-next",o))}),$(".action-back",o).on("click",function(){i.fire("back")}),o.on("x-backbutton",function(e){return i.fire("back"),!1}),o.on("iron-overlay-closed",function(){o.remove(),i.cbOnClose&&i.cbOnClose()}),o.hammer({domEvents:!0}).on("doubletap",".img-cont",function(e,t){Math.abs(i.cur.imgCurScale-i.cur.imgMaxScale)<.1?i.cur.imgCurScale=i.cur.imgMinScale:i.cur.imgCurScale=i.cur.imgMaxScale;var n=e.pageX,o=e.pageY,r=$(this).find("img").offset(),a=n-r.left,l=o-r.top,s=a/i.cur.imgViewWidth,c=l/i.cur.imgViewHeight;i.adjustForImageScale(i.curImgIdx,{x:s,y:c})}),o.on("touchmove",".img-cont",function(n){if(2===n.originalEvent.touches.length)if(null!==i.touchStartDistSq){var o=(e(n.originalEvent.touches)-i.touchStartDistSq)/25e4,r=i.touchStartScale+o;r=Math.max(r,i.cur.imgMinScale),r=Math.min(r,i.cur.imgMaxScale),i.cur.imgCurScale=r,i.adjustForImageScale(i.curImgIdx,{x:i.touchRelXInImg,y:i.touchRelYInImg})}else t(n.originalEvent.touches,this)}).on("touchstart",function(e){2===e.originalEvent.touches.length?t(e.originalEvent.touches,this):i.touchStartDistSq=null}).on("touchend",function(){i.touchStartDistSq=null}),o.hammer({domEvents:!0}).on("swipeleft",".img-cont",function(e,t){i.bPanable||i.next()}).on("swiperight",".img-cont",function(e,t){i.bPanable||i.prev()}),$(".action-zoom-in",o).on("click",function(e){var t=(i.cur.imgMaxScale-i.cur.imgMinScale)/5,o=Math.min(i.cur.imgCurScale+t,i.cur.imgMaxScale);i.cur.imgCurScale=o,i.adjustForImageScale(i.curImgIdx,n())}),$(".action-zoom-out",o).on("click",function(e){var t=(i.cur.imgMaxScale-i.cur.imgMinScale)/5,o=Math.max(i.cur.imgCurScale-t,i.cur.imgMinScale);i.cur.imgCurScale=o,i.adjustForImageScale(i.curImgIdx,n())}),$(".action-next",o).on("click",function(){i.lib.hasNext()&&i.next()}),$(".action-prev",o).on("click",function(){i.lib.hasPrev()&&i.prev()}),$(".action-time",o).on("click",function(){i.fire("time-play")}),$(".action-set-time",o).on("click",function(){i.fire("set-time")}),$(".action-del",o).on("click",function(){i.fire("delete",i.lib.getCurImgName())}),$(".action-save",o).on("click",function(){var e=i.lib.getCurImgPath(),t=i.lib.getCurImgSaveFileName(),n=Object.create(p.a);n.create(i.home,e,t,localString("export_menu_save_file",t)),n.show({toggler:this}).then(function(e){c.default.toastShowShortCenter(localString("saved_image_success",e))},function(e){"cancel"!==e&&c.default.toastShowLongCenter(localString("common_failed"),"error")})}),$(".action-share",o).on("click",function(){var e=i.lib.getCurImgPath(),t=i.lib.getCurImgSaveFileName();m.mobileShareFile(i.home,e,t).then(function(){c.default.toastShowShortCenter(localString("common_success"))},function(e){"cancel"!==e&&c.default.toastShowShortCenter(localString("common_failed"),"error")})}),$(".action-resize-small",o).on("click",function(){i.fire("resize")}),$(".action-resize-full",o).on("click",function(){i.fire("resize")}),s("MobileApp")||s("FakeMobile")||($(".img-cont",o).on("mousedown",function(e){i.bPanable&&(i.bPanning=!0,i.padStartX=e.pageX,i.padStartY=e.pageY,i.padStartScrollLeft=this.scrollLeft,i.padStartScrollTop=this.scrollTop,$(this).addClass("panning"))}),$(".img-cont",o).on("mouseup",function(e){i.bPanable&&($(this).removeClass("panning"),i.bPanning=!1)}),$(".img-cont",o).on("mousemove",function(e){if(i.bPanning){var t=e.pageX-i.padStartX,n=e.pageY-i.padStartY;this.scrollLeft=i.padStartScrollLeft-t,this.scrollTop=i.padStartScrollTop-n}}))},resize:function(e){void 0===e?(this.$el.find(".action-resize-small").hide(),this.$el.find(".action-resize-full").hide()):(this.$el.find(".action-resize-small").toggle(!e),this.$el.find(".action-resize-full").toggle(e))},next:function(){var e=this;if(e.lib.next()){var t=(e.curImgIdx+1)%3,n=e.items[t].$cont;n[0];e.animPages.entryAnimation="slide-from-right-animation",e.animPages.exitAnimation="slide-left-animation",e.curImgIdx=t,e.cur=e.items[t],e.animPages.selected=n.attr("name"),e.refresh()}},prev:function(){var e=this;if(e.lib.prev()){var t=(e.curImgIdx+3-1)%3,n=e.items[t].$cont;n[0];e.animPages.entryAnimation="slide-from-left-animation",e.animPages.exitAnimation="slide-right-animation",e.curImgIdx=t,e.cur=e.items[t],e.animPages.selected=n.attr("name"),e.refresh()}},adjustForImageScale:function(e,t){var n=this,i=n.$el,o=(n.home,n.items[e]),r=o.$cont,a=o.image,l=o.imgCurScale*o.imgWidth,s=o.imgCurScale*o.imgHeight,c=i.width(),d=i.height();a.style["margin-left"]=l>c?"0px":(c-l)/2+"px",a.style["margin-top"]=s>d?"0px":(d-s)/2+"px",o.imgViewWidth=l,o.imgViewHeight=s,a.style.width=l+"px",a.style.height=s+"px";var u=r[0];if(t){var p=t.x*l-c/2,m=t.y*s-d/2;p<0?p=0:p>l-c&&(p=l-c),m<0?m=0:m>s-d&&(m=s-d),u.scrollLeft=p,u.scrollTop=m}if(e===n.curImgIdx){u.scrollWidth-u.clientWidth>5||u.scrollHeight-u.clientHeight>5?$(u).addClass("padable"):$(u).removeClass("padable"),n.$el.find(".action-zoom-in").toggleAttr("disabled",Math.abs(o.imgCurScale-o.imgMaxScale)<.01),n.$el.find(".action-zoom-out").toggleAttr("disabled",Math.abs(o.imgCurScale-o.imgMinScale)<.01),n.bPanable=Math.abs(o.imgCurScale-o.imgMinScale)>.01}},changeImage:function(e,t,n,i){function o(e,t){a.imgWidth=e,a.imgHeight=t;var n=c.width(),o=c.height();console.assert(n&&o),o/n>t/e?(a.imgWidthMajor=!0,n<a.imgWidth?a.imgMinScale=n/e:a.imgMinScale=1):(a.imgWidthMajor=!1,o<a.imgHeight?a.imgMinScale=o/t:a.imgMinScale=1),a.imgMaxScale=1,a.imgCurScale=a.imgMinScale,r.adjustForImageScale(i)}var r=this,a=r.items[i],s=(a.$cont,a.image);e!==s.src&&(s.src=e);var c=r.$el,d=(r.home,t),u=n;if(d&&u)return o(d,u),l.resolve();var p=l.defer();return $(s).on("load",function(){o(s.naturalWidth,s.naturalHeight),p.resolve()}),p.promise},updateTime:function(e){var t=this.lib.getCurImgTimeStr(),n=this.$el.find(".action-time");n.text(t||""),t&&e?(n.show(),n.cssAnimate("bounceIn")):n.toggle(!!t)},refresh:function(){var e=this;return e.$el.find(".action-next").toggleAttr("disabled",!e.lib.hasNext()),e.$el.find(".action-prev").toggleAttr("disabled",!e.lib.hasPrev()),e.updateTime(),e.bPanning=!1,e.changeImage(e.lib.getCurImgSrc(),e.lib.getCurImgWidth(),e.lib.getCurImgHeight(),e.curImgIdx).then(function(){if(e.lib.hasNext()){var t=(e.curImgIdx+1)%3;e.lib.next();var n=e.lib.getCurImgSrc(),i=e.lib.getCurImgWidth(),o=e.lib.getCurImgHeight();return e.lib.prev(),e.changeImage(n,i,o,t)}}).then(function(){if(e.lib.hasPrev()){var t=(e.curImgIdx+3-1)%3;e.lib.prev();var n=e.lib.getCurImgSrc(),i=e.lib.getCurImgWidth(),o=e.lib.getCurImgHeight();return e.lib.next(),e.changeImage(n,i,o,t)}})},enter:function(){var e=this;e.refresh(),e.$el.focus()}}),h={getCurImgSrc:null,getCurImgName:null,getCurImgSaveFileName:null,getCurImgPath:null,getCurImgWidth:null,getCurImgHeight:null,getCurImgTimeStr:null,next:null,prev:null,hasNext:null,hasPrev:null}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i,o=n(19),r=(n.n(o),n(23)),a=(n.n(r),n(20)),l=(n.n(a),n(6)),s=(n.n(l),n(22)),c=n(21),d=(n.n(c),n(91),n(7)),u=(n.n(d),o.extend(Object.create(s.default.Observer),{create:function(e){var t=this;if(t.home=e,!i){var n=_$("#common #photo-taker-templ");i=Polymer.dom(n).innerHTML,n.parentNode.removeChild(n)}var o=window.localHtml(i),r=s.default.htmlToElement(o,!0);t.$el=$(r),t.$el.css("display",""),t.$video=t.$el.find("video"),t.$img=t.$el.find("img"),t.$canvas=t.$el.find("canvas"),t.ctx=t.$canvas[0].getContext("2d"),t.bindEvents()},bindEvents:function(){var e=this;window.addEventListener("resize",function(t){e.applySize()}),$(".action-back",e.$el).on("click",function(){if(e.localMediaStream){var t=e.localMediaStream.getTracks()[0];t&&t.stop(),e.localMediaStream=null}_$(".take-anim",e.$el).selected=0,e.fire("back")}),$(".action-take",e.$el).on("click",function(){e.localMediaStream&&(e.ctx.drawImage(e.$video[0],0,0),e.$img[0].src=e.$canvas[0].toDataURL("image/png"),e.$img.fadeIn(),e.$video.fadeOut(),_$(".take-anim",e.$el).selected=1,e.$el.find(".action-yes").show().cssAnimate("fadeIn slideInLeft"),e.$el.find(".action-no").show().cssAnimate("fadeIn slideInRight"),e.$el.find(".action-take").css("-webkit-transform-origin","50% 50% 0px").cssAnimate("zoomOut",!0))}),$(".action-yes",e.$el).on("click",function(){var t=s.default.dataUrlToBlob(e.$img[0].src);e.fire("save",t),e.realTimeReady(!0)}),$(".action-no",e.$el).on("click",function(){e.realTimeReady(!0)}),e.$video[0].addEventListener("playing",function(){0===this.videoWidth?(console.error("videoWidth is 0. Camera not connected?"),e.videoNaturalWidth=640,e.videoNaturalHeight=480):(e.videoNaturalWidth=this.videoWidth,e.videoNaturalHeight=this.videoHeight),e.$video.fadeIn(),e.$el.find(".label-initializing").fadeOut(),e.$el.find(".action-take").removeAttr("disabled"),e.applySize()},!1)},applySize:function(){var e=this;if(e.videoNaturalWidth||e.videoNaturalHeight){var t=e.$el.find(".video-view").width(),n=e.$el.find(".video-view").height();t/n>e.videoNaturalWidth/e.videoNaturalHeight?(e.$video.css("height","100%"),e.$video.css("width",""),n,e.videoNaturalWidth/e.videoNaturalHeight*n,e.$img.css("height","100%"),e.$img.css("width","")):(e.$video.css("width","100%"),e.$video.css("height",""),t,e.videoNaturalHeight/e.videoNaturalWidth*t,e.$img.css("width","100%"),e.$img.css("height","")),e.$canvas.attr("width",e.videoNaturalWidth),e.$canvas.attr("height",e.videoNaturalHeight)}},enter:function(){var e=this;e.$video.hide(),e.$el.find(".label-initializing").show(),e.$el.find(".action-take").addAttr("cross-fade").addAttr("disabled"),e.realTimeReady(),navigator.getUserMedia({video:!0},function(t){e.$video[0].src=window.URL.createObjectURL(t),e.localMediaStream=t},function(){s.default.toastShowLongCenter(localString("pt_video_failed"),"error"),e.$el.find(".action-take").addAttr("disabled")})},leave:function(){var e=this;$(".action-back",e.$el).click()},realTimeReady:function(e){var t=this;t.$el.find(".action-take").removeClass("animated"),_$(".take-anim",t.$el).selected=0,e?(t.$img.fadeOut(),t.localMediaStream&&t.$video.fadeIn()):(t.$img.hide(),t.localMediaStream&&t.$video.show())}}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"LEToolbar",function(){return w}),n.d(t,"TOOLBAR_MOUSE_EVT",function(){return v}),n.d(t,"desktopTakePhotoStream",function(){return o});var i,o,r=n(19),a=(n.n(r),n(20)),l=(n.n(a),n(6)),s=(n.n(l),n(91)),c=(n(92),n(22)),d=n(21),u=(n.n(d),n(110)),p=n(8),m=n(7),f=(n.n(m),n(117)),h=n(98),g=(n(97),n(118),n(119),n(129),n(133)),v="click",b=Kefir.stream(function(e){return i=e,function(){}}),y=Kefir.merge([b.filter(e=>"take-photo"===e).map(()=>({insertPos:ar.leditor.makeInsertPos(["active","append"]),cbBack:null})),g.b]);l("MobileApp")?y.onValue(function(e){f.b("Camera",function(t,n){ar.leToolbar.onInsertImage(t,n,e.insertPos).then(function(t){t&&t.length&&ar.leditor.makeLinesVisible(t.last()),e.cbBack&&e.cbBack()})})}):o=y;var w={create:function(e,t,n){var i=this;r.extend(i,{home:e,leditor:t,el:n,$el:$(n)});var o=i.$el.find(".action-forecolor .dropdown");r.each(s.a.FORE_COLORS,function(e,t){var n=document.createElement("PAPER-ITEM");n.dataset.edit="foreColor",n.dataset.value=0===t?"inherit":s.a.FORE_COLORS[t],n.style.background=e,n.classList.add("note-edit-popover-cmd"),o.append(n)}),i.bindEvents(),Kefir.merge([t.textHandler.cursorMoveStream,Kefir.fromEvents(t.$el,"click")]).throttle(300).onValue(function(){i.updateCmdButtonStatus()})},bindEvents:function(){var e=this,t=e.leditor;p.isXSmall()&&$("#xs-insert-image").on("click",function(){e._showInsertImageMenu(this,!1)}),p.vars.$appBody.on("click",".note-edit-cmd",function(n){var i=n.currentTarget.dataset.cmd,o=n.currentTarget;n.originalEvent&&!o.classList.contains("no-restore-active-ln")&&t.restoreActiveLn(),e.handleEditCmd(i,o)}),(l("MobileApp")||l("FakeMobile"))&&(console.assert("mousedown"!==v),e.$el.on("mousedown","*[data-edit]:not(.note-edit-popover-cmd)",function(e){m.DEBUG_FOCUS&&log.debug("toolbar cmd: prevent focus"),t.manualUpdateLineActivelState(),e.preventDefault()}),$("*[data-cmd], .note-edit-popover-trigger",e.$el).on("mousedown",function(e){m.DEBUG_FOCUS&&log.debug("toolbar cmd: prevent focus"),t.manualUpdateLineActivelState(),e.preventDefault()}),p.vars.$appBody.on("mousedown",".editor-focus-safe",function(e){"Edit"===ar.curNoteMode&&e.preventDefault()})),e.$el.on(v,"*[data-edit]",function(e){return e.originalEvent&&t.restoreActiveLn(),t.execEditCmd(this.dataset.edit,this.dataset.value),!1}),$(".action-save",e.$el).on(v,function(){return e.home.manualSaveCurArticleContent(),!1}),t.history.on("changed",function(){var e=t.history;$(".note-edit-cmd[data-cmd='undo']").toggleAttr("disabled",!e.canUndo()),$(".note-edit-cmd[data-cmd='redo']").toggleAttr("disabled",!e.canRedo())})},handleEditCmd:function(e,t){var n=this,o=n.leditor;if("undo"===e)o.history.canUndo()&&o.history.undo();else if("redo"===e)o.history.canRedo()&&o.history.redo();else if("bullet-list"===e||"numbered-list"===e){var r="bullet-list"===e?s.a.ListType.BULLET:s.a.ListType.NUMBERED;o.cmdListType(r)}else if("indent"===e)o.cmdIndent_();else if("outdent"===e)o.cmdOutdent_();else if("insert-image"===e)n._showInsertImageMenu(t,!0);else if("insert-pdf"===e)n.showInsertPdfMenu(t);else if("take-photo"===e)i.emit("take-photo");else if("insert-abm"===e)o.textHandler.cmdInsertAbm();else if("set-line-abm"===e){var a=o.getOperatingLns();if(a.length){var l=a.line(),c=n.home.getCurAudioTime();null==l.time||Math.abs(l.time-c)>s.a.TIME_EPSILON?o.cmdSetLinesTime(a,c):o.cmdSetLinesTime(a,null),c&&o.once("abm-list-updated",function(){a.find(".line-abm").cssAnimate("bounceIn")})}}else if("highlight"===e){d="rgba(255,255,0,.5)";o.execEditCmd("HiliteColor",d)}else if("clear-highlight"===e){var d="transparent";o.execEditCmd("HiliteColor",d)}},updateButtonStates:function(e){var t=this;if(e)t.$el.find("x-icon-button").toggleAttr("disabled",!0);else{t.$el.find("x-icon-button").toggleAttr("disabled",!1);var n=t.leditor.history;$(".note-edit-cmd[data-cmd='undo']").toggleAttr("disabled",!n.canUndo()),$(".note-edit-cmd[data-cmd='redo']").toggleAttr("disabled",!n.canRedo())}},updateCmdButtonStatus:function(){var e=this;e.doUpdateCmdButton(_$("*[data-edit='bold']",e.$el)),e.doUpdateCmdButton(_$("*[data-edit='italic']",e.$el)),e.doUpdateCmdButton(_$("*[data-edit='strikeThrough']",e.$el));var t=e.leditor.getActiveLn().parentLn().line();t&&t.listType===s.a.ListType.NUMBERED?$("*[data-cmd='numbered-list']",e.$el).addAttr("active"):$("*[data-cmd='numbered-list']",e.$el).removeAttr("active"),t&&t.listType===s.a.ListType.BULLET?$("*[data-cmd='bullet-list']",e.$el).addAttr("active"):$("*[data-cmd='bullet-list']",e.$el).removeAttr("active")},doUpdateCmdButton:function(e){var t=e.dataset.edit,n=e.dataset.value;n&&document.queryCommandEnabled(t)&&document.queryCommandValue(t)==n?$(e).addAttr("active"):document.queryCommandEnabled(t)&&document.queryCommandState(t)?$(e).addAttr("active"):$(e).removeAttr("active")},showInsertPdfMenu:function(e,t){var n=this,i=(n.leditor,t||{}),o=Object.create(u.a);n.insertPdfPos_=i.pos||ar.leditor.makeInsertPos(["append"]),n.totalPages=0,n.successPdfPages=0,n.importPdfCmd=null,o.create(n.home,i,n.onInsertPdf.bind(n)),o.show(e)},_showInsertImageMenu:function(e,t){var n=this,i=n.leditor;i.saveInsertPos();var o=Object.create(f.a),r={type:"Blob"};l("MobileApp")&&(r.bNoCamera=!!t),o.create(n.home,r,n.onInsertImage.bind(n)),(l("FakeMobile")||l("MobileApp"))&&o.$el.addAttr("no-auto-focus"),o.show(e),l("MobileApp")&&i.refocus()},onInsertPdf:function(e,t){var n=this,i=ar.leditor.ldoc.getTotalImages();if(t&&(n.totalPages=t.totalPages),e)return log.fail(e),"too-many-pics"===e?c.default.toastShowLongCenter(localString("import_too_many_pictures",n.successPdfPages,n.totalPages-n.successPdfPages),"error"):c.default.toastShowLongCenter(localString("import_pdf_failed"),"error"),n.importPdfCmd&&n.importPdfCmd.getNumCmds()&&ar.leditor.history.add(n.importPdfCmd),void(n.importPdfCmd=null);if(n.home.checkMaxImages(i+1)){if(!n.importPdfCmd){var o=Object.create(h.a);o.create(),o.execute(),n.importPdfCmd=o,n.successPdfPages=0}if(t){var r=ar.leditor.makeInsertPos(["append"]),a=(t.title||"")+"["+localString("pdf_page_n",t.pageIdx+1)+"].jpg";return ar.leditor.imageHandler.cmdInsertImage(t.blob,a,r,n.importPdfCmd).then(function(e){var i=n.insertPdfPos_;return ar.leditor.textHandler.cmdInsertTextLine(localString("pdf_page_n",t.pageIdx+1),i,n.importPdfCmd).then(function(){n.successPdfPages++,ar.leditor.makeLinesVisible(e)})})}return n.importPdfCmd&&n.importPdfCmd.getNumCmds()&&ar.leditor.history.add(n.importPdfCmd),n.importPdfCmd=null,void c.default.toastShowLongCenter(localString("import_pdf_succeed",n.successPdfPages))}throw"too-many-pics"},onInsertImage:function(e,t,n){if(e)return c.default.toastShowLongCenter(localString("insert_image_failed"),"error"),a.resolve(null);if(t.length){var i=this,o=i.leditor,l=$();return r.reduce(t,function(e,t){return e.then(function(){var r=o.ldoc.getTotalImages();return i.home.checkMaxImages(r+1)?o.imageHandler.cmdInsertImage(t.data,t.title,n).then(function(e){$.merge(l,e)}):e})},a()).then(function(){let e=l.length;e!==t.length?c.default.toastShowLongCenter(localString("import_too_many_pictures",e,t.length-e),"error"):c.default.toastShowShortCenter(localString("note_image_imported_success",e),"info")},function(e){c.default.toastShowLongCenter(localString("insert_image_failed"),"error")}).then(()=>l)}return a.resolve(null)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return m}),n.d(t,"b",function(){return p});var i,o=n(19),r=(n.n(o),n(20)),a=(n.n(r),n(6)),l=(n.n(a),n(92)),s=n(22),c=n(21),d=(n.n(c),n(91)),u=(n(8),n(7)),p=(n.n(u),n(97),Kefir.stream(function(e){return i=e,function(){}})),m={create(e,t){var n=this;o.extend(n,{home:e,leditor:t,animPages:_$("#hp-animated-pages"),padView:_$("#hp-pad-view"),writeView:_$("#hp-write-view"),togglerView:_$("#hp-toggler-view"),el:_$("#hp-pad-view"),$el:$("#hp-pad-view")}),n.$animPages=$(n.animPages),n.$writeView=$(n.writeView),n.$padView=$(n.padView),n._updateBmStrings(),n._bindEvents(),n.togglerView.animationConfig={exit:[{name:"slide-right-animation",node:n.togglerView}],entry:[{name:"slide-from-right-animation",node:n.togglerView}]},n.padView.animationConfig={exit:[{name:"fade-out-animation",node:n.padView}],entry:[{name:"fade-in-animation",node:n.padView}]},n.writeView.animationConfig={exit:[{name:"fade-out-animation",node:n.writeView}],entry:[{name:"fade-in-animation",node:n.writeView}]},e.recorder.audioCurTimeString.onValue(function(e){n.$padView.find(".label-time").text(e)}),n.$el.find(".action-take-photo").on("click",function(){n.animPages.selected="hp-invisible-view";var e=ar.leditor.makeInsertPos(["append"]);i.emit({insertPos:e,cbBack:function(){n.animPages.selected="hp-pad-view"}})})},_bindEvents(){function e(e,t,n){var i=t.querySelector(".from"),o=t.querySelector(".to");t.animationConfig=[{animatable:o,type:"entry"},{animatable:i,type:"exit"}],i.animationConfig={exit:[{name:"hero-animation",id:"hero",toPage:o}]};var r=e.lnContent();n.style.width=r.width()+"px",n.style.height=r.height()+"px",i.sharedElements={hero:n},o.animationConfig={entry:[{name:"hero-animation",id:"hero",fromPage:i}]},o.sharedElements={hero:r[0]},e.css("z-index","1"),$(t).one("neon-animation-finish",function(e){var t=e.originalEvent.detail;t.$ln&&t.$ln.css("z-index","")}),t.playAnimation(null,{$ln:e})}var t=this,n=t.leditor,i=t.home;$(t.animPages).on("selected-changed",function(e){"hp-pad-view"===this.selected&&(t.newLines=0,o.delay(function(){t.$el.focus()},100))});let r=Kefir.fromEvents($(".action-open",t.togglerView),"click");Kefir.merge([r.map(()=>!1),i.editorUtil.openHotPadByEditMode]).flatMap(e=>(t.animPages.selected="hp-pad-view",a("ChromeApp")&&!a("FakeMobile")&&i.hideNoteList(!0),Kefir.fromEvents(t.$animPages,"neon-animation-finish").take(1).map(()=>e))).onValue(e=>{if(e){let e=t.$el.find(".start-record");s.default.fakeButtonClickAnim(e),e.click();let n=$("#modal-rename-note");i.recorder.recorderStateStream.filter(e=>"stopped"===e).take(1).filter(()=>"hp-pad-view"===t.animPages.selected).flatMap(()=>(n.find(".input-name")[0].value=ar.curArticle.artTitle,n.find(".input-name").inputSelectAll(),n.showModal(()=>{n.find(".input-name").polymerFocus()}),Kefir.merge([Kefir.fromEvents(n.find(".action-rename"),"click").map(()=>"Rename"),Kefir.fromEvents(n,"iron-overlay-closed").map(()=>"Cancel")]).take(1))).onValue(e=>{if("Rename"===e){var t=n.find(".input-name")[0].value;i.setArtTitle(ar.curArticle,t)}})}}),r.onValue(()=>{ar.settings.bVisitedHotPad||(ar.settings.bVisitedHotPad=!0,i.saveSettings())}),Kefir.fromEvents($(".action-back",t.$el),"click").flatMap(()=>(t.animPages.selected="hp-toggler-view",a("ChromeApp")&&!a("FakeMobile")&&i.hideNoteList(ar.settings.bHideNoteList),Kefir.fromEvents(t.$animPages,"neon-animation-finish").take(1))).flatMap(()=>{if(t.newLines){var e=n.lastLine();if(e.length){var i=n.textHandler.makeCursorLastActiveState(e.lnName());if(n.setActiveLn(e,i),a("AndroidApp")&&window.cordova.plugins.Keyboard.show(),a("MobileApp"))return ar.createKeyboardShowSoonOnce().map(()=>e)}}return Kefir.never()}).onValue(e=>{n.makeLinesVisible(e)}),t.el.addEventListener("x-backbutton",function(e){s.default.tryClickButton(t.$el.find(".action-back")),e.preventDefault(),e.stopPropagation()}),t.$el.on("keydown",function(e){if(!(u.bDebug&&a("ChromeApp")&&82===e.keyCode&&e.ctrlKey)){if(e.keyCode===s.default.KeyCode.VK_TAB)return!0;var n;return 27===e.keyCode?(n=t.$el.find(".action-back"),s.default.fakeButtonClickAnim(n),n.click()):13===e.keyCode?(n=t.$el.find(".action-write"),s.default.fakeButtonClickAnim(n),n.click()):82===e.keyCode?(n=t.$el.find(".start-record"),s.default.fakeButtonClickAnim(n),n.click()):80===e.keyCode?(n=t.$el.find(".action-take-photo"),s.default.fakeButtonClickAnim(n),n.click()):e.keyCode>=49&&e.keyCode<55&&(n=t.$el.find(s.default.sprintf(".action-bm[name='%d']",e.keyCode-49+1)))[0].click(),!1}}),function(){function o(e){t.writeTime=e,t.$writeView.find(".input-write").polymerFocus().get(0).value="",t.$writeView.find(".label-timestamp").text(e?i.makeBmTimeStr(e):"")}function r(){t.animPages.selected="hp-pad-view"}function l(i){var a=n.ldoc.newTextLine(),l=t.$writeView.find(".input-write"),c=l[0].value;if(c.length){a.content=c,a.time=t.writeTime;var d=n.cmdInsertLine(a,n.ldoc.getAllEndPos());n.makeLinesVisible(d),t.newLines++;var u=s.default.animRunnerPool.getFree();if(u){var p=l[0].parentElement.querySelector(".fly-line-dummy");p.style.left=t.$writeView.find(".label-timestamp").width()-4+"px",p.style.bottom="0px",e(d,u,p)}}i?o():r()}$(".action-write",t.$el).on("click",function(){t.animPages.selected="hp-write-view",o(i.recorder.getCurOffsetedAudioTime(!0))}),(a("MobileApp")||a("FakeMobile"))&&(t.$writeView.find(".check-keep-writting").on("click",function(e){ar.settings.bHotPadKeepWritting=this.checked,i.saveSettings(ar.settings.bHotPadKeepWritting),t.$writeView.find(".input-write").polymerFocus()}),t.$writeView.find(".check-keep-writting")[0].checked=ar.settings.bHotPadKeepWritting),t.$writeView.on("keydown",function(e){if(13===e.keyCode){var n;return(n=!!e.shiftKey)||!a("MobileApp")&&!a("FakeMobile")||(n=t.$writeView.find(".check-keep-writting")[0].checked),l(n),!1}if(27===e.keyCode)return r(),!1}),t.$writeView.find(".input-write").on("value-changed",function(){null==t.writeTime&&this.value?(t.writeTime=i.recorder.getCurOffsetedAudioTime(!0),t.$writeView.find(".label-timestamp").cssAnimate("fadeIn").text(i.makeBmTimeStr(t.writeTime))):null==t.writeTime||this.value||(t.writeTime=null,t.$writeView.find(".label-timestamp").text(""))}),t.$writeView.find(".action-back").click(function(){r()}),(a("MobileApp")||a("FakeMobile"))&&t.$writeView.on("x-backbutton",function(e){return r(),!1})}(),$(".action-bm",t.$el).on("click",function(r){var a=this.attributes.name.value.charCodeAt(0)-"1".charCodeAt(0),l=a<ar.settings.bmStrings.length?ar.settings.bmStrings[a].string:null;if(l){var c=n.ldoc.newTextLine(),u=d.a.FORE_COLORS[ar.settings.bmStrings[a].colorIdx],p=s.default.sprintf("<span style='color: %s;'>%s</span>",u,o.escape(l));c.content=p,c.time=i.recorder.getCurOffsetedAudioTime(!0);var m=n.cmdInsertLine(c,n.ldoc.getAllEndPos());n.makeLinesVisible(m),t.newLines++,t.$el.focus();var f=this,h=s.default.animRunnerPool.getFree();if(h){var g=f.parentElement.querySelector(".fly-line-dummy"),v=f.querySelector("div > span");g.style.left=$(v).offset().left-$(f).offset().left+"px",g.style.top="10px",e(m,h,g)}i.checkRunTimeTip("bBookmarkString",localString("tip_bm_string"))}}),l.a.addListener("onSettingsChanged",function(e){t._updateBmStrings()})},_updateBmStrings(){for(var e=this.$el.find(".item.bm"),t=(Math.min(e.length,ar.settings.bmStrings.length),0);t<e.length;t++){var n=e[t];if(t<ar.settings.bmStrings.length){n.style.display="";var i=d.a.FORE_COLORS[ar.settings.bmStrings[t].colorIdx],r=s.default.sprintf("<div class='colored-bm-string' style='color: %s;'><span>%s</span></div>",i,o.escape(ar.settings.bmStrings[t].string));Polymer.dom(n.querySelector("paper-button")).innerHTML=r}else n.style.display="none"}}}},function(e,t,n){"use strict";function i(e){u=e,v("ChromeApp")&&!v("FakeMobile")?(d=L).create(u):d=null;{let e;e=g.isXSmall()?$("#main-menu"):$("#note-nav"),console.assert(e.length),u.updateProOnlyUI(e)}o(),a(),ar.settings.bShowEditWave&&$("#edit-wave").toggleClass("iron-selected",!0).attr("aria-checked","true"),ar.settings.bShowTrans&&$("#menu-transcribe").toggleClass("iron-selected",!0).attr("aria-checked","true"),b.a.addListener("onRecordStarted",function(){$("#menu-new-note,#menu-del-note,#menu-import-rec").toggleAttr("disabled",!0)}),b.a.addListener("onRecordStopped",function(){$("#menu-new-note,#menu-del-note,#menu-import-rec").toggleAttr("disabled",!1)}),b.a.addListener("onSettingsChanged",function(){})}function o(){if(ar.signInShowName)$("#menu-signin-show-name").text(ar.signInShowName).parent("paper-item").css("display",""),$("#menu-signin").css("display","none");else if(ar.signInUserEmail)$("#menu-signin-show-name").text(ar.signInUserEmail).parent("paper-item").css("display",""),$("#menu-signin").css("display","none");else if(ar.signInUserId){var e=f.sprintf("ID_%.8s...",ar.signInUserId);$("#menu-signin-show-name").text(e).parent("paper-item").css("display",""),$("#menu-signin").css("display","none")}else $("#menu-signin-show-name").parent("li").css("display","none"),$("#menu-signin").css("display","")}function r(){function e(e,t,i){if("menu-new-note"===e)u.noteList.cmdNewNote(),ar.settings.tips.bFastNewNote||(ar.settings.tips.bFastNewNote=!0,u.saveSettings(),u.showPopoverTips("#note-list-header .action-new-note",{popPos:"bottom"},localString("fast_new_note_tip")));else if("menu-import-note"===e){var o=!i&&t.previousElementSibling;u.importEx.cmdImportNotes(o)}else if("menu-trash-box"===e)u.noteList.enterFolder("Trash","Trash");else if("menu-note-prop"===e)T.a(u,ar.curArticle);else if("menu-import-rec"===e){let e=!i&&t.previousElementSibling;u.importEx.cmdImportRec(e)}else if("menu-del-note"===e)E.emit([ar.curArticle,!0]);else if("menu-export-note"===e){let e=!i&&t.previousElementSibling;u.shareView.cmdExportNote(e)}else"menu-save-rec"===e?new Promise(function(e){e()}).then(function(){var e=[n(105)];(function(e){e.exportRecording(u).then(function(e){y.default.toastShowLongCenter(localString("common_success"))},function(e){"cancel"!==e&&y.default.toastShowLongCenter(localString("common_failed"))})}).apply(null,e)}).catch(n.oe):"menu-gen-share-link"===e?A.a(u,ar.curArticle):"menu-email-note"===e?C.a(u):"menu-transcribe"===e?(u.toggleTransBar(),$(t).toggleClass("iron-selected",ar.settings.bShowTrans).attr("aria-checked",ar.settings.bShowTrans)):"edit-wave"===e?(u.toggleEditWave(),$(t).toggleClass("iron-selected",ar.settings.bShowEditWave).attr("aria-checked",ar.settings.bShowEditWave)):"menu-del-rec"===e?y.default.messageBox(localString("mb_del_rec_title"),localString("mb_del_rec_body"),{btnOk:!0,okTitle:localString("common_delete"),btnCancel:!0},function(e){"Ok"===e&&k.a()}):"menu-capturer"===e?ar.settings.bCapturerInstalled?d.uninstallCapturer(function(e){"success"===e&&(a(),y.default.toastShowShortCenter(localString("uninstall_capturer_success")))}):d.installCapturer():"menu-about"===e?($("#client_version").text("v"+_.CLIENT_VERSION),$("#modal-about").showModal()):"btn_account"===e?ar.accountView.render():"menu-settings"===e?S.showSettings(u):"menu-signin"===e?u.signInAccount():"menu-account-name"===e?S.showSettings(u,"account"):"menu-upgrade-to-pro"===e?S.showSettings(u,"purchase"):"menu-update-app"===e?(console.assert(Object(I.hasUpdateAppLink)()),Object(I.openUpdateAppLink)()):"menu-faq"===e?Object(I.openExternalLink)("https://www.micnote.audio/faq"):"menu-user-agreement"===e?Object(I.openExternalLink)("https://www.micnote.audio/user-agreement"):"menu-privacy-policy"===e?Object(I.openExternalLink)("https://www.micnote.audio/privacy-policy"):"menu-print-note"===e&&new Promise(function(e){e()}).then(function(){var e=[n(105)];(function(e){e.printNote(u,ar.curArticle)}).apply(null,e)}).catch(n.oe);g.isXSmall()&&("import-link"===e?u.importEx.cmdImportNotesFrom("Link"):"import-gdrive"===e?u.importEx.cmdImportNotesFrom("GDrive"):"import-dropbox"===e&&u.importEx.cmdImportNotesFrom("Dropbox")),(v("AndroidApp")||v("FakeMobile"))&&"menu-exit"===e&&(console.assert(!ar.bRecording),v("AndroidApp")?navigator.app.exitApp():v("ChromeApp")?window.close():console.assert(!1))}g.vars.$appBody.on("iron-activate",".main-menu",function(t){var n=t.originalEvent.detail.selected,i=t.originalEvent.detail.item;v("Mobile")||v("FakeMobile")?m.delay(function(){e(n,i,!0)},100):e(n,i),t.preventDefault()}),g.isXSmall()&&$("#main-menu-drawer .content").on("click","#main-menu paper-item",function(e){_$("#main-menu-drawer").togglePanel()}),$("#menu-feedback").on("click",function(){l()}),g.vars.$appBody.on("click",".mini-wave-bar-toggler",function(){u.toggleMiniWaveBar()}),v("ChromeApp")&&$("#menu-get-android").on("click",function(){Object(I.openExternalLink)(_.gpGetAndroidUrl)}),$("#menu-tools").on("click",function(e){e.target.classList.contains("x-dropdown-trigger")&&d&&d.isCapturerInstalled(function(e){ar.settings.bCapturerInstalled=e,u.saveSettings(),a()})}),$("#show-slient-error").on("click",function(e){p&&p(),p=null,$(this).fadeOut()}),$("#toggle-note-list").on("click",function(e){if(g.isXSmall())u.switchMainScreen("NoteList");else{var t=!ar.settings.bHideNoteList;u.hideNoteList(t),ar.settings.bHideNoteList=t,$(this).toggleAttr("active",ar.settings.bHideNoteList).attr("aria-checked",ar.settings.bHideNoteList),u.saveSettings()}})}function a(){var e=ar.settings.bCapturerInstalled;$("#menu-capturer span").text(localString(e?"menu_uninstall_capturer":"menu_install_capturer"))}function l(){$("#modal-feedback").remove();var e=localHtml(x),t="\n\n\n---"+localString("fb_write_above")+"---\nUID: "+ar.uid+"\nVersion: "+_.CLIENT_VERSION+"\nUA: "+navigator.userAgent;e=localHtml(e,{rt_mail_subject:"",rt_mail_body:encodeURIComponent(t)});var n=$(y.default.htmlToElement(e,!0));y.default.insertModal(n),n.showModal(),$(".action-send",n).on("click",function(){var e=$(".feedback-content",n).val(),t=$(".feedback-title",n).val();y.default.showFullscreenWaiting(!0);var i,o=log.getLogMemStrings();m.each(o,function(e){i+=e+"\n"});var r={feedback_title:t,feedback_content:e,feedback_user_contact:$(".feedback-user-contact",n).val(),feedback_log:i};$.ajax({url:y.default.makeApiUrl("/api/feedback"),method:"POST",xhrFields:{withCredentials:!0},data:r,success:function(e,t,i,o){y.default.showFullscreenWaiting(!1),n.hideModal(),y.default.messageBox(localString("home_fb_send_success"),localString("home_fb_thanks"))},error:function(e){y.default.showFullscreenWaiting(!1),y.default.toastShowLongCenter(localString("home_fb_error_retry"),"error")}})}),$(".feedback-title",n).on("iron-input-validate",function(e){$("#modal-feedback .action-send").toggleAttr("disabled",this.invalid)})}function s(){console.assert(!ar.bRecording),y.default.messageBox(localString("mb_exit_title"),localString("mb_exit_desc"),{btnCancel:!0,btnClose:!0,okTitle:localString("menu_exit"),cancelTitle:localString("common_no")},function(e){"Ok"===e&&navigator.app.exitApp()})}function c(e){p?log.warn("ignore to prompt a slient error since there is one exists"):($("#show-slient-error").fadeIn().cssAnimate("flash"),p=e)}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return i}),n.d(t,"bindMainMenuEvents",function(){return r}),n.d(t,"updateSignInShowName",function(){return o}),n.d(t,"handleExitByBackBtn",function(){return s}),n.d(t,"setSlientError",function(){return c}),n.d(t,"delNoteStream",function(){return E});var d,u,p,m=n(19),f=(n.n(m),n(23)),h=(n.n(f),n(20)),g=(n.n(h),n(8)),v=n(6),b=(n.n(v),n(92)),y=n(22),w=n(21),_=(n.n(w),n(7)),x=(n.n(_),n(91),n(95),n(108),n(181)),S=(n.n(x),n(102)),k=n(120),T=n(183),C=n(184),A=n(186),L=(n(94),n(121)),I=n(24);let E=new Kefir.Bus},function(e,t,n){"use strict";function i(e){Ae=Q("ChromeApp"),W=e,o(),(Q("MobileApp")||Q("FakeMobile"))&&$("#back-10s").on("click",function(e){var t=ar.wavesurfer.backend.getCurrentTime();t=Math.max(0,t-10),ar.wavesurfer.backend.play(t)}),Q("nacl")&&window.common.registerFun("onInputVolume",function(e){if(ar.bRecording){var t=e.volume;ar.wavesurfer.drawer.updateProgress(Math.abs(t)),ar.recordSyncTime=e.syncTime,d()}}),K.isXSmall()?(Se.onValue(function(e){$("#time-label-cur").text(e)}),ke.onValue(function(e){$("#time-label-max").text(e)})):Kefir.combine([Se,ke],function(e,t){return e+"/"+t}).onValue(function(e){$(".wave-time-label").text(e)}),Kefir.merge([Kefir.fromEvents(ar.leditor,"abm-changed"),Kefir.fromEvents(ar.wavesurfer,"ready")]).debounce(100).onValue(()=>{j(ar.leditor)}),$("#play-pause").click(function(){f()?u():p()}),$("#play-stop").click(function(){m()}),ar.leditor.textHandler.on("click-doc-abm",function(e){O(e.innerHTML,e)}),ar.leditor.on("click-line-abm",function(e){U(e)}),te.a.addListener("onAudioChanged",function(){var e=W.isAudioEditable(ar.curArticle);$(".start-record").toggleAttr("disabled",!e)}),$("#wave",W.$el).on("markChanged",function(){var e=ar.markA&&ar.markB&&ar.markB.position-ar.markA.position>.1;W.$el.find(".action-repeat").toggleAttr("disabled",!e)}),$(".action-repeat-a",W.$el).click(function(){W.setMarkA(ar.wavesurfer.backend.getCurrentTime()),(!ar.markB||Math.abs(ar.markB.position-ar.markA.position)<.1)&&W.setMarkB(ar.wavesurfer.backend.getDuration())}),$(".action-repeat-b",W.$el).click(function(){W.setMarkB(ar.wavesurfer.backend.getCurrentTime()),(!ar.markA||Math.abs(ar.markB.position-ar.markA.position)<.1)&&W.setMarkA(0)}),$(".action-repeat",W.$el).click(function(){W.playAB()}),$("#wave-bar .btn").on("mousedown",function(e){document.activeElement===ar.editor[0]&&e.preventDefault()}),Z.default.hotLineChanged.onValue(e=>{"changed"===e.name?e.curLn&&ar.wavesurfer.mark({id:"hotline-prev",color:"aquamarine",position:e.curLn.time,width:2,height:ve}):"ended"===e.name&&ar.wavesurfer.clearMarks(e=>"hotline-prev"===e)})}function o(){var e=Object.create(ae.a);ar.wavesurfer=e,Q("DesktopApp")?ar.audioBackendMethod="TagAudio":Q("Mobile")&&Q("App")?ar.audioBackendMethod="MediaAudio":window.AudioContext||window.webkitAudioContext?ar.audioBackendMethod=se?"TagAudio":"WebAudio":ar.audioBackendMethod="TagAudio",ge.info(he,"Audio backend mehtod: "+ar.audioBackendMethod),console.assert("WebAudio"!==ar.audioBackendMethod,"need to create audioContext"),"WebAudio"==ar.audioBackendMethod?ar.bWaveScroll=ar.settings.bWaveScroll:(ar.bWaveScroll=ar.settings.bWaveScroll,$("#wave_mode").hide()),be="WebAudio"==ar.audioBackendMethod?100:40,ve=Math.round(.4*be),e.init({container:_$("#wave"),height:be,barHeight:ve,waveColor:"SkyBlue",progressColor:"#57BBE2",normalize:!1,cursorWidth:3,markWidth:3,minPxPerSec:100,scrollParent:!1,backendMethod:ar.audioBackendMethod,audioContext:null}),e.on("ready",function(){if(d(),ar.curArticle){var e=ar.wavesurfer.backend.getDuration();e!=ar.curArticle.audioTime&&(ar.curArticle.audioTime=e,W.saveArticle(ar.curArticle))}}),e.on("error",function(t,n){"ERROR_DOWNLOAD"==n?e.drawer.setTitle(localString("home_dl_audio_error")):e.drawer.setTitle(t)}),e.playerProgress.onValue(()=>{console.assert(!ar.bRecording),d()}),e.playerPaused.onValue(()=>{c(!0)}),e.playerStarted.onValue(()=>{c(!1)}),e.seekByClick.onValue(e=>{h(),ar.settings.numSeekByClick++,W.saveSettings(),ar.settings.numSeekByClick>3&&!f()&&!W.isRunTimeTipFinish("bDragPlayhead")&&W.checkRunTimeTipWithPic("bDragPlayhead",localString("tip_drag_playhead_msg"),"./img/dragPlayhead.jpg",localString("tip_drag_playhead_pic_notation"))})}function r(e){function t(t,o){var r=(Ee=t).getAudioTracks()[0],l="audio.mp3"===i.audioName,s=Math.pow(2,(ar.settings.gain-1)/9*3);o?(ar.audioContext=new(window.AudioContext||window.webkitAudioContext),ge.info(he,"AudioContext SampleRate: "+ar.audioContext.sampleRate),Pe=ar.audioContext.createMediaStreamSource(t),Ne=ar.audioContext.createScriptProcessor(Me,2,2),Pe.connect(Ne),Ne.connect(ar.audioContext.destination),Q("nacl")?window.common.naclPostMessage("startRecordChrome35",{uid:ar.uid,artName:i.artName,contType:e,sampleRate:ar.audioContext.sampleRate,bMp3:l,gain:s},n):Q("Node")&&le.node.media.startRecord({uid:ar.uid,artName:i.artName,contType:e,sampleRate:ar.audioContext.sampleRate,bMp3:l,gain:s},n),Q("nacl")?Ne.onaudioprocess=function(e){let t=e.inputBuffer.getChannelData(0),n=t[0],i=t.buffer;window.common.naclPostMessage("waveDataChrome35",i),a(n)}:Q("Node")&&(Ne.onaudioprocess=function(e){let t=e.inputBuffer.getChannelData(0),n=t[0]*s;le.node.media.onWaveData(t),a(n)})):window.common.naclPostMessage("startRecord",{track:r,uid:ar.uid,artName:i.artName,contType:e,bMp3:l,gain:s},n)}function n(t){t?J.default.toastShowLongCenter(localString("common_error"),"error"):(ar.recordSyncTime=0,ar.recordStartTime=Y.getCurTime(),ar.recordBaseTime="Insert"===e||"Replace"===e?0:ar.wavesurfer.backend.getDuration(),Q("ChromeApp")?chrome.power.requestKeepAwake("system"):Q("Node")&&(ar.nodePowerSaveBlockerId=le.node.powerSaveBlocker.start("prevent-app-suspension")),ar.bRecordingRealStarted=!0,Fe.emit("recording"),te.a.onRecordStarted())}var i=ar.curArticle;ar.wavesurfer.stop(),e||(e=i.audioCommit===X.a.NEW_AUDIO_COMMIT?"New":"Cont"),Q("MobileApp")&&"New"!==e&&"Cont"!==e&&(e="New",ge.error(he,"not implemented yet! insert, replace...")),ar.wavesurfer.drawer.progressBarStyleStart();var o;if(o="Insert"===e?localString("wave_title_insert"):"Replace"===e?localString("wave_title_replace"):"RemoteAudioBuffer"===ar.audioInputName?localString("wave_title_record_remote",ee.getCurSourceName()):localString("wave_title_record"),ar.wavesurfer.drawer.setTitle(o),ar.bRecording=!0,ar.bPauseRecording=!1,ar.bRecordingRealStarted=!1,ar.recContType=e,Fe.emit("record-starting"),c(!0),i.audioCommit=Y.genCommitHash(),i.noteCommit=Y.genCommitHash(),i.noteCommitMd5="INVALID",W.saveArticle(i),Q("nacl")){if(ee.isRemoteAudioReady()){console.debug("record from remote audio buffer"),ar.audioInputName="RemoteAudioBuffer";var r=Math.pow(2,(ar.settings.gain-1)/9*3),l=ar.remoteAudioBufferSampleRate;window.common.naclPostMessage("startRecordChrome35",{uid:ar.uid,artName:i.artName,contType:e,sampleRate:l,bMp3:!0,gain:r},n)}else ar.remoteAudioStream?(console.debug("record remote stream"),ar.audioInputName="RemoteAudioStream",t(ar.remoteAudioStream)):(ar.audioInputName="MicNacl",navigator.getUserMedia({audio:!0},function(e){t(e)},function(e){ge.fail(he,e),J.default.messageBox(localString("common_error"),localString("request_audio_failed"))}))}else if(Q("Node"))ar.audioInputName="MicScripted",navigator.getUserMedia({audio:!0},function(e){t(e,!0)},function(e){ge.fail(he,e),J.default.messageBox(localString("common_error"),localString("request_audio_failed"))});else{var s=ar.fileSystem.getRootPath()+Y.removeFirstSplash(ar.userDir)+i.artName+"/"+i.audioName;ge.log(he,"save rec at: "+s),ar.mobileMedia=new window.Media;let t=Math.pow(2,(ar.settings.gain-1)/9*3);ar.mobileMedia.startRecord(s,"Cont"===e,t),ar.settings.lastRecordingPath=s,ar.settings.lastRecordingCont="Cont"===e,W.saveSettings(),ar._recordTimeId=window.setInterval(d,1e3),window.plugin.notification.local.add({id:"MicNote_Recording",icon:"icon",smallIcon:"recording_icon",title:localString("common_app_name"),message:"Recording",ongoing:!0,sound:null}),ar.recordSyncTime=0,ar.recordStartTime=Y.getCurTime(),ar.recordBaseTime="Insert"===e||"Replace"===e?0:ar.wavesurfer.backend.getDuration(),ar.bRecordingRealStarted=!0,Fe.emit("recording"),te.a.onRecordStarted()}}function a(e){console.assert(ar.bRecording),Ie=Math.max(Ie,Math.abs(e)),++Le>=$e&&(ar.wavesurfer.drawer.updateProgress(Ie),ar.recordSyncTime=Y.getCurTime()-ar.recordStartTime,d(),Le=0,Ie=0)}function l(e,t){window.common.naclPostMessage("waveDataChrome35",e),a(t)}function s(e){function t(){ar.bRecorderStopping=!0,Fe.emit(e?"paused":"stopped"),ar.wavesurfer.drawer.progressBarStyleEnd(),ar.wavesurfer.drawer.setTitle("");var t=ar.recordSyncTime,o=W.makeTimeShowStr(t),r=E(t);K.isXSmall()?J.default.toastShowLongCenter([localString("toast_rec_stopped",o),localString("toast_rec_stopped",r)]):W.setInfoBarInfo([localString("toast_rec_stopped",o),localString("toast_rec_stopped",r)]),ar.curArticle.audioTime=i,H(ar.curArticle).finally(function(){n.resolve()}),ee.isRemoteAudioReady()&&W.updateRemoteSourceLabel(),te.a.onRecordStopped()}console.assert(ar.bRecording);var n=q.defer(),i=b();ar.bRecording=!1,ar.bRecorderStopping=!0,Fe.emit(e?"record-stopping":"pause-stopping"),Q("ChromeApp")?chrome.power.releaseKeepAwake():Q("Node")&&null!=ar.nodePowerSaveBlockerId&&(le.node.powerSaveBlocker.stop(ar.nodePowerSaveBlockerId),ar.nodePowerSaveBlockerId=null);q.resolve();return Q("nacl")||Q("Node")?"RemoteAudioBuffer"===ar.audioInputName?window.common.naclPostMessage("stopRecord",function(e){e?J.default.toastShowLongCenter(localString("common_error"),"error"):k(ar.curArticle,function(){t(),Ee=null})}):(Ne&&(Ne.disconnect(0),Ne=null),Pe&&(Pe.disconnect(0),Pe=null),ar.audioContext&&(ar.audioContext=null),Ee&&(Ee.oninactive=function(){function e(e){e?J.default.toastShowLongCenter(localString("common_error"),"error"):k(ar.curArticle,function(){t(),Ee=null})}this.oninactive=void 0,Q("nacl")?window.common.naclPostMessage("stopRecord",e):Q("Node")&&le.node.media.stopRecord(e)},"function"==typeof Ee.stop?Ee.stop():Ee.getAudioTracks()[0].stop(),Ee=null)):(console.assert(ar._recordTimeId),window.clearInterval(ar._recordTimeId),ar.mobileMedia.stopRecord(function(){var e;e=Y.removeLastSplash(ar.fileSystem.getRootPath())+ar.userDir+ar.curArticle.artName+"/"+ar.curArticle.audioName,ar.wavesurfer.load(e),window.plugin.notification.local.cancelAll({id:"MicNote_Recording"}),t()},ge.fail),delete ar.settings.lastRecordingPath,delete ar.settings.lastRecordingCont,W.saveSettings()),n.promise}function c(e){if(void 0===e&&(e=ar.wavesurfer.backend.isPaused()),e){t=localHtml("{=aria_play=}{=hk_play_pause=}");$("#play-pause").attr("icon","bs:play").attr("aria-label",J.default.fixAriaShortcut(t))}else{var t=localHtml("{=aria_pause=}{=hk_play_pause=}");$("#play-pause").attr("icon","bs:pause").attr("aria-label",J.default.fixAriaShortcut(t))}}function d(){var e,t;ar.bRecording?(e=b(),t=C()):(e=ar.wavesurfer.backend.getCurrentTime(),t=ar.wavesurfer.backend.getDuration(),Ae&&e>t&&(e=t),Math.abs(e-t)<.1&&c(!0)),isNaN(e)||isNaN(t)||(ye.emit(e),we.emit(t),ar.bRecording&&ar.bRecordingRealStarted&&!x()&&(ar.settings.bAutoNewNote&&Ue.filter(e=>"stopped"===e).take(1).onValue(()=>{var e,t,n=ar.curArticle;null!==(t=n.artTitle.match(/\((\d+)\)$/))&&(e=t[1]);var i,o;if(e?(i=window.parseInt(e)+1,o=n.artTitle.slice(0,n.artTitle.length-e.length-2)):(i=1,o=W.getArtTitleShowName(n)),i<=fe){var r=o+"("+i+")",a=Object.create(oe.a);a.create(),W.doNewNote({bCheckNoteNum:!0,parentName:n.parentName,title:r,ldoc:a}).then(function(e){return W.selectArticle(e)}).then(function(){$(".start-record:visible").first().click();var e={type:"basic",title:localString("auto_new_notify_title"),message:localString("auto_new_notify_msg",r),iconUrl:"MN_128.png"};(Q("ChromeApp")||Q("MobileApp"))&&chrome.notifications.create("",e,function(e){})})}else _()}),Te.emit()))}function u(){ar.wavesurfer.pause(),h(),W.transView&&re.h(W.transView)}function p(){ar.wavesurfer.play(),W.transView&&re.i(W.transView)}function m(){ar.wavesurfer.stop(),h()}function f(){return!ar.bRecording&&!ar.wavesurfer.backend.isPaused()}function h(){ar.curArticle&&(ar.curArticle.lastPlayPos=ar.wavesurfer.backend.getCurrentTime(),W.saveArticle(ar.curArticle))}function g(e){return e.flatMap(function(e){if(ge.log(he,"CHANGE STATE: "+e),!ar.bRecording&&!ar.bPauseRecording)return Kefir.never();var t;switch(e){case"RINGING":ge.log(he,"Phone is ringing"),ar.bRecording&&(t=["stop",!0]);break;case"OFFHOOK":ge.log(he,"Phone is off-hook");break;case"IDLE":ge.log(he,"Phone is idle"),ar.bPauseRecording&&(t=["start"])}return t?Kefir.constant(t):Kefir.never()})}function v(){var e=[Oe,ie.c,Te.map(()=>["stop"])];Q("ChromeApp")?e.push(Re):Q("MobileApp")&&e.push(g(De)),(K.isXSmall()||K.isMiddle())&&(console.assert(ar.noteModeStream),e.push(ar.noteModeStream.flatMap(e=>"Review"===e?Kefir.constant(["stop"]):Kefir.never()))),Kefir.merge(e).flatMap(function([e,t]){var n=null;if("stop"===e){if(ar.bRecording){var i=t,o=s(i);void 0!==i&&(ar.bPauseRecording=i),n=Kefir.fromPromise(o)}}else if("pause-to-stop"===e)Fe.emit("stopped"),ar.bPauseRecording=!1;else if("start"===e){var a=t;if(x(!0)&&!ar.bRecording)if(ar.curArticle.audioName!=ar.AUDIO_NAME){var l=localString("audio_format_diff");Q("MobileApp")&&K.isXSmall()?window.plugins.toast.showLongCenter(l):J.default.toastShowLongCenter(l,"error")}else r(a),ar.bPauseRecording=!1}else log.debug("unknown record cmd:",e);return n||Kefir.never()}).onValue(function(e){})}function b(){return ar.bRecording?(Q("nacl")||(ar.recordSyncTime=Y.getCurTime()-ar.recordStartTime),ar.recordSyncTime+ar.recordBaseTime):ar.wavesurfer.backend.getCurrentTime()}function y(e){var t=b();return isNaN(t)?0:e?Math.max(0,t+ar.settings.offsetAbmTime):t}function w(e){ar.bWaveScroll=e,ar.wavesurfer.changeWaveMode(ar.bWaveScroll),ar.settings.bWaveScroll=e,W.saveSettings()}function _(){var e={type:"basic",title:localString("timeup_notify_title"),message:localString("timeup_notify_msg"),iconUrl:"img/timeup.png"};(Q("ChromeApp")||Q("MobileApp"))&&chrome.notifications.create("",e,function(e){})}function x(e){return!((ar.bRecording?b():ar.wavesurfer.backend.getDuration())>C()&&(!ce||ar.commits.accountType===ar.AT_Pro&&ar.commits.proPlan!==ar.PP_Trial?W.setInfoBarInfo(localString("pro_max_rec_time_exceeds")):(ar.settings.bPromptAudioLength||W.reportAccount(),J.default.messageBox(localString("home_maximum_audio_time_title"),localString("home_maximum_audio_time_body",A()),{okTitle:localString("view_more_pro_features"),okClass:"btn-success",btnCancel:!0,btnClose:!0},function(e){ar.settings.bPromptAudioLength=!0,W.saveSettings(),"Ok"==e&&ne.showSettings(W,"purchase")})),e||ar.settings.bAutoNewNote||_(),1))}function S(e){e.audioDate=e.serverAudioDate,W.findLocalArticle(e.artName).audioDate=e.serverAudioDate,W.saveArticleList()}function k(e,t){if("TagAudio"===ar.audioBackendMethod){var n=ar.fileSystem.getDirUrl(ar.userDir+e.artName)+"/"+e.audioName;if(Ce++,e.audioUrl=n+"?"+Ce,Ae){ar.fileSystem.getFileSize(ar.userDir+e.artName+"/"+e.audioName,function(n,i){if(!n){let n=i/216*.072;(n>30||n<0)&&(n=null),T(e,function(e){t&&t()},n)}})}else T(e,function(e){t&&t()})}else if("WebAudio"===ar.audioBackendMethod){i=ar.userDir+e.artName+"/"+e.audioName;ar.fileSystem.loadFile(i,"ArrayBuffer",function(n,i){n?t&&t():(e.audioBuffer=i,T(e,function(e){t&&t()}))})}else{var i;i=Q("iOS")?Y.removeLastSplash(ar.fileSystem.getRootPath())+encodeURIComponent(ar.userDir+e.artName):Y.removeLastSplash(ar.fileSystem.getRootPath())+ar.userDir+e.artName+"/"+e.audioName,e.mediaPath=i,T(e,function(e){t&&t()})}}function T(e,t,n){if(ar.wavesurfer.drawer.setTitle(""),e)if(e.audioBuffer)ar.wavesurfer.load(e.audioBuffer,void 0,t,n);else if(e.audioUrl)ar.wavesurfer.load(e.audioUrl,e.wave,t,n);else{if(!e.mediaPath)return ar.wavesurfer.empty(),t&&t(),!1;ar.wavesurfer.load(e.mediaPath,e.wave,t)}else ar.wavesurfer.empty(),t&&t();return!0}function C(){return ar.commits.accountType===ar.AT_Pro?ar.commits.proPlan===ar.PP_Trial?me:ue:ar.commits.accountType===ar.AT_Edu?pe:de}function A(){return parseInt(de/60)}function L(e,t){var n=Math.floor(e/60),i=e-60*n;return z.sprintf(t||"%02d:%02.0f",n,i)}function I(e){var t=Math.floor(e/3600),n=e-3600*t,i=Math.floor(n/60),o=n-60*i;return t?z.sprintf("%dh:%dm:%ds",t,i,o):i?z.sprintf("%dm:%ds",i,o):z.sprintf("%ds",o)}function E(e){var t=Math.floor(e/60),n=Math.floor(e-60*t);return localString("aria_rec_time",t,n)}function N(e){return 60*parseInt(e.replace(/(.*):.*/,"$1"))+parseFloat(e.replace(/.*:(.*)/,"$1"))}function P(e){if("number"==typeof e){var t=ar.wavesurfer.mark({id:"a",color:"rgba(0, 255, 0, 0.5)",position:e});ar.markA=t}else ar.markA&&ar.markA.remove(),ar.markA=null;ar.markA&&(!ar.markB||ar.markB.position<ar.markA.position)&&F(null),$("#wave").trigger("markChanged")}function F(e){if("number"==typeof e){var t=ar.wavesurfer.mark({id:"b",color:"rgba(255, 0, 0, 0.5)",position:e});ar.markB=t}else ar.markB&&ar.markB.remove(),ar.markB=null;ar.markB&&(!ar.markA||ar.markA.position>ar.markB.position)&&P(null),$("#wave").trigger("markChanged")}function D(){if(!ar.markA)return!1;var e;return ar.markB&&ar.markA.position<ar.markB.position&&(e=ar.markB.position),ar.wavesurfer.backend.play(ar.markA.position,e),!0}function M(e){var t,n;if(-1!=e.indexOf("-")){var i,o;i=e.replace(/\[(.*)-.*/,"$1"),o=e.replace(/\[.*-(.*)\]/,"$1"),t=N(i),n=N(o)}else t=N(i=e.replace(/\[(.*)\]/,"$1"));var r=[];return"number"!=typeof t||isNaN(t)||r.push(t),"number"!=typeof n||isNaN(n)||r.push(n),r}function O(e,t){if(!ar.bRecording){var n=M(e);U(n[0],n[1],t)}}function U(e,t,n){if(void 0!==e&&void 0!=t)P(e),F(t),D();else if(void 0!==e){if(ar.settings.bSmartB&&n)for(var i=$(n).nextAll("a"),o=0;o<i.length;o++){var r=i[o];if(-1!==r.href.indexOf("#home/a-abm")){t=M(r.innerHTML)[0];break}}P(e),F(t),D()}}function B(e){ar.bRecording||(P(e),F(null),D())}function H(e){var t=W.getAudioPath(e);return q.ninvoke(ar.fileSystem,"getFileSize",t).then(function(t){e.audioSize=t,W.saveArticle(e)})}function j(e){ar.wavesurfer.clearMarks(function(e){return 0===e.indexOf("line_abm_")});var t=e.getAllLns();R.pipe(R.map(e=>$(e).line()),R.filter(e=>"number"==typeof e.time&&e.name!==X.a.LN_ROOT_NAME),R.map(e=>ar.wavesurfer.mark({id:"line_abm_"+e.name,color:"rgb(218, 239, 250)",position:e.time,width:1,height:ve})))(t.toArray())}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"create",function(){return i}),n.d(t,"changeWaveMode",function(){return w}),n.d(t,"updatePlayPauseIcon",function(){return c}),n.d(t,"loadAudio",function(){return k}),n.d(t,"pausePlay",function(){return u}),n.d(t,"playPlay",function(){return p}),n.d(t,"stopPlay",function(){return m}),n.d(t,"isPlaying",function(){return f}),n.d(t,"chromeOnRemoteWaveData",function(){return l}),n.d(t,"getCurAudioTime",function(){return b}),n.d(t,"getCurOffsetedAudioTime",function(){return y}),n.d(t,"setMarkA",function(){return P}),n.d(t,"setMarkB",function(){return F}),n.d(t,"playAB",function(){return D}),n.d(t,"parseAbm",function(){return M}),n.d(t,"makeBmTimeStr",function(){return L}),n.d(t,"makeTimeShowStr",function(){return I}),n.d(t,"updateAudioSize",function(){return H}),n.d(t,"getFreeAccountRecTimeInMinutes",function(){return A}),n.d(t,"gotoAbm",function(){return B}),n.d(t,"saveAudioCacheDate",function(){return S}),n.d(t,"wavesurferLoad",function(){return T}),n.d(t,"saveLastPlayPos",function(){return h}),n.d(t,"createRecorderCmdStream",function(){return v}),n.d(t,"audioCurTime",function(){return _e}),n.d(t,"audioTotalTime",function(){return xe}),n.d(t,"audioCurTimeString",function(){return Se}),n.d(t,"audioTotalTimeString",function(){return ke}),n.d(t,"recorderStateStream",function(){return Ue});var W,V=n(7),G=(n.n(V),n(19)),z=(n.n(G),n(23)),q=(n.n(z),n(20)),K=(n.n(q),n(8)),X=n(91),J=n(22),Y=n(21),Q=(n.n(Y),n(6)),Z=(n.n(Q),n(104)),ee=n(121),te=n(92),ne=n(102),ie=n(120),oe=(n(97),n(101)),re=n(107),ae=n(99),le=n(24),se=!1,ce=V.ENABLE_PRO,de="cn"===V.market?14400:Q("AndroidApp")?2700:600,ue=14400,pe=2700,me=2700,fe=10,he="[recorder]",ge=log.reg("reocrder");let ve,be;var ye,we,_e=Kefir.stream(function(e){return ye=e,function(){}}).toProperty(function(){return 0}),xe=Kefir.stream(function(e){return we=e,function(){}}).toProperty(function(){return 0}),Se=_e.map(L),ke=xe.map(L);let Te=new Kefir.Bus,Ce=0,Ae=!1;const $e=5;let Le=0,Ie=0;window.makeCall=function(e){for(var t=e,n=1;n<arguments.length;++n)t+="\n"+arguments[n];return t};var Ee,Ne,Pe,Fe,De=function(){var e;return Q("AndroidApp")||Q("FakeMobile")?(window.PhoneCallTrap?window.PhoneCallTrap.onCall(function(t){e(t)}):ge.warn("PhoneCallTrap was not loaded, be using CADT or FakeMobile?"),V.bDebug&&(window.dbgCallEvent=function(t){e(t)}),Kefir.stream(function(t){return e=t.emit,function(){}})):Kefir.never()}(),Me=4096,Oe=Kefir.stream(function(e){return K.vars.$appBody.on("click",".start-record",e.emit),function(){K.vars.$appBody.off("click",".start-record",e.emit)}}).flatMap(function(){return ar.bRecording&&ar.bRecordingRealStarted?Kefir.constant(["stop"]):ar.bRecording?(log.log("record is starting, ignore"),Kefir.never()):ar.bPauseRecording?Kefir.constant(["pause-to-stop"]):Kefir.constant(["start"])}),Re=Kefir.fromEvents(te.a,"onCapturerDisconnected").flatMap(function(){return W.updateRemoteSourceLabel(),ar.bRecording&&"RemoteAudioBuffer"===ar.audioInputName?Kefir.constant(["stop"]):Kefir.never()}),Ue=Kefir.stream(function(e){return Fe=e,function(){}});Ue.onValue(function(e){var t="record-starting"===e||"record-stopping"===e||"pause-stopping"===e;"stopped"===e?($(".start-record").attr("icon","moon:mic").attr("data-state","stopped").attr("title",localHtml("{=start_record=}{=hk_toggle_rec=}")).attr("aria-label",J.default.fixAriaShortcut(localHtml("{=start_record=}{=hk_toggle_rec=}"))),$(".cg-playing").toggleAttr("disabled",!1)):"paused"===e?$(".start-record").attr("icon","bs:earphone").cssAnimate("flash infinite").attr("data-state","paused").attr("title",localHtml("{=stop_record=}{=hk_toggle_rec=}")).attr("aria-label",J.default.fixAriaShortcut(localHtml("{=stop_record=}{=hk_toggle_rec=}"))):"recording"===e?$(".start-record").attr("icon","moon:mic").attr("data-state","recording").attr("title",localHtml("{=stop_record=}{=hk_toggle_rec=}")).attr("aria-label",J.default.fixAriaShortcut(localHtml("{=stop_record=}{=hk_toggle_rec=}"))):"record-starting"===e?$(".cg-playing").toggleAttr("disabled",!0):"record-stopping"===e||"pause-stopping"===e||log.error("unknown status:",e),t?$(".start-record").cssAnimate("flash infinite"):$(".start-record").cssAnimateStop("flash infinite")});Ue.toProperty(function(){return"stopped"})},,,function(e,t,n){"use strict";var i=n(99);n(124);i.a.Drawer.Canvas=Object.create(i.a.Drawer),i.a.util.extend(i.a.Drawer.Canvas,{createElements:function(){this.marks={};var e=this.wrapper.appendChild(document.createElement("canvas"));this.style(e,{position:"absolute"});var t=this.wrapper.appendChild(document.createElement("wave"));t.classList.add("wave-progress"),this.style(t,{position:"absolute",overflow:"hidden",width:"0"});var n=t.appendChild(document.createElement("canvas")),i=this.wrapper.appendChild(document.createElement("canvas"));this.style(i,{position:"absolute"}),this.cursor=this.wrapper.appendChild(document.createElement("div"));var o=.2*this.params.height*2+8,r=(this.params.height-o)/2;this.style(this.cursor,{position:"absolute",overflow:"hidden",width:this.params.cursorWidth+"px",top:r+"px",bottom:r+"px","background-color":"rgb(37, 124, 173)"});var a=this.wrapper.appendChild(document.createElement("h2"));this.style(a,{textAlign:"center",verticalAlign:"middle",position:"relative","font-size":"14px",padding:"10px 0",margin:"0",display:"none","white-space":"nowrap","overflow-x":"hidden","text-overflow":"ellipsis"}),this.waveTitle=a,this.setTitle=function(e){this.waveTitle.innerText=e,this.waveTitle.style.display=e?"block":"none"},this.canvases=[e,n,i],this.waveCc=e.getContext("2d"),this.progressCc=n.getContext("2d"),this.progressWave=t,this.marksCc=i.getContext("2d")},updateWidth:function(){var e=Math.round(this.width/this.pixelRatio)+"px";this.canvases.forEach(function(t){t.width=this.width,t.height=this.height,t.style.width=e},this),this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc.clearRect(0,0,this.width,this.height)},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(e,t,n){if(this.bRecording)this.drawWaveForRecording();else{var i=void 0!==e[0];if(e.length==this.width){this.waveCc.fillStyle=this.params.waveColor,this.progressCc.fillStyle=this.params.progressColor;var o=this.barHeight/2/t,r=this.height/2;if(this.waveCc.beginPath(),this.waveCc.moveTo(0,r),this.progressCc.beginPath(),this.progressCc.moveTo(0,r),i)for(u=0;u<this.width;u++){p=Math.round(e[u]*o);this.waveCc.lineTo(u,r+p),this.progressCc.lineTo(u,r+p)}else for(u=0;u<this.width;u++){p=o;this.waveCc.lineTo(u,r+p),this.progressCc.lineTo(u,r+p)}if(this.waveCc.lineTo(this.width,r),this.progressCc.lineTo(this.width,r),this.waveCc.moveTo(0,r),this.progressCc.moveTo(0,r),i)for(u=0;u<this.width;u++){p=Math.round(e[u]*o);this.waveCc.lineTo(u,r-p),this.progressCc.lineTo(u,r-p)}else for(u=0;u<this.width;u++){p=o;this.waveCc.lineTo(u,r-p),this.progressCc.lineTo(u,r-p)}this.waveCc.lineTo(this.width,r),this.waveCc.fill(),this.progressCc.lineTo(this.width,r),this.progressCc.fill()}else{var a=document.createElement("canvas"),l=document.createElement("canvas"),s=e.length;a.width=s,l.width=s,a.height=this.height,l.height=this.height;var c=a.getContext("2d"),d=l.getContext("2d");c.fillStyle=this.params.waveColor,d.fillStyle=this.params.progressColor;var o=this.barHeight/2/t,r=this.height/2;if(c.beginPath(),c.moveTo(0,r),d.beginPath(),d.moveTo(0,r),i)for(u=0;u<s;u++){p=Math.round(e[u]*o);c.lineTo(u,r+p),d.lineTo(u,r+p)}else for(u=0;u<s;u++){p=o;c.lineTo(u,r+p),d.lineTo(u,r+p)}if(c.lineTo(s,r),d.lineTo(s,r),c.moveTo(0,r),d.moveTo(0,r),i)for(u=0;u<s;u++){p=Math.round(e[u]*o);c.lineTo(u,r-p),d.lineTo(u,r-p)}else for(var u=0;u<s;u++){var p=o;c.lineTo(u,r-p),d.lineTo(u,r-p)}c.lineTo(s,r),c.fill(),d.lineTo(s,r),d.fill(),this.waveCc.drawImage(a,0,0,this.width,this.height),this.progressCc.drawImage(l,0,0,this.width,this.height)}if(n){var m,f;this.width/n>10?(m=1,f=10):(m=10,f=6);for(var h=0,g=0,v=[this.waveCc,this.progressCc];h<n;){var b=h/n*this.width;v.forEach(function(e){e.beginPath(),e.moveTo(b,0),e.lineTo(b,g%f==0?8:4),e.stroke()}),h+=m,g++}}}},fillProgressBar:function(e,t){this.waveCc.fillStyle=e,this.progressCc.fillStyle=t;var n=this.width,i=.2*this.height,o=this.height/2;this.waveCc.beginPath(),this.waveCc.moveTo(0,o-i),this.waveCc.lineTo(0,o+i),this.waveCc.lineTo(n,o+i),this.waveCc.lineTo(n,o-i),this.waveCc.fill(),this.progressCc.beginPath(),this.progressCc.moveTo(0,o-i),this.progressCc.lineTo(0,o+i),this.progressCc.lineTo(n,o+i),this.progressCc.lineTo(n,o-i),this.progressCc.fill()},updateProgress:function(e){if(!this.bHackIgnoreProgressEvent){var t=Math.round(this.width*e/this.pixelRatio);if(t>this.width/this.pixelRatio-this.params.cursorWidth&&(t=this.width/this.pixelRatio-this.params.cursorWidth),this.progressWave.style.width=t+"px",this.bRecording){this.recProgWidth=t,this.recStepWidth=.05*t}else{t=this.width*e/this.pixelRatio;var n=Math.min(t,this.width-this.params.cursorWidth);this.cursor.style.left=n+"px"}}},addMark:function(e){var t=e.id in this.marks;this.marks[e.id]=e,t?this.redrawMarks():this.drawMark(e)},removeMark:function(e){delete this.marks[e.id],this.redrawMarks()},drawMark:function(e){this.marksCc.fillStyle=e.color;var t=Math.min(this.width-e.width,Math.max(0,Math.round(e.percentage*this.width)));t>this.width-e.width&&(t=this.width-e.width);var n=(this.height-e.height)/2;this.marksCc.fillRect(t,n,e.width,e.height)},redrawMarks:function(){this.marksCc.clearRect(0,0,this.width,this.height),Object.keys(this.marks).forEach(function(e){this.drawMark(this.marks[e])},this)},drawWaveForRecording:function(){this.fillProgressBar("#5cb85c","rgba(0, 220, 0, 1.0)")},progressBarStyleStart:function(){this.cursor.style.display="none",this.progressWave.style.width="0px",this.drawWaveForRecording(),window.globalHas("AndroidApp")&&(this.bHackIgnoreProgressEvent=!0),window.globalHas("MobileApp")&&$(this.waveTitle).addClass("blink"),this.bRecording=!0,this.recProgWidth=0,this.recStepWidth=0,this.wrapper.classList.add("recording")},progressBarStyleEnd:function(){this.bRecording=!1,this.wrapper.classList.remove("recording"),window.globalHas("MobileApp")&&$(this.waveTitle).removeClass("blink"),window.globalHas("AndroidApp")&&(this.bHackIgnoreProgressEvent=!1),this.cursor.style.display="initial",this.progressWave.style.width="0px",this.redraw()}})},function(e,t,n){"use strict";var i=n(99);i.a.WebAudio={scriptBufferSize:256,init:function(e){if(!window.AudioContext&&!window.webkitAudioContext)throw new Error("wavesurfer.js: your browser doesn't support WebAudio");this.params=e,this.ac=e.audioContext||this.getAudioContext(),this.createVolumeNode(),this.createScriptNode()},createScriptNode:function(){var e=this,t=this.scriptBufferSize;this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(t):this.scriptNode=this.ac.createJavaScriptNode(t),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){if(!e.isPaused()){var t=e.getCurrentTime();t>e.scheduledPause&&e.pause(),e.fireEvent("audioprocess",t)}}},createVolumeNode:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},clearSource:function(){this.source.disconnect(),this.source=null},refreshBufferSource:function(){this.source&&this.clearSource(),this.source=this.ac.createBufferSource(),this.buffer&&(this.source.buffer=this.buffer),this.source.connect(this.gainNode)},setBuffer:function(e){this.lastPause=0,this.lastStart=0,this.startTime=0,this.paused=!0,this.buffer=e},loadBuffer:function(e,t,n,i){var o=this;try{var r=e.slice(0);this.ac.decodeAudioData(r,function(e){o.setBuffer(e),n&&n(e)},i)}catch(e){console.log("Decode error: "+e)}},loadEmpty:function(){this.setBuffer(null)},isPaused:function(){return this.paused},getDuration:function(){return this.buffer?this.buffer.duration:0},play:function(e,t){this.refreshBufferSource(),null==e&&(e=this.getCurrentTime()),null==t&&(t=this.getDuration()),e>t&&(e=0),this.lastStart=e,this.startTime=this.ac.currentTime,this.paused=!1,this.scheduledPause=t,this.source.start?this.source.start(0,e,t-e):this.source.noteGrainOn(0,e,t-e),this.fireEvent("play")},pause:function(){this.lastPause=this.lastStart+(this.ac.currentTime-this.startTime),this.paused=!0,this.source&&(this.source.stop?this.source.stop(0):this.source.noteOff(0),this.clearSource()),this.fireEvent("pause")},getPeaks:function(e,t){var n=this.buffer,i=Math.ceil(n.length/e);t=t||~~(i/10);for(var o=n.numberOfChannels,r=new Float32Array(e),a=0;a<o;a++)for(var l=n.getChannelData(a),s=0;s<e;s++){for(var c=~~(s*i),d=c+i,u=0,p=c;p<d;p+=t){var m=l[p];m>u?u=m:-m>u&&(u=-m)}a>1?r[s]+=u/o:r[s]=u/o}return r},getPlayedPercents:function(){var e=this.getDuration();return e>0?this.getCurrentTime()/e:0},getCurrentTime:function(){return this.isPaused()?this.lastPause:this.lastStart+(this.ac.currentTime-this.startTime)},audioContext:null,getAudioContext:function(){return i.a.WebAudio.audioContext||(i.a.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),i.a.WebAudio.audioContext},offlineAudioContext:null,getOfflineAudioContext:function(e){return i.a.WebAudio.offlineAudioContext||(i.a.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),i.a.WebAudio.offlineAudioContext}},i.a.util.extend(i.a.WebAudio,i.a.Observer)},function(e,t,n){"use strict";var i=n(99);i.a.TagAudio={scriptBufferSize:256,init:function(e){this.params=e,this.createVolumeNode(),this.audio=document.createElement("audio")},createVolumeNode:function(){},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},clearSource:function(){this.source.disconnect(),this.source=null},setBuffer:function(e){this.startTime=0,this.paused=!0,this.audio.src=""},loadBuffer:function(e,t,n,i){this.durFromWave=t;var o=this;this.audio.src=e,this.audio.onloadedmetadata=function(){o.audio.onerror=null,n&&n()},this.audio.onerror=function(){o.audio.onerror=null,i&&i()}},loadFromUrl:function(e,t){this.audio.src=e,this.durFromWave=t},loadEmpty:function(){this.setBuffer(null)},isPaused:function(){return this.paused},getDuration:function(){return this.durFromWave&&!isNaN(this.audio.duration)&&this.durFromWave<this.audio.duration?this.durFromWave:isNaN(this.audio.duration)?0:this.audio.duration},play:function(e,t){let n=isNaN(this.audio.duration)?0:this.audio.duration;null==e&&(e=this.getCurrentTime()),null==t&&(t=n),e>t&&(e=0),this.startTime=this.audio.currentTime,this.paused=!1,this.scheduledPause=t,this.audio.readyState!==this.audio.HAVE_NOTHING&&(this.audio.currentTime=e,this.audio.play()),this.fireEvent("play")},setSpeed:function(e){this.audio.playbackRate=e},seekTo:function(e){0!==this.audio.readyState&&(this.audio.currentTime=e)},pause:function(){this.paused=!0,this.audio.pause(),this.fireEvent("pause")},getPeaks:function(e,t){return{length:e}},getPlayedPercents:function(){var e=this.getDuration();return e>0?this.getCurrentTime()/e:0},getCurrentTime:function(){return this.audio.currentTime},onProgress:function(e){this.isPaused()||this.audio.currentTime>=this.scheduledPause&&(this.pause(),this.audio.currentTime=this.scheduledPause)}},i.a.util.extend(i.a.TagAudio,i.a.Observer)},function(e,t,n){"use strict";function i(){return(new Date).getTime()/1e3}var o=n(99);o.a.MediaAudio={scriptBufferSize:256,init:function(e){this.params=e,this.lastStart=0,this.sysStartTime=0,this.paused=!0,this.media=null},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},clearSource:function(){this.source.disconnect(),this.source=null},setBuffer:function(e){},loadFromUrl:function(e,t,n){function i(){r&&(o.getDuration()>0?n():setTimeout(i,100))}this.durFromWave=t,this.media&&this.media.release();var o=this,r=!0;this.media=new Media(e,function(e){},function(e){e.code===MediaError.MEDIA_ERR_ABORTED&&(r=!1,o.fireEvent("file-not-found"),n("file-not-found"))},function(e){e===Media.MEDIA_STOPPED&&o.pause()}),this.paused=!0,this.lastStart=0,this.sysStartTime=0,-1!=navigator.appVersion.indexOf("Android")?this.media.seekTo(0):(this.media.play(),this.media.pause(),this.media.seekTo(0)),i()},loadEmpty:function(){this.setBuffer(null)},isPaused:function(){return this.paused},getDuration:function(){return this.durFromWave?this.durFromWave:this.media?this.media.getDuration():0},setSpeed:function(e){console.log("setSpeed: unimplemented")},play:function(e,t){null==e&&(e=this.getCurrentTime()),null==t&&(t=this.getDuration()),e>t&&(e=0),this.sysStartTime=i(),this.lastStart=e,this.paused=!1,this.scheduledPause=t,this.media.play(),this.media.seekTo(1e3*e),this.fireEvent("play")},seekTo:function(e){this.lastStart=e,this.paused||(this.sysStartTime=i()),this.media.seekTo(1e3*e)},pause:function(){this.paused||(this.lastStart=this.getCurrentTime()),this.paused=!0,this.media&&this.media.pause(),this.fireEvent("pause")},getPeaks:function(e,t){return{length:e}},getPlayedPercents:function(){var e=this.getDuration();return e>0?this.getCurrentTime()/e:0},getCurrentTime:function(){return this.paused?this.lastStart:this.lastStart+(i()-this.sysStartTime)},onProgress:function(e){this.isPaused()||this.getCurrentTime()>=this.scheduledPause&&this.pause()}},o.a.util.extend(o.a.MediaAudio,o.a.Observer)},function(e,t){!function(e){function t(t){if("string"==typeof t.data){var n=t.handler,i=t.data.toLowerCase().split(" "),o=["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color"];t.handler=function(t){if(this===t.target||!(/textarea|select/i.test(t.target.nodeName)||e.inArray(t.target.type,o)>-1)){var r="keypress"!==t.type&&e.hotkeys.specialKeys[t.which],a=String.fromCharCode(t.which).toLowerCase(),l="",s={};t.altKey&&"alt"!==r&&(l+="alt+"),t.ctrlKey&&"ctrl"!==r&&(l+="ctrl+"),t.metaKey&&!t.ctrlKey&&"meta"!==r&&(l+="meta+"),t.shiftKey&&"shift"!==r&&(l+="shift+"),r?s[l+r]=!0:(s[l+a]=!0,s[l+e.hotkeys.shiftNums[a]]=!0,"shift+"===l&&(s[e.hotkeys.shiftNums[a]]=!0));for(var c=0,d=i.length;c<d;c++)if(s[i[c]])return n.apply(this,arguments)}}}}e.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},e.each(["keydown","keyup","keypress"],function(){e.event.special[this]={add:t}})}(jQuery)},,,,,function(e,t,n){"use strict"},function(e,t,n){"use strict";var i=n(19),o=(n.n(i),n(23)),r=(n.n(o),n(20)),a=(n.n(r),n(6)),l=(n.n(a),n(22),n(21)),s=(n.n(l),n(91),n(7)),c=(n.n(s),n(92),n(100),n(149));n.n(c)},function(e,t){e.exports='<paper-dialog id="modal-import-disk" class="dialog-middle-width" closeSelector="" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key >\n  <h2>{=modal_import_disk=}</h2>\n  <paper-button class="action-cancel" dialog-confirm >{=common_cancel=}</paper-button>\n  <paper-button class="action-import-disk text-primary" dialog-confirm disabled>\n    {=modal_import_import=}\n  </paper-button>\n  <p>\n    <div class="x-input-group">\n      <span class="x-input-group-btn">\n\t<span class="x-btn btn-file">\n\t  {=mi_browse=}<input type="file" accept="" />\n\t</span>\n      </span>\n      <input type="text" class="input-seled-files x-input-group-control" readonly="readonly" />\n    </div>\n    <div class="form-item-footnote">\n      FOOTNOTE\n    </div>\n    <div class="alert" style="margin-bottom:0;visibility:hidden">\n      PLACEHOLDER\n    </div>\n    <div class="x-center-block">\n    </div>\n  </p>\n</paper-dialog>\n'},function(e,t){e.exports='<paper-dialog id="modal-import-link" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key class="dialog-middle-width" entry-animation="fade-in-animation" exit-animation="fade-out-animation" >\n  <h2>{=modal_import_link=}</h2>\n  <div>\n    <p class="x-input-group">\n      <span class="x-input-group-label">URL</span>\n      <input type="text" class="x-input-group-control" />\n      <div class="form-item-footnote">\n\tFOOTNOTE\n      </div>\n    </p>\n    <div class="alert" style="margin-bottom:0;visibility:hidden">\n      PLACEHOLDER\n    </div>\n    <div class="progress" style="display:none">\n      <paper-progress class="progress-bar" style="width: 100%;">\n      </paper-progress>\n      <div clas="text-prog" style="text-align:center">\n        0%\n      </div>\n    </div>\n    <div class="x-center-block">\n    </div>\n  </div>\n  <div class="buttons">\n    <paper-button class="action-cancel" >{=common_cancel=}</paper-button>\n    <paper-button class="action-import-link text-primary" disabled>\n      {=modal_import_import=}\n    </paper-button>\n  </div>\n</paper-dialog>\n'},function(e,t){e.exports='<div>\n  <section class="slide-panel panel-folder-list1" name="list1">\n    <div class="slide-header">\n      <label>FOLDER NAME</label>\n      <paper-button class="left-action action-back-folder">BACK NAME</paper-button>\n      <paper-button class="right-action action-select">ACTION NAME</paper-button>\n    </div>\n    <div class="slide-body">\n      <div class="slide-form x-list-group" role="listbox">\n        \x3c!-- folder list --\x3e\n      </div>\n      <div class="text-error text-danger" style="text-align:center">\n      </div>\n    </div>\n  </section>\n  <section class="slide-panel panel-folder-list2" name="list2">\n    <div class="slide-header">\n      <label>FOLDER NAME</label>\n      <paper-button class="left-action action-back-folder">BACK NAME</paper-button>\n      <paper-button class="right-action action-select">ACTION NAME</paper-button>\n    </div>\n    <div class="slide-body">\n      <div class="slide-form x-list-group" role="listbox">\n        \x3c!-- folder list --\x3e\n      </div>\n      <div class="text-error text-danger" style="text-align:center">\n      </div>\n    </div>\n  </section>\n  <section class="slide-panel panel-prog" name="prog">\n    <div class="slide-header">\n      <paper-button class="left-action action-back-error" style="display:none">BACK NAME</paper-button>\n      <label>{=import_gdirve_loading=}</label>\n    </div>\n    <div class="slide-body">\n      <div class="progress">\n        <paper-progress class="progress-bar" value="0" style="width:100%">\n        </paper-progress>\n        <div class="text-prog" style="text-align:center">\n          0%\n        </div>\n      </div>\n      <p class="text-status">\n      </p>\n    </div>\n  </section>\n</div>\n'},function(e,t){e.exports='<paper-dialog id="modal-cloud-picker" class="x-dialog slide" style="width:400px;height:500px" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key>\n  \x3c!-- <div class="slide-header-bg"></div> --\x3e\n  <x-slider attr-for-selected="name">\n  </x-slider>\n</paper-dialog>\n'},function(e,t,n){"use strict";function i(e,t){let n=_.XORCipherAscii.encode(E,t);w.default.appSettings[e+".dropbox.secret"]=n,w.default.saveAppSettings()}function o(e){let t=w.default.appSettings[e+".dropbox.secret"];return _.XORCipherAscii.decode(E,t)}function r(e){var t,n;if(e)if(console.error(e),e instanceof Error&&e.stack&&console.error(e.stack),"string"==typeof e)t=e;else if(401===(n=e.status||e.code))L=!1,t=localString("dropbox_author_error");else if(n<=0)L=!1,t="Network error ("+n+(e.responseText||"")+").";else if(409===n&&e.error&&e.error.error&&"path"==e.error.error[".tag"]&&"not_found"===e.error.error.path[".tag"])n=404,t="Dropbox error ("+e.error.error_summary+").";else{t="string"==typeof e.responseText&&-1!==e.responseText.indexOf("<html>")?"Dropbox error ("+n+").":"Dropbox error ("+n+": "+(e.responseText||"")+")."}else t="Unknown error";var i=new Error(t);throw i.code=n,i}function a(){return x.Promise(function(e,t){b.ajax({url:"https://www.dropbox.com/static/api/2/dropins.js",type:"HEAD"}).done(function(){N=!0,h||(h=new C({clientId:y.DROPBOX_FULL_KEY})),e()}).fail(function(e){var n={code:e.status,message:e.statusText};t(n)})})}function l(){var e={client_id:y.DROPBOX_FULL_KEY,redirect_uri:w.default.makeApiUrl("/node-db-oauth2callback"),response_type:"code"};let t="https://www.dropbox.com/oauth2/authorize?"+b.param(e),n=w.default.makeApiUrl("/api/node-db-auth");return T.a(t,n)}function s(e){return Object(k.c)().then(()=>(log.log("get token"),x(b.ajax({url:w.default.makeApiUrl("/api/node-db-token"),type:"GET",xhrFields:{withCredentials:!0},dataType:"json",data:{ncode:e}})).then(e=>e.token,e=>{throw"no-token"===w.default.xhrSafeResponseText(e)?"need-redir":w.default.xhrSafeErrorString(e)}))).then(e=>{h.setCredentials({token:e}),L=!0})}function c(e){return log.log("check token"),x(h.usersGetCurrentAccount()).then(e=>e.account_id,e=>{throw e&&401===e.status||400===e.status?"need-redir":e})}function d(e){return s(e).then(t=>c(t).then(n=>({token:t,ncode:e,userId:n})))}function u(e,t){return x.resolve().then(()=>{let t=w.default.appSettings[e+".db.nc"];if(t)return d(t);throw"need-redir"}).catch(n=>{if("need-redir"===n){if(t)return l().then(t=>(w.default.appSettings[e+".db.nc"]=t,w.default.saveAppSettings(),d(t)));var i=new Error(localString("dropbox_author_error"));throw i.appName="need-redir",i}throw n}).then(({token:e,ncode:t,userId:n})=>{})}function p(e,t){function n(){function t(){var t=chrome.identity.getRedirectURL(),o=h.getAuthenticationUrl(t);chrome.identity.launchWebAuthFlow({url:o,interactive:!a},t=>{if(t){L=!0;var o=t.replace("#access_token","?access_token"),l=_.parseUrlQueryString(o).access_token;h.setAccessToken(l),i(e,l),r.resolve()}else if(chrome.runtime.lastError&&$.warn("Chrome lastError: "+chrome.runtime.lastError.message),1==a)a=!1,n();else{let e;e=chrome.runtime.lastError?chrome.runtime.lastError.message:"Access to Dropbox account is not authorized.",r.reject(e)}})}S("MobileApp")&&!a&&(ar.bMobileDontSleep=!0);let l=o(e);l?(h.setAccessToken(l),c(l).then(()=>{r.resolve()},e=>{t()})):t()}if(!0===L)return x.resolve();var r=x.defer(),a=!0;return S("Node")?u(e,t).then(r.resolve,r.reject):n(),r.promise}function m(e){return 0===e.indexOf(P)?{root:"sandbox",path:"/sandbox"+e.replace(P,"")}:{root:"dropbox",path:e}}function f(e,t){function n(e){return a=a.concat(e.entries),e.has_more?x(h.filesListFolderContinue({cursor:e.cursor})).then(n,e=>{o.reject(e)}):x.resolve()}var i=m(e),o=x.defer(),r=x.resolve(),a=[];return(r=r.then(function(){let e={path:i.path,include_deleted:!1};return e.limit=5,h.filesListFolder(e)}).then(function(e){return n(e)})).then(function(){o.resolve(a)},function(e){o.reject(e)}),g.delay(function(){o.notify({name:"cancel-handler",handler:function(e){$.warn("listChildren canceled:");var t=new Error(localString("common_cancel"));t.appName=e||"cancel",o.reject(t)}})}),o.promise}var h,g=n(19),v=(n.n(g),n(23)),b=(n.n(v),n(9)),y=(n.n(b),n(91),n(7)),w=(n.n(y),n(22)),_=n(21),x=(n.n(_),n(103),n(102),n(92),n(20)),S=(n.n(x),n(6)),k=(n.n(S),n(24),n(95)),T=n(106),C=n(158),A="[dropboxHelper]",$=log.reg("dropboxHelper"),L=!1,I={};S("Node")&&(window.Dropbox&&window.Dropbox.bPatchDropboxForNode||log.error("not found dropbox node patch"));const E=["3","a","d","P","E","D","3","9"].join("");I.clearCachedAuthToken=function(e){let t=x.defer(),n=o(e);return n?(w.default.appSettings[e+".dropbox.secret"]=null,w.default.saveAppSettings(),chrome.identity.removeCachedAuthToken({token:n},()=>{t.resolve()})):t.resolve(),t.promise};var N=!1,P="/sandbox";I.getAppRootMark=function(){return P},I.listChildren=function(e,t){return f(e).catch(r)},I.upload=function(e,t,n,i,o,a,l,s){function c(e){d.notify(e),f.notify(e)}$.log(A,"upload, path: "+e);let d=g.defaults(s||{},{notify:null});d.notify||(d.notify=function(){});var u=S("MobileApp")&&d.fileUrl;u?(console.assert(!t),d.byteLength):"string"==typeof t?t.length:t.byteLength;var p=m(e),f=x.defer(),v=x.resolve();return(v=v.then(function(){return x.Promise(function(e,i){if(u){var o=h._urls.putFile+"/"+h._urlEncodePath(p.path),r={};h._oauth.addAuthParams("GET",o,r);var a=b.param(r);a&&(o+="?"+a);var l=function(t){if(200===t.responseCode){var n=JSON.parse(t.response),o=C.File.Stat.parse(n);e(o)}else i({code:t.responseCode,message:"unknown"})},s=function(e){i({code:e.http_status,message:"unnknown"})},m=d.fileUrl,g=new window.FileUploadOptions;g.fileKey="file",g.fileName=m.substr(m.lastIndexOf("/")+1),g.mimeType=n,g.httpMethod="PUT",g.trustAllHosts=!0,g.headers={};var v=new window.FileTransfer;v.onprogress=function(e){let t={name:"progress",loaded:e.loaded,total:e.total};f.notify(t),d.notify(t)},v.upload(m,o,l,s,g),c({name:"cancel-handler",handler:function(e){$.warn("upload canceled"),v.abort(),f.reject(e||"cancel")}})}else{let n={path:p.path,contents:t,autorename:!1,mute:!0,mode:{".tag":d.bNoOverwrite?"update":"overwrite"}};x(h.filesUpload(n)).then(t=>{e(t)},i)}})})).catch(r).then(f.resolve,f.reject),f.promise},I.download=function(e,t,n){function i(e){l.notify(e)}$.log(A,"download, fileId: "+e);var o=S("MobileApp")&&n&&n.targetUrl;n||(n={});var a=m(e),l=x.defer(),s=x.resolve();return(s=s.then(function(){return x.Promise(function(e,t){if(o){var r;r=h._urls.getFile+"/"+h._urlEncodePath(a.path);var s={};h._oauth.addAuthParams("GET",r,s);var c=b.param(s);c&&(r+="?"+c);var d=new window.FileTransfer,u={};d.onprogress=function(e){l.notify({name:"progress",loaded:e.loaded,total:e.total})},d.download(r,n.targetUrl,function(n){return x.ninvoke(h,"stat",a.path).then(function(t){var n=t[0];e([t,n])},t)},function(e){$.error("download error source "+e.source),$.error("download error target "+e.target),$.error("upload error code"+e.code),t({code:e.code,message:"unknown"})},!0,{headers:u}),i({name:"cancel-handler",handler:function(e){$.warn("download canceled"),d.abort(),l.reject(e||"cancel")}})}else Object.keys(n).length>0&&!n.blob&&$.error("unsupported download opts = "+Object.keys(n)),x(h.filesDownload({path:a.path})).then(t=>{e(t)},t)}).then(function(e){return e})})).catch(r).then(l.resolve,l.reject),l.promise},I.moveFile=function(e,t,n){$.log(A,"moveFile fm:",t," to:",n);var i=m(t),o=m(n);console.assert(i.root==o.root);var a=x.resolve();return(a=a.then(function(){return x.ninvoke(h,"move",i.path,o.path).then(function(e){return e})})).catch(r)},I.createDir=function(e,t){$.log(A,"createDir:",t);var n=m(t),i=x.resolve();return(i=i.then(function(){return x.ninvoke(h,"mkdir",n.path)})).catch(r)},I.stat=function(e,t){$.log(A,"stat:",t);var n=m(t),i=x.resolve();return(i=i.then(function(){return x(h.filesGetMetadata({path:n.path,include_deleted:!0})).then(function(e){if("deleted"==e[".tag"])throw{code:404,message:"file not found"};return e})})).catch(r)},I.deleteFile=function(e,t){$.log(A,"deleteFile:",t);var n=m(t),i=x.resolve();return(i=i.then(function(){return x(h.filesDelete({path:n.path}))})).catch(r)},I.share=function(e,t,n){$.log(A,"share, path:",e);g.defaults(n||{},{hint:""});var i={downloadHack:!0},o=x.resolve();return(o=o.then(function(){return x.ninvoke(h,"makeUrl",e,i)}).then(function(e){return{link:e.url}})).catch(r)},I.authenticate=function(e,t){$.log(A,"authenticate");var n=x.resolve();return n=n.then(a),n=n.then(p.bind(window,e,t))},t.a=I},function(e,t){e.exports='<div>\n  <div class="pages">\n    <section class="setting-page page-general" role="tabpanel">\n      <div class="slide-form x-list-group">\n        <div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n              <x-menu-button class="combo-font-size" halign="right">\n                <paper-item value="small" show-name="{=font_small=}">{=font_small=}</paper-item>\n                <paper-item value="middle" show-name="{=font_middle=}">{=font_middle=}</paper-item>\n                <paper-item value="large" show-name="{=font_large=}">{=font_large=}</paper-item>\n              </x-menu-button>\n\t    </div>\n\t    <label class="slide-label">\n\t      {=font_size_label=} \n\t    </label>\n\t  </div>\n          <div class="form-item-footnote">\n            {=font_size_footnote=}\n\t  </div>\n        </div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <label class="slide-label" id="aria-gain-label">{=gain_level=}</label>\n\t    <div class="slide-control">\n              <span class="text-gain">88</span>\n\t    </div>\t    \n\t  </div>\n          <div class="form-item-footnote" style="100%">\n\t    <div>\n\t      <paper-slider class="slider-gain" min="1" max="10" value="0" style="width:100%" aria-labelledby="aria-gain-label" aria-describedby="aria-gain-desc"/>\n\t    </div>\n\t    <div id="aria-gain-desc">\n\t    </div>\n\t  </div>\n\t</div>\n        <div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n              <x-menu-button class="combo-offset-abm" halign="right">\n                <paper-item show-name="0s" value="0">0s</paper-item>\n                <paper-item show-name="-1s" value="-1">-1s</paper-item>\n                <paper-item show-name="-2s" value="-2">-2s</paper-item>\n                <paper-item show-name="-3s" value="-3">-3s</paper-item>\n                <paper-item show-name="-5s" value="-5">-5s</paper-item>\n                <paper-item show-name="-10s" value="-10">-10s</paper-item>\n                <paper-item show-name="-20s" value="-20">-20s</paper-item>\n                <paper-item show-name="-30s" value="-30">-30s</paper-item>\n              </x-menu-button>\n\t    </div>\n\t    <label class="slide-label">\n\t      {=offset_abm_label=} \n\t    </label>\n\t  </div>\n          <div class="form-item-footnote">\n            {=offset_abm_footnote=}\n\t  </div>\n        </div>\n        <div class="x-list-group-item mobile-hide">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n              <x-menu-button class="combo-rewind-speed" halign="right">\n                <paper-item show-name="2.0x" value="2">2.0x</paper-item>\n                <paper-item show-name="3.0x" value="3">3.0x</paper-item>\n                <paper-item show-name="4.0x" value="4">4.0x</paper-item>\n                <paper-item show-name="5.0x" value="5">5.0x</paper-item>\n                <paper-item show-name="6.0x" value="6">6.0x</paper-item>\n              </x-menu-button>\n\t    </div>\n\t    <label class="slide-label">\n\t      {=rewind_speed_label=} \n\t    </label>\n\t  </div>\n          <div class="form-item-footnote">\n            {=rewind_speed_footnote=}\n\t  </div>\n        </div>\n        <div class="x-list-group-item body-action action-bm">\n\t    <div class="form-item-body">\n\t      <label class="slide-label">{=bm_setting_label=}</label>\n\t    </div>\n\t    <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right" role="presentation"></iron-icon>\n\t    </div>\n            <div class="form-item-footnote">\n\t      {=bm_setting_footnote=}\n\t    </div>\n\t  </div>\n       \t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-insert-marker"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label" style="">{=insert_marker_label=}</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=insert_marker_footnote=}\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-auto-new-note"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label" style="">{=auto_new_note_label=}</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=auto_new_note_footnote=}\n\t    <span class="text-pro-only"></span>\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item mobile-only">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-wifi-only" ></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label" style="">{=wify_only_label=}</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=wify_only_footnote=}\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item android-only">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <a class="action-disable-keyboard-sound" href="{=void=}">{=disable_keyboard_sound_action=}</a>\n\t    </div>\n\t    <label class="slide-label" style="">{=disable_keyboard_sound_label=}</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {==disable_keyboard_sound_footnote==}\n\t  </div>\n\t</div>\n        <div class="x-list-group-item cn-hide">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n              <paper-button class="action-save-settings-on-server">{=common_save=}</paper-button>\n\t    </div>\n\t    <label class="slide-label">\n              {=save_settings_to_server_title=}\n\t    </label>\n\t  </div>\n\t  <div class="form-item-footnote">\n            {=save_settings_to_server_footnote=}\n            <span class="save-settings-on-server-need-signin">XXX</span>\n          </div>\n\t</div>\n        <div class="x-list-group-item body-action action-share-folder">\n\t  <div class="form-item-body">\n\t    <div class="slide-control text-share-folder long-text">\n\t      /PATH/TO/SHARE/FOLDER\n\t    </div>\n\t    <label class="slide-label">\n\t      {=share_folder=}            \n\t    </label>\n            <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right"></iron-icon>\n\t    </div>\n\t  </div>\n          <div class="form-item-footnote">\n            {=share_folder_footnote=}\n\t  </div>\n        </div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-disable-spell-check"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label" style="">{=disable_spell_check_label=}</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=disable_spell_check_footnote=}\n            <span class="text-force-spell-check" style="display: none" >{==locked_left==}</span>\n\t  </div>\n\t</div>\n        <div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-button class="action-reset-all-tutorials">{=reset_all_tutorials_action=}</paper-button>\n\t    </div>\n\t    <label class="slide-label">\n              {=reset_all_tutorials_label=}\n\t    </label>\n\t  </div>\n\t</div>\n        \x3c!-- <core-dropdown class="share-folder-provider-menu" role="radiogroup" halign="right" style="border: solid 1px lightgray;">\n\t<paper-item data-value="Disable"  tabindex="0" role="radio">\n        <iron-icon icon="bs:ban-circle"></iron-icon>\n\t{=share_folder_disable=}\n\t</paper-item>\n        <paper-item data-value="GDrive"  tabindex="0" role="radio">\n        <iron-icon icon="moon:gdrive"></iron-icon>\n\t{=google_drive=}\n        </paper-item>\n        <paper-item data-value="Dropbox"   tabindex="0" role="radio">\n        <iron-icon icon="moon:dropbox"></iron-icon>\n\t{=dropbox=}\n        </paper-item>\n        </core-dropdown> --\x3e\n      </div>\n    </section>\n    <section class="setting-page page-account" role="tabpanel">\t\t\t\t\t\t\t\n      <div class="slide-form x-list-group">\n\t<div class="cn-hide x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="layout horizontal center">\n\t\t<span class="label-account-name long-text flex">SHOW NAME</span>\n\t\t<span class="text-account-type free-hide pro-label">XXX</span>\n\t      </div>\n\t    </div>\n\t    <label class="slide-label">{=account_name_label=}</label>\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <span class="label-notes" >88/88</span>\n\t    </div>\n\t    <label class="slide-label">{=account_note_num=}</label>\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="text-space-used">8888M</div>\n\t    </div>\n\t    <div class="slide-label">\n\t      <label>{=account_disk_used_label=}</label>\n\t    </div>\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item android-only">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="text-android-data-folder selectable-text">/PATH/TO/DATA</div>\n\t    </div>\n\t    <div class="slide-label">\n\t      <label>{=account_android_data_folder=}</label>\n\t    </div>\n\t  </div>\n\t</div>\n        <div class="x-list-group-item node-only">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="text-node-data-folder selectable-text">/PATH/TO/DATA</div>\n\t    </div>\n\t    <div class="slide-label">\n\t      <label>{=account_node_data_folder=}</label>\n\t    </div>\n\t  </div>\n\t</div>\n\t<div class="cn-hide x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <a class="action-upgrade x-btn text-primary" href="{=void=}" style="padding-right: 0">\n\t\t{=account_upgrade_to_pro=}\n\t\t<iron-icon icon="bs:chevron-right"></iron-icon>\n\t      </a>\n\t    </div>\n\t  </div>\n\t</div>\n        <div class="form-footnote small">\n\t  <ul>\n\t    <li class="node-only">{==node_reset_app_footnote1==}</li>\n\t    <li class="android-only">{==android_reset_app_footnote1==}</li>\n\t  </ul>\n\t</div>\n      </div>\n    </section>\n    <section class="setting-page page-sync" role="tabpanel">\n      <div class="slide-form x-list-group">\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="cloud-list x-list-group" style="position:relative;margin-bottom:0;display: inline-block;" role="radiogroup" aria-labelledby="aria-sync-dest-label">\n\t\t<paper-item  class="x-list-group-item" data-value="Disable" tabindex="0" role="radio" >\n                  <iron-icon icon="bs:hdd"></iron-icon>\n\t\t  {=sync_provider_disable=}\n\t\t</paper-item>\n\t\t<paper-item  class="x-list-group-item" data-value="GDrive" tabindex="0" role="radio">\n                  <iron-icon icon="moon:gdrive"></iron-icon>\n\t\t  {=google_drive=}\n\t\t</paper-item>\n\t\t<paper-item  class="x-list-group-item" data-value="Dropbox" tabindex="0" role="radio">\n                  <iron-icon icon="moon:dropbox"></iron-icon>\n\t\t  Dropbox\n\t\t</paper-item>\n\t\t\x3c!-- <div id="backup-type-list" class="dropdown pull-right" style="position:absolute;display:none;right:5px;z-index:3"> --\x3e\n\t\t\x3c!-- \t<a href="{=void=}" class="dropdown-toggle" data-toggle="dropdown"> --\x3e\n\t\t\x3c!-- \t\t<i class="glyphicon glyphicon-cog" style="color:white"></i> --\x3e\n\t\t\x3c!-- \t</a> --\x3e\n\t\t\x3c!-- \t<ul class="dropdown-menu"> --\x3e\n\t\t\x3c!-- \t\t<li class=""> --\x3e\n\t\t\x3c!-- \t\t\t<a id="" href="{=void=}" class="" data-name="MicNote" title=""> --\x3e\n\t\t\x3c!-- \t\t\t\tMicNote --\x3e\n\t\t\x3c!-- \t\t\t</a> --\x3e\n\t\t\x3c!-- \t\t</li> --\x3e\n\t\t\x3c!-- \t\t<li> --\x3e\n\t\t\x3c!-- \t\t\t<a id="" href="{=void=}" class=""  data-name="Audio" title=""> --\x3e\n\t\t\x3c!-- \t\t\t\tAudio --\x3e\n\t\t\x3c!-- \t\t\t</a> --\x3e\n\t\t\x3c!-- \t\t</li> --\x3e\n\t\t\x3c!-- \t</ul> --\x3e\n\t\t\x3c!-- </div> --\x3e\n\t      </div>\n\t    </div>\n            <label class="control-label" id="aria-sync-dest-label">{=sync_dest_label=}</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=sync_dest_footnote=}\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item body-action action-sel-sync-folder">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="text-sync-folder long-text">/FOLDER_NAME</div>\n\t    </div>\n\t    <label class="slide-label">{=sync_db_folder=}</label>\n\t  </div>\n\t  <div class="slide-arrow">\n\t    <iron-icon icon="bs:chevron-right"></iron-icon>\n\t  </div>\n\t  <div class="options-footnote form-item-footnote">\n\t    {=sync_db_folder_footnote=}\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item item-upgrade-gdrive-folder" style="display:none">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t    </div>\n\t    <div class="slide-label">\n\t      <a class="action-upgrade-gdrive-folder text-danger" href="{=void=}" role="button">UPGRADE DATABASE FOLDER</a>\n\t    </div>\n\t  </div>\n\t  <div class="form-item-footnote">Moves <strong>In [Mic Note] App</strong> to an external folder on Google Drive, using external folder is RECOMMENDED from now on.</div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox id="check_auto_sync"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label">{=auto_sync_label=}</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=auto_sync_footnote=}\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-button class="action-clear-cache">{=clear_cache_action=}</paper-button>\n\t    </div>\n\t    <label class="slide-label">\n              {=clear_cache_label=}\n\t    </label>\n\t  </div>\n\t  <div class="form-item-footnote">\n            <div class="text-total-cache">TOTAL 8888M</div>\n            <div>\n              {=clear_cache_footnote=}\n            </div>\n          </div>\n\t</div>\n        <div class="form-footnote small">\n\t  <ul>\n            <li class="gdrive-only" style="display:none">\n              <iron-icon icon="moon:gdrive" aria-label="Google Drive"></iron-icon>{=gdrive_sync_folder_tips=}\n            </li>\n\t    <li class="cn-only">{==sync_footnote_gfw_warning==}</li>\n\t  </ul>\n\t</div>\n      </div>\n    </section>\n    \x3c!-- <div class="modal-footer"> --\x3e\n    \x3c!-- \t<button data-dismiss="modal" class="btn btn-default">{=common_cancel=}</button> --\x3e\n    \x3c!-- \t<button data-name="save" data-dismiss="modal" class="btn btn-success">{=common_save=}</button>\t\t\t --\x3e\n    \x3c!-- </div> --\x3e\n    <section class="setting-page page-auto-export" role="tabpanel">\n      <div class="slide-form x-list-group">\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="cloud-list x-list-group" style="position:relative;margin-bottom:0;display: inline-block;" role="radiogroup" aria-labelledby="aria-auto-export">\n\t\t<paper-item  class="x-list-group-item" data-value="Disable" tabindex="0" role="radio">\n                  <iron-icon icon="bs:ban-circle"></iron-icon>\n\t\t  {=auto_exp_provider_disable=}\n\t\t</paper-item>\n\t\t<paper-item  class="x-list-group-item" data-value="GDrive" tabindex="0" role="radio">\n                  <iron-icon icon="moon:gdrive"></iron-icon>\n\t\t  {=google_drive=}\n\t\t</paper-item>\n\t\t<paper-item  class="x-list-group-item" data-value="Dropbox" tabindex="0" role="radio">\n                  <iron-icon icon="moon:dropbox"></iron-icon>\n\t\t  Dropbox\n\t\t</paper-item>\n\t      </div>\n\t    </div>\n\t    <label class="slide-label" id="aria-auto-export">{=auto_exp_dest_label=}</label>\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item body-action action-options">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="text-options long-text">PROVIDER NAME</div>\n\t    </div>\n\t    <label class="slide-label">{=auto_exp_options_label=}</label>\n\t  </div>\n\t  <div class="slide-arrow">\n\t    <iron-icon icon="bs:chevron-right"></iron-icon>\n\t  </div>\n\t  <div class="options-footnote form-item-footnote">\n\t    YOUR NOTES ARE BACKING UP IN XXX FORMATS.\n\t  </div>\n\t</div>\n\t<div class="form-footnote small">\n\t  <ul>\n\t    <li>{==auto_exp_footnote1==}</li>\n\t    <li>{==auto_exp_footnote2==}</li>\n            <li>{==auto_exp_footnote3==}</li>\n            <li class="gdrive-only" style="display:none">\n              <iron-icon icon="moon:gdrive" aria-label="Google Drive"></iron-icon>{=gdrive_auto_exp_folder_tips=}\n            </li>\n\t    <li class="cn-only">{==auto_exp_footnote_cn_warn==}</li>\n\t  </ul>\n\t</div>\n      </div>\n    </section>\n  </div> \x3c!-- end of pages --\x3e\n  <div class="panels">\n    \x3c!-- panel - upgrade --\x3e\n    <section class="slide-panel panel-upgrade" name="upgrade">\n      <div class="slide-header">\n\t<label>{=upgrade_page_title=}</label>\n\t<paper-button class="right-action action-close">{=common_close=}</paper-button>\n\t<paper-button class="left-action action-back">{=common_back=}</paper-button>\t\t\t\t\t\n      </div>\t\t\t\t\n      <div class="slide-body layout vertical" style="padding:0;margin-bottom:10px;" hero-id="hero" hero >\n        <div class="text-trial-prompt" style="padding: 10px 29px">\n        </div>\n        <div class="promo-msg" style="display:none">\n          <div class="alert-danger" style="padding: 10px 29px;"></div>\n        </div>\n\t<div class="pro-desc-panel x-panel x-panel-success" style="margin: 20px 50px 0 50px">\n\t  <div class="x-panel-heading">\n\t    {==upgrade_panel_title==}<span class="can-buy-pro pro-price">({=getting_price=})</span>\n\t  </div>\n\t  <div class="x-panel-body">\n\t    <div class="desc-item">\n\t      <iron-icon icon="bs:ok" role="presentation"></iron-icon>\n\t      <div>\n\t\t<strong>\n\t\t  {=upgrade_max_rec_time_label=}\n\t\t</strong>\n\t\t<div class="small help-block text-upgrade-rec-time-help">\n\t\t</div>\n\t      </div>\n\t    </div>\n            <div class="desc-item">\n\t      <iron-icon icon="bs:ok"></iron-icon>\n\t      <div>\n\t\t<strong>\n\t\t  {=upgrade_images_label=}\n\t\t</strong>\n\t\t<div class="small help-block text-upgrade-images-help">\n\t\t</div>\n\t      </div>\n\t    </div>\n            \x3c!-- <div class="desc-item">\n\t    <iron-icon icon="bs:ok" role="presentation"></iron-icon>\n\t    <div>\n\t    <strong>\n\t    {=upgrade_unlimited_notes_label=}\n\t    </strong>\n\t    <div class="small help-block">\n\t    {==upgrade_unlimited_notes_help==}\n\t    </div>\n\t    </div>\n\t    </div> --\x3e\n\t    <div class="desc-item desktop-only">\n\t      <iron-icon icon="bs:ok" role="presentation"></iron-icon>\n\t      <div>\n\t\t<strong>\n\t\t  {=upgrade_unlock_more_features_label=}\n\t\t</strong>\n\t\t<div class="small help-block">\n\t\t  {=upgrade_unlock_more_features_help=}\n\t\t</div>\n\t      </div>\n\t    </div>\n            <div class="desc-item">\n\t      <iron-icon icon="bs:ok"></iron-icon>\n\t      <div>\n\t\t<strong>\n\t\t  {=upgrade_platform_label=}\n\t\t</strong>\n\t\t<div class="small help-block">\n\t\t  {=upgrade_platform_help=}\n\t\t</div>\n\t      </div>\n\t    </div>\n            <div class="desc-item mobile-only">\n\t      <iron-icon icon="bs:ok"></iron-icon>\n\t      <div>\n\t\t<strong>\n\t\t  {=upgrade_premium_label=}\n\t\t</strong>\n\t\t<div class="small help-block">\n\t\t  {=upgrade_premium_help=}\n\t\t</div>\n\t      </div>\n\t    </div>\n\t  </div>\n\t  <div class="x-panel-footer small">\n\t    <li class="chrome-only">\n\t      {==purchase_bound_google_for_cws==}\n\t    </li>\n\t    <li class="node-only">\n\t      {==purchase_bound_google_for_node==}\n\t    </li>\n\t    <li class="android-only">\n\t      {==purchase_bound_google_for_android==}\n\t    </li>\n\t    <li class="ios-only">\n\t      {==purchase_bound_apple_id==}\n\t    </li>\n\t    <li>\n\t      {==one_off_payment==}\n\t    </li>\n          </div>\n\t</div>\x3c!-- .panel --\x3e\n\t<div class="text-warning text-signin-warning" style="visibility:hidden;text-align:center">{==need_sign_in_before_purchase==}</div>\n\t<div class="can-buy-pro chrome-only" style="text-align:center" >\n\t  <input type="image" id="pay-with-paypal" style="vertical-align: middle;width:200px" src="/img/AM_mc_vs_dc_ae.jpg" role="button" aria-label="buy with paypal"/>\n\t  <span class="gwallet-only">{=pay_method_or=}</span>\n\t  <input class="gwallet-only" type="image" id="pay-with-gwallet" style="vertical-align: middle;width:200px" src="/img/wallet_images_buy_button.png" role="button" aria-label="buy with google wallet"/>\n\t</div>\n\t<div class="can-buy-pro node-only" style="text-align:center" >\n\t  <input type="image" id="pay-with-paypal" style="vertical-align: middle;width:200px" src="img/AM_mc_vs_dc_ae.jpg" role="button" aria-label="buy with paypal"/>\n\t</div>\n\t<div class="android-only can-buy-pro" style="text-align:center" >\n\t  <input type="image" id="pay-with-gwallet" style="vertical-align: middle;width:200px" src="/img/wallet_images_buy_button.png" role="button" aria-label="buy with google wallet"/>\n\t</div>\n        <div style="text-align:center">\n\t  <paper-button class="no-buy-pro text-success" disabled>\n\t    <iron-icon icon="star"></iron-icon>\n\t    {=already_pro=}\n\t  </paper-button>\n        </div>\n        \x3c!-- <div class="free-only debug-only" style="margin-left: 50px;margin-top: 10px;">\n        Do you have purchased before? you may need <a class="action-restore-purchase text-primary" href="{=void=}">Restore Purchase</a>\n        </div> --\x3e\n        <div class="flex"></div>\n        <div class="desktop-only" style="margin: 10px 50px";">\n          Buy for organizations? you may want <a class="action-buy-vol text-primary" href="{=void=}">Volume Purchase</a>.\n        </div>\n      </div>\n    </section>\n    <section class="slide-panel panel-share-folder" name="share-folder">\n      <div class="slide-header">\n\t<label>{=share_folder=}</label>\n\t<paper-button class="right-action action-close">{=common_close=}</paper-button>\n\t<paper-button class="left-action action-back">{=common_back=}</paper-button>\t\t\t\t\t\n      </div>\n      <div class="slide-body">\n        <div class="slide-form x-list-group">\n\t  <div class="x-list-group-item">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t        <div class="cloud-list x-list-group" style="position:relative;margin-bottom:0;display: inline-block;" role="radiogroup">\n\t\t  <paper-item  class="x-list-group-item" data-value="Disable" tabindex="0" role="radio">\n                    <iron-icon icon="bs:ban-circle"></iron-icon>\n\t\t    {=share_folder_disable=}\n\t\t  </paper-item>\n\t\t  <paper-item  class="x-list-group-item" data-value="GDrive" tabindex="0" role="radio">\n                    <iron-icon icon="moon:gdrive"></iron-icon>\n\t\t    {=google_drive=}\n\t\t  </paper-item>\n\t\t  <paper-item  class="x-list-group-item" data-value="Dropbox" tabindex="0" role="radio">\n                    <iron-icon icon="moon:dropbox"></iron-icon>\n\t\t    Dropbox\n\t\t  </paper-item>\n\t        </div>\n\t      </div>\n\t      <label class="slide-label">{=share_folde_dest_label=}</label>\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item body-action action-sel-folder">\n\t    <div class="form-item-body">\n\t      <div class="slide-control long-text text-folder">\n                PATH/TO/SHARE/FOLDER\n\t      </div>\n\t      <label class="slide-label">{=share_folder_folder=}</label>\n\t    </div>\n\t    <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right"></iron-icon>\n\t    </div>\n\t    <div class="form-item-footnote">\n\t    </div>\n\t  </div>\n        </div>\n      </div>\n    </section>\n    <section class="slide-panel panel-bm" name="bookmark">\n      <div class="slide-header">\n\t<label>{=bm_setting_label=}</label>\n\t<paper-button class="right-action action-close">{=common_close=}</paper-button>\n\t<paper-button class="left-action action-back">{=common_back=}</paper-button>\t\t\t\t\t\n      </div>\n      <div class="slide-body">\n        <div class="slide-form x-list-group">\n\t  <div class="x-list-group-item item-bm-strings">\n\t    <div class="form-item-body">\n              <div class="string-list" style="width:100%" >\n                <div class="string-templ">\n                  <div class="string-item layout horizontal" >\n                    <paper-input class="string flex"></paper-input>\n                    <x-dropdown-button class="color" halign="right">\n                      <x-icon-button slot="x-dropdown-trigger" class="" icon="bs:stop" title="Color">\n                      </x-icon-button>\n                      <paper-listbox class="dropdown" style="width:100px; padding:0;">\n                      </paper-listbox>\n                    </x-dropdown-button>\n                  </div>\n                </div>\n              </div>\n            </div>\n\t    <div class="form-item-footnote" style="margin-top: 10px;">\n              <span>{=bm_setting_footnote=}</span>\n              <a href="{=void=}" class="action-reset">({=bm_reset=})</a>\n\t    </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  </div> \x3c!-- end of panels --\x3e\n</div>\n'},function(e,t){e.exports='\x3c!-- framework for large screen --\x3e\n<paper-dialog id="modal-settings" class="slide" style="width:500px;height:580px" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key >\n  \x3c!-- <div class="slide-header-bg"></div> --\x3e\n  <x-slider selected="main" attr-for-selected="name">\n    \x3c!-- panel - main --\x3e\n    <section class="panel-main slide-panel" name="main">\n      <div class="slide-header">\n\t<label>{=settings_panel_settings=}</label>\n\t<paper-button class="right-action action-close">{=common_close=}</paper-button>\n      </div>\t\t\t\t\n      <div class="slide-body layout horizontal" style="padding:0">\n\t<div style="border-right:1px solid #e5e5e5; height:100%;padding:0px" class="flex flex-1">\n\t  <div class="nav-tab x-list-group" role="tablist">\n\t    <paper-item class="x-list-group-item" data-name="general" role="tab" tabindex="0">{=settings_page_general=}</paper-item>\n\t    <paper-item class="x-list-group-item" data-name="sync" role="tab" tabindex="0">{=settings_page_sync=}</paper-item>\n\t    <paper-item class="x-list-group-item" data-name="auto-export" role="tab" tabindex="0">{=settings_page_auto_exp=}</paper-item>\n\t    <paper-item class="x-list-group-item" data-name="account" class="" role="tab" tabindex="0">{=settings_page_account=}</paper-item>\n\t  </div>\n\t</div>\n\t<div style="padding:15px;overflow-y: auto;" class="flex flex-3" >\n\t  <div class="pos-pages"></div>\n\t</div>\n      </div>\n    </section>\n    <div class="pos-panels"></div>\n  </x-slider>\n</paper-dialog>\n'},function(e,t){e.exports='<paper-dialog id="modal-settings" class="x-dialog slide" entry-animation="fade-in-animation" exit-animation="fade-out-animation" >\n  \x3c!-- <div class="slide-header-bg"></div> --\x3e\n  <x-slider selected="main" attr-for-selected="name">\n    \x3c!-- panel - main --\x3e\n    <div class="slide-panel panel-main" name="main">\n      <div class="slide-header">\n        <label>{=home_settings=}</label>\n        <paper-button class="right-action action-close">{=common_close=}</paper-button>\n      </div>\t\t\t\t\n      <div class="slide-body" style="">\n        <div class="slide-form x-list-group">\n\t  <div class="x-list-group-item body-action action-general">\n\t    <div class="form-item-body">\n\t      <label class="slide-label">{=settings_page_general=}</label>\n\t    </div>\n\t    <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right" role="presentation"></iron-icon>\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item body-action action-sync">\n\t    <div class="form-item-body">\n\t      <label class="slide-label">{=settings_page_sync=}</label>\n\t    </div>\n\t    <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right" role="presentation"></iron-icon>\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item body-action action-auto-export">\n\t    <div class="form-item-body">\n\t      <label class="slide-label">{=settings_page_auto_exp=}</label>\n\t    </div>\n\t    <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right" role="presentation"></iron-icon>\n\t    </div>\n\t  </div>\n\t  <div class="x-list-group-item body-action action-account">\n\t    <div class="form-item-body">\n\t      <label class="slide-label">{=settings_page_account=}</label>\n\t    </div>\n\t    <div class="slide-arrow">\n\t      <iron-icon icon="bs:chevron-right" role="presentation"></iron-icon>\n\t    </div>\n\t  </div>\n        </div>\n      </div>\t\n    </div>\n    \x3c!-- panel - general --\x3e\n    <div class="slide-panel panel-general" name="general">\n      <div class="slide-header">\n        <label>{=settings_page_general=}</label>\n        <paper-button class="left-action action-back">{=common_back=}</paper-button>\n        <paper-button class="right-action action-close">{=common_close=}</paper-button>\n      </div>\t\t\t\t\n      <div class="slide-body">\n        <div class="pos-general"></div>\n      </div>\n    </div>\n    \x3c!-- panel - sync --\x3e\n    <div class="slide-panel panel-sync" name="sync">\n      <div class="slide-header">\n        <label>{=settings_page_sync=}</label>\n        <paper-button class="left-action action-back">{=common_back=}</paper-button>\n        <paper-button class="right-action action-close">{=common_close=}</paper-button>\n      </div>\t\t\t\t\n      <div class="slide-body">\n        <div class="pos-sync"></div>\n      </div>\n    </div>\n    \x3c!-- panel - auto export --\x3e\n    <div class="slide-panel panel-auto-export" name="auto-export">\n      <div class="slide-header">\n        <label>{=settings_page_auto_exp=}</label>\n        <paper-button class="left-action action-back">{=common_back=}</paper-button>\n        <paper-button class="right-action action-close">{=common_close=}</paper-button>\n      </div>\t\t\t\t\n      <div class="slide-body">\n        <div class="pos-auto-export"></div>\n      </div>\n    </div>\n    \x3c!-- panel - Account --\x3e\n    <div class="slide-panel panel-account" name="account">\n      <div class="slide-header">\n        <label>{=settings_page_account=}</label>\n        <paper-button class="left-action action-back">{=common_back=}</paper-button>\n        <paper-button class="right-action action-close">{=common_close=}</paper-button>\n      </div>\t\t\t\t\n      <div class="slide-body">\n        <div class="pos-account"></div>\n      </div>\n    </div>\n    <div class="pos-panels"></div>\n  </x-slider>\n</paper-dialog>\n'},function(e,t){e.exports='<div>\n  <section class="slide-panel panel-gdrive" name="ae-main">\n    <div class="slide-header">\n      <label>{=rt_cloud_name=}</label>\n      <paper-button class="left-action action-back" href="{=void=}">Back</paper-button>\n    </div>\n    <div class="slide-body">\n      <div class="slide-form x-list-group">\n\t<div class="x-list-group-item body-action action-sel-folder">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <div class="text-folder long-text">PATH</div>\n\t    </div>\n\t    <label class="slide-label">Folder</label>\n\t  </div>\n\t  <div class="slide-arrow">\n\t    <iron-icon icon="bs:chevron-right"></iron-icon>\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-micnote"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label">.micnote</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    MicNote\'s native format. All-in-one, the best format for backing up and sharing with other MicNote users.\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-recording"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label">Recording</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    Mp3 format.\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item gdrive-only">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-pdf"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label">PDF</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=export_cloud_pdf_footnote=}[1]\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item gdrive-only">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-gdoc"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label">Google Doc</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n            {=export_cloud_gdoc_footnote=}[1]\n\t  </div>\n\t</div>\n\t<div class="x-list-group-item">\n\t  <div class="form-item-body">\n\t    <div class="slide-control">\n\t      <paper-checkbox class="check-html"></paper-checkbox>\n\t    </div>\n\t    <label class="slide-label">HTML</label>\n\t  </div>\n\t  <div class="form-item-footnote">\n\t    {=export_cloud_html_footnote=}[1]\n\t  </div>\n\t</div>\n      </div>\n      <div class="form-footnote">\n\t<div class ="" >\n\t  {=export_cloud_options=}\n\t</div>\n      </div>\n        <div class="slide-form x-list-group">\n\t  <div class="x-list-group-item">\n\t    <div class="form-item-body">\n\t      <div class="slide-control">\n\t\t<paper-checkbox class="check-with-abm" ></paper-checkbox>\n\t      </div>\n\t      <label class="slide-label">{=export_cloud_with_abm_label=}</label>\n\t    </div>\n            <div class="form-item-footnote">\n\t      <span class=\'gdrive-only\'>{=export_cloud_with_abm_footnote_gdrive=}</span>\n\t      <span class=\'dropbox-only\'>{=export_cloud_with_abm_footnote_dropbox=}</span>\n\t    </div>\n\t  </div>\n          <div class="form-footnote small">\n\t    <div class ="" >\n\t      [1]{==footnote_exp_doc_problem==}\n\t    </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</div>\n'},function(e,t,n){var i=n(159);e.exports=i},function(e,t,n){var i,o=n(160),r=n(172);((i=function(e){o.call(this,e)}).prototype=Object.create(o.prototype)).constructor=i,(i.prototype=Object.assign(i.prototype,r)).filesGetSharedLinkFile=function(e){return this.request("sharing/get_shared_link_file",e,"api","download")},e.exports=i},function(e,t,n){var i,o=n(161);n(162),(i=function(e){e=e||{},this.accessToken=e.accessToken,this.clientId=e.clientId,this.selectUser=e.selectUser}).prototype.setAccessToken=function(e){this.accessToken=e},i.prototype.getAccessToken=function(){return this.accessToken},i.prototype.setClientId=function(e){this.clientId=e},i.prototype.getClientId=function(){return this.clientId},i.prototype.getAuthenticationUrl=function(e,t){var n,i=this.getClientId();if(!i)throw new Error("A client id is required. You can set the client id using .setClientId().");if(!e)throw new Error("A redirect uri is required.");return n="https://www.dropbox.com/oauth2/authorize?response_type=token&client_id="+i,e&&(n=n+"&redirect_uri="+e),t&&(n=n+"&state="+t),n},i.prototype.authenticateWithCordova=function(e,t){var n=this.getAuthenticationUrl("https://www.dropbox.com/1/oauth2/redirect_receiver"),i=window.open(n,"_blank"),o=!1,r=function(e){window.setTimeout(function(){i.close()},10),t()},a=function(n){if(n.url.indexOf("&error=")>-1)window.setTimeout(function(){i.close()},10),t();else{var o=n.url.indexOf("#access_token="),r=n.url.indexOf("&token_type=");if(o>-1){o+="#access_token=".length,window.setTimeout(function(){i.close()},10);var a=n.url.substring(o,r);e(a)}}},l=function(e){o||(i.removeEventListener("loaderror",r),i.removeEventListener("loadstop",a),i.removeEventListener("exit",l),o=!0)};i.addEventListener("loaderror",r),i.addEventListener("loadstop",a),i.addEventListener("exit",l)},i.prototype.request=function(e,t,n,i,r){var a=null;switch(r){case o.RPC:a=this.getRpcRequest();break;case o.DOWNLOAD:a=this.getDownloadRequest();break;case o.UPLOAD:a=this.getUploadRequest();break;default:throw new Error("Invalid request style: "+r)}return a(e,t,n,i,this.getAccessToken(),this.selectUser)},i.prototype.setRpcRequest=function(e){i.prototype.rpcRequest=e},i.prototype.getRpcRequest=function(){return void 0===i.prototype.rpcRequest&&(i.prototype.rpcRequest=n(163)),i.prototype.rpcRequest},i.prototype.setDownloadRequest=function(e){i.prototype.downloadRequest=e},i.prototype.getDownloadRequest=function(){return void 0===i.prototype.downloadRequest&&(i.prototype.downloadRequest=n(170)),i.prototype.downloadRequest},i.prototype.setUploadRequest=function(e){i.prototype.uploadRequest=e},i.prototype.getUploadRequest=function(){return void 0===i.prototype.uploadRequest&&(i.prototype.uploadRequest=n(171)),i.prototype.uploadRequest},e.exports=i},function(e,t){e.exports={RPC:"rpc",DOWNLOAD:"download",UPLOAD:"upload"}},function(e,t){"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";var t,n,i,o;if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(t=Object(e),n=1;n<arguments.length;n++)if(void 0!==(i=arguments[n])&&null!==i)for(o in i)i.hasOwnProperty(o)&&(t[o]=i[o]);return t})},function(e,t,n){var i=n(114),o=n(115).Promise,r=n(116),a=function(e,t){var n;if(t)try{n=JSON.parse(t.text)}catch(e){n=t.text}return{status:e.status,error:n||e,response:t}};e.exports=function(e,t,n,l,s,c){return new o(function(o,d){function u(e){o&&o(e)}function p(e){d&&d(e)}var m;switch(t||(t=null),m=i.post(r(l)+e).type("application/json"),n){case"team":case"user":m.set("Authorization","Bearer "+s);break;case"noauth":break;default:throw new Error("Unhandled auth type: "+n)}c&&(m=m.set("Dropbox-API-Select-User",c)),m.send(t).end(function(e,t){e?p(a(e,t)):u(t.body)})})}},function(e,t,n){function i(e){if(e)return o(e)}function o(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}e.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i,o=0;o<n.length;o++)if((i=n[o])===t||i.fn===t){n.splice(o,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var i=0,o=(n=n.slice(0)).length;i<o;++i)n[i].apply(this,t);return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){function i(e){if(e)return o(e)}function o(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}var r=n(127);e.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(e){return this._parser=e,this},i.prototype.responseType=function(e){return this._responseType=e,this},i.prototype.serialize=function(e){return this._serializer=e,this},i.prototype.timeout=function(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},i.prototype.retry=function(e){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(e,t){if(!this._fullfilledPromise){var n=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(e,t){n.end(function(n,i){n?t(n):e(i)})})}return this._fullfilledPromise.then(e,t)},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.use=function(e){return e(this),this},i.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},i.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},i.prototype.get=function(e){return this._header[e.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(e,t){if(r(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},i.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},i.prototype.field=function(e,t){if(null===e||void 0===e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),r(e)){for(var n in e)this.field(n,e[n]);return this}if(Array.isArray(t)){for(var i in t)this.field(e,t[i]);return this}if(null===t||void 0===t)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},i.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},i.prototype.withCredentials=function(e){return void 0==e&&(e=!0),this._withCredentials=e,this},i.prototype.redirects=function(e){return this._maxRedirects=e,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(e){var t=r(e),n=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&r(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(n||this.type("form"),n=this._header["content-type"],this._data="application/x-www-form-urlencoded"==n?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(n||this.type("json"),this)},i.prototype.sortQuery=function(e){return this._sort=void 0===e||e,this},i.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var n=this.url.substring(t+1).split("&");"function"==typeof this._sort?n.sort(this._sort):n.sort(),this.url=this.url.substring(0,t)+"?"+n.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(e,t,n){if(!this._aborted){var i=new Error(e+t+"ms exceeded");i.timeout=t,i.code="ECONNABORTED",i.errno=n,this.timedout=!0,this.abort(),this.callback(i)}},i.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(e,t,n){function i(e){if(e)return o(e)}function o(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}var r=n(167);e.exports=i,i.prototype.get=function(e){return this.header[e.toLowerCase()]},i.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=r.type(t);var n=r.params(t);for(var i in n)this[i]=n[i];this.links={};try{e.link&&(this.links=r.parseLinks(e.link))}catch(e){}},i.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e}},function(e,t){t.type=function(e){return e.split(/ *; */).shift()},t.params=function(e){return e.split(/ *; */).reduce(function(e,t){var n=t.split(/ *= */),i=n.shift(),o=n.shift();return i&&o&&(e[i]=o),e},{})},t.parseLinks=function(e){return e.split(/ *, */).reduce(function(e,t){var n=t.split(/ *; */),i=n[0].slice(1,-1);return e[n[1].split(/ *= */)[1].slice(1,-1)]=i,e},{})},t.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&delete e.cookie,e}},function(e,t){var n=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];e.exports=function(e,t){return!!(e&&e.code&&~n.indexOf(e.code))||(!!(t&&t.status&&t.status>=500)||(!!(e&&"timeout"in e&&"ECONNABORTED"==e.code)||!!(e&&"crossDomain"in e)))}},function(e,t){},function(e,t,n){var i,o,r,a=n(114),l=n(115).Promise,s=n(116),c=n(128);a.parse["application/octect-stream"]=function(e){return e},i=function(e,t){return{status:e.status,error:(t?t.text:null)||e.toString(),response:t}},r=function(e,t){e.text="",e.setEncoding("binary"),e.on("data",function(t){e.text+=t}),e.on("end",function(){t()})},o=function(e,t,n,o,d,u){if("user"!==n)throw new Error("Unexpected auth type: "+n);return new l(function(n,l){function p(e){n&&n(e)}function m(e){l&&l(e)}function f(e,t){var n;e?m(i(e,t)):(n=JSON.parse(t.headers["dropbox-api-result"]),t.xhr?n.fileBlob=t.xhr.response:n.fileBinary=t.res.text,p(n))}var h;h=a.post(s(o)+e).set("Authorization","Bearer "+d).set("Dropbox-API-Arg",c(t)).on("request",function(){this.xhr&&(this.xhr.responseType="blob")}),u&&(h=h.set("Dropbox-API-Select-User",u)),"undefined"==typeof window?h.buffer(!0).parse(r).end(f):h.end(f)})},e.exports=o},function(e,t,n){var i=n(114),o=n(115).Promise,r=n(116),a=n(128),l=function(e,t){return{status:e.status,error:(t?t.text:null)||e.toString(),response:t}};e.exports=function(e,t,n,s,c,d){if("user"!==n)throw new Error("Unexpected auth type: "+n);return new o(function(n,o){function u(e){n&&n(e)}function p(e){o&&o(e)}var m,f=t.contents;delete t.contents,m=i.post(r(s)+e).type("application/octet-stream").set("Authorization","Bearer "+c).set("Dropbox-API-Arg",a(t)),d&&(m=m.set("Dropbox-API-Select-User",d)),m.send(f).end(function(e,t){e?p(l(e,t)):u(t.body)})})}},function(e,t){var n={};n.authTokenFromOauth1=function(e){return this.request("auth/token/from_oauth1",e,"app","api","rpc")},n.authTokenRevoke=function(e){return this.request("auth/token/revoke",e,"user","api","rpc")},n.filePropertiesPropertiesAdd=function(e){return this.request("file_properties/properties/add",e,"user","api","rpc")},n.filePropertiesPropertiesOverwrite=function(e){return this.request("file_properties/properties/overwrite",e,"user","api","rpc")},n.filePropertiesPropertiesRemove=function(e){return this.request("file_properties/properties/remove",e,"user","api","rpc")},n.filePropertiesPropertiesSearch=function(e){return this.request("file_properties/properties/search",e,"user","api","rpc")},n.filePropertiesPropertiesUpdate=function(e){return this.request("file_properties/properties/update",e,"user","api","rpc")},n.filePropertiesTemplatesAddForTeam=function(e){return this.request("file_properties/templates/add_for_team",e,"team","api","rpc")},n.filePropertiesTemplatesAddForUser=function(e){return this.request("file_properties/templates/add_for_user",e,"user","api","rpc")},n.filePropertiesTemplatesGetForTeam=function(e){return this.request("file_properties/templates/get_for_team",e,"team","api","rpc")},n.filePropertiesTemplatesGetForUser=function(e){return this.request("file_properties/templates/get_for_user",e,"user","api","rpc")},n.filePropertiesTemplatesListForTeam=function(e){return this.request("file_properties/templates/list_for_team",e,"team","api","rpc")},n.filePropertiesTemplatesListForUser=function(e){return this.request("file_properties/templates/list_for_user",e,"user","api","rpc")},n.filePropertiesTemplatesUpdateForTeam=function(e){return this.request("file_properties/templates/update_for_team",e,"team","api","rpc")},n.filePropertiesTemplatesUpdateForUser=function(e){return this.request("file_properties/templates/update_for_user",e,"user","api","rpc")},n.fileRequestsCreate=function(e){return this.request("file_requests/create",e,"user","api","rpc")},n.fileRequestsGet=function(e){return this.request("file_requests/get",e,"user","api","rpc")},n.fileRequestsList=function(e){return this.request("file_requests/list",e,"user","api","rpc")},n.fileRequestsUpdate=function(e){return this.request("file_requests/update",e,"user","api","rpc")},n.filesAlphaGetMetadata=function(e){return this.request("files/alpha/get_metadata",e,"user","api","rpc")},n.filesAlphaUpload=function(e){return this.request("files/alpha/upload",e,"user","content","upload")},n.filesCopy=function(e){return this.request("files/copy",e,"user","api","rpc")},n.filesCopyBatch=function(e){return this.request("files/copy_batch",e,"user","api","rpc")},n.filesCopyBatchCheck=function(e){return this.request("files/copy_batch/check",e,"user","api","rpc")},n.filesCopyReferenceGet=function(e){return this.request("files/copy_reference/get",e,"user","api","rpc")},n.filesCopyReferenceSave=function(e){return this.request("files/copy_reference/save",e,"user","api","rpc")},n.filesCopyV2=function(e){return this.request("files/copy_v2",e,"user","api","rpc")},n.filesCreateFolder=function(e){return this.request("files/create_folder",e,"user","api","rpc")},n.filesCreateFolderV2=function(e){return this.request("files/create_folder_v2",e,"user","api","rpc")},n.filesDelete=function(e){return this.request("files/delete",e,"user","api","rpc")},n.filesDeleteBatch=function(e){return this.request("files/delete_batch",e,"user","api","rpc")},n.filesDeleteBatchCheck=function(e){return this.request("files/delete_batch/check",e,"user","api","rpc")},n.filesDeleteV2=function(e){return this.request("files/delete_v2",e,"user","api","rpc")},n.filesDownload=function(e){return this.request("files/download",e,"user","content","download")},n.filesGetMetadata=function(e){return this.request("files/get_metadata",e,"user","api","rpc")},n.filesGetPreview=function(e){return this.request("files/get_preview",e,"user","content","download")},n.filesGetTemporaryLink=function(e){return this.request("files/get_temporary_link",e,"user","api","rpc")},n.filesGetThumbnail=function(e){return this.request("files/get_thumbnail",e,"user","content","download")},n.filesGetThumbnailBatch=function(e){return this.request("files/get_thumbnail_batch",e,"user","content","rpc")},n.filesListFolder=function(e){return this.request("files/list_folder",e,"user","api","rpc")},n.filesListFolderContinue=function(e){return this.request("files/list_folder/continue",e,"user","api","rpc")},n.filesListFolderGetLatestCursor=function(e){return this.request("files/list_folder/get_latest_cursor",e,"user","api","rpc")},n.filesListFolderLongpoll=function(e){return this.request("files/list_folder/longpoll",e,"noauth","notify","rpc")},n.filesListRevisions=function(e){return this.request("files/list_revisions",e,"user","api","rpc")},n.filesMove=function(e){return this.request("files/move",e,"user","api","rpc")},n.filesMoveBatch=function(e){return this.request("files/move_batch",e,"user","api","rpc")},n.filesMoveBatchCheck=function(e){return this.request("files/move_batch/check",e,"user","api","rpc")},n.filesMoveV2=function(e){return this.request("files/move_v2",e,"user","api","rpc")},n.filesPermanentlyDelete=function(e){return this.request("files/permanently_delete",e,"user","api","rpc")},n.filesPropertiesAdd=function(e){return this.request("files/properties/add",e,"user","api","rpc")},n.filesPropertiesOverwrite=function(e){return this.request("files/properties/overwrite",e,"user","api","rpc")},n.filesPropertiesRemove=function(e){return this.request("files/properties/remove",e,"user","api","rpc")},n.filesPropertiesTemplateGet=function(e){return this.request("files/properties/template/get",e,"user","api","rpc")},n.filesPropertiesTemplateList=function(e){return this.request("files/properties/template/list",e,"user","api","rpc")},n.filesPropertiesUpdate=function(e){return this.request("files/properties/update",e,"user","api","rpc")},n.filesRestore=function(e){return this.request("files/restore",e,"user","api","rpc")},n.filesSaveUrl=function(e){return this.request("files/save_url",e,"user","api","rpc")},n.filesSaveUrlCheckJobStatus=function(e){return this.request("files/save_url/check_job_status",e,"user","api","rpc")},n.filesSearch=function(e){return this.request("files/search",e,"user","api","rpc")},n.filesUpload=function(e){return this.request("files/upload",e,"user","content","upload")},n.filesUploadSessionAppend=function(e){return this.request("files/upload_session/append",e,"user","content","upload")},n.filesUploadSessionAppendV2=function(e){return this.request("files/upload_session/append_v2",e,"user","content","upload")},n.filesUploadSessionFinish=function(e){return this.request("files/upload_session/finish",e,"user","content","upload")},n.filesUploadSessionFinishBatch=function(e){return this.request("files/upload_session/finish_batch",e,"user","api","rpc")},n.filesUploadSessionFinishBatchCheck=function(e){return this.request("files/upload_session/finish_batch/check",e,"user","api","rpc")},n.filesUploadSessionStart=function(e){return this.request("files/upload_session/start",e,"user","content","upload")},n.paperDocsArchive=function(e){return this.request("paper/docs/archive",e,"user","api","rpc")},n.paperDocsCreate=function(e){return this.request("paper/docs/create",e,"user","api","upload")},n.paperDocsDownload=function(e){return this.request("paper/docs/download",e,"user","api","download")},n.paperDocsFolderUsersList=function(e){return this.request("paper/docs/folder_users/list",e,"user","api","rpc")},n.paperDocsFolderUsersListContinue=function(e){return this.request("paper/docs/folder_users/list/continue",e,"user","api","rpc")},n.paperDocsGetFolderInfo=function(e){return this.request("paper/docs/get_folder_info",e,"user","api","rpc")},n.paperDocsList=function(e){return this.request("paper/docs/list",e,"user","api","rpc")},n.paperDocsListContinue=function(e){return this.request("paper/docs/list/continue",e,"user","api","rpc")},n.paperDocsPermanentlyDelete=function(e){return this.request("paper/docs/permanently_delete",e,"user","api","rpc")},n.paperDocsSharingPolicyGet=function(e){return this.request("paper/docs/sharing_policy/get",e,"user","api","rpc")},n.paperDocsSharingPolicySet=function(e){return this.request("paper/docs/sharing_policy/set",e,"user","api","rpc")},n.paperDocsUpdate=function(e){return this.request("paper/docs/update",e,"user","api","upload")},n.paperDocsUsersAdd=function(e){return this.request("paper/docs/users/add",e,"user","api","rpc")},n.paperDocsUsersList=function(e){return this.request("paper/docs/users/list",e,"user","api","rpc")},n.paperDocsUsersListContinue=function(e){return this.request("paper/docs/users/list/continue",e,"user","api","rpc")},n.paperDocsUsersRemove=function(e){return this.request("paper/docs/users/remove",e,"user","api","rpc")},n.sharingAddFileMember=function(e){return this.request("sharing/add_file_member",e,"user","api","rpc")},n.sharingAddFolderMember=function(e){return this.request("sharing/add_folder_member",e,"user","api","rpc")},n.sharingChangeFileMemberAccess=function(e){return this.request("sharing/change_file_member_access",e,"user","api","rpc")},n.sharingCheckJobStatus=function(e){return this.request("sharing/check_job_status",e,"user","api","rpc")},n.sharingCheckRemoveMemberJobStatus=function(e){return this.request("sharing/check_remove_member_job_status",e,"user","api","rpc")},n.sharingCheckShareJobStatus=function(e){return this.request("sharing/check_share_job_status",e,"user","api","rpc")},n.sharingCreateSharedLink=function(e){return this.request("sharing/create_shared_link",e,"user","api","rpc")},n.sharingCreateSharedLinkWithSettings=function(e){return this.request("sharing/create_shared_link_with_settings",e,"user","api","rpc")},n.sharingGetFileMetadata=function(e){return this.request("sharing/get_file_metadata",e,"user","api","rpc")},n.sharingGetFileMetadataBatch=function(e){return this.request("sharing/get_file_metadata/batch",e,"user","api","rpc")},n.sharingGetFolderMetadata=function(e){return this.request("sharing/get_folder_metadata",e,"user","api","rpc")},n.sharingGetSharedLinkFile=function(e){return this.request("sharing/get_shared_link_file",e,"user","content","download")},n.sharingGetSharedLinkMetadata=function(e){return this.request("sharing/get_shared_link_metadata",e,"user","api","rpc")},n.sharingGetSharedLinks=function(e){return this.request("sharing/get_shared_links",e,"user","api","rpc")},n.sharingListFileMembers=function(e){return this.request("sharing/list_file_members",e,"user","api","rpc")},n.sharingListFileMembersBatch=function(e){return this.request("sharing/list_file_members/batch",e,"user","api","rpc")},n.sharingListFileMembersContinue=function(e){return this.request("sharing/list_file_members/continue",e,"user","api","rpc")},n.sharingListFolderMembers=function(e){return this.request("sharing/list_folder_members",e,"user","api","rpc")},n.sharingListFolderMembersContinue=function(e){return this.request("sharing/list_folder_members/continue",e,"user","api","rpc")},n.sharingListFolders=function(e){return this.request("sharing/list_folders",e,"user","api","rpc")},n.sharingListFoldersContinue=function(e){return this.request("sharing/list_folders/continue",e,"user","api","rpc")},n.sharingListMountableFolders=function(e){return this.request("sharing/list_mountable_folders",e,"user","api","rpc")},n.sharingListMountableFoldersContinue=function(e){return this.request("sharing/list_mountable_folders/continue",e,"user","api","rpc")},n.sharingListReceivedFiles=function(e){return this.request("sharing/list_received_files",e,"user","api","rpc")},n.sharingListReceivedFilesContinue=function(e){return this.request("sharing/list_received_files/continue",e,"user","api","rpc")},n.sharingListSharedLinks=function(e){return this.request("sharing/list_shared_links",e,"user","api","rpc")},n.sharingModifySharedLinkSettings=function(e){return this.request("sharing/modify_shared_link_settings",e,"user","api","rpc")},n.sharingMountFolder=function(e){return this.request("sharing/mount_folder",e,"user","api","rpc")},n.sharingRelinquishFileMembership=function(e){return this.request("sharing/relinquish_file_membership",e,"user","api","rpc")},n.sharingRelinquishFolderMembership=function(e){return this.request("sharing/relinquish_folder_membership",e,"user","api","rpc")},n.sharingRemoveFileMember=function(e){return this.request("sharing/remove_file_member",e,"user","api","rpc")},n.sharingRemoveFileMember2=function(e){return this.request("sharing/remove_file_member_2",e,"user","api","rpc")},n.sharingRemoveFolderMember=function(e){return this.request("sharing/remove_folder_member",e,"user","api","rpc")},n.sharingRevokeSharedLink=function(e){return this.request("sharing/revoke_shared_link",e,"user","api","rpc")},n.sharingShareFolder=function(e){return this.request("sharing/share_folder",e,"user","api","rpc")},n.sharingTransferFolder=function(e){return this.request("sharing/transfer_folder",e,"user","api","rpc")},n.sharingUnmountFolder=function(e){return this.request("sharing/unmount_folder",e,"user","api","rpc")},n.sharingUnshareFile=function(e){return this.request("sharing/unshare_file",e,"user","api","rpc")},n.sharingUnshareFolder=function(e){return this.request("sharing/unshare_folder",e,"user","api","rpc")},n.sharingUpdateFileMember=function(e){return this.request("sharing/update_file_member",e,"user","api","rpc")},n.sharingUpdateFolderMember=function(e){return this.request("sharing/update_folder_member",e,"user","api","rpc")},n.sharingUpdateFolderPolicy=function(e){return this.request("sharing/update_folder_policy",e,"user","api","rpc")},n.teamLogGetEvents=function(e){return this.request("team_log/get_events",e,"team","api","rpc")},n.teamLogGetEventsContinue=function(e){return this.request("team_log/get_events/continue",e,"team","api","rpc")},n.usersGetAccount=function(e){return this.request("users/get_account",e,"user","api","rpc")},n.usersGetAccountBatch=function(e){return this.request("users/get_account_batch",e,"user","api","rpc")},n.usersGetCurrentAccount=function(e){return this.request("users/get_current_account",e,"user","api","rpc")},n.usersGetSpaceUsage=function(e){return this.request("users/get_space_usage",e,"user","api","rpc")},e.exports=n},function(e,t){e.exports='\x3c!-- insert-pdf-menu --\x3e\n<x-popover id="insert-pdf-menu" auto-remove>\n  <h3 slot="heading" heading>{=rt_heading=}</h3>\n  <paper-item class="mobile-hide" data-value="Disk" title="">\n    <div>\n      <div>\n        <iron-icon icon="bs:hdd"></iron-icon>\n        {=local_disk=}\n      </div>\n      <div class="small help-block">\n        {=insert_pdf_local_disk_help=}\n      </div>\n    </div>\n  </paper-item>\n  <paper-item data-value="GDrive" title="">\n    <div>\n      <div>\n        <iron-icon icon="moon:gdrive"></iron-icon>\n        {=google_drive=}\n      </div>\n      <div class="small help-block">\n        {=insert_pdf_gdrive_help=}\n      </div>\n    </div>\n  </paper-item>\n  <paper-item data-value="Dropbox" title="">\n    <div>\n      <div>\n        <iron-icon icon="moon:dropbox"></iron-icon>\n        {=dropbox=}\n      </div>\n      <div class="small help-block">\n        {=insert_pdf_dropbox_help=}\n      </div>\n    </div>\n  </paper-item>\n</x-popover>\n'},,function(e,t){e.exports='\x3c!-- import-image-menu --\x3e\n<x-popover id="import-image-menu" auto-remove>\n  <h3 slot="heading" heading>{=rt_heading=}</h3>\n  <paper-listbox>\n    <paper-item class="mobile-only" data-value="Camera" title="">\n      <iron-icon icon="bs:camera"></iron-icon>\n      {=insert_pic_camera=}\n    </paper-item>\n    <paper-item class="mobile-only" data-value="Library" title="">\n      <iron-icon icon="bs:picture"></iron-icon>\n      {=insert_pic_library=}\n    </paper-item>\n    <paper-item class="mobile-hide" data-value="Disk" title="">\n      <iron-icon icon="bs:hdd"></iron-icon>\n      {=insert_pic_local_disk=}\n    </paper-item>\n    <paper-item data-value="Link" title="">\n      <iron-icon icon="bs:link"></iron-icon>\n      {=insert_pic_link=}\n    </paper-item>\n    <paper-item data-value="GDrive" title="">\n      <iron-icon icon="moon:gdrive"></iron-icon>\n      {=google_drive=}\n    </paper-item>\n    <paper-item data-value="Dropbox"  title="">\n      <iron-icon icon="moon:dropbox"></iron-icon>\n      {=dropbox=}\n    </paper-item>\n  </paper-listbox>\n</x-popover>\n'},function(e,t){e.exports='<div id="img-toolbar" style="position:absolute; text-align:center;">\n  <div class="float-toolbar">\n    <a data-name="view" href="#void" class="x-btn img-btn">{=img_tool_view=}</a>\n    <a data-name="align" href="#void" class="x-btn img-btn">{=img_tool_align=}</a>\n    <a data-name="copy" href="#void" class="x-btn img-btn">{=common_copy=}</a>\n    <a data-name="delete" href="#void" class="x-btn android-hide img-btn">{=common_cut=}</a>\n  </div>\n</div>\n'},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(19),o=(n.n(i),n(23)),r=(n.n(o),n(20)),a=(n.n(r),n(6)),l=(n.n(a),n(22)),s=n(21),c=(n.n(s),n(91),n(7)),d=(n.n(c),n(24)),u=(n(105),n(94)),p=n(96),m=n(179),f=(n.n(m),window.localHtml(m)),h={create:function(e,t,n,i){this.home=e,this.path=t,this.defTitle=n||s.getFileName(t),console.assert(0===$("#export-ex-menu").length);var o=f;i&&(o=window.localHtml(o,{rt_header:i})),this.el=l.default.htmlToElement(o,!0),this.$el=$(this.el),this.bindEvents()},win_:function(e){this.doneDefer.resolve(e),this.doneDefer=null},fail_:function(e){this.doneDefer.reject(e),this.doneDefer=null},bindEvents:function(){function e(e){if("Disk"===e)d.saveFile(n.path,n.defTitle).then(function(e){n.win_(e)});else if("GDrive"===e){var t={bSelectFolder:!1,bUpload:!0,uploadDefTitle:n.defTitle,uploadPath:n.path,actionName:localString("common_save"),bCancelable:!0},o=p.a(u.gdrive,i,t);p.d(o,n.onCloudExported.bind(n))}else if("Dropbox"===e){var t={bSelectFolder:!1,bUpload:!0,uploadDefTitle:n.defTitle,uploadPath:n.path,actionName:localString("common_save"),bCancelable:!0},o=p.a(u.dropboxStd,i,t);p.d(o,n.onCloudExported.bind(n))}else console.error("unsupported type: ",e)}var t,n=this,i=this.home,o=this.$el;o.on("iron-overlay-closed",function(){n.doneDefer&&(t?e(t):n.fail_("cancel"))}),$("paper-item",o).on("click",function(e){t=this.dataset.value,n.$el.hideModal()})},show:function(e){var t=this.el;this.$el;l.default.insertModal(t),t.togglerElem=$(e.toggler)[0],t.open();var n=r.defer();return this.doneDefer=n,n.promise},onCloudExported:function(e,t){"Ok"===e?this.win_(t.meta.title):this.fail_("cancel")}}},function(e,t){e.exports='<div>\n  <paper-dialog id="modal-export-disk-desktop" class="slide x-dialog" with-backdrop style="width:400px;height:500px">\n    \x3c!-- <div class="slide-header-bg"></div> --\x3e\n    <x-slider selected="main"  attr-for-selected="name">\n      <section class="slide-panel panel-main" name="main">\n        <div class="slide-header">\n          <label>{=export_disk_desktop_title=}</label>\n          <paper-button class="right-action action-close">{=common_close=}</paper-button>\n        </div>\n        <div class="slide-body">\n          <div class="disk-form slide-form x-list-group">\n            <div class="x-list-group-item">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-micnote" href="{=void=}">\n                    {=export_disk_desktop_export=}\n                  </a>\n                </div>\n                <label class="slide-label">.micnote</label>\n              </div>\n              <div class="form-item-footnote">\n                {=export_cloud_mn_footnote=}\n              </div>\n            </div>\n            <div class="x-list-group-item">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-audio" href="{=void=}">\n                    {=export_disk_desktop_export=}\n                  </a>\n                </div>\n                <label class="slide-label">{=export_cloud_recording=}</label>\n              </div>\n              <div class="form-item-footnote">\n                {=export_cloud_rec_footnote=}\n              </div>\n            </div>\n            <div class="x-list-group-item desktop-only">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-pdf" href="{=void=}">\n                    {=export_disk_desktop_export=}\n                  </a>\n                </div>\n                <label class="slide-label">PDF</label>\n              </div>\n              <div class="form-item-footnote">\n                {==export_disk_desktop_pdf_footnote==}\n                \x3c!-- removed, can not show a modal above another modal --\x3e\n                \x3c!-- <a href="{=void=}" data-toggle="modal-popover" data-placement="top" data-target="#pdf-popover" data-with-backdrop="true">(?)</a> --\x3e\n              </div>\n            </div>\n            <div class="x-list-group-item">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-html" href="{=void=}">\n                    {=export_disk_desktop_export=}\n                  </a>\n                </div>\n                <label class="slide-label">HTML</label>\n              </div>\n              <div class="form-item-footnote">\n                {=export_cloud_html_footnote=}\n              </div>\n            </div>\n            <div class="x-list-group-item mobile-only">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-text" href="{=void=}">\n                    {=export_disk_desktop_share=}\n                  </a>\n                </div>\n                <label class="slide-label">{=export_disk_desktop_text=}</label>\n              </div>\n              <div class="form-item-footnote">\n                {=export_disk_desktop_text_footnote=}\n              </div>\n            </div>\n          </div>\n          <div class="text-disk-status" style="text-align:center;margin-top: 8px;">\n          </div>\n        </div>\n      </section>\n    </x-slider>\n    \x3c!-- <div id="pdf-popover" class="popover" style=""> --\x3e\n    \x3c!--   <div class="arrow"></div> --\x3e\n    \x3c!--   <h3 class="popover-title">How to setup in print preview?</h3> --\x3e\n    \x3c!--   <div class="popover-content"> --\x3e\n    \x3c!--     <img src="img/printToPdf.png" /> --\x3e\n    \x3c!--   </div> --\x3e\n    \x3c!-- </div> --\x3e\n  </paper-dialog>\n  <paper-dialog id="modal-export-disk-mobile" class="slide x-dialog" with-backdrop style="width:400px;height:500px">\n    \x3c!-- <div class="slide-header-bg"></div> --\x3e\n    <x-slider selected="main"  attr-for-selected="name">\n      <section class="slide-panel panel-main" name="main">\n        <div class="slide-header">\n          <label>{=export_disk_mobile_share_on_device=}</label>\n          <paper-button class="right-action action-close">{=common_close=}</paper-button>\n        </div>\n        <div class="slide-body">\n          <div class="disk-form slide-form x-list-group">\n            <div class="x-list-group-item">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-micnote" href="{=void=}">\n                    {=export_disk_mobile_share=}\n                  </a>\n                </div>\n                <label class="slide-label">.micnote</label>\n              </div>\n              <div class="form-item-footnote">\n                {=export_cloud_mn_footnote=}\n              </div>\n            </div>\n            <div class="x-list-group-item">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-audio" href="{=void=}">\n                    {=export_disk_mobile_share=}\n                  </a>\n                </div>\n                <label class="slide-label">{=export_cloud_recording=}</label>\n              </div>\n              <div class="form-item-footnote">\n                {=export_cloud_rec_footnote=}\n              </div>\n            </div>              \n            <div class="x-list-group-item">\n              <div class="form-item-body">\n                <div class="slide-control">\n                  <a class="action-export-text" href="{=void=}">\n                    {=export_disk_mobile_share=}\n                  </a>\n                </div>\n                <label class="slide-label">{=export_disk_desktop_text=}</label>\n              </div>\n              <div class="form-item-footnote">\n                {=export_disk_desktop_text_footnote=}\n              </div>\n            </div>\n          </div>\n          <div class="text-disk-status" style="text-align:center;margin-top: 8px;">\n          </div>\n        </div>\n      </section>\n    </x-slider>\n  </paper-dialog>\n</div>\n'},function(e,t){e.exports='\x3c!-- export-ex-menu --\x3e\n<x-popover id="export-ex-menu" auto-remove>\n  <h3 slot="heading" heading>{=rt_header=}</h3>\n  <paper-item data-value="Disk" class="mobile-hide" >\n    <iron-icon icon="bs:hdd"></iron-icon>\n    {=menu_import_local_disk=}\n  </paper-item>\n  <paper-item data-value="GDrive" >\n    <iron-icon icon="moon:gdrive"></iron-icon>\n    {=google_drive=}\n  </paper-item>\n  <paper-item data-value="Dropbox" >\n    <iron-icon icon="moon:dropbox"></iron-icon>\n    {=dropbox=}\n  </paper-item>\n</x-popover>\n\n'},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n(19),o=(n.n(i),n(23)),r=(n.n(o),n(20)),a=(n.n(r),n(6)),l=(n.n(a),n(91)),s=(n(92),n(22)),c=n(21),d=(n.n(c),n(8),n(98),n(97),n(130)),u=n(131),p=n(132),m={NOTEPAD:"Notepad",PICVIEWER:"PicViewer",PHOTOTAKER:"PhotoTaker"},f=i.extend(Object.create(s.default.Observer),{create:function(e,t){var n=this;i.extend(n,{home:e,settings:t,el:_$("#text-view"),$el:$("#text-view"),curViewMode:"Preview",leditor:ar.leditor,imageHandler:ar.leditor.imageHandler,numLinesDirty:0,viewType:m.NOTEPAD,notepadPage:_$("#notepad-view"),embeddedPVPage:_$("#iv-viewer-embedded-view"),fullPVPage:_$("#iv-viewer-full-view"),photoTakerPage:_$("#iv-photo-taker-view")});var o=Object.create(h);o.init(n);var r=d.b({home:n.home,lib:o,bSmall:!0});r.on("delete",function(e){n.viewerDelImage(e,r)}),r.on("resize",function(){n.fullViewer.lib.setCurLn(r.lib.getCurLn()),n.el.entryAnimation=null,n.el.exitAnimation=null,n.embeddedPVPage.selectAnim("hero-animation",n.embeddedPVPage),n.fullPVPage.selectAnim("hero-animation",n.fullPVPage),n.el.selected="iv-viewer-full-view",n.curPicViewer=c,n.viewType=m.PICVIEWER,n.el.async(function(){n.fullViewer.enter()}),n.settings.bFullViewer=!0,n.fire("settings-changed",n.settings)}),r.on("back",function(){var e,t=r.lib.$curLn;if(t.length){t.line();e=n.imageHandler.lineToImage(t)[0],n.$newVisibleLn=t}n.el.entryAnimation=null,n.el.exitAnimation=null,n.embeddedPVPage.selectAnim("hero-animation",n.embeddedPVPage),n.fullPVPage.selectAnim("hero-animation",e),n.el.selected="notepad-view",n.curPicViewer=null,n.viewType=m.NOTEPAD,n.fire("enable-toggler")}),r.on("time-play",function(){var e=r.lib.$curLn.line();"number"==typeof e.time&&n.home.gotoAbm(e.time)}),r.on("set-time",function(){var e=r.lib.$curLn,t=e.line(),i=n.leditor.cmdSetLinesTime(e);n.numLinesDirty++,s.default.toastShowShortCenter(localString("pv_set_time_success",n.home.makeBmTimeStr(t.time)),"info",null,localString("common_undo"),function(){n.leditor.history.getUndoCmd()===i&&n.leditor.history.undo().then(function(){s.default.toastShowShortCenter(localString("common_undo_success"))})})}),$("#iv-viewer-embedded-view").append(r.$el),n.embeddedViewer=r;var l=Object.create(h);l.init(n);var c=d.b({home:n.home,lib:l,bSmall:!1});c.on("delete",function(e){n.viewerDelImage(e,c)}),c.on("resize",function(){n.embeddedViewer.lib.setCurLn(c.lib.getCurLn()),n.el.entryAnimation=null,n.el.exitAnimation=null,n.embeddedPVPage.selectAnim("hero-animation",n.embeddedPVPage),n.fullPVPage.selectAnim("hero-animation",n.fullPVPage),n.el.selected="iv-viewer-embedded-view",n.curPicViewer=r,n.viewType=m.PICVIEWER,n.el.async(function(){n.embeddedViewer.enter()}),n.settings.bFullViewer=!1,n.fire("settings-changed",n.settings)}),c.on("back",function(){n.leditor.$el.find(".il-img").removeAttr("hero-id").removeAttr("hero");var e,t=c.lib.$curLn;if(t.length){t.line();e=n.imageHandler.lineToImage(t)[0],n.$newVisibleLn=t}n.el.entryAnimation=null,n.el.exitAnimation=null,n.fullPVPage.selectAnim("hero-animation",n.fullPVPage),n.notepadPage.selectAnim("hero-animation",e),n.el.selected="notepad-view",n.curPicViewer=null,n.viewType=m.NOTEPAD,n.fire("enable-toggler")}),c.on("time-play",function(){var e=c.lib.$curLn.line();"number"==typeof e.time&&n.home.gotoAbm(e.time)}),c.on("set-time",function(){var e=c.lib.$curLn,t=e.line(),i=n.leditor.cmdSetLinesTime(e);n.numLinesDirty++,s.default.toastShowShortCenter(localString("pv_set_time_success",n.home.makeBmTimeStr(t.time)),"info",null,localString("common_undo"),function(){n.leditor.history.getUndoCmd()===i&&n.leditor.history.undo().then(function(){s.default.toastShowShortCenter(localString("common_undo_success"))})})}),$("#iv-viewer-full-view").append(c.$el),n.fullViewer=c,ar.leditor.on("time-changed",function(e){n.curPicViewer&&n.curPicViewer.lib.$curLn[0]===e[0]&&n.curPicViewer.updateTime(!0)});var f=Object.create(u.a);f.create(n.home),f.on("save",function(e){var t=new s.default.DateFmt("%y-%m-%d_%H.%M.%S"),o=e.type.replace("image/","");"jpeg"===o&&(o="jpg");var r=t.format(new Date)+"."+o;n.imageHandler.checkAndPromptMaxImages(1,!0)?n.imageHandler.cmdInsertImage(e,r,n.takePhotoInsertPos).then(function(e){n.$lastPhotoLn_=e;var t=n.leditor.history.getUndoCmd();n.numLinesDirty++,s.default.toastShowShortCenter(localString("pv_image_inserted_success",1),"info",null,localString("common_undo"),function(){n.leditor.history.getUndoCmd()===t&&n.leditor.history.undo().then(function(){s.default.toastShowShortCenter(localString("common_undo_success"))})})},function(){s.default.toastShowLongCenter(localString("common_failed"),"error")}):(n.bLeaveTakerDueToImageExceeds=!0,i.delay(function(){f.leave()}))}),f.on("back",function(){n.el.entryAnimation=null,n.el.exitAnimation=null,n.notepadPage.selectAnim(null),n.photoTakerPage.selectAnim("fade-out-animation"),n.el.selected="notepad-view",n.curPicViewer=null,n.viewType=m.NOTEPAD,n.fire("enable-toggler"),n.$lastPhotoLn_&&(n.$newVisibleLn=n.$lastPhotoLn_),n.cbPhotoTakerBack&&n.cbPhotoTakerBack()}),$("#iv-photo-taker-view").append(f.$el),n.ptaker=f,a("DesktopApp")&&p.desktopTakePhotoStream.onValue(function(e){n._cmdTakePhoto(e.cbBack,e.insertPos)}),n.bindEvents_()},bindEvents_:function(){var e=this,t=e.$el;e.leditor.on("model-changed",function(){e.el.selected="notepad-view",e.curPicViewer=null,e.viewType=m.NOTEPAD,e.fire("enable-toggler"),e.numLinesDirty=0}),t.on("selected-changed",function(t){t.target===e.el&&"notepad-view"===e.el.selected&&i.delay(function(){if(e.numLinesDirty&&(e.leditor.onResize(!0),e.numLinesDirty=0),e.$newVisibleLn&&e.$newVisibleLn.length&&(e.leditor.makeLinesVisible(e.$newVisibleLn),e.$newVisibleLn=null),e.bLeaveTakerDueToImageExceeds){e.bLeaveTakerDueToImageExceeds=!1;var t=e.leditor.ldoc.getTotalImages();e.home.checkMaxImages(t+1)}})})},cmdViewImage:function(e){var t=this,n=(t.leditor,t.$el,t.el),i=e.line(),o=t.imageHandler.lineToImage(e);if("Preview"===t.curViewMode){var r=t.settings.bFullViewer?t.fullViewer:t.embeddedViewer;r.lib.setCurLn(e);var a=t.settings.bFullViewer?t.fullPVPage:t.embeddedPVPage;t.el.entryAnimation=null,t.el.exitAnimation=null,a.selectAnim("hero-animation",a),t.notepadPage.selectAnim("hero-animation",o[0]),n.selected=t.settings.bFullViewer?"iv-viewer-full-view":"iv-viewer-embedded-view",t.curPicViewer=r,t.viewType=m.PICVIEWER,n.async(function(){r.enter()}),t.fire("disable-toggler")}else"Select"===t.curViewMode&&(t.bCancelNextSel?t.bCancelNextSel=!1:t.toggleItemSel(i))},_cmdTakePhoto:function(e,t){var n=this;n.cbPhotoTakerBack=e,n.takePhotoInsertPos=t,n.el.entryAnimation="fade-in-animation",n.el.exitAnimation=null,n.el.selected="iv-photo-taker-view",n.curPicViewer=null,n.viewType=m.PHOTOTAKER,n.ptaker.enter(),n.$lastPhotoLn_=null,n.fire("disable-toggler")},viewerDelImage:function(e,t){var n=this,i=n.leditor.findLineElem(e);if(i.childLns().length)s.default.toastShowLongCenter(localString("pv_img_deleted_failed_with_children"),"error");else{var o=!0;t.lib.hasNext()?(t.lib.next(),o=!1):t.lib.hasPrev()&&(t.lib.prev(),o=!1),n.leditor.cmdDeleteLines(i);var r=n.leditor.history.getUndoCmd();n.numLinesDirty++,s.default.toastShowShortCenter(localString("pv_img_deleted",1),"info",null,localString("common_undo"),function(){n.leditor.history.getUndoCmd()===r&&n.leditor.history.undo().then(function(){if(s.default.toastShowShortCenter(localString("common_undo_success")),!o){var i=n.leditor.findLineElem(e);i.length&&(t.lib.setCurLn(i),t.refresh())}})}),o?t.fire("back"):t.refresh()}},getPhotoDir:function(){return this.leditor.noteDir+"/images"},isViewActive:function(){return this.viewType!==m.NOTEPAD},onResize:function(){var e=this;e.viewType===m.PICVIEWER&&e.curPicViewer.refresh(),e.viewType!==m.NOTEPAD&&e.numLinesDirty++}}),h=i.extend(Object.create(d.a),{init:function(e,t){this.iview=e,this.$curLn=t||$()},setCurLn:function(e){this.$curLn=e||$()},getCurLn:function(){return this.$curLn},getCurImgSrc:function(){var e=this.$curLn.line();return this.iview.imageHandler.makeImageUrl(e.filename)},getCurImgName:function(){return this.$curLn.line().name},getCurImgSaveFileName:function(){var e=this.$curLn.line();return e.origFileName||e.filename},getCurImgPath:function(){var e=this.$curLn.line();return this.iview.getPhotoDir()+"/"+e.filename},getCurImgWidth:function(){return this.$curLn.line().imgWidth},getCurImgHeight:function(){return this.$curLn.line().imgHeight},getCurImgTimeStr:function(){var e=this.$curLn.line();return"number"==typeof e.time?this.iview.home.makeBmTimeStr(e.time):null},prev:function(){this.iview.leditor;var e=this.$curLn.aboveLn(l.a.LineType.IMAGE);return!!e.length&&(this.$curLn=e,!0)},next:function(){this.iview.leditor;var e=this.$curLn.belowLn(l.a.LineType.IMAGE);return!!e.length&&(this.$curLn=e,!0)},hasPrev:function(){return 0!==this.$curLn.aboveLn(l.a.LineType.IMAGE).length},hasNext:function(){return 0!==this.$curLn.belowLn(l.a.LineType.IMAGE).length}})},function(e,t){e.exports='<paper-dialog id="modal-feedback" class="layout vertical" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key style="height: 500px"">\n  <h2>{=fb_feedback=}</h2>\n  <div id="feedback_form" class="flex layout vertical" >\n    <div>\n      <paper-input class="feedback-title" required error="{=fb_title_empty=}" maxlength="100" label="{=fb_msg_title=}" auto-validate></paper-input>\n    </div>\n    <div class="flex layout vertical">\n      \x3c!-- <paper-textarea class="feedback-content" maxlength="500" style="width:100%" label="{=fb_content=}"></paper-textarea> --\x3e\n      <div style="margin: 10px 0 4px 0">{=fb_content=}</div>\n      <textarea class="feedback-content flex" maxlength="500" style="width:100%;resize:none;font-size:14px" aria-label="{=fb_content=}"></textarea>\n\n      \x3c!-- <div class="help-block">\n      ({=fb_content_placeholder=})\n      </div> --\x3e\n    </div>\n    <div>\n      <paper-input class="feedback-user-contact" aria-describedby="aria-user-contact-desc" type="email" label="{=fb_your_email=}"></paper-input>\n      <div class="help-block" id="aria-user-contact-desc">\n        ({=fb_your_email_placeholder=})\n      </div>\n    </div>\n    <br>\n    <p style="text-align:left">\n      {=fb_also_can_mail_to=} <a class="external-link" href="mailto:treebeard.bros@gmail.com?subject={=rt_mail_subject=}&body={=rt_mail_body=}" target="_blank">treebeard.bros@gmail.com</a>\n    </p style="height: 400" ">\n  </div>\n  <div class="buttons"class="fle layout verticalx">\n    <paper-button dialog-dismiss class="action-cancel">{=common_cancel=}</paper-button>\n    <paper-button class="action-send text-primary" disabled>{=fb_send=}</paper-button>\n  </div>\n</paper-dialog>\n'},function(e,t,n){"use strict";function i(e,t){t=o.extend(t||{},{bDontDownload:!0,icon:"moon:mn-doc",firstPageBackName:localString("common_cancel"),emptyTitleShowName:localString("home_unnamed_note")});var n=l.localNoteProvider,i=s.a(n,e,t),r=a.defer();return s.d(i,function(e,t){if("Ok"===e){var n=o.map(t,function(e){return e.id});r.resolve(n)}else r.reject()}),r.promise}n.d(t,"a",function(){return i});var o=n(19),r=(n.n(o),n(23)),a=(n.n(r),n(20)),l=(n.n(a),n(8),n(94)),s=n(96)},function(e,t,n){"use strict";function i(e,t){if(l){var n=o(e,t),i=Object(g.diff)(l,n);s=Object(g.patch)(s,i),l=n,$(s).showModal()}else l=o(e,t),s=Object(g.create)(l),m.default.insertModal(s),$(s).showModal(),$(s).find("x-slider")[0].selected=0,r(s)}function o(e,t){let n=function(e){return c.escape(localString(e))};localString;var i=f.getExtension(t.audioName).toUpperCase();let o=t.audioFormat&&0!==t.audioFormat.indexOf("MicNote_")?localString("audio_fmt_external",i):localString("audio_fmt_mn"),r=a(e,e.findLocalArticle(t.parentName));return""===r&&(r="/"),Object(g.h)("paper-dialog#modal-note-prop.slide.x-dialog",{style:{width:"400px",height:"450px"},"with-backdrop":""},[,Object(g.h)("x-slider",[,Object(g.h)("div.slide-panel.panel-main",{name:"main"},[Object(g.h)("div.slide-header",[Object(g.h)("label",[n("mai_art_attri")]),Object(g.h)("paper-button.right-action.action-close",[n("common_close")])]),Object(g.h)("div.slide-body",[Object(g.h)("div.slide-form.x-list-group",[Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div.long-text",[e.getArtTitleShowName(t)])]),Object(g.h)("label.slide-label",[n("mai_name")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div",[t.cDate.toLocaleString()])]),Object(g.h)("label.slide-label",[n("mai_cdate")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div",[t.mDate.toLocaleString()])]),Object(g.h)("label.slide-label",[n("mai_mdate")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div",[d.sprintf("%.2fM",t.audioSize/1024/1024)])]),Object(g.h)("label.slide-label",[n("mai_audio_size")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div",[o])]),Object(g.h)("label.slide-label",[n("mai_audio_format")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div",[t.ldoc.getTotalChars()])]),Object(g.h)("label.slide-label",[n("mai_char_num")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div",[t.ldoc.getTotalImages()])]),Object(g.h)("label.slide-label",[n("mai_pic_num")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div",[d.sprintf("%.2fM",t.ldoc.getTotalImageSize()/1024/1024)])]),Object(g.h)("label.slide-label",[n("mai_pic_size")])])]),Object(g.h)("div.x-list-group-item",[Object(g.h)("div.form-item-body",[Object(g.h)("div.slide-control",[Object(g.h)("div.text-folder.long-text",[r])]),Object(g.h)("label.slide-label",[n("mai_folder")])])])])])])])])}function r(e){let t=$(e);t.on("click",".action-close",function(){t.hideModal()})}function a(e,t){return"Root"===t.artName?"":a(e,e.findLocalArticle(t.parentName))+"/"+e.getArtTitleShowName(t)+("Note"===t.type?".micnote":"")}n.d(t,"a",function(){return i});var l,s,c=n(19),d=(n.n(c),n(23)),u=(n.n(d),n(6)),p=(n.n(u),n(20)),m=(n.n(p),n(8),n(22)),f=n(21),h=(n.n(f),n(91),n(7)),g=(n.n(h),n(92),n(122));n.n(g)},function(e,t,n){"use strict";function i(e){$("#modal-email-note").remove();var t={home:e},n=$(u.default.htmlToElement(window.localHtml(g),!0));if(t.$el=n,o(t),ar.settings.emailNoteToHistory.length){var i=ar.settings.emailNoteToHistory[ar.settings.emailNoteToHistory.length-1];_$(".to",n).value=i,n.find(".action-send").toggleAttr("disabled",!r(i))}_$(".subject",n).value=ar.curArticle.artTitle,ar.settings.bEmailRec&&n.find(".check-rec").addAttr("checked"),ar.settings.bEmailNotes&&n.find(".check-notes").addAttr("checked"),u.default.insertModal(n),n.showModal()}function o(e){e.home;var t=e.$el;$(".action-send",t).on("click",function(){a(e,!1).done()}),$(".action-draft",t).on("click",function(){a(e,!0).done()}),$(".to",t).on("input",function(){var e=r(this.value);$(".action-send",t).toggleAttr("disabled",!e)})}function r(e){var t=!0,n=(e=e.replace(/;/g,",")).split(",");return l.each(n,function(e){return!((e=e.trim())&&!u.default.validateEmail(e)&&(t=!1,1))}),t}function a(e,t){function n(){var e="<pre>"+b+"</pre>";g&&(e+=x);var n={bDraft:t,subject:v,to:r,msg:e};let y=!1;return c.resolve().then(()=>c.Promise((e,n,i)=>{l.delay(()=>{let n;n=t?m?localString("sending_email_draft_rec"):localString("sending_email_draft"):m?localString("sending_email_rec"):localString("sending_email"),i({name:"cancel-handler",handler:function(){y=!0}}),i({name:"update-cancelable-msg",msg:n}),e()})})).then(function(){return m?c.ninvoke(ar.fileSystem,"loadFile",d,{type:"ArrayBuffer"}).then(function(e){n.attach={type:"audio/mpeg",name:i.getArtTitleShowName(a)+"."+p.getExtension(a.audioName),data:e}}):void 0}).then(function(){if(y){var e=new Error(localString("common_cancel"));throw e.appName="cancel",e}return f.default.authenticateEx(ar.accountId,"gmail",!0)}).then(function(){return f.default.sendGmail(ar.accountId,n)}).then(null,null,function(e){if("progress"===e.name){var n=u.default.getCloudProgressShowString(e.loaded,e.total),i=t?localString("sending_email_draft_percent",n):localString("sending_email_percent",n);return log.debug("progress",i),{name:"update-cancelable-msg",msg:i}}return e}).then(function(e){if(o.hideModal(),t){var n=s.sprintf("https://mail.google.com/mail?authuser=%s&#drafts?compose=%s",_,e.msgId);Object(h.openExternalLink)(n)}else u.default.messageBox(localString("common_success"),localString("email_note_send_success_desc",u.default.ellipsisString(r,50)),{btnCancel:!0,cancelTitle:localString("view_on_gmail"),okTitle:localString("common_close"),cancelClass:"text-info"},function(t){if("Cancel"===t){var n=s.sprintf("https://mail.google.com/mail?authuser=%s&#sent/%s",_,e.msgId);Object(h.openExternalLink)(n)}});ar.settings.bEmailRec=m,ar.settings.bEmailNotes=g,ar.settings.emailNoteToHistory.push(r),i.saveSettings()},function(e){if(!e||"cancel"!==e.appName)throw o.hideModal(),u.default.messageBox(localString("common_failed"),localString("email_note_failed",u.default.getShowError(e)),{},function(){o.showModal()}),e;log.log("canceled")})}var i=e.home,o=e.$el,r=_$(".to",o).value.replace("/;/g",","),a=ar.curArticle,d=ar.userDir+a.artName+"/"+a.audioName,m=o.find(".check-rec").hasAttr("checked"),g=o.find(".check-notes").hasAttr("checked"),v=o.find(".subject")[0].value,b=o.find(".mail-content")[0].value,y=c.resolve(),w=u.default.addActivityAnimation(o,!0),_=ar.settings.emailNoteSenderEmail;_||(y=y.then(function(){return f.default.authenticateEx(ar.accountId,"gmail",!0)}).then(function(){return f.default.gmailGetUserProfile(ar.accountId)}).then(function(e){if(e.emails.length<=0||!e.emails[0].value)throw"No user email found";log.debug("found email:",e.emails[0].value),_=e.emails[0].value,ar.settings.emailNoteSenderEmail=_,i.saveSettings()}));var x;return y=y.then(function(){console.assert(a===ar.curArticle),x=ar.leditor.genReadableHtml()}),y=y.then(function(){return n()}),u.default.cancelable(y).finally(()=>{$(w).remove()})}n.d(t,"a",function(){return i});var l=n(19),s=(n.n(l),n(23)),c=(n.n(s),n(20)),d=(n.n(c),n(6)),u=(n.n(d),n(92),n(22)),p=n(21),m=(n.n(p),n(91),n(8),n(7)),f=(n.n(m),n(93)),h=n(24),g=n(185);n.n(g)},function(e,t){e.exports='<paper-dialog id="modal-email-note" class="" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key style="min-width: 500px">\n  <h2>Email Note</h2>\n  <div class="slide-form x-list-group" style="margin-top: 40px">\n    <div class="x-list-group-item">\n      <div class="form-item-body">\n\t<div class="slide-control">\n\t  <paper-checkbox class="check-rec"></paper-checkbox>\n\t</div>\n\t<label class="slide-label" style="">Recording</label>\n      </div>\n      <div class="form-item-footnote">\n        Sends with recording(MP3) as an attachment. Maximum size: 30M.\n      </div>\n    </div>\n    <div class="x-list-group-item">\n      <div class="form-item-body">\n\t<div class="slide-control">\n\t  <paper-checkbox class="check-notes"></paper-checkbox>\n\t</div>\n\t<label class="slide-label" style="">Notes</label>\n      </div>\n      <div class="form-item-footnote">\n        Appends notes(HTML) to the end of the email body. Embedded images are not supported.\n      </div>\n    </div>\n  </div>\n  <div>\n    <paper-input class="to" maxlength="100" label="To (Separates emails by comma)" style="width:100%" required></paper-input>\n  </div>\n  \x3c!-- <div>\n  <label>From</label>\n  <core-dropdown-menu label="Your Email">\n  <core-dropdown class="dropdown">\n  <core-selector>\n  <core-item class="core-selected" label="imskull@gmail.com"></core-item>\n  </core-selector>\n  </core-dropdown>\n  </core-dropdown-menu>\n  </div> --\x3e\n  <div>\n    <paper-input class="subject" maxlength="100" label="Subject" style="font-weight:bold;width:100%"></paper-input>\n  </div>\n  <div>\n    <paper-input class="mail-content" maxlength="500" multiline rows="5" maxrows="5" style="width:100%" label="Say something"></paper-input>\n  </div>\n  <div class="layout horizontal">\n    <paper-button class="action-draft text-info" aria-haspopup="true">\n      Send from Gmail\n    </paper-button>\n    <span class="flex"></span>\n    <paper-button dialog-dismiss class="action-cancel">{=common_cancel=}</paper-button>\n    <paper-button class="action-send text-primary"  disabled>Send</paper-button>\n  </div>\n</paper-dialog>\n'},function(e,t,n){"use strict";function i(e,t,n){return e.listChildren(t,ar.accountId,{title:n,bFolderOnly:!0}).then(function(i){return i.length>0?(i.length>1&&log.warn("found mutiple folders with name: ",n,i.length),i[0].id):e.createDir(ar.accountId,n,t).then(function(e){return e})})}function o(e){return ar.settings.shareFolderId?h.resolve():i(_.getStdProvider(ar.settings.shareFolderProvider),"root",localString("def_share_folder_name")).then(t=>{ar.settings.shareFolderId=t,e.saveSettings()})}function r(e,t,n){function r(e){var t=localString("sharing_link_in_cloud",e,l.showName);w.updateMsg(t)}var l=_.getStdProvider(ar.settings.shareFolderProvider),c=e.getArtTitleShowName(t),d=ar.userDir+t.artName+"/"+t.audioName,u=t.audioName;let p="Full"===n||"AudioOnly"===n;var f=ar.userDir+"~shareLink.html",g=v.default.addActivityAnimation(e.$el,!0),w=v.default.canceler();let x=R.curry((e,t)=>{if("progress"===t.name){var n=localPrintf("sharing_link_in_cloud_percent",e,l.showName,v.default.getCloudProgressShowString(t.loaded,t.total));w.updateMsg(n)}w.handleNotify(t)}),S=h.resolve().then(function(){if(!t.ldoc)return e.loadArtContent(t)}).then(function(){return l.authenticate(ar.accountId,!0)}).then(function(){return o(e)}).then(function(){return i(l,ar.settings.shareFolderId,c)}).then(function(e){return l.readyHostFolder(e,ar.accountId,{})}).then(e=>p?(r(u),s(d,u,"audio/mpeg",l,e.folderId,null,x(u)).then(e=>l.readyHostFile(e.id,u,ar.accountId)).then(t=>({hostFolderInfo:e,audioFileInfo:t}))):{hostFolderInfo:e,audioFileInfo:null}).then(({hostFolderInfo:n,audioFileInfo:i})=>{let o=R.filter(R.propEq("type",y.a.LineType.IMAGE))(t.ldoc.getAllLines()),a={},c=e.getNoteDir(t);return m.reduce(o,(e,t)=>e.then(()=>{let e=c+"/images/"+t.filename,i=v.default.getImageMimeTypeByExtenstion(b.getExtension(t.filename));return r(t.filename),s(e,t.filename,i,l,n.folderId,null,x(t.filename)).then(e=>l.readyHostFile(e.id,t.filename,ar.accountId).then(e=>a[t.filename]=e))}),h.resolve()).then(()=>({hostFolderInfo:n,audioFileInfo:i,imageFileInfos:a}))}).then(({hostFolderInfo:i,audioFileInfo:o,imageFileInfos:r})=>{let a=p?o.hostLink:null,l=R.mapObj(R.pick(["hostLink","link"]),r);return log.log("generate share link html"),e.shareView.createShareLinkHtml(t,n,l,a).then(e=>h.ninvoke(ar.fileSystem,"saveFile",f,e,"text/html")).then(R.always({hostFolderInfo:i}))}).then(({hostFolderInfo:e})=>(r("index.html"),s(f,"index.html","text/html",l,e.folderId,null,x("index.html")).then(t=>({hostFolderInfo:e,htmlFileId:t.id})))).then(({hostFolderInfo:e,htmlFileId:t})=>l.readyHostFile(t,"index.html",ar.accountId).then(t=>({hostFolderInfo:e,htmlFileInfo:t}))).then(({hostFolderInfo:e,htmlFileInfo:t})=>{let n=l.getHostLink(e,t);return n});w.updateMsg(localString("sharing_link_in_cloud",c,l.showName)),w.run(S,0).then(n=>{$(g).remove(),t.lastShareLink=n,e.saveArticle(t),a(e,n)},function(e){$(g).remove(),w.isRejectedByCancel(e)?v.default.toastShowShortCenter(localString("operation_canceled")):v.default.toastShowLongCenter(localString("common_failed_with_reason",v.default.getShowError(e)),"error")})}function a(e,t){$("#modal-share-link").remove();var n={home:e},i=$(v.default.htmlToElement(window.localHtml(k),!0));n.$el=i,l(n);_.getStdProvider(ar.settings.shareFolderProvider);$(".input-link",i).val(t),i.on("iron-overlay-closed",function(){i[0].async(function(){var e=_$(".input-link",i);e.focus(),e.setSelectionRange(0,t.length),e.scrollLeft=0})}),v.default.insertModal(i),i.showModal()}function l(e){$(".view-link",e.$el).on("click",function(){var t=$(".input-link",e.$el).val();Object(S.openExternalLink)(t)}),g("ChromeApp")&&$(".action-copy-link",e.$el).on("click",function(){var t=$(".input-link",e.$el).val();$(".input-link",e.$el).focus().get(0).setSelectionRange(0,t.length),document.execCommand("Copy",!1,null)}),g("MobileApp")&&$(".action-share-link",e.$el).on("click",function(){var t=$(".input-link",e.$el).val();window.plugins.socialsharing.share(null,null,null,t)})}function s(e,t,n,i,o,r,a){var l=g("MobileApp")?"File":"ArrayBuffer";return h.resolve().then(function(){return h.ninvoke(ar.fileSystem,"loadFile",e,{type:l})}).then(function(e){var l,s;return g("MobileApp")?(l=null,s={byteLength:e.size,fileUrl:e.localURL}):(l=e,s={}),s.notify=a,r?i.upload(r,o,t,l,n,void 0,void 0,void 0,ar.accountId,s):_.util.uploadTryOverwrite(i,o,t,l,n,void 0,void 0,void 0,ar.accountId,s)})}function c(e,t){function n(){$(".action-continue",i).toggleAttr("disabled",!ar.settings.bAgreeGenShareLink||!ar.settings.shareLinkShareType||"Disable"===ar.settings.shareFolderProvider)}$("#modal-share-confirm").remove();var i=$(v.default.htmlToElement(window.localHtml(p)));let o;if("Disable"!==ar.settings.shareFolderProvider){var r=_.getStdProvider(ar.settings.shareFolderProvider);o=f.sprintf("[%s]%s",r.showName,ar.settings.shareFolderShowPath)}else o="<span class='text-danger'>"+localString("share_link_share_folder_none")+"</span>";let l=localString("gen_share_link_tips",o);i.find(".warning-msg").html(l),i.find(".share-type")[0].selected=ar.settings.shareLinkShareType,i.find(".share-type-label").html(localString("share_type_label",e.getArtTitleShowName(t))),$(".check-agree",i)[0].checked=ar.settings.bAgreeGenShareLink,n();var s=h.defer();return $(".action-continue",i).on("click",function(){s.resolve({result:"Continue"})}),$(".action-cancel",i).on("click",function(){s.resolve({result:"Cancel"})}),$(".action-change-folder",i).on("click",function(){i.hideModal(),s.resolve({result:"ChangeFolder"})}),$(".check-agree",i).on("change",function(){ar.settings.bAgreeGenShareLink=this.checked,e.saveSettings(),n()}),$(".share-type",i).on("selected-changed",t=>{ar.settings.shareLinkShareType=t.currentTarget.selected,e.saveSettings()}),$(".get-last",i).toggle(!!t.lastShareLink),$(".get-last",i).on("click",function(){i.hideModal(),a(self.home,t.lastShareLink)}),v.default.insertModal(i),i.showModal(),s.promise}function d(){var e=_$("#modal-share-confirm-templ");p=Polymer.dom(e).innerHTML,e.parentNode.removeChild(e)}function u(e,t){p||d(),c(e,t).then(function(n){"Continue"===n.result?(e.saveSettings(),r(e,ar.curArticle,ar.settings.shareLinkShareType)):"ChangeFolder"===n.result&&(x.showSettings(e,"share-folder"),x.settingsClosed.take(1).onValue(()=>{u(e,t)}))})}n.d(t,"a",function(){return u});var p,m=n(19),f=(n.n(m),n(23)),h=(n.n(f),n(20)),g=(n.n(h),n(6)),v=(n.n(g),n(92),n(22)),b=n(21),y=(n.n(b),n(91)),w=(n(8),n(7)),_=(n.n(w),n(94)),x=n(102),S=(n(93),n(24)),k=n(187);n.n(k)},function(e,t){e.exports='<paper-dialog id="modal-share-link" class="dialog-middle-width" closeSelector=".action-close" with-backdrop no-cancel-on-outside-click no-cancel-on-esc-key >\n  <h2>{=share_link_title=}</h2>\n  <p>\n    <div class="layout horizontal">\n      <input type="text" class="input-link flex" readonly="readonly"/>\n      <paper-button class="action-copy-link text-primary desktop-only" raised>{=copy_link=}</paper-button>\n      <paper-button class="action-share-link text-primary mobile-only" raised>{=common_share=}</paper-button>\n    </div>\n  </p>\n  <p>\n    {=share_link_desc=}\n  </p>\n  <div class="layout horizontal">\n    <paper-button class="view-link text-info">{=share_link_view=}</paper-button>\n    <span class="flex"></span>\n    <paper-button class="action-close text-primary" dialog-confirm>{=common_close=}</paper-button>\n  </div>\n</paper-dialog>\n'},function(e,t){e.exports='<div id="home-main" class="layout vertical flex">\n  <div id="note-view" style="position:relative;;order:1" class="flex layout vertical">\n    \x3c!-- overflow-y:hidden - for ad-right too long in iPad landscape--\x3e\n    \x3c!-- overflow-x:hidden - dont know why scroll bar appears due to "row" in article selection bar --\x3e\n    <neon-animated-pages id="note-bottom-bar" attr-for-selected="name" selected="standard"  style="order:3; height: 30px;padding: 0 10px;border-top: solid 1px lightgray;overflow:hidden" class="layout horizontal center" entry-animation="fade-in-animation" exit-animation="fade-out-animation" >\n      <a name="trial" href="{=void=}" class="action-trial" aria-haspopup="true" style="line-height: 30px;padding: 0 4px;">YOU HAVE XXX DAYS LEFT...</a>\n      <a name="link-msg" href="{=void=}" class="action-promo-link" aria-haspopup="true" style="line-height: 30px;padding: 0 4px;"></a>\n      <div name="static-msg" class="" style="width:100%; text-align: right; padding-right: 60px;padding-top: 8px;"></div>\n      <div name="standard" class="text-modified-date text-help" style="width:100%; text-align: right; padding-right: 60px;padding-top: 8px;"></div>\n    </neon-animated-pages>\n    <div id="view-modes" style="position:relative;order:2;" class="flex">\n      <neon-animated-pages id="text-view" class="fit" selected="notepad-view" attr-for-selected="id">\n        <x-hero-page id="iv-viewer-embedded-view" class="pv-view fit" style="display:hide">\n        </x-hero-page>\n        <x-hero-page id="iv-viewer-full-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n        </x-hero-page>\n        <x-hero-page id="iv-photo-taker-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n        </x-hero-page>\n        <x-hero-page id="notepad-view" class="layout vertical" style="height:100%">\n          <div style="position:relative;overflow-y:hidden;overflow-x:hidden;order:1;" class="flex">\n            <div class="fit">\n              <div id="editor_row" class="layout vertical" style="position:relative; height:100%;" >\n                <div id="composer-container" style="position:relative" class="flex">\n                  <div id="composer-view" class="fit" style="overflow-y:auto;overflow-x:hidden">\n                    <div id="pos-note-title-bar"></div>\n                    <div id="ev_composer" style="margin:0 2px;">\n                      <div id="editor-view">\n                        <div id="abm-list-col" style="">\n                          <div id="abm-list" style="position:absolute;margin-top: -4px;">\n                          </div>\n                        </div>\n                        <div id="editor" aria-label="{=aria_editor=}">\n                          \x3c!-- <textarea id="composer_textarea" style="height:100%;width:100%;resize:none; " placeholder="Enter text ..."></textarea> --\x3e\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <div id="playing-pos-arrow-above" style="display:none">\n                  </div>\n                  <div id="playing-pos-arrow-below" style="display:none">\n                  </div>\n                  \x3c!-- <div class="composer-shadow" style="position:absolute; left:-10px;width:10px;top:0;bottom:0">\n                  <paper-material elevation="1"></paper-material>\n                  </div> --\x3e\n                </div>    \n              </div>\n            </div>\n          </div>\n          <div id="toolbar-view" style="border-top:1px solid #cccccc;order:0">\n            <div id="toolbar" class="view-toolbar x-shadow layout horizontal center wrap " data-role="editor-toolbar" data-target="#editor" aria-label="Composer toolbar" role="toolbar" style="margin-bottom:2px">\n              <x-icon-button class="action-save" icon="bs:floppy-disk" title="Save{=hk_editor_save=}">\n              </x-icon-button>\n              <span class="x-btn-group-spliter"></span>\n              <div class="">\n                <x-icon-button icon="moon:undo" class="note-edit-cmd" data-cmd="undo" title="Undo{=hk_editor_undo=}">\n                </x-icon-button>\n                <x-icon-button icon="moon:redo" class="note-edit-cmd" data-cmd="redo" title="Redo{=hk_editor_redo=}">\n                </x-icon-button>                                                                                        \n              </div>\n              <span class="x-btn-group-spliter"></span>\n              <div class="">\n                <x-icon-button icon="bs:bookmark" class="note-edit-cmd" data-cmd="insert-abm" title="{=home_insert_abm_tip=}{=hk_insert_abm=}">\n                </x-icon-button>\n                <x-icon-button icon="moon:clock" class="note-edit-cmd" data-cmd="set-line-abm" title="{=set_line_abm_tip=}{=hk_set_line_abm=}">\n                </x-icon-button>\n              </div>\n              <span class="x-btn-group-spliter"></span>\n              <div class="">\n                <x-dropdown-button class="action-forecolor"  {=rt_mobile_noautofocus=}>\n                  <x-icon-button slot="x-dropdown-trigger" class="note-edit-popover-trigger" icon="bs:th-large"  data-app-edit="foreColor" title="Font Color">\n                  </x-icon-button>\n                  <paper-listbox class="dropdown" style="width:100px;padding:0;">\n                    \x3c!-- <paper-item data-edit="foreColor" data-value="inherit" style="background: rgb(51,51,51)">\n                    </paper-item>\n                    <paper-item data-edit="foreColor" data-value="Crimson" style="background: Crimson">\n                    </paper-item>\n                    <paper-item data-edit="foreColor" data-value="DarkGreen" style="background: DarkGreen">\n                    </paper-item>\n                    <paper-item data-edit="foreColor" data-value="blueviolet" style="background: blueviolet">\n                    </paper-item>\n                    <paper-item data-edit="foreColor" data-value="gray" style="background: gray">\n                    </paper-item> --\x3e\n                  </paper-listbox>\n                </x-dropdown-button>\n                <x-icon-button icon="moon:bold" data-edit="bold" title="Bold{=hk_editor_bold=}" unselectable="on" href="{=void=}">\n                </x-icon-button>\n                <x-icon-button icon="moon:italic" data-edit="italic" title="Italic{=hk_editor_italic=}">\n                </x-icon-button>\n                <x-icon-button icon="moon:strikethrough" data-edit="strikeThrough" title="Strikethrough">\n                </x-icon-button>\n              </div>        \n              <span class="x-btn-group-spliter"></span>\n              <div>\n                <x-icon-button icon="moon:list" class="note-edit-cmd" data-cmd="bullet-list" title="Bullet list">\n                </x-icon-button>\n                <x-icon-button icon="moon:numbered-list" class="note-edit-cmd" data-cmd="numbered-list" title="Numbered list">\n                </x-icon-button>\n                <x-icon-button icon="moon:outdent" class="note-edit-cmd" data-cmd="outdent" title="Decrease indent{=hk_editor_outdent=}">\n                </x-icon-button>\n                <x-icon-button icon="moon:indent" class="note-edit-cmd" data-cmd="indent" title="Increase indent{=hk_editor_indent=}">\n                </x-icon-button>\n              </div>\n              <span class="x-btn-group-spliter mobile-hide"></span>\n              <div class="mobile-hide">\n                <x-icon-button icon="moon:highlighter" class="note-edit-cmd" data-cmd="highlight" title="Highlight">\n                </x-icon-button>\n                <x-icon-button icon="moon:uniF12D" class="note-edit-cmd" data-cmd="clear-highlight" title="Clear highlight">\n                </x-icon-button>\n              </div>\n              <span class="x-btn-group-spliter"></span>\n              <div class="">\n                <x-icon-button icon="bs:picture"  class="note-edit-cmd" data-cmd="insert-image" title="Insert picture (or just drag &amp; drop)">\n                </x-icon-button>\n                <x-icon-button icon="moon:file-pdf" class="note-edit-cmd" data-cmd="insert-pdf" class="mobile-hide" title="Insert PDF/PPT">\n                </x-icon-button>                        \n                <x-icon-button icon="bs:camera"  class="note-edit-cmd no-restore-active-ln" data-cmd="take-photo" title="Take photos with camera">\n                </x-icon-button>\n              </div>\n              <span class="x-btn-group-spliter"></span>\n              <x-icon-button class="action-in-note-search" icon="bs:search"  title="{=search_within_note=}{=hk_search_within_note=}">\n              </x-icon-button>          \n              <div class="flex" style="text-align:right">\n                <span id="text-saving" class="help-block small long-text" style="margin: auto 4px auto 4px;">\n              </div>\n                </span>\n            </div>\n            <div id="in-note-search-bar" style="border-top:1px solid #cccccc;display:none" class="layout horizontal center">\n              <span class="flex"></span>\n              <div class="text-result help-block small" style="margin: 0 8px;">\n                MTCHES 8888\n              </div>\n              <span class="x-btn-group-spliter"></span>\n              <x-icon-button class="action-backward" icon="arrow-back"></x-icon-button>\n              <x-icon-button class="action-forward" icon="arrow-forward"></x-icon-button>\n              <input class="input-search" style="font-size:16px; width: 200px;" type="search" placeholder="{=search_within_note=}" title="{=search_in_all_notes=}">\n              </input>\n              <paper-button class="action-done">\n                Done\n              </paper-button>\n            </div>\n          </div>\n        </x-hero-page>\n      </neon-animated-pages>\n      \x3c!-- <core-animated-pages id="photo-view" style="display:none" fit transitions="hero-transition cross-fade" selected="pv-list-view" attr-for-selected="id">\n      <div id="pv-viewer-embedded-view" class="pv-view" style="display:hide" fit>\n      </div>\n      <div id="pv-viewer-full-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n      </div>\n      <div id="pv-photo-taker-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n      </div>\n      <div id="pv-list-view" class="pv-view" fit>\n      <div layout vertical style="height:100%">\n      <div style="position:relative;overflow-y:hidden;overflow-x:hidden;order:1;" flex>\n      <div id="photo-list-cont" fit style="overflow-y: auto">\n      <div id="photo-list" layout horizontal wrap data-view-mode="">\n      <div id="photo-item-templ">\n      <div class="pv-item photo-item" data-name="{=rt_name=}">\n      <img src="{=rt_img_src=}">\n      <a class="action-play" href="{=void=}">\n      <div class="label-time">\n      {=rt_time=}\n      </div>\n      </a>\n      <div class="top-bar" layout horizontal center>\n      <iron-icon class="icon-check" icon="check-box-outline-blank">\n      </iron-icon>\n      <span flex></span>\n      </div>\n      </div>                  \n      </div>\n      <div id="photo-hint-item-templ">\n      <div class="pv-item hint-item" layout vertical center center-justified>\n      <div class="hint">\n      {==pv_hint_item_desc==}\n      </div>\n      </div>                  \n      </div>\n      </div>\n      </div>\n      <paper-fab class="action-take-photo" icon="bs:camera" style="position:absolute; right: 0px; bottom: 0px; margin-right: 10px; margin-bottom: 10px" hero hero-id="hero-photo-taker">\n      </paper-fab>\n      </div>\n      <div id="photo-toolbar-view" style="border-top:1px solid #cccccc;order:0">\n      <paper-material class="composer-shadow"></paper-material>\n      <div style="position: relative; height:36px">\n      <div id="pv-toolbar" class="pv-toolbar view-toolbar" layout horizontal center wrap aria-label="Photos toolbar" role="toolbar">\n      <x-icon-button icon="bs:picture"  class="action-import-pic" title="Import pictures">\n      Import Pictures\n      </x-icon-button>\n      <x-icon-button icon="moon:file-pdf" class="action-import-pdf mobile-hide" title="Import PDF/PPT">\n      Import PDF/PPT\n      </x-icon-button>                        \n      <x-dropdown-button class="x-open-below" halign="left">\n      <x-icon-button class="x-dropdown-trigger " icon="bs:option-vertical">\n      More\n      </x-icon-button>\n      <paper-listbox class="dropdown" id="pv-menu" style="min-width: 100px">\n      <paper-item class="action-undo" title="{=pv_menu_sel=}" disabled>\n      UNDO XXX\n      </paper-item>\n      <paper-item class="action-select" title="{=pv_menu_sel=}">\n      {=pv_menu_sel=}\n      </paper-item>\n      </paper-listbox>\n      </x-dropdown-button>\n      </div>\n      <div id="pv-sel-toolbar" class="pv-toolbar view-toolbar" layout horizontal center wrap aria-label="Photos selection toolbar" role="toolbar" style="display:none">\n      <x-icon-button class="action-delete" icon="bs:trash" disabled>\n      Delete\n      </x-icon-button>\n      <x-icon-button class="action-cancel" icon="bs:null-placeholder">\n      Cancel\n      </x-icon-button>\n      <span flex></span>\n      <div class="label-sel-status help-block" style="margin-right: 4px">\n      </div>\n      </div>\n      </div>\n      </div>\n      </div>\n      </div>\n      </core-animated-pages> --\x3e\n      \n      \x3c!-- <div id="view-togglers" style="" layout vertical>\n      <x-icon-button class="action-text view-toggler" title="Notepad view" icon="moon:file-text">\n      <paper-material></paper-material>\n      </x-icon-button>\n      <x-icon-button class="action-photo view-toggler" title="Photo view" icon="moon:pictures2" style="display: none">\n      <span class="label-photo-num">x8888</span>\n      <paper-material></paper-material>\n      </x-icon-button>\n      </div> --\x3e\n    </div>\n    <div id="wave-view" style="position:relative;order:0;overflow-y:hidden">\n      <div id="info-bar-container" class="layout horizontal center" style="position:relative;" >\n        <div class="flex">\n          <span id="offline_icon" class="label label-info circle-label" style="position:absolute;right:0px;display:none">\n            {=home_offline=}\n          </span>\n          <div id="info-bar" class="bg-warning" style="visibility:hidden;height:20px;">&nbsp;</div>\n        </div>\n        <div id="mini-wave-bar" style="display:none" class="layout horizontal center">\n          <div class="wave-time-label" class="small" style="font-size:12px;">\n          </div>\n          <x-icon-button class="start-record" icon="moon:mic" data-state="stopped" title="{=start_record=}{=hk_toggle_rec=}" style="">\n          </x-icon-button>        \n        </div>\n      </div>\n      <div id="wave-bar" style="" class="layout horizontal center">      \n        <paper-icon-button id=\'play-pause\' icon="bs:play" class="cg-playing" title="Play/Pause{=hk_play_pause=}">\n        </paper-icon-button>\n        <paper-icon-button id="play-stop"  icon="bs:stop" class="cg-playing" title="Stop{=hk_stop_play=}">\n        </paper-icon-button>\n        \x3c!-- <paper-button id="play-speed" class="cg-playing mobile-hide" style="min-width:initial;width:40px;margin:0" title="Playback speed">\n        <span class="small">8.8X</span>\n        </paper-button> --\x3e\n        <paper-icon-button id="back-10s" icon="moon:back10s" class="mobile-only cg-playing" style="" title="Rewind 10 seconds{=hk_back_10s=}">\n        </paper-icon-button>\n        <div id="wave" class="flex"></div>\n        <div class="wave-time-label" class="small" style="position:absolute;right:60px;top:52px;font-size:12px;">\n        </div>\n        <paper-fab class="start-record" icon="moon:mic" data-state="stopped" title="{=start_record=}{=hk_toggle_rec=}" style="margin-left: 6px; margin-right: 6px">\n        </paper-fab>\n      </div>\n      <div id="trans-bar" style="display:none" class="layout horizontal center wrap">\n        <paper-icon-button class="action-goto-start cg-playing" icon="moon:step-backward" title="{=play_goto_start_tip=}{=hk_goto_start=}" >\n        </paper-icon-button>\n        <paper-icon-button class="action-backward cg-playing" icon="moon:backward" title="{=rewind_btn_tip=}{=hk_rewind=}" >\n        </paper-icon-button>\n        <paper-icon-button class="action-forward cg-playing" icon="moon:forward" title="{=fast_forward_btn_tip=}{=hk_fast_forward=}" >\n        </paper-icon-button>\n        <paper-icon-button class="action-goto-end cg-playing" icon="moon:step-forward" title="{=play_goto_end_tip=}{=hk_goto_end=}" >\n        </paper-icon-button>\n        <span class="x-btn-group-spliter" style="margin-right: 6px"></span>\n        <div class="layout horizontal center">\n          <paper-icon-button icon="moon:gauge" class="action-switch-speed cg-playing" title="{=switch_speed_tip=}{=hk_switch_speed=}">\n          </paper-icon-button>\n          <paper-slider class="slider-speed cg-playing" min="0" max="15" value="5" style="width:250px"></paper-slider>\n          <span class="text-speed" style="color:gray">\n            8.8x\n          </span>\n        </div>\n        <span class="x-btn-group-spliter" style="margin-right: 6px;margin-left: 6px"></span>\n        <div class="layout horizontal center">\n\t  \x3c!-- @polymer paper-button bug: Exception caught during observer callback: TypeError: Cannot read property \'downAction\' of undefined --\x3e \n          <x-icon-button class="action-auto-time text-primary cg-playing" icon="bs:flash" title="{=trans_auto_time_tip=}" toggles >\n            {=trans_auto_time=}\n          </x-icon-button>\n        </div>\n        <span class="x-btn-group-spliter" style="margin-right: 6px;margin-left: 6px"></span>\n        <div class="repeat-bar">\n          <paper-button class="action-repeat uppercase-off text-primary" title="{=home_repeate_tip=}{=hk_play_ab=}" >\n            {=wave_bar_play_ab=}\n          </paper-button>\n          <paper-button class="action-repeat-a uppercase-off text-primary" title="{=home_set_a_tip=}{=hk_set_a=}">\n            <iron-icon icon="bs:flag" style="color:lightgreen"></iron-icon>\n            {=wave_bar_set_a=}\n          </paper-button>\n          <paper-button class="action-repeat-b uppercase-off text-primary" title="{=home_set_b_tip=}{=hk_set_b=}">\n            <iron-icon icon="bs:flag" style="color:crimson"></iron-icon>\n            {=wave_bar_set_b=}\n          </paper-button>\n        </div>\n      </div>\n      <div id="edit-wave-bar" style="display:none" class="layout horizontal center wrap">\n        <div class="repeat-bar">\n          <paper-button class="action-repeat uppercase-off text-primary" title="{=home_repeate_tip=}{=hk_play_ab=}" >\n            {=wave_bar_play_ab=}\n          </paper-button>\n          <paper-button class="action-repeat-a uppercase-off text-primary" title="{=home_set_a_tip=}{=hk_set_a=}">\n            <iron-icon icon="bs:flag" style="color:lightgreen"></iron-icon>\n            {=wave_bar_set_a=}\n          </paper-button>\n          <paper-button class="action-repeat-b uppercase-off text-primary" title="{=home_set_b_tip=}{=hk_set_b=}">\n            <iron-icon icon="bs:flag" style="color:crimson"></iron-icon>\n            {=wave_bar_set_b=}\n          </paper-button>\n        </div>\n        <span class="x-btn-group-spliter"></span>\n        <div class="">\n          <paper-button class="action-insert uppercase-off text-primary" title="Insert recording from the middle of the exist." aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_insert=}\n          </paper-button>\n          <paper-button class="action-extract uppercase-off text-primary" title="Make a new note by copying recording between A-B" aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_extract=}\n          </paper-button>\n        </div>\n        <span class="x-btn-group-spliter"></span>\n        <div>\n          <paper-button class="action-del uppercase-off text-danger" title="Delete all recording between A-B"  aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_del=}\n          </paper-button>\n          <paper-button class="action-trim uppercase-off text-danger" title="Delete all recording before A and after B"  aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_trim=}\n          </paper-button>\n          <paper-button class="action-clear-all uppercase-off text-danger" title="Clear all recording" aria-haspopup="true">\n            {=wave_bar_clear_all=}\n          </paper-button>\n        </div>\n        <span class="x-btn-group-spliter"></span>\n        <div class="">\n          <paper-button class="action-undo text-info" title="Undo the last operation(Delete, Trim, Clear All)" style="display:none">\n            {=common_undo=}\n          </paper-button>\n        </div>\n        <span class="flex"></span>\n        <div class="">\n          <x-icon-button class="action-zoom-in text-primary" icon="bs:zoom-in" title="Zoom in/out wave bar" toggles >\n            {=wave_bar_zoom_in=}\n          </x-icon-button>    \n          \x3c!-- <a class="btn text-dark action-close" style="padding-top: 10px;margin-right: 10px;" href="{=void=}" title="Close editor toolbar"> --\x3e\n          \x3c!--   <i class="glyphicon glyphicon-remove"></i> --\x3e\n          \x3c!-- </a> --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div id="note-nav" class="app-nav x-shadow" style="padding-right:2px;order:0;font-size:14px;" elevation="{=rt_mobile_shadow_z=}">\n    <div id="note-nav-main-nav-pos"></div>\n  </div>\n</div>\n'},function(e,t){e.exports='<div id="home-main" style="width:100%;height:100%" xsNoteMode="review" class="layout vertical">\n  <div id="note-view" style="position:relative;order:1" class="flex layout vertical">\n    <div id="info-bar-container" style="position:relative;display:none">\n      <span id="offline_icon" class="label label-info circle-label" style="position:absolute;right:0px;display:none">\n        {=home_offline=}\n      </span>\n      <div id="info-bar" class="bg-warning" style="visibility:hidden;">&nbsp;</div>\n    </div>\n    <div id="wave-bar" style="display:none;position:relative;height: 48px;" class="layout horizontal center">      \n      <paper-icon-button id=\'play-pause\' icon="bs:play" class="cg-playing editor-focus-safe" title="Play/Pause{=hk_play_pause=}">\n      </paper-icon-button>\n      <paper-icon-button id="play-stop"  icon="bs:stop" class="cg-playing editor-focus-safe" title="Stop{=hk_stop_play=}">\n      </paper-icon-button>\n      <div id="wave" class="flex"></div>\n      <paper-icon-button id="back-10s" icon="moon:back10s" class="cg-playing editor-focus-safe" style="" title="Back 10s{=hk_back_10s=}">\n      </paper-icon-button>\n      <div id="time-label-max" style="font-size: 10px;color:#555;position:absolute;right:36px;bottom:0;">\n      </div>\n    </div>\n    \x3c!-- overflow-x:hidden - dont know why scroll bar appears due to "row" in article selection bar --\x3e\n    <div style="position:relative;overflow-y:hidden;overflow-x:hidden;border-top: solid 1px gray;" class="flex">\n      <div id="view-modes" style="">\n        <neon-animated-pages id="text-view" class="fit" transitions="hero-transition cross-fade" selected="notepad-view" attr-for-selected="id">\n          <x-hero-page id="iv-viewer-embedded-view" class="pv-view fit" style="display:hide">\n          </x-hero-page>\n          <x-hero-page id="iv-viewer-full-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n          </x-hero-page>\n          <x-hero-page id="iv-photo-taker-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n          </x-hero-page>\n          <x-hero-page id="notepad-view" style="height:100%">\n            <div id="editor_row" style="height:100%" class="layout vertical">\n              <div id="composer-container" style="position:relative" class="flex">\n                <div id="composer-view" class="fit" style="overflow-y:auto;overflow-x: hidden;border-top: 1px solid lightgray;border: 1px solid rgb(204, 204, 204);">\n                  <div id="pos-note-title-bar"></div>\n                  <div id="ev_composer" style="">                    \n                    <div id="editor-view">\n                      <div id="abm-list-col" style="">\n                        <div id="abm-list" style="position:absolute;margin-top: -4px;">\n                        </div>\n                      </div>\n                      <div id="editor" aria-label="{=aria_editor=}">\n                        \x3c!-- <textarea id="composer_textarea" style="height:100%;width:100%;resize:none; " placeholder="Enter text ..."></textarea> --\x3e\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div id="floating-editor-toolbar" class="note-edit-mode toast-push" style="position:absolute; bottom: 4px; right: 4px;display:none;" data-toast-push-base="4" >\n                  <x-icon-button icon="moon:undo" class="note-edit-cmd" data-cmd="undo"  title="Undo{=hk_editor_undo=}">\n                  </x-icon-button>\n                  <x-icon-button icon="moon:redo" class="note-edit-cmd" data-cmd="redo"  title="Redo{=hk_editor_redo=}">\n                  </x-icon-button>\n                </div>                        \n              </div>\n              <div id="toolbar-container" style="display:none;">\n                <div id="toolbar" class="view-toolbar" data-role="editor-toolbar" data-target="#editor" aria-label="Composer toolbar" role="toolbar" style="height:34px;white-space:nowrap;text-align:center">\n                  \x3c!-- <span class="x-btn-group-spliter"></span> --\x3e\n                  <span id="text-saving" class="help-block small" style="display:none">\n                  </span>\n                  \x3c!-- <div style="">\n                  <x-icon-button icon="moon:undo" class="note-edit-cmd" data-cmd="undo"  title="Undo{=hk_editor_undo=}">\n                  </x-icon-button>\n                  <x-icon-button icon="moon:redo" class="note-edit-cmd" data-cmd="redo"  title="Redo{=hk_editor_redo=}">\n                  </x-icon-button>                                                                                      \n                  </div> --\x3e\n                  \x3c!-- <span class="x-btn-group-spliter"></span> --\x3e\n                  <x-icon-button icon="bs:bookmark" class="note-edit-cmd" data-cmd="insert-abm" title="{=home_insert_abm_tip=}{=hk_insert_abm=}">\n                  </x-icon-button>\n                  <span class="x-btn-group-spliter"></span>\n                  <x-dropdown-button class="action-forecolor" valign="bottom" no-auto-focus >\n                    <x-icon-button slot="x-dropdown-trigger" class="note-edit-popover-trigger" icon="bs:th-large"  data-app-edit="foreColor" title="Font Color">\n                    </x-icon-button>\n                    <paper-listbox class="dropdown" style="width:100px; padding:0;">\n                    </paper-listbox>\n                  </x-dropdown-button>\n                  <x-icon-button icon="moon:bold" data-edit="bold" title="Bold{=hk_editor_bold=}" unselectable="on" href="{=void=}">\n                  </x-icon-button>\n                  <x-icon-button icon="moon:italic" data-edit="italic" title="Italic{=hk_editor_italic=}">\n                  </x-icon-button>\n                  <x-icon-button icon="moon:strikethrough" data-edit="strikeThrough" title="Strikethrough">\n                  </x-icon-button>\n                  <span class="x-btn-group-spliter"></span>\n                  <x-icon-button icon="moon:list" class="note-edit-cmd" data-cmd="bullet-list" title="Bullet list">\n                  </x-icon-button>\n                  <x-icon-button icon="moon:numbered-list" class="note-edit-cmd" data-cmd="numbered-list" title="Numbered list">\n                  </x-icon-button>\n                  <x-icon-button icon="moon:outdent" class="note-edit-cmd" data-cmd="outdent" title="Decrease indent{=hk_editor_outdent=}">\n                  </x-icon-button>\n                  <x-icon-button icon="moon:indent" class="note-edit-cmd" data-cmd="indent" title="Increase indent{=hk_editor_indent=}">\n                  </x-icon-button>\n                </div>\n              </div>          \n            </div>\n          </x-hero-page>\n        </neon-animated-pages>\n        <neon-animated-pages id="photo-view" style="display:none" class="fit">\n          <div class="layout vertical" style="height:100%">\n            <div style="position:relative;overflow-y:hidden;overflow-x:hidden;order:1;" class="flex">\n              <div id="photo-list-cont" class="fit" style="overflow-y: auto">\n                <div id="photo-list" class="layout horizontal wrap" data-view-mode="">\n                  <div id="photo-item-templ">\n                    <div class="pv-item photo-item layout vertical center center-justified" data-name="{=rt_name=}" >\n                      <img src="{=rt_img_src=}">\n                      <a class="action-play" href="{=void=}">\n                        <div class="label-time">\n                          {=rt_time=}\n                        </div>\n                      </a>\n                      <div class="top-bar layout horizontal center">\n                        <iron-icon class="icon-check" icon="check-box-outline-blank">\n                        </iron-icon>\n                        <span class="flex"></span>\n                      </div>\n                    </div>                  \n                  </div>\n                  <div id="photo-hint-item-templ">\n                    <div class="pv-item hint-item layout vertical center center-justified">\n                      <div class="hint">\n                        {==pv_hint_item_desc==}\n                      </div>\n                    </div>                  \n                  </div>\n                </div>\n              </div>\n              <paper-fab class="action-take-photo" icon="bs:camera" style="position:absolute; right: 0px; bottom: 0px; margin-right: 10px; margin-bottom: 10px">\n              </paper-fab>\n            </div>\n            <div id="photo-toolbar-view" style="border-top:1px solid #cccccc;order:0">\n              <paper-material class="composer-shadow">\n                <div style="position: relative; height:36px">\n                  <div id="pv-toolbar" class="pv-toolbar view-toolbar layout horizontal center wrap" aria-label="Photos toolbar" role="toolbar">\n                    \x3c!-- <x-icon-button class="action-save" icon="bs:floppy-disk" title="Save{=hk_editor_save=}">\n                    </x-icon-button> --\x3e\n                    <x-icon-button class="action-import" icon="bs:import">\n                      Import\n                    </x-icon-button>\n                    <span class="flex"></span>\n                    <x-dropdown-button class="x-open-below" halign="right">\n                      <x-icon-button slot="x-dropdown-trigger" class=" " icon="bs:option-vertical">\n                      </x-icon-button>\n                      <paper-listbox class="dropdown" id="pv-menu" style="min-width: 100px">\n                        <paper-item class="action-undo" title="{=pv_menu_sel=}" disabled>\n                          UNDO XXX\n                        </paper-item>\n                        <paper-item class="action-select" title="{=pv_menu_sel=}">\n                          {=pv_menu_sel=}\n                        </paper-item>\n                      </paper-listbox>\n                    </x-dropdown-button>\n                  </div>\n                  <div id="pv-sel-toolbar" class="pv-toolbar view-toolbar layout horizontal center wrap" aria-label="Photos selection toolbar" role="toolbar" style="display:none">\n                    <x-icon-button class="action-delete" icon="bs:trash" disabled>\n                      Delete\n                    </x-icon-button>\n                    <x-icon-button class="action-cancel" icon="bs:null-placeholder">\n                      Cancel\n                    </x-icon-button>\n                    <span class="flex"></span>\n                    <div class="label-sel-status help-block" style="margin-right: 4px">\n                    </div>\n                  </div>\n                </div>\n              </paper-material>\n            </div>\n          </div>\n        </neon-animated-pages>\n        \x3c!-- <div id="view-togglers" style="position:absolute; top: 50px; right: -2px" layout vertical>\n        <x-icon-button class="action-text view-toggler" title="Notepad view" icon="moon:file-text">\n        {=text_view_label=}\n        <paper-material></paper-material>\n        </x-icon-button>\n        <x-icon-button class="action-photo view-toggler" title="Photo view" icon="moon:pictures2" style="display: none">\n        {=photo_view_label=}\n        <paper-material></paper-material>\n        </x-icon-button>\n        </div> --\x3e\n      </div>\n      <paper-fab class="action-edit-mode toast-push" icon="bs:edit" style="position:absolute; right: 10px; bottom: 10px" data-toast-push-base="10" >\n      </paper-fab>\n    </div>\n  </div> \x3c!-- end of note-view --\x3e\n  <div id="note-nav" class="app-nav" style="position:relative;order:0"  >\n    <div style="width:100%;height: 100%;margin: 0;" class="layout horizontal center">\n      <div class="time-label-bg">\n      </div>\n      \x3c!-- <div class="time-label-bg-tail">\n      </div> --\x3e\n      <div id="time-label-cur">\n      </div>\n      <div id="toggle-note-list" class="x-btn note-review-mode" aria-lael="Back to note list" role="button" tabindex="0">\n        <span class="btn-icon-bar"></span>\n        <span class="btn-icon-bar"></span>\n        <span class="btn-icon-bar"></span>\n      </div>\n      <paper-icon-button class="action-edit-done note-edit-mode" icon="bs:ok" style="color: rgb(121, 221, 141)">\n      </paper-icon-button>\n      \x3c!-- <paper-icon-button class="action-undo note-edit-mode" icon="moon:undo">\n      </paper-icon-button>\n      <paper-icon-button class="action-redo note-edit-mode" icon="moon:redo">\n      </paper-icon-button> --\x3e\n      <paper-icon-button id="toggle-wave-bar" class="editor-focus-safe" icon="bs:chevron-down">\n      </paper-icon-button>\n      <span class="flex"></span>\n      <paper-icon-button id="xs-insert-image" class="note-edit-mode" icon="bs:camera">\n      </paper-icon-button>\n      <paper-icon-button class="start-record editor-focus-safe" icon="moon:mic">\n      </paper-icon-button>\n      <x-dropdown-button id="xs-note-menu" class="x-open-below" halign="right" no-auto-focus >\n        <paper-icon-button slot="x-dropdown-trigger" class="" icon="more-vert">\n        </paper-icon-button>\n        <paper-listbox class="dropdown main-menu" attr-for-selected="id" >\n          <paper-item id="menu-note-prop" class="btn-note-prop"  title="{=home_art_attr=}">\n            <iron-icon icon="moon:info"></iron-icon>\n            {=note_menu_prop=}\n          </paper-item>\n          \x3c!-- <paper-item class="" id="menu-gen-share-link"  title="{=menu_gen_share_link_help=}">\n          <iron-icon icon="bs:link"></iron-icon>\n          {=menu_gen_share_link=}\n          </paper-item> --\x3e\n          <paper-item class="" id="menu-save-rec"  title="{=menu_save_mp3_help=}">\n            <iron-icon icon="bs:share"></iron-icon>\n            {=menu_share_rec=}\n          </paper-item>\n          <div class="x-dropdown-header">{=note_menu_export=}</div>\n          <paper-item class="export-note-source" data-value="Disk" title="Export to Local Disk">\n            <iron-icon icon="bs:hdd"></iron-icon>\n            <span class="mobile-hide">{=local_disk=}</span>\n            <span class="mobile-only">{=on_device=}</span>\n          </paper-item>\n          <paper-item  class="export-note-source" data-value="GDrive"  title="Export to Google Drive">\n            <iron-icon icon="moon:gdrive"></iron-icon>\n            {=google_drive=}\n          </paper-item>\n          <paper-item  class="export-note-source" data-value="Dropbox"  title="Export to Dropbox">\n            <iron-icon icon="moon:dropbox"></iron-icon>\n            {=dropbox=}\n          </paper-item>\n        </paper-listbox>\n      </x-dropdown-button>\n    </div>\n  </div>\n  <x-popover id="tip-popover" class="tips">\n    CONTENT\n  </x-popover>\n</div>\n'},function(e,t){e.exports='<div id="home-main" class="layout vertical flex">\n  <div id="note-view" style="position:relative;;order:1" class="flex layout vertical">\n    \x3c!-- overflow-y:hidden - for ad-right too long in iPad landscape--\x3e\n    \x3c!-- overflow-x:hidden - dont know why scroll bar appears due to "row" in article selection bar --\x3e\n    <neon-animated-pages id="note-bottom-bar" attr-for-selected="name" selected="standard"  style="order:3; height: 30px;padding: 0 10px;border-top: solid 1px lightgray;overflow:hidden" class="layout horizontal center" entry-animation="fade-in-animation" exit-animation="fade-out-animation" >\n      <a name="trial" href="{=void=}" class="action-trial" aria-haspopup="true" style="line-height: 30px;padding: 0 4px;">YOU HAVE XXX DAYS LEFT...</a>\n      <a name="link-msg" href="{=void=}" class="action-promo-link" aria-haspopup="true" style="line-height: 30px;padding: 0 4px;"></a>\n      <div name="static-msg" class="" style="width:100%; text-align: right; padding-right: 60px;padding-top: 8px;"></div>\n      <div name="standard" class="text-modified-date text-help" style="width:100%; text-align: right; padding-right: 60px;padding-top: 8px;"></div>\n    </neon-animated-pages>\n    <div id="view-modes" style="position:relative;order:2;" class="flex">\n      <neon-animated-pages id="text-view" class="fit" selected="notepad-view" attr-for-selected="id">\n        <x-hero-page id="iv-viewer-embedded-view" class="pv-view fit" style="display:hide">\n        </x-hero-page>\n        <x-hero-page id="iv-viewer-full-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n        </x-hero-page>\n        <x-hero-page id="iv-photo-taker-view" class="pv-view" style="display:hide;position:fixed;left:0;top:0;right:0;bottom:0;z-index: 14">\n        </x-hero-page>\n        <x-hero-page id="notepad-view" class="layout vertical" style="height:100%">\n          <div style="position:relative;overflow-y:hidden;overflow-x:hidden;order:1;" class="flex">\n            <div class="fit">\n              <div id="editor_row" class="layout vertical" style="position:relative; height:100%;" >\n                <div id="composer-container" style="position:relative" class="flex">\n                  <div id="composer-view" class="fit" style="overflow-y:auto;overflow-x:hidden">\n                    <div id="pos-note-title-bar"></div>\n                    <div id="ev_composer" style="margin:0 2px;">\n                      <div id="editor-view">\n                        <div id="abm-list-col" style="">\n                          <div id="abm-list" style="position:absolute;margin-top: -4px;">\n                          </div>\n                        </div>\n                        <div id="editor" aria-label="{=aria_editor=}">\n                          \x3c!-- <textarea id="composer_textarea" style="height:100%;width:100%;resize:none; " placeholder="Enter text ..."></textarea> --\x3e\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <div id="playing-pos-arrow-above" style="display:none">\n                  </div>\n                  <div id="playing-pos-arrow-below" style="display:none">\n                  </div>\n                  \x3c!-- <div class="composer-shadow" style="position:absolute; left:-10px;width:10px;top:0;bottom:0">\n                  <paper-material elevation="1"></paper-material>\n                  </div> --\x3e\n                </div>\n                <div id="toolbar-container" style="display:none">\n                  <div id="toolbar" class="view-toolbar layout horizontal center around-justified" data-role="editor-toolbar" data-target="#editor" aria-label="Composer toolbar" role="toolbar" style="height:34px">\n                    <x-icon-button icon="bs:bookmark" class="note-edit-cmd" data-cmd="insert-abm" title="{=home_insert_abm_tip=}{=hk_insert_abm=}">\n                    </x-icon-button>\n                    <x-icon-button icon="moon:clock" class="note-edit-cmd" data-cmd="set-line-abm" title="{=set_line_abm_tip=}{=hk_set_line_abm=}">\n                    </x-icon-button>\n                    <span class="x-btn-group-spliter"></span>\n                    <x-dropdown-button class="action-forecolor" valign="bottom" no-auto-focus >\n                      <x-icon-button slot="x-dropdown-trigger" class="note-edit-popover-trigger" icon="bs:th-large"  data-app-edit="foreColor" title="Font Color">\n                      </x-icon-button>\n                      <paper-listbox class="dropdown" style="width:100px; padding:0;">\n                      </paper-listbox>\n                    </x-dropdown-button>\n                    <x-icon-button icon="moon:bold" data-edit="bold" title="Bold{=hk_editor_bold=}" unselectable="on" href="{=void=}">\n                    </x-icon-button>\n                    <x-icon-button icon="moon:italic" data-edit="italic" title="Italic{=hk_editor_italic=}">\n                    </x-icon-button>\n                    <x-icon-button icon="moon:strikethrough" data-edit="strikeThrough" title="Strikethrough">\n                    </x-icon-button>\n                    <span class="x-btn-group-spliter"></span>\n                    <x-icon-button icon="moon:list" class="note-edit-cmd" data-cmd="bullet-list" title="Bullet list">\n                    </x-icon-button>\n                    <x-icon-button icon="moon:numbered-list" class="note-edit-cmd" data-cmd="numbered-list" title="Numbered list">\n                    </x-icon-button>\n                    <x-icon-button icon="moon:outdent" class="note-edit-cmd" data-cmd="outdent" title="Decrease indent{=hk_editor_outdent=}">\n                    </x-icon-button>\n                    <x-icon-button icon="moon:indent" class="note-edit-cmd" data-cmd="indent" title="Increase indent{=hk_editor_indent=}">\n                    </x-icon-button>\n                  </div>              \n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="edit-hide" style="height:1px;border-bottom:1px solid lightgray;" ></div>\n        </x-hero-page>\n      </neon-animated-pages>\n    </div>\n    <div id="wave-view" style="position:relative;order:0;overflow-y:hidden">\n      <div id="info-bar-container" class="layout horizontal center" style="position:relative;" >\n        <div class="flex">\n          <span id="offline_icon" class="label label-info circle-label" style="position:absolute;right:0px;display:none">\n            {=home_offline=}\n          </span>\n          <div id="info-bar" class="bg-warning" style="visibility:hidden;height:20px;">&nbsp;</div>\n        </div>\n        <div id="mini-wave-bar" style="display:none" class="layout horizontal center">\n          <div class="wave-time-label" class="small" style="font-size:12px;">\n          </div>\n          <x-icon-button class="start-record" icon="moon:mic" data-state="stopped" title="{=start_record=}{=hk_toggle_rec=}" style="">\n          </x-icon-button>        \n        </div>\n      </div>\n      <div id="wave-bar" style="height:48px;" class="layout horizontal center">      \n        <paper-icon-button id=\'play-pause\' icon="bs:play" class="cg-playing editor-focus-safe" title="Play/Pause{=hk_play_pause=}">\n        </paper-icon-button>\n        <paper-icon-button id="play-stop"  icon="bs:stop" class="cg-playing editor-focus-safe" title="Stop{=hk_stop_play=}">\n        </paper-icon-button>\n        \x3c!-- <paper-button id="play-speed" class="cg-playing mobile-hide" style="min-width:initial;width:40px;margin:0" title="Playback speed">\n        <span class="small">8.8X</span>\n        </paper-button> --\x3e\n        <paper-icon-button id="back-10s" icon="moon:back10s" class="cg-playing editor-focus-safe" style="" title="Rewind 10 seconds{=hk_back_10s=}">\n        </paper-icon-button>\n        <div class="flex" style="position:relative">\n          <div id="wave" style="margin-right: 6px" ></div>\n          <div class="wave-time-label" class="small" style="position:absolute;right:4px;bottom:-4px;font-size:12px;">\n          </div>\n        </div>\n        <paper-fab class="start-record editor-focus-safe" icon="moon:mic" data-state="stopped" title="{=start_record=}{=hk_toggle_rec=}" style="margin-right: 6px">\n        </paper-fab>\n      </div>\n      <div id="trans-bar" style="display:none" class="layout horizontal center wrap">\n        <paper-icon-button class="action-goto-start cg-playing" icon="moon:step-backward" title="{=play_goto_start_tip=}{=hk_goto_start=}" >\n        </paper-icon-button>\n        <paper-icon-button class="action-backward cg-playing" icon="moon:backward" title="{=rewind_btn_tip=}{=hk_rewind=}" >\n        </paper-icon-button>\n        <paper-icon-button class="action-forward cg-playing" icon="moon:forward" title="{=fast_forward_btn_tip=}{=hk_fast_forward=}" >\n        </paper-icon-button>\n        <paper-icon-button class="action-goto-end cg-playing" icon="moon:step-forward" title="{=play_goto_end_tip=}{=hk_goto_end=}" >\n        </paper-icon-button>\n        <span class="x-btn-group-spliter" style="margin-right: 6px"></span>\n        <div class="layout horizontal center">\n          <paper-icon-button icon="moon:gauge" class="action-switch-speed cg-playing" title="{=switch_speed_tip=}{=hk_switch_speed=}">\n          </paper-icon-button>\n          <paper-slider class="slider-speed cg-playing" min="0" max="15" value="5" style="width:250px"></paper-slider>\n          <span class="text-speed" style="color:gray">\n            8.8x\n          </span>\n        </div>\n        <span class="x-btn-group-spliter" style="margin-right: 6px;margin-left: 6px"></span>\n        <div class="layout horizontal center">\n\t  \x3c!-- @polymer paper-button bug: Exception caught during observer callback: TypeError: Cannot read property \'downAction\' of undefined --\x3e \n          <x-icon-button class="action-auto-time text-primary cg-playing" icon="bs:flash" title="{=trans_auto_time_tip=}" toggles>\n            {=trans_auto_time=}\n          </x-icon-button>\n        </div>\n        <span class="x-btn-group-spliter" style="margin-right: 6px;margin-left: 6px"></span>\n        <div class="repeat-bar">\n          <paper-button class="action-repeat uppercase-off text-primary" title="{=home_repeate_tip=}{=hk_play_ab=}" >\n            {=wave_bar_play_ab=}\n          </paper-button>\n          <paper-button class="action-repeat-a uppercase-off text-primary" title="{=home_set_a_tip=}{=hk_set_a=}">\n            <iron-icon icon="bs:flag" style="color:lightgreen"></iron-icon>\n            {=wave_bar_set_a=}\n          </paper-button>\n          <paper-button class="action-repeat-b uppercase-off text-primary" title="{=home_set_b_tip=}{=hk_set_b=}">\n            <iron-icon icon="bs:flag" style="color:crimson"></iron-icon>\n            {=wave_bar_set_b=}\n          </paper-button>\n        </div>\n      </div>\n      <div id="edit-wave-bar" style="display:none" class="layout horizontal center wrap">\n        <div class="repeat-bar">\n          <paper-button class="action-repeat uppercase-off text-primary" title="{=home_repeate_tip=}{=hk_play_ab=}" >\n            {=wave_bar_play_ab=}\n          </paper-button>\n          <paper-button class="action-repeat-a uppercase-off text-primary" title="{=home_set_a_tip=}{=hk_set_a=}">\n            <iron-icon icon="bs:flag" style="color:lightgreen"></iron-icon>\n            {=wave_bar_set_a=}\n          </paper-button>\n          <paper-button class="action-repeat-b uppercase-off text-primary" title="{=home_set_b_tip=}{=hk_set_b=}">\n            <iron-icon icon="bs:flag" style="color:crimson"></iron-icon>\n            {=wave_bar_set_b=}\n          </paper-button>\n        </div>\n        <span class="x-btn-group-spliter"></span>\n        <div class="">\n          <paper-button class="action-insert uppercase-off text-primary" title="Insert recording from the middle of the exist." aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_insert=}\n          </paper-button>\n          <paper-button class="action-extract uppercase-off text-primary" title="Make a new note by copying recording between A-B" aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_extract=}\n          </paper-button>\n        </div>\n        <span class="x-btn-group-spliter"></span>\n        <div>\n          <paper-button class="action-del uppercase-off text-danger" title="Delete all recording between A-B"  aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_del=}\n          </paper-button>\n          <paper-button class="action-trim uppercase-off text-danger" title="Delete all recording before A and after B"  aria-haspopup="true">\n            <iron-icon icon="bs:lock" class="pro-hide"></iron-icon>\n            {=wave_bar_trim=}\n          </paper-button>\n          <paper-button class="action-clear-all uppercase-off text-danger" title="Clear all recording" aria-haspopup="true">\n            {=wave_bar_clear_all=}\n          </paper-button>\n        </div>\n        <span class="x-btn-group-spliter"></span>\n        <div class="">\n          <paper-button class="action-undo text-info" title="Undo the last operation(Delete, Trim, Clear All)" style="display:none">\n            {=common_undo=}\n          </paper-button>\n        </div>\n        <span class="flex"></span>\n        <div class="">\n          <x-icon-button class="action-zoom-in text-primary" icon="bs:zoom-in" title="Zoom in/out wave bar" toggles >\n            {=wave_bar_zoom_in=}\n          </x-icon-button>    \n          \x3c!-- <a class="btn text-dark action-close" style="padding-top: 10px;margin-right: 10px;" href="{=void=}" title="Close editor toolbar"> --\x3e\n          \x3c!--   <i class="glyphicon glyphicon-remove"></i> --\x3e\n          \x3c!-- </a> --\x3e\n        </div>\n      </div>\n    </div>\n    <paper-fab class="action-edit-mode" icon="bs:edit" style="position:absolute; right: 10px; bottom: 10px" >\n    </paper-fab>\n  </div>\n  <div id="note-nav" class="app-nav x-shadow" style="padding-right:2px;order:0;font-size:14px;" elevation="{=rt_mobile_shadow_z=}">\n    <div id="note-nav-main-nav-pos"></div>\n  </div>\n</div>\n'},function(e,t){e.exports='<div style="height:100%;padding-left: 40px;" class="horizontal layout center">\n  <div class="" style="position:absolute; left: 0px; top:4px">\n    <div id="toggle-note-list" class="x-btn" title="Hide note list" role="checkbox" aria-checked="false" tabindex="0">\n      <span class="btn-icon-bar"></span>\n      <span class="btn-icon-bar"></span>\n      <span class="btn-icon-bar"></span>\n    </div>\n  </div>\n  <paper-button id="menu-feedback" class="uppercase-off chrome-hide" aria-label="{=home_feedback=}" aria-haspopup="true">\n    <iron-icon icon="bs:leaf"></iron-icon>\n    {=home_feedback=}\n  </paper-button>\n  <paper-button id="sync" class="uppercase-off" aria-label="{=home_sync=}" style="">\n    <iron-icon icon="bs:refresh"></iron-icon>\n    {=home_sync=}\n  </paper-button>\n  <paper-icon-button id="show-slient-error" icon="report-problem" title="{=slient_error_title=}" style="color:darkred;display:none;">\n  </paper-icon-button>\n  <span class="flex"></span>\n  <x-dropdown-button class="x-open-below">\n    <paper-button id="menu-note" slot="x-dropdown-trigger" class="uppercase-off" aria-label="Note">\n      <iron-icon icon="moon:mn-font"></iron-icon>\n      {=menu_note=}\n      <iron-icon icon="arrow-drop-down"></iron-icon>\n    </paper-button>\n    <paper-listbox class="dropdown main-menu" attr-for-selected="id">\n      <paper-item id="menu-new-note"  title="{=mai_art_attri=}">\n        <iron-icon icon="bs:file"></iron-icon>\n        {=menu_new_note=}\n      </paper-item>\n      <paper-item id="menu-import-note"  title="{=menu_import_note=}">\n        <iron-icon icon="bs:import"></iron-icon>\n        {=menu_import_note=}\n      </paper-item>\n      <paper-item id="menu-trash-box"  title="{=trash_folder_tip=}">\n        <iron-icon icon="bs:trash"></iron-icon>\n        {=menu_trash_box=}\n      </paper-item>\n      <div class="x-dropdown-header">{=menu_header_current_note=}</div>\n      <paper-item id="menu-note-prop"  title="{=mai_art_attri=}">\n        <iron-icon icon="moon:info"></iron-icon>\n        {=menu_note_prop=}\n      </paper-item>\n      <paper-item class="mobile-hide" id="menu-import-rec"  title=" {=menu_import_rec=}">\n        <iron-icon icon="moon:file-audio-o"></iron-icon>\n        {=menu_import_rec=}\n      </paper-item>\n      <paper-item id="menu-print-note" class="desktop-only" title="{=menu_print_note=}">\n        <iron-icon icon="print"></iron-icon>\n        {=menu_print_note=}\n      </paper-item>\n      <paper-item id="menu-del-note"  title="{=menu_del_note=}">\n        <iron-icon icon="bs:remove"></iron-icon>\n        {=menu_del_note=}\n      </paper-item>\n      <div class="x-dropdown-header">{=menu_header_share=}</div>\n      \x3c!-- <paper-item class="" id="menu-gen-share-link"  title="{=menu_gen_share_link_help=}">\n      <iron-icon icon="bs:link"></iron-icon>\n      {=menu_gen_share_link=}\n      </paper-item> --\x3e\n      <paper-item id="menu-export-note"  title="{=menu_export_note=}">\n        <iron-icon icon="bs:export"></iron-icon>\n        {=menu_export_note=}\n      </paper-item>\n      <paper-item class="mobile-hide" id="menu-save-rec"  title="{=menu_save_rec_help=}">\n        <iron-icon icon="bs:save"></iron-icon>\n        {=menu_save_rec=}\n      </paper-item>\n      <paper-item class="mobile-only" id="menu-save-rec"  title="{=menu_save_rec_help=}">\n        <iron-icon icon="bs:share"></iron-icon>\n        {=menu_share_rec=}\n      </paper-item>\n      <paper-item id="menu-email-note" class="mobile-hide"  title="{=menu_email=}">\n        <iron-icon icon="mail"></iron-icon>\n        {=menu_email=}\n      </paper-item>\n      \x3c!-- <div class="x-dropdown-header">{=menu_note_export=}</div>\n      <paper-item data-value="Disk"  title="Export to Local Disk">\n      <iron-icon icon="bs:hdd"></iron-icon>\n      <span class="mobile-hide">{=local_disk=}</span>\n      <span class="mobile-only">{=on_device=}</span>\n      </paper-item>\n      <paper-item data-value="GDrive"  title="Export to Google Drive">\n      <iron-icon icon="moon:gdrive"></iron-icon>\n      {=google_drive=}\n      </paper-item>\n      <paper-item data-value="Dropbox"  title="Export to Dropbox">\n      <iron-icon icon="moon:dropbox"></iron-icon>\n      {=dropbox=}\n      </paper-item> --\x3e\n    </paper-listbox>\n  </x-dropdown-button>\n  <x-dropdown-button id="menu-tools"  class="x-open-below">\n    \x3c!-- <paper-icon-button class="x-dropdown-trigger" icon="favorite">{=home_tools=}</paper-icon-button> --\x3e\n    <paper-button slot="x-dropdown-trigger" class="uppercase-off" aria-label="{=home_tools=}">\n      <iron-icon icon="bs:briefcase"></iron-icon>\n      {=home_tools=}\n      <iron-icon icon="arrow-drop-down"></iron-icon>\n    </paper-button>\n    \x3c!--     200px: @polymer fix dynamic menu item(capturer) error --\x3e\n    <paper-listbox class="dropdown main-menu" style="min-width: 200px" attr-for-selected="id">\n      <paper-item id="menu-transcribe" class="mobile-hide"  role="menuitemcheckbox">\n        <iron-icon icon="create"></iron-icon>\n\t{=menu_transcribe=}\n      </paper-item>\n      <paper-item id="edit-wave" class="mobile-hide"  role="menuitemcheckbox">\n        <iron-icon icon="content-cut"></iron-icon>\n\t{=menu_edit_recording=}\n      </paper-item>\n      <div class="x-dropdown-header mobile-hide"></div>\n      \x3c!-- <paper-item id="menu-offset-abm" >\n      <iron-icon icon="bs:null-placeholder"></iron-icon>\n      {=menu_offset_abm=}\n      </paper-item> --\x3e\n      <paper-item id="menu-del-rec" >\n        <iron-icon icon="bs:remove"></iron-icon>\n\t{=menu_del_rec=}\n      </paper-item>\n      \x3c!-- <paper-item id="menu-capturer" class="chrome-only" >\n      <iron-icon icon="bs:null-placeholder"></iron-icon>\n      <span>{==menu_install_capturer==}</span>\n      </paper-item> --\x3e\n      \x3c!-- <paper-item id="menu-install-capturer" class="chrome-only" >\n      <iron-icon icon="bs:null-placeholder"></iron-icon>\n      {==menu_install_capturer==}\n      </paper-item>\n      <paper-item id="menu-uninstall-capturer" class="chrome-only"  style="display: none;" >\n      <iron-icon icon="bs:null-placeholder"></iron-icon>\n      {==menu_uninstall_capturer==}\n      </paper-item> --\x3e\n    </paper-listbox>\n  </x-dropdown-button>\n  <x-dropdown-button halign="right" id="main-menu-options" >\n    <paper-button slot="x-dropdown-trigger" class="uppercase-off" aria-label="{=home_options=}">\n      <iron-icon icon="bs:thList"></iron-icon>\n      {=home_options=}\n      <iron-icon icon="arrow-drop-down"></iron-icon>\n    </paper-button>\n    <paper-listbox class="dropdown main-menu" style="min-width: 200px" attr-for-selected="id">\n      <paper-item id="menu-settings"  title="{=home_settings=}">\n        <iron-icon icon="bs:cog"></iron-icon>\n\t{=home_settings=}\n      </paper-item>\n      <paper-item id="menu-about"  title="{=home_about=}">\n        <iron-icon icon="bs:list-alt"></iron-icon>\n\t{=home_about=}\n      </paper-item>\n      <paper-item id="menu-upgrade-to-pro" class="android-hide can-buy-pro" >\n        <iron-icon icon="bs:star"></iron-icon>\n        {=menu_upgrade_to_pro=}\n      </paper-item>\n      <paper-item id="menu-account-name" class="cn-hide"  style="color:gray;display:none;position:relative;padding-right:0px;max-width:200px;">\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n        <span id="menu-signin-show-name" class="long-text" style="max-width: calc(100% - 40px);margin-right:0">\n          {=menu_unregisted=}\n        </span>\n        <span class="text-account-type free-hide pro-label" style="margin-left: 4px">XXX</span>\n      </paper-item>\n      <paper-item id="menu-signin"  class="cn-hide" style="color: #31708f;">\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n        {=menu_sign_in=} (<iron-icon icon="moon:google"></iron-icon>)\n      </paper-item>\n      <paper-item id="menu-update-app"  class="chrome-hide text-warning" style="display: none;">\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n        {=menu_update_app=}\n      </paper-item>\n      <div class="x-dropdown-header cn-hide"></div>\n      <paper-item id="menu-feedback" class="chrome-only" aria-label="{=home_feedback=}" aria-haspopup="true">\n        <iron-icon icon="bs:leaf"></iron-icon>\n        {=home_feedback=}\n      </paper-item>\n      <paper-item id="menu-faq" class="cn-hide"  title="FAQ" role="link">\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n        FAQ\n      </paper-item>\n      <paper-item id="menu-privacy-policy" class="cn-hide"  title="{=menu_privacy_policy=}" role="link">\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n\t{=menu_privacy_policy=}\n      </paper-item>\n      <paper-item id="menu-user-agreement" class="cn-hide"  title="{=menu_user_agreement=}" role="link">\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n\t{=menu_user_agreement=}\n      </paper-item>\n    </paper-listbox>\n  </x-dropdown-button>\n  <x-icon-button class="mini-wave-bar-toggler" icon="unfold-more" title="{=minimize_recording_bar=}" tabindex="0" aria-label="{=minimize_recording_bar=}" role="checkbox" aria-checked="false">\n  </x-icon-button>\n</div>\n'},function(e,t){e.exports='<neon-animated-pages id="note-nav-cont" selected="review-nav" attr-for-selected="name" style="height:100%" entry-animation="fade-in-animation" exit-animation="fade-out-animation" >\n  <div name="review-nav" style="height:100%;padding-left: 40px;" class="horizontal layout center">\n    <div class="" style="position:absolute; left: 0px; top:4px">\n      <div id="toggle-note-list" class="x-btn" title="Hide note list" role="checkbox" aria-checked="false" tabindex="0">\n        <span class="btn-icon-bar"></span>\n        <span class="btn-icon-bar"></span>\n        <span class="btn-icon-bar"></span>\n      </div>\n    </div>\n    <paper-button id="menu-feedback" class="uppercase-off" aria-label="{=home_feedback=}" aria-haspopup="true">\n      <iron-icon icon="bs:leaf"></iron-icon>\n      {=home_feedback=}\n    </paper-button>\n    <paper-button id="sync" class="uppercase-off" aria-label="{=home_sync=}" style="">\n      <iron-icon icon="bs:refresh"></iron-icon>\n      {=home_sync=}\n      <i id="sync_error_icon" class="glyphicon glyphicon-warning-sign text-danger hide"></i>\n    </paper-button>\n    <paper-icon-button id="show-slient-error" icon="report-problem" title="{=slient_error_title=}" style="color:darkred;display:none;">\n    </paper-icon-button>\n    <span class="flex"></span>\n    <x-dropdown-button class="x-open-below">\n      <paper-button id="menu-note" slot="x-dropdown-trigger" class="uppercase-off" aria-label="Note">\n        <iron-icon icon="moon:mn-font"></iron-icon>\n        {=menu_note=}\n        <iron-icon icon="arrow-drop-down"></iron-icon>\n      </paper-button>\n      <paper-listbox class="dropdown main-menu" attr-for-selected="id">\n        <paper-item id="menu-new-note"  title="{=mai_art_attri=}">\n          <iron-icon icon="bs:file"></iron-icon>\n          {=menu_new_note=}\n        </paper-item>\n        <paper-item id="menu-import-note"  title="{=menu_import_note=}">\n          <iron-icon icon="bs:import"></iron-icon>\n          {=menu_import_note=}\n        </paper-item>\n        <paper-item id="menu-trash-box"  title="{=trash_folder_tip=}">\n          <iron-icon icon="bs:trash"></iron-icon>\n          {=menu_trash_box=}\n        </paper-item>\n        <div class="x-dropdown-header">{=menu_header_current_note=}</div>\n        <paper-item id="menu-note-prop"  title="{=mai_art_attri=}">\n          <iron-icon icon="moon:info"></iron-icon>\n          {=menu_note_prop=}\n        </paper-item>\n        <paper-item class="mobile-hide" id="menu-import-rec"  title=" {=menu_import_rec=}">\n          <iron-icon icon="moon:file-audio-o"></iron-icon>\n          {=menu_import_rec=}\n        </paper-item>\n        <paper-item id="menu-del-note"  title="{=menu_del_note=}">\n          <iron-icon icon="bs:remove"></iron-icon>\n          {=menu_del_note=}\n        </paper-item>\n        <div class="x-dropdown-header">{=menu_header_share=}</div>\n        \x3c!-- <paper-item class="" id="menu-gen-share-link"  title="{=menu_gen_share_link_help=}">\n        <iron-icon icon="bs:link"></iron-icon>\n        {=menu_gen_share_link=}\n        </paper-item> --\x3e\n        <paper-item id="menu-export-note"  title="{=menu_export_note=}">\n          <iron-icon icon="bs:export"></iron-icon>\n          {=menu_export_note=}\n        </paper-item>\n        <paper-item class="mobile-hide" id="menu-save-rec"  title="{=menu_save_rec_help=}">\n          <iron-icon icon="bs:save"></iron-icon>\n          {=menu_save_rec=}\n        </paper-item>\n        <paper-item class="mobile-only" id="menu-save-rec"  title="{=menu_save_rec_help=}">\n          <iron-icon icon="bs:share"></iron-icon>\n          {=menu_share_rec=}\n        </paper-item>\n        <paper-item class="mobile-hide" id="menu-gen-share-link"  title="{=menu_gen_share_link_help=}">\n          <iron-icon icon="bs:link"></iron-icon>\n          {=menu_gen_share_link=}\n        </paper-item>\n        <paper-item id="menu-email-note" class="mobile-hide"  title="{=menu_email=}">\n          <iron-icon icon="mail"></iron-icon>\n          {=menu_email=}\n        </paper-item>\n        \x3c!-- <div class="x-dropdown-header">{=menu_note_export=}</div>\n        <paper-item data-value="Disk"  title="Export to Local Disk">\n        <iron-icon icon="bs:hdd"></iron-icon>\n        <span class="mobile-hide">{=local_disk=}</span>\n        <span class="mobile-only">{=on_device=}</span>\n        </paper-item>\n        <paper-item data-value="GDrive"  title="Export to Google Drive">\n        <iron-icon icon="moon:gdrive"></iron-icon>\n        {=google_drive=}\n        </paper-item>\n        <paper-item data-value="Dropbox"  title="Export to Dropbox">\n        <iron-icon icon="moon:dropbox"></iron-icon>\n        {=dropbox=}\n        </paper-item> --\x3e\n      </paper-listbox>\n    </x-dropdown-button>\n    <x-dropdown-button halign="right">\n      <paper-button slot="x-dropdown-trigger" class="uppercase-off" aria-label="{=home_options=}">\n        <iron-icon icon="bs:thList"></iron-icon>\n        {=home_options=}\n        <iron-icon icon="arrow-drop-down"></iron-icon>\n      </paper-button>\n      <paper-listbox class="dropdown main-menu" style="min-width: 150px" attr-for-selected="id">\n        <paper-item id="menu-settings"  title="{=home_settings=}">\n          <iron-icon icon="bs:cog"></iron-icon>\n\t  {=home_settings=}\n        </paper-item>\n        <paper-item id="menu-about"  title="{=home_about=}">\n          <iron-icon icon="bs:list-alt"></iron-icon>\n\t  {=home_about=}\n        </paper-item>\n        <paper-item id="menu-upgrade-to-pro" class="android-hide can-buy-pro" >\n          <iron-icon icon="bs:star"></iron-icon>\n          {=menu_upgrade_to_pro=}\n        </paper-item>\n        <paper-item id="menu-account-name" class="cn-hide"  style="color:gray;display:none;position:relative;padding-right:0px;max-width:200px;">\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n          <span id="menu-signin-show-name" class="long-text" style="max-width: calc(100% - 40px);margin-right:0">\n            {=menu_unregisted=}\n          </span>\n          <span class="text-account-type free-hide pro-label" style="margin-left: 4px">XXX</span>\n        </paper-item>\n        <paper-item id="menu-signin"  class="cn-hide" style="color: #31708f;">\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n          {=menu_sign_in=} (<iron-icon icon="moon:google"></iron-icon>)\n        </paper-item>\n        <paper-item id="menu-update-app"  class="mobile-only text-warning" style="display: none;">\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n          {=menu_update_app=}\n        </paper-item>\n        <div class="x-dropdown-header cn-hide"></div>      \n        <paper-item id="menu-faq" class="cn-hide"  title="FAQ" role="link">\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n          FAQ\n        </paper-item>\n        <paper-item id="menu-privacy-policy" class="cn-hide"  title="{=menu_privacy_policy=}" role="link">\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n\t  {=menu_privacy_policy=}\n        </paper-item>\n        <paper-item id="menu-user-agreement" class="cn-hide"  title="{=menu_user_agreement=}" role="link">\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n\t  {=menu_user_agreement=}\n        </paper-item>\n      </paper-listbox>\n    </x-dropdown-button>\n  </div>\n  <div name="edit-nav" class="layout horizontal center" >\n    <x-icon-button class="action-edit-done note-edit-mode" icon="bs:ok" style="color: rgb(121, 221, 141)" >\n    </x-icon-button>\n    <x-icon-button icon="moon:undo" class="note-edit-cmd" data-cmd="undo" title="Undo{=hk_editor_undo=}">\n    </x-icon-button>\n    <x-icon-button icon="moon:redo" class="note-edit-cmd" data-cmd="redo" title="Redo{=hk_editor_redo=}">\n    </x-icon-button>                                                                                        \n    <span class="flex">\n    </span>\n    <x-icon-button icon="bs:camera"  class="note-edit-cmd no-restore-active-ln" data-cmd="take-photo" title="Take photos with camera">\n    </x-icon-button>\n    <x-icon-button icon="bs:picture"  class="note-edit-cmd no-restore-active-ln" data-cmd="insert-image" title="Insert picture (or just drag &amp; drop)">\n    </x-icon-button>\n    <x-icon-button class="mini-wave-bar-toggler editor-focus-safe" icon="unfold-more" title="{=minimize_recording_bar=}" tabindex="0" aria-label="{=minimize_recording_bar=}" role="checkbox" aria-checked="false">\n    </x-icon-button>\n    <x-dropdown-button id="menu-tools"  class="x-open-below" halign="right">\n      <x-icon-button slot="x-dropdown-trigger" class="" icon="more-vert">\n      </x-icon-button>\n      <paper-listbox class="dropdown main-menu" attr-for-selected="id">\n        <paper-item id="menu-transcribe" class="mobile-hide"  role="menuitemcheckbox">\n          <iron-icon icon="create"></iron-icon>\n\t  {=menu_transcribe=}\n        </paper-item>\n        <paper-item id="edit-wave" class="mobile-hide"  role="menuitemcheckbox">\n          <iron-icon icon="content-cut"></iron-icon>\n\t  {=menu_edit_recording=}\n        </paper-item>\n        <div class="x-dropdown-header mobile-hide"></div>\n        <paper-item id="menu-undo"  disabled>\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n\t  <span>{=menu_undo=}</span>\n        </paper-item>\n        <paper-item id="menu-del-rec" >\n          <iron-icon icon="bs:remove"></iron-icon>\n\t  {=menu_del_rec=}\n        </paper-item>\n        <paper-item id="menu-capturer" class="chrome-only" >\n          <iron-icon icon="bs:null-placeholder"></iron-icon>\n          <span>{==menu_install_capturer==}</span>\n        </paper-item>\n        \x3c!-- <paper-item id="menu-install-capturer" class="chrome-only" >\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n        {==menu_install_capturer==}\n        </paper-item>\n        <paper-item id="menu-uninstall-capturer" class="chrome-only"  style="display: none;" >\n        <iron-icon icon="bs:null-placeholder"></iron-icon>\n        {==menu_uninstall_capturer==}\n        </paper-item> --\x3e\n      </paper-listbox>\n    </x-dropdown-button>\n  </div>\n</neon-animated-pages>\n'},function(e,t){e.exports='<div id="art-name-bar" class="layout horizontal center" style="position:relative;height: 62px;">\n  <div style="width: 100%">\n    <a id="note-title" class="x-btn" style="color: black" role="button" tabindex="0">\n    </a>\n    <input id="input-note-title" hidden>\n    </input>\n  </div>\n</div>\n'},function(e,t){e.exports='<paper-drawer-panel id="main-menu-drawer" disable-swipe responsive-width="99999px"" >\n  <paper-header-panel slot="drawer" mode="seamed">\n    <div class="drawer-header layout vertical center center-justified" style="height:150px">\n      <iron-icon src="MN_72.png" style="width:72px;height:72px"></iron-icon>\n      <div style="font-size: 30px;font-weight: bold;color: white;">{=common_app_name=}</div>\n      \x3c!-- <img src="img/xSmallHeader.png" width="100%" height="100%"> --\x3e\n    </div>\n    <div>\n      <div id="main-menu" style="height:100%;font-size:16px" layout vertical end-justified aria-label="Drawer" tabindex="-1">\n        <paper-listbox attr-for-selected="id" class="main-menu" >\n          \x3c!-- <li> --\x3e\n          \x3c!-- \t<a id="rate-me" href="{=void=}" class=""  title="Rate me"> --\x3e\n          \x3c!-- \t\t<span class=""> --\x3e\n          \x3c!-- \t\t\t<i class="glyphicon glyphicon-heart text-success"></i> --\x3e\n          \x3c!-- \t\t</span> --\x3e\n          \x3c!-- \t\tRate --\x3e\n          \x3c!-- \t</a> --\x3e\n          \x3c!-- </li> --\x3e\n          <div class="x-dropdown-header">{=menu_import_micnote=}</div>\n          <paper-item class="mobile-hide" id="import-disk"  title="" tabindex="-1">\n            <iron-icon icon-removed="bs:hdd"></iron-icon>\n            {=menu_import_local_disk=}\n          </paper-item>\n          <paper-item id="import-link" icon-removed="bs:link" title="" tabindex="-1">\n            {=menu_import_link=}\n          </paper-item>\n          <paper-item id="import-gdrive"  title="" tabindex="-1">\n            \x3c!-- <iron-icon icon-removed="moon:gdrive"></iron-icon> --\x3e\n            {=google_drive=}\n          </paper-item>\n          <paper-item id="import-dropbox" title="" tabindex="-1">\n            \x3c!-- <iron-icon icon-removed="moon:dropbox"></iron-icon> --\x3e\n            {=dropbox=}\n          </paper-item>\n          <div class="x-dropdown-header">{=menu_else=}</div>\n          <paper-item id="menu-settings"  title="{=home_settings=}" tabindex="-1">\n            \x3c!-- <iron-icon icon-removed="bs:cog"></iron-icon> --\x3e\n            {=home_settings=}\n          </paper-item>\n          <paper-item id="menu-trash-box"  title="{=trash_folder_tip=}">\n            {=menu_trash_box=}\n          </paper-item>\n          <paper-item id="menu-about" title="{=home_about=}" tabindex="-1">\n            \x3c!-- <iron-icon icon-removed="bs:list-alt"></iron-icon> --\x3e\n            {=home_about=}\n          </paper-item>\n          \x3c!-- <li class="divider"></li> --\x3e\n          <paper-item id="menu-feedback"  class=""  title="" tabindex="-1">\n            \x3c!-- <iron-icon icon-removed="bs:leaf"></iron-icon> --\x3e\n            {=home_feedback=}\n          </paper-item>\n          <paper-item id="menu-upgrade-to-pro" class="cn-hide pro-hide" style="color:goldenrod" tabindex="-1">\n            {=menu_upgrade_to_pro=}\n          </paper-item>\n          <paper-item id="menu-account-name" class="cn-hide small" style="color:gray;display:none" tabindex="-1">\n            <span id="menu-signin-show-name" class="long-text" style="max-width: calc(100% - 40px);">\n              {=menu_unregisted=}\n            </span>\n            <span class="text-account-type free-hide pro-label" style="margin-left: 4px">XXX</span>\n          </paper-item>\n          <paper-item class="cn-hide" id="menu-signin" style="color: #31708f;" tabindex="-1">\n            {=menu_sign_in=} (<iron-icon icon="moon:google"></iron-icon>)\n          </paper-item>\n          <paper-item id="menu-update-app" class="mobile-only text-warning" style="display:none;">\n            {=menu_update_app=}\n          </paper-item>\n          <paper-item class="android-only" id="menu-exit" tabindex="-1">\n            {=menu_exit=}\n          </paper-item>\n          \x3c!-- <li class="ar-discard"> --\x3e\n          \x3c!-- \t<a id="btn_account" href="{=void=}" class=""  title=""> --\x3e\n          \x3c!-- \t\t<i class="glyphicon glyphicon-user"></i> --\x3e\n          \x3c!-- \t\t{=home_account=} --\x3e\n          \x3c!-- \t</a> --\x3e\n          \x3c!-- </li> --\x3e\n        </paper-listbox>\n      </div>\n    </div>\n  </paper-header-panel>\n  <div slot="main">\n    <x-slider id="main-slider" selected="note-list" attr-for-selected="name">\n      <div class="slide-panel" name="note-list">\n        <div id="note-list-pos"></div>\n      </div>\n      <div class="slide-panel" name="home">\n        <div id="home-pos"></div>\n      </div>\n    </x-slider>\n  </div>\n</paper-drawer-panel>\n'},function(e,t){jQuery.fn.highlight=function(e){function t(e,i){var o=0;if(3==e.nodeType){var r=e.data.toUpperCase().indexOf(i);if(r>=0){var a=document.createElement("span");a.className="kw-highlight";var l=e.splitText(r),s=(l.splitText(i.length),l.cloneNode(!0));a.appendChild(s),l.parentNode.replaceChild(a,l),o=1,n+=1}}else if(1==e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&!e.classList.contains("kw-highlight"))for(var c=0;c<e.childNodes.length;++c)c+=t(e.childNodes[c],i);return o}var n=0;return this.length&&e&&this.each(function(){for(var n=0;n<e.length;++n)t(this,e[n].toUpperCase())}),n},jQuery.fn.removeHighlight=function(){return this.find("span.kw-highlight").each(function(){this.parentNode.firstChild.nodeName,this.parentNodereplaceChild(this.firstChild,this),this.parentNodenormalize()}).end()}},function(e,t){if(void 0===n||!n)var n={};n.apps=n.apps||{},function(){function e(e,t,n,i){i=i||e;var o;e&&(e.addEventListener?(o=function(e){n.call(i,e)},e.addEventListener(t,o,!1)):e.attachEvent&&(o=function(){var e=window.event;e.target=e.target||e.srcElement,e.preventDefault=function(){window.event.returnValue=!1},n.call(i,e)},e.attachEvent("on"+t,o))),l.push([e,t,n,o])}function t(e,t,n){var i,o,r;for(r=0;r<l.length;r++)(o=l[r])[0]==e&&o[1]==t&&o[2]==n&&(i=o[3])&&(e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i))}function i(e){do{e=e.parentNode}while(e&&1!=e.nodeType);return e}function o(e){do{e=e.previousSibling}while(e&&1!=e.nodeType);return e}function r(e){return e.width>1||e.height>1}var a={trigger:null,expType:null,sole:"true",stage:null,port:null};n.apps.DGFlow=function(e){var t=this;return t.UI={},t.miniWin={},t._init(e),{setTrigger:function(e){t._setTrigger(e)},startFlow:function(e){var n=t._render();n.location?n.location=e:n.src=e},closeFlow:function(){t._destroy()},isOpen:function(){return t.dgWindow?"incontext"==t.dgWindow?t.isOpen:"object"==typeof t.dgWindow&&!t.dgWindow.closed:t.isOpen}}},n.apps.DGFlow.prototype={name:"PPDGFrame",isOpen:!1,NoB:!0,dgWindow:"incontext",RMC:!1,_init:function(e){if(e)for(var t in a)void 0!==e[t]?this[t]=e[t]:this[t]=a[t];if(this.port=null==this.port?"":":"+this.port,this.stage=null==this.stage?"www.paypal.com":"www."+this.stage+".paypal.com"+this.port,this.trigger&&this._setTrigger(this.trigger),this._addCSS(),1==this.NoB&&"true"==this.sole){var n="https://"+this.stage+"/webapps/checkout/nameOnButton.gif";this._getImage(n,this._addImage)}},_launchMiniWin:function(){return void 0!=this.miniWin.state?this.miniWin.twin.closed?(this.miniWin={},this._openMiniBrowser()):(this.miniWin.twin.focus(),this.miniWin):this._openMiniBrowser()},_launchMask:function(){this._createMask(),this._centerLightbox(),this._bindEvents()},_render:function(){var e;if(navigator.userAgent.match(/iPhone|iPod|iPad|Android|Blackberry.*WebKit/i))return e=window.open("",this.name),this.dgWindow=e,e;switch(this.expType){case"mini":this._buildDOMMB(),this._launchMask();case"popup":return this._launchMiniWin();case"instant":if(!this.RMC)return this._buildDOMMB(),this._launchMask(),this._launchMiniWin();default:return this._buildDOM(),this._launchMask(),this.isOpen=!0,this.UI.iframe}},_openMiniBrowser:function(){var t,n,i,o=!1;window.outerWidth?(t=Math.round((window.outerWidth-420)/2)+window.screenX,n=Math.round((window.outerHeight-560)/2)+window.screenY):window.screen.width&&(t=Math.round((window.screen.width-420)/2),n=Math.round((window.screen.height-560)/2)),i=window.open("about:blank",this.name,"top="+n+", left="+t+", width=420, height=560, location=1, status=1, toolbar=0, menubar=0, resizable=0, scrollbars=1");try{i.document.write("<style>#myDiv{position:absolute; left:36%; top:27%; font-style:italic; font-weight:bold; font-family:arial,Helvetica,sans-serif; font-size:75%; color:#084482; }</style><body><div id=\"myDiv\">LOADING <span id=\"mySpan\"> </span></div></body><script>var sspan = document.getElementById('mySpan');var int = setInterval(function() { if ((sspan.innerHTML += '.').length == 4)  sspan.innerHTML = '';}  , 200);<\/script>")}catch(e){}if(this.miniWin.state=!1,this.dgWindow=i,o=!0,"instant"==this.expType||"mini"==this.expType){var r=this;o&&(intVal=setInterval(function(){if(i&&i.closed)return clearInterval(intVal),o=!1,r._destroy()},1e3)),e(this.UI.goBtn,"click",this._launchMiniWin,this),e(this.UI.closer,"click",this._destroy,this)}return this.miniWin.twin=i,i},_addCSS:function(){var e="",t=document.createElement("style");e+="#"+this.name+" { z-index:20002; position:absolute; top:0; left:0; }",e+="#"+this.name+" .panel { z-index:20003; position:relative; }",e+="#"+this.name+" .panel iframe { width:385px; height:550px; border:0; }",e+="#"+this.name+" .mask { z-index:20001; position:absolute; top:0; left:0; background-color:#000; opacity:0.2; filter:alpha(opacity=20); }",e+=".nameOnButton { display: inline-block; text-align: center; }",e+=".nameOnButton img { border:none; }",("instant"==this.expType&&!this.RMC||"mini"==this.expType)&&(e+="#"+this.name+" .panel { font:12px Arial,Helvetica,sans-serif;}",e+="#"+this.name+' .panel .outer { position:relative; border:0;background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll left top transparent; }',e+="#"+this.name+' .panel .page #goBtn { border:1px solid #d5bd98; border-right-color:#935e0d; border-bottom-color:#935e0d; background:#ffa822 url("https://www.paypalobjects.com/en_US/i/pui/core/btn_bg_sprite.gif") left 17.5% repeat-x; cursor:pointer; font:12px Arial,Helvetica,sans-serif; margin-top:10px;}',e+="#"+this.name+" .panel .page #goBtn span {margin:5px;}",e+="#"+this.name+' .panel .outer .page { background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll right top transparent; margin-left:  15px; padding: 10px 10px 0 0; position:relative; min-height: 290px; left:17px; }',e+="#"+this.name+" .panel .outer .page .launcher { padding:0 0 20px 0; width:315px!important; }",e+="#"+this.name+" .panel .outer .page .launcher .logoPara { text-align:right;}",e+="#"+this.name+" .panel .outer .page .launcher .continueText { padding-right:10px;}",e+="#"+this.name+' .panel .minifooter {background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll right bottom transparent; position: absolute;  width:80%; height:12px; right:0px}',e+="#"+this.name+' .panel .outer .minifootercap {background: url("https://www.paypalobjects.com/en_US/i/scr/scr_dg_sliding_door_bdr_wf.png") no-repeat scroll left bottom transparent; left: -32px; position: absolute; height: 12px; width:80%;}',e+="#"+this.name+" .panel #closer{ top:-10px; right:0; position:absolute;}",e+="#"+this.name+' .panel #closer a{margin:0; padding:0; list-style:none;  text-decoration:none; position:absolute; height:26px; display:block; width:26px; background:url("https://www.paypal.com/en_US/i/btn/btn_dg_close_sprite.png");cursor:pointer;}',e+="#"+this.name+' .panel #closer a:hover{background: url("https://www.paypal.com/en_US/i/btn/btn_dg_close_sprite.png") -26px 0;}'),t.type="text/css",t.id="dgCSS",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)},_buildDOM:function(){this.UI.wrapper=document.createElement("div"),this.UI.wrapper.id=this.name,this.UI.panel=document.createElement("div"),this.UI.panel.className="panel";try{this.UI.iframe=document.createElement('<iframe name="'+this.name+'">')}catch(e){this.UI.iframe=document.createElement("iframe"),this.UI.iframe.name=this.name}this.UI.iframe.frameBorder="0",this.UI.iframe.border="0",this.UI.iframe.scrolling="no",this.UI.iframe.allowTransparency="true",this.UI.mask=document.createElement("div"),this.UI.mask.className="mask",this.UI.panel.appendChild(this.UI.iframe),this.UI.wrapper.appendChild(this.UI.mask),this.UI.wrapper.appendChild(this.UI.panel),document.body.appendChild(this.UI.wrapper)},_buildDOMMB:function(){this.UI.wrapper=document.createElement("div"),this.UI.wrapper.id=this.name,this.UI.panel=document.createElement("div"),this.UI.panel.className="panel",this.UI.mask=document.createElement("div"),this.UI.mask.className="mask",this.UI.outer=document.createElement("div"),this.UI.outer.className="outer",this.UI.page=document.createElement("div"),this.UI.page.className="page",this.UI.closer=document.createElement("div"),this.UI.closer.id="closer",this.UI.closerImg=document.createElement("a"),this.UI.closerImg.src="#",this.UI.launcher=document.createElement("div"),this.UI.launcher.className="launcher",this.UI.loadingPara=document.createElement("p"),this.UI.loadingPara.className="continueText",this.UI.loadingText=document.createTextNode("Please continue your purchase in the secure window we opened. If you don't see it, click the button below."),this.UI.goBtn=document.createElement("button"),this.UI.goBtn.id="goBtn",this.UI.goBtn.value="Go",this.UI.goBtn.innerHTML="<span>Go</span>",this.UI.goBtn.className="button primary",this.UI.logoPara=document.createElement("p"),this.UI.logoPara.className="logoPara",this.UI.logoImg=document.createElement("img"),this.UI.logoImg.alt="logo",this.UI.logoImg.src="https://www.paypal.com/en_US/i/logo/logo_paypal_140wx50h.gif",this.UI.logoImg.className="logo",this.UI.minifooter=document.createElement("div"),this.UI.minifooter.className="minifooter",this.UI.minifooter.id="minifooter",this.UI.minifootercap=document.createElement("div"),this.UI.minifootercap.className="minifootercap",this.UI.minifootercap.id="minifootercap",this.UI.wrapper.appendChild(this.UI.mask),this.UI.wrapper.appendChild(this.UI.panel),document.body.appendChild(this.UI.wrapper),this.UI.panel.appendChild(this.UI.outer),this.UI.outer.appendChild(this.UI.page),this.UI.page.appendChild(this.UI.launcher),this.UI.outer.appendChild(this.UI.closer),this.UI.closer.appendChild(this.UI.closerImg),this.UI.launcher.appendChild(this.UI.logoPara),this.UI.logoPara.appendChild(this.UI.logoImg),this.UI.loadingPara.appendChild(this.UI.loadingText),this.UI.launcher.appendChild(this.UI.loadingPara),this.UI.launcher.appendChild(this.UI.goBtn),this.UI.page.appendChild(this.UI.minifooter),this.UI.page.appendChild(this.UI.minifootercap)},_createMask:function(e){var t,n,i,o,r,a,l=document.documentElement?document.documentElement.clientWidth:window.innerWidth;window.innerHeight&&window.scrollMaxY?(i=l+window.scrollMaxX,o=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(i=document.body.scrollWidth,o=document.body.scrollHeight):(i=document.body.offsetWidth,o=document.body.offsetHeight),window.innerHeight?(t=l,n=window.innerHeight):document.documentElement&&document.documentElement.clientHeight?(t=document.documentElement.clientWidth,n=document.documentElement.clientHeight):document.body&&(t=document.body.clientWidth,n=document.body.clientHeight),r=t>i?t:i,a=n>o?n:o,this.UI.mask.style.width=r+"px",this.UI.mask.style.height=a+"px"},_centerLightbox:function(e){var t,n,i;if(window.innerWidth?(t=window.innerWidth,n=window.innerHeight,i=window.pageYOffset):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(t=document.documentElement.clientWidth,n=document.documentElement.clientHeight,i=document.documentElement.scrollTop):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(t=document.body.clientWidth,n=document.body.clientHeight,i=document.body.scrollTop),"instant"==this.expType&&!this.RMC||"mini"==this.expType){this.UI.launcher.style.width="355px",this.UI.launcher.style.height="300px",this.UI.panel.style.left=Math.round((t-355)/2)+"px";o=Math.round((n-550)/2)+i+20}else{this.UI.panel.style.left=Math.round((t-this.UI.iframe.offsetWidth)/2)+"px";var o=Math.round((n-this.UI.iframe.offsetHeight)/2)+i}o<5&&(o=10),this.UI.panel.style.top=o+"px"},_bindEvents:function(){e(window,"resize",this._createMask,this),e(window,"resize",this._centerLightbox,this),e(window,"unload",this._destroy,this)},_setTrigger:function(t){if(t.constructor.toString().indexOf("Array")>-1)for(var n=0;n<t.length;n++)this._setTrigger(t[n]);else(t="string"==typeof t?document.getElementById(t):t)&&t.form?t.form.target=this.name:t&&"a"==t.tagName.toLowerCase()&&(t.target=this.name),e(t,"click",this._triggerClickEvent,this)},_getImage:function(e,t){void 0!==this.callback&&(e=this.url,t=this.callback);var n=this,i=new Image;i.src="",i.readyState?i.onreadystatechange=function(){"complete"!=i.readyState&&"loaded"!=i.readyState||t(i,n)}:i.onload=function(){t(i,n)},i.src=e},_addImage:function(e,t){if(r(e)){t.RMC=!0;var n="https://"+t.stage+"/webapps/checkout/clearNob.gif",i={};i.callback=t._removeImage,i.url=n,i.outer=t;var o=t.trigger;if(null!=o)if(o.constructor.toString().indexOf("Array")>-1)for(var a=0;a<o.length;a++){var l=e.cloneNode(!0);t._placeImage(o[a],l,i)}else t._placeImage(o,e,i)}},_placeImage:function(t,n,o){var r=i(t="string"==typeof t?document.getElementById(t):t),a=document.createElement("span");a.className="nameOnButton";var l=document.createElement("br"),s=document.createElement("a");s.href="javascript:",s.appendChild(n),r.insertBefore(a,t),a.appendChild(t),a.insertBefore(s,t),a.insertBefore(l,t),o.span=a,o.link=s,o.lbreak=l,e(s,"click",o.outer._getImage,o)},_removeImage:function(e,t){r(e)||(t.outer.trigger.constructor.toString().indexOf("Array")>-1?t.outer._removeMultiImages(t.outer.trigger):(spanElement=t.span,link=t.link,lineBreak=t.lbreak,spanElement.removeChild(link),spanElement.removeChild(lineBreak)))},_removeMultiImages:function(e){for(var t=0;t<e.length;t++)e[t]="string"==typeof e[t]?document.getElementById(e[t]):e[t],rootNode=i(e[t]),"nameOnButton"==rootNode.className&&(lineBreak=o(e[t]),linkNode=o(lineBreak),rootNode.removeChild(linkNode),rootNode.removeChild(lineBreak))},_triggerClickEvent:function(e){this._render()},_destroy:function(e){if("object"==typeof this.dgWindow)try{this.dgWindow.close()}catch(e){}document.getElementById("PPDGFrame")&&document.getElementById("PPDGFrame").parentNode.removeChild(document.getElementById("PPDGFrame")),this.isOpen&&this.UI.wrapper.parentNode&&this.UI.wrapper.parentNode.removeChild(this.UI.wrapper),this.interval&&clearInterval(this.interval),t(window,"resize",this._createMask),t(window,"resize",this._centerLightbox),t(window,"unload",this._destroy),t(window,"message",this._windowMessageEvent),this.isOpen=!1}};var l=[]}()}]));
//# sourceMappingURL=3.bundle.js.map